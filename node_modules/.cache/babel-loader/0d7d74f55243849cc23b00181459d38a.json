{"remainingRequest":"F:\\vscode\\gocode\\cloudMusic\\node_modules\\babel-loader\\lib\\index.js!F:\\vscode\\gocode\\cloudMusic\\src\\assets\\mui\\js\\mui.js","dependencies":[{"path":"F:\\vscode\\gocode\\cloudMusic\\src\\assets\\mui\\js\\mui.js","mtime":1605347186000},{"path":"F:\\vscode\\gocode\\cloudMusic\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\vscode\\gocode\\cloudMusic\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmV2ZXJ5Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LXByb3RvdHlwZS1vZiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuY29uc3RydWN0b3IiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcubWF0Y2giKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwZWF0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcudHJpbSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giKTsKCnZhciBfdHlwZW9mID0gcmVxdWlyZSgiRjovdnNjb2RlL2dvY29kZS9jbG91ZE11c2ljL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL3R5cGVvZiIpOwoKLyohCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIE11aSB2My43LjMgKGh0dHA6Ly9kZXYuZGNsb3VkLm5ldC5jbi9tdWkpCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqLwoKLyoqCiAqIE1VSeaguOW/g0pTCiAqIEB0eXBlIF9MNC4kfEZ1bmN0aW9uCiAqLwp2YXIgbXVpID0gZnVuY3Rpb24gKGRvY3VtZW50LCB1bmRlZmluZWQpIHsKICB2YXIgcmVhZHlSRSA9IC9jb21wbGV0ZXxsb2FkZWR8aW50ZXJhY3RpdmUvOwogIHZhciBpZFNlbGVjdG9yUkUgPSAvXiMoW1x3LV0rKSQvOwogIHZhciBjbGFzc1NlbGVjdG9yUkUgPSAvXlwuKFtcdy1dKykkLzsKICB2YXIgdGFnU2VsZWN0b3JSRSA9IC9eW1x3LV0rJC87CiAgdmFyIHRyYW5zbGF0ZVJFID0gL3RyYW5zbGF0ZSg/OjNkKT9cKCguKz8pXCkvOwogIHZhciB0cmFuc2xhdGVNYXRyaXhSRSA9IC9tYXRyaXgoM2QpP1woKC4rPylcKS87CgogIHZhciAkID0gZnVuY3Rpb24gJChzZWxlY3RvciwgY29udGV4dCkgewogICAgY29udGV4dCA9IGNvbnRleHQgfHwgZG9jdW1lbnQ7CiAgICBpZiAoIXNlbGVjdG9yKSByZXR1cm4gd3JhcCgpOwogICAgaWYgKF90eXBlb2Yoc2VsZWN0b3IpID09PSAnb2JqZWN0JykgaWYgKCQuaXNBcnJheUxpa2Uoc2VsZWN0b3IpKSB7CiAgICAgIHJldHVybiB3cmFwKCQuc2xpY2UuY2FsbChzZWxlY3RvciksIG51bGwpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHdyYXAoW3NlbGVjdG9yXSwgbnVsbCk7CiAgICB9CiAgICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnZnVuY3Rpb24nKSByZXR1cm4gJC5yZWFkeShzZWxlY3Rvcik7CgogICAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gJ3N0cmluZycpIHsKICAgICAgdHJ5IHsKICAgICAgICBzZWxlY3RvciA9IHNlbGVjdG9yLnRyaW0oKTsKCiAgICAgICAgaWYgKGlkU2VsZWN0b3JSRS50ZXN0KHNlbGVjdG9yKSkgewogICAgICAgICAgdmFyIGZvdW5kID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUmVnRXhwLiQxKTsKICAgICAgICAgIHJldHVybiB3cmFwKGZvdW5kID8gW2ZvdW5kXSA6IFtdKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB3cmFwKCQucXNhKHNlbGVjdG9yLCBjb250ZXh0KSwgc2VsZWN0b3IpOwogICAgICB9IGNhdGNoIChlKSB7fQogICAgfQoKICAgIHJldHVybiB3cmFwKCk7CiAgfTsKCiAgdmFyIHdyYXAgPSBmdW5jdGlvbiB3cmFwKGRvbSwgc2VsZWN0b3IpIHsKICAgIGRvbSA9IGRvbSB8fCBbXTsKICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihkb20sICQuZm4pOwogICAgZG9tLnNlbGVjdG9yID0gc2VsZWN0b3IgfHwgJyc7CiAgICByZXR1cm4gZG9tOwogIH07CgogICQudXVpZCA9IDA7CiAgJC5kYXRhID0ge307CiAgLyoqCiAgICogZXh0ZW5kKHNpbXBsZSkKICAgKiBAcGFyYW0ge3R5cGV9IHRhcmdldAogICAqIEBwYXJhbSB7dHlwZX0gc291cmNlCiAgICogQHBhcmFtIHt0eXBlfSBkZWVwCiAgICogQHJldHVybnMge3VucmVzb2x2ZWR9CiAgICovCgogICQuZXh0ZW5kID0gZnVuY3Rpb24gKCkgewogICAgLy9mcm9tIGpxdWVyeTIKICAgIHZhciBvcHRpb25zLAogICAgICAgIG5hbWUsCiAgICAgICAgc3JjLAogICAgICAgIGNvcHksCiAgICAgICAgY29weUlzQXJyYXksCiAgICAgICAgY2xvbmUsCiAgICAgICAgdGFyZ2V0ID0gYXJndW1lbnRzWzBdIHx8IHt9LAogICAgICAgIGkgPSAxLAogICAgICAgIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGgsCiAgICAgICAgZGVlcCA9IGZhbHNlOwoKICAgIGlmICh0eXBlb2YgdGFyZ2V0ID09PSAiYm9vbGVhbiIpIHsKICAgICAgZGVlcCA9IHRhcmdldDsKICAgICAgdGFyZ2V0ID0gYXJndW1lbnRzW2ldIHx8IHt9OwogICAgICBpKys7CiAgICB9CgogICAgaWYgKF90eXBlb2YodGFyZ2V0KSAhPT0gIm9iamVjdCIgJiYgISQuaXNGdW5jdGlvbih0YXJnZXQpKSB7CiAgICAgIHRhcmdldCA9IHt9OwogICAgfQoKICAgIGlmIChpID09PSBsZW5ndGgpIHsKICAgICAgdGFyZ2V0ID0gdGhpczsKICAgICAgaS0tOwogICAgfQoKICAgIGZvciAoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKChvcHRpb25zID0gYXJndW1lbnRzW2ldKSAhPSBudWxsKSB7CiAgICAgICAgZm9yIChuYW1lIGluIG9wdGlvbnMpIHsKICAgICAgICAgIHNyYyA9IHRhcmdldFtuYW1lXTsKICAgICAgICAgIGNvcHkgPSBvcHRpb25zW25hbWVdOwoKICAgICAgICAgIGlmICh0YXJnZXQgPT09IGNvcHkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGRlZXAgJiYgY29weSAmJiAoJC5pc1BsYWluT2JqZWN0KGNvcHkpIHx8IChjb3B5SXNBcnJheSA9ICQuaXNBcnJheShjb3B5KSkpKSB7CiAgICAgICAgICAgIGlmIChjb3B5SXNBcnJheSkgewogICAgICAgICAgICAgIGNvcHlJc0FycmF5ID0gZmFsc2U7CiAgICAgICAgICAgICAgY2xvbmUgPSBzcmMgJiYgJC5pc0FycmF5KHNyYykgPyBzcmMgOiBbXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjbG9uZSA9IHNyYyAmJiAkLmlzUGxhaW5PYmplY3Qoc3JjKSA/IHNyYyA6IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB0YXJnZXRbbmFtZV0gPSAkLmV4dGVuZChkZWVwLCBjbG9uZSwgY29weSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGNvcHkgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0YXJnZXRbbmFtZV0gPSBjb3B5OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiB0YXJnZXQ7CiAgfTsKICAvKioKICAgKiBtdWkgbm9vcChmdW5jdGlvbikKICAgKi8KCgogICQubm9vcCA9IGZ1bmN0aW9uICgpIHt9OwogIC8qKgogICAqIG11aSBzbGljZShhcnJheSkKICAgKi8KCgogICQuc2xpY2UgPSBbXS5zbGljZTsKICAvKioKICAgKiBtdWkgZmlsdGVyKGFycmF5KQogICAqLwoKICAkLmZpbHRlciA9IFtdLmZpbHRlcjsKCiAgJC50eXBlID0gZnVuY3Rpb24gKG9iaikgewogICAgcmV0dXJuIG9iaiA9PSBudWxsID8gU3RyaW5nKG9iaikgOiBjbGFzczJ0eXBlW3t9LnRvU3RyaW5nLmNhbGwob2JqKV0gfHwgIm9iamVjdCI7CiAgfTsKICAvKioKICAgKiBtdWkgaXNBcnJheQogICAqLwoKCiAgJC5pc0FycmF5ID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiAob2JqZWN0KSB7CiAgICByZXR1cm4gb2JqZWN0IGluc3RhbmNlb2YgQXJyYXk7CiAgfTsKICAvKioKICAgKiBtdWkgaXNBcnJheUxpa2UgCiAgICogQHBhcmFtIHtPYmplY3R9IG9iagogICAqLwoKCiAgJC5pc0FycmF5TGlrZSA9IGZ1bmN0aW9uIChvYmopIHsKICAgIHZhciBsZW5ndGggPSAhIW9iaiAmJiAibGVuZ3RoIiBpbiBvYmogJiYgb2JqLmxlbmd0aDsKICAgIHZhciB0eXBlID0gJC50eXBlKG9iaik7CgogICAgaWYgKHR5cGUgPT09ICJmdW5jdGlvbiIgfHwgJC5pc1dpbmRvdyhvYmopKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdHlwZSA9PT0gImFycmF5IiB8fCBsZW5ndGggPT09IDAgfHwgdHlwZW9mIGxlbmd0aCA9PT0gIm51bWJlciIgJiYgbGVuZ3RoID4gMCAmJiBsZW5ndGggLSAxIGluIG9iajsKICB9OwogIC8qKgogICAqIG11aSBpc1dpbmRvdyjpnIDogIPomZFvYmrkuLp1bmRlZmluZWTnmoTmg4XlhrUpCiAgICovCgoKICAkLmlzV2luZG93ID0gZnVuY3Rpb24gKG9iaikgewogICAgcmV0dXJuIG9iaiAhPSBudWxsICYmIG9iaiA9PT0gb2JqLndpbmRvdzsKICB9OwogIC8qKgogICAqIG11aSBpc09iamVjdAogICAqLwoKCiAgJC5pc09iamVjdCA9IGZ1bmN0aW9uIChvYmopIHsKICAgIHJldHVybiAkLnR5cGUob2JqKSA9PT0gIm9iamVjdCI7CiAgfTsKICAvKioKICAgKiBtdWkgaXNQbGFpbk9iamVjdAogICAqLwoKCiAgJC5pc1BsYWluT2JqZWN0ID0gZnVuY3Rpb24gKG9iaikgewogICAgcmV0dXJuICQuaXNPYmplY3Qob2JqKSAmJiAhJC5pc1dpbmRvdyhvYmopICYmIE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmopID09PSBPYmplY3QucHJvdG90eXBlOwogIH07CiAgLyoqCiAgICogbXVpIGlzRW1wdHlPYmplY3QKICAgKiBAcGFyYW0ge09iamVjdH0gbwogICAqLwoKCiAgJC5pc0VtcHR5T2JqZWN0ID0gZnVuY3Rpb24gKG8pIHsKICAgIGZvciAodmFyIHAgaW4gbykgewogICAgICBpZiAocCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfTsKICAvKioKICAgKiBtdWkgaXNGdW5jdGlvbgogICAqLwoKCiAgJC5pc0Z1bmN0aW9uID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICByZXR1cm4gJC50eXBlKHZhbHVlKSA9PT0gImZ1bmN0aW9uIjsKICB9OwogIC8qKgogICAqIG11aSBxdWVyeVNlbGVjdG9yQWxsCiAgICogQHBhcmFtIHt0eXBlfSBzZWxlY3RvcgogICAqIEBwYXJhbSB7dHlwZX0gY29udGV4dAogICAqIEByZXR1cm5zIHtBcnJheX0KICAgKi8KCgogICQucXNhID0gZnVuY3Rpb24gKHNlbGVjdG9yLCBjb250ZXh0KSB7CiAgICBjb250ZXh0ID0gY29udGV4dCB8fCBkb2N1bWVudDsKICAgIHJldHVybiAkLnNsaWNlLmNhbGwoY2xhc3NTZWxlY3RvclJFLnRlc3Qoc2VsZWN0b3IpID8gY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFJlZ0V4cC4kMSkgOiB0YWdTZWxlY3RvclJFLnRlc3Qoc2VsZWN0b3IpID8gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZShzZWxlY3RvcikgOiBjb250ZXh0LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpKTsKICB9OwogIC8qKgogICAqIHJlYWR5KERPTUNvbnRlbnRMb2FkZWQpCiAgICogQHBhcmFtIHt0eXBlfSBjYWxsYmFjawogICAqIEByZXR1cm5zIHtfTDYuJH0KICAgKi8KCgogICQucmVhZHkgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgIGlmIChyZWFkeVJFLnRlc3QoZG9jdW1lbnQucmVhZHlTdGF0ZSkpIHsKICAgICAgY2FsbGJhY2soJCk7CiAgICB9IGVsc2UgewogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZnVuY3Rpb24gKCkgewogICAgICAgIGNhbGxiYWNrKCQpOwogICAgICB9LCBmYWxzZSk7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfTsKICAvKioKICAgKiDlsIYgZm4g57yT5a2Y5LiA5q615pe26Ze05ZCOLCDlho3ooqvosIPnlKjmiafooYwKICAgKiDmraTmlrnms5XkuLrkuobpgb/lhY3lnKggbXMg5q615pe26Ze05YaFLCDmiafooYwgZm4g5aSa5qyhLiDluLjnlKjkuo4gcmVzaXplICwgc2Nyb2xsICwgbW91c2Vtb3ZlIOetiei/nue7reaAp+S6i+S7tuS4rTsKICAgKiDlvZMgbXMg6K6+572u5Li6IC0xLCDooajnpLrnq4vljbPmiafooYwgZm4sIOWNs+WSjOebtOaOpeiwg+eUqCBmbiDkuIDmoLc7CiAgICog6LCD55So6L+U5Zue5Ye95pWw55qEIHN0b3Ag5YGc5q2i5pyA5ZCO5LiA5qyh55qEIGJ1ZmZlciDmlYjmnpwKICAgKiBAcGFyYW0ge09iamVjdH0gZm4KICAgKiBAcGFyYW0ge09iamVjdH0gbXMKICAgKiBAcGFyYW0ge09iamVjdH0gY29udGV4dAogICAqLwoKCiAgJC5idWZmZXIgPSBmdW5jdGlvbiAoZm4sIG1zLCBjb250ZXh0KSB7CiAgICB2YXIgdGltZXI7CiAgICB2YXIgbGFzdFN0YXJ0ID0gMDsKICAgIHZhciBsYXN0RW5kID0gMDsKICAgIHZhciBtcyA9IG1zIHx8IDE1MDsKCiAgICBmdW5jdGlvbiBydW4oKSB7CiAgICAgIGlmICh0aW1lcikgewogICAgICAgIHRpbWVyLmNhbmNlbCgpOwogICAgICAgIHRpbWVyID0gMDsKICAgICAgfQoKICAgICAgbGFzdFN0YXJ0ID0gJC5ub3coKTsKICAgICAgZm4uYXBwbHkoY29udGV4dCB8fCB0aGlzLCBhcmd1bWVudHMpOwogICAgICBsYXN0RW5kID0gJC5ub3coKTsKICAgIH0KCiAgICByZXR1cm4gJC5leHRlbmQoZnVuY3Rpb24gKCkgewogICAgICBpZiAoIWxhc3RTdGFydCB8fCAvLyDku47mnKrov5DooYzov4cKICAgICAgbGFzdEVuZCA+PSBsYXN0U3RhcnQgJiYgJC5ub3coKSAtIGxhc3RFbmQgPiBtcyB8fCAvLyDkuIrmrKHov5DooYzmiJDlip/lkI7lt7Lnu4/otoXov4dtc+avq+enkgogICAgICBsYXN0RW5kIDwgbGFzdFN0YXJ0ICYmICQubm93KCkgLSBsYXN0U3RhcnQgPiBtcyAqIDggLy8g5LiK5qyh6L+Q6KGM5oiW5pyq5a6M5oiQ77yM5ZCOOCptc+avq+enkgogICAgICApIHsKICAgICAgICAgIHJ1bi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRpbWVyKSB7CiAgICAgICAgICB0aW1lci5jYW5jZWwoKTsKICAgICAgICB9CgogICAgICAgIHRpbWVyID0gJC5sYXRlcihydW4sIG1zLCBudWxsLCAkLnNsaWNlLmNhbGwoYXJndW1lbnRzKSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHsKICAgICAgICBpZiAodGltZXIpIHsKICAgICAgICAgIHRpbWVyLmNhbmNlbCgpOwogICAgICAgICAgdGltZXIgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfTsKICAvKioKICAgKiBlYWNoCiAgICogQHBhcmFtIHt0eXBlfSBlbGVtZW50cwogICAqIEBwYXJhbSB7dHlwZX0gY2FsbGJhY2sKICAgKiBAcmV0dXJucyB7X0w4LiR9CiAgICovCgoKICAkLmVhY2ggPSBmdW5jdGlvbiAoZWxlbWVudHMsIGNhbGxiYWNrLCBoYXNPd25Qcm9wZXJ0eSkgewogICAgaWYgKCFlbGVtZW50cykgewogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBpZiAodHlwZW9mIGVsZW1lbnRzLmxlbmd0aCA9PT0gJ251bWJlcicpIHsKICAgICAgW10uZXZlcnkuY2FsbChlbGVtZW50cywgZnVuY3Rpb24gKGVsLCBpZHgpIHsKICAgICAgICByZXR1cm4gY2FsbGJhY2suY2FsbChlbCwgaWR4LCBlbCkgIT09IGZhbHNlOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBlbGVtZW50cykgewogICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eSkgewogICAgICAgICAgaWYgKGVsZW1lbnRzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrLmNhbGwoZWxlbWVudHNba2V5XSwga2V5LCBlbGVtZW50c1trZXldKSA9PT0gZmFsc2UpIHJldHVybiBlbGVtZW50czsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKGNhbGxiYWNrLmNhbGwoZWxlbWVudHNba2V5XSwga2V5LCBlbGVtZW50c1trZXldKSA9PT0gZmFsc2UpIHJldHVybiBlbGVtZW50czsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9OwoKICAkLmZvY3VzID0gZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgIGlmICgkLm9zLmlvcykgewogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBlbGVtZW50LmZvY3VzKCk7CiAgICAgIH0sIDEwKTsKICAgIH0gZWxzZSB7CiAgICAgIGVsZW1lbnQuZm9jdXMoKTsKICAgIH0KICB9OwogIC8qKgogICAqIHRyaWdnZXIgZXZlbnQKICAgKiBAcGFyYW0ge3R5cGV9IGVsZW1lbnQKICAgKiBAcGFyYW0ge3R5cGV9IGV2ZW50VHlwZQogICAqIEBwYXJhbSB7dHlwZX0gZXZlbnREYXRhCiAgICogQHJldHVybnMge19MOC4kfQogICAqLwoKCiAgJC50cmlnZ2VyID0gZnVuY3Rpb24gKGVsZW1lbnQsIGV2ZW50VHlwZSwgZXZlbnREYXRhKSB7CiAgICBlbGVtZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KGV2ZW50VHlwZSwgewogICAgICBkZXRhaWw6IGV2ZW50RGF0YSwKICAgICAgYnViYmxlczogdHJ1ZSwKICAgICAgY2FuY2VsYWJsZTogdHJ1ZQogICAgfSkpOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKICAvKioKICAgKiBnZXRTdHlsZXMKICAgKiBAcGFyYW0ge3R5cGV9IGVsZW1lbnQKICAgKiBAcGFyYW0ge3R5cGV9IHByb3BlcnR5CiAgICogQHJldHVybnMge3N0eWxlc30KICAgKi8KCgogICQuZ2V0U3R5bGVzID0gZnVuY3Rpb24gKGVsZW1lbnQsIHByb3BlcnR5KSB7CiAgICB2YXIgc3R5bGVzID0gZWxlbWVudC5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCwgbnVsbCk7CgogICAgaWYgKHByb3BlcnR5KSB7CiAgICAgIHJldHVybiBzdHlsZXMuZ2V0UHJvcGVydHlWYWx1ZShwcm9wZXJ0eSkgfHwgc3R5bGVzW3Byb3BlcnR5XTsKICAgIH0KCiAgICByZXR1cm4gc3R5bGVzOwogIH07CiAgLyoqCiAgICogcGFyc2VUcmFuc2xhdGUKICAgKiBAcGFyYW0ge3R5cGV9IHRyYW5zbGF0ZVN0cmluZwogICAqIEBwYXJhbSB7dHlwZX0gcG9zaXRpb24KICAgKiBAcmV0dXJucyB7T2JqZWN0fQogICAqLwoKCiAgJC5wYXJzZVRyYW5zbGF0ZSA9IGZ1bmN0aW9uICh0cmFuc2xhdGVTdHJpbmcsIHBvc2l0aW9uKSB7CiAgICB2YXIgcmVzdWx0ID0gdHJhbnNsYXRlU3RyaW5nLm1hdGNoKHRyYW5zbGF0ZVJFIHx8ICcnKTsKCiAgICBpZiAoIXJlc3VsdCB8fCAhcmVzdWx0WzFdKSB7CiAgICAgIHJlc3VsdCA9IFsnJywgJzAsMCwwJ107CiAgICB9CgogICAgcmVzdWx0ID0gcmVzdWx0WzFdLnNwbGl0KCIsIik7CiAgICByZXN1bHQgPSB7CiAgICAgIHg6IHBhcnNlRmxvYXQocmVzdWx0WzBdKSwKICAgICAgeTogcGFyc2VGbG9hdChyZXN1bHRbMV0pLAogICAgICB6OiBwYXJzZUZsb2F0KHJlc3VsdFsyXSkKICAgIH07CgogICAgaWYgKHBvc2l0aW9uICYmIHJlc3VsdC5oYXNPd25Qcm9wZXJ0eShwb3NpdGlvbikpIHsKICAgICAgcmV0dXJuIHJlc3VsdFtwb3NpdGlvbl07CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdDsKICB9OwogIC8qKgogICAqIHBhcnNlVHJhbnNsYXRlTWF0cml4CiAgICogQHBhcmFtIHt0eXBlfSB0cmFuc2xhdGVTdHJpbmcKICAgKiBAcGFyYW0ge3R5cGV9IHBvc2l0aW9uCiAgICogQHJldHVybnMge09iamVjdH0KICAgKi8KCgogICQucGFyc2VUcmFuc2xhdGVNYXRyaXggPSBmdW5jdGlvbiAodHJhbnNsYXRlU3RyaW5nLCBwb3NpdGlvbikgewogICAgdmFyIG1hdHJpeCA9IHRyYW5zbGF0ZVN0cmluZy5tYXRjaCh0cmFuc2xhdGVNYXRyaXhSRSk7CiAgICB2YXIgaXMzRCA9IG1hdHJpeCAmJiBtYXRyaXhbMV07CgogICAgaWYgKG1hdHJpeCkgewogICAgICBtYXRyaXggPSBtYXRyaXhbMl0uc3BsaXQoIiwiKTsKICAgICAgaWYgKGlzM0QgPT09ICIzZCIpIG1hdHJpeCA9IG1hdHJpeC5zbGljZSgxMiwgMTUpO2Vsc2UgewogICAgICAgIG1hdHJpeC5wdXNoKDApOwogICAgICAgIG1hdHJpeCA9IG1hdHJpeC5zbGljZSg0LCA3KTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgbWF0cml4ID0gWzAsIDAsIDBdOwogICAgfQoKICAgIHZhciByZXN1bHQgPSB7CiAgICAgIHg6IHBhcnNlRmxvYXQobWF0cml4WzBdKSwKICAgICAgeTogcGFyc2VGbG9hdChtYXRyaXhbMV0pLAogICAgICB6OiBwYXJzZUZsb2F0KG1hdHJpeFsyXSkKICAgIH07CgogICAgaWYgKHBvc2l0aW9uICYmIHJlc3VsdC5oYXNPd25Qcm9wZXJ0eShwb3NpdGlvbikpIHsKICAgICAgcmV0dXJuIHJlc3VsdFtwb3NpdGlvbl07CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAkLmhvb2tzID0ge307CgogICQuYWRkQWN0aW9uID0gZnVuY3Rpb24gKHR5cGUsIGhvb2spIHsKICAgIHZhciBob29rcyA9ICQuaG9va3NbdHlwZV07CgogICAgaWYgKCFob29rcykgewogICAgICBob29rcyA9IFtdOwogICAgfQoKICAgIGhvb2suaW5kZXggPSBob29rLmluZGV4IHx8IDEwMDA7CiAgICBob29rcy5wdXNoKGhvb2spOwogICAgaG9va3Muc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICByZXR1cm4gYS5pbmRleCAtIGIuaW5kZXg7CiAgICB9KTsKICAgICQuaG9va3NbdHlwZV0gPSBob29rczsKICAgIHJldHVybiAkLmhvb2tzW3R5cGVdOwogIH07CgogICQuZG9BY3Rpb24gPSBmdW5jdGlvbiAodHlwZSwgY2FsbGJhY2spIHsKICAgIGlmICgkLmlzRnVuY3Rpb24oY2FsbGJhY2spKSB7CiAgICAgIC8v5oyH5a6a5LqGY2FsbGJhY2sKICAgICAgJC5lYWNoKCQuaG9va3NbdHlwZV0sIGNhbGxiYWNrKTsKICAgIH0gZWxzZSB7CiAgICAgIC8v5pyq5oyH5a6aY2FsbGJhY2vvvIznm7TmjqXmiafooYwKICAgICAgJC5lYWNoKCQuaG9va3NbdHlwZV0sIGZ1bmN0aW9uIChpbmRleCwgaG9vaykgewogICAgICAgIHJldHVybiAhaG9vay5oYW5kbGUoKTsKICAgICAgfSk7CiAgICB9CiAgfTsKICAvKioKICAgKiBzZXRUaW1lb3V05bCB6KOFCiAgICogQHBhcmFtIHtPYmplY3R9IGZuCiAgICogQHBhcmFtIHtPYmplY3R9IHdoZW4KICAgKiBAcGFyYW0ge09iamVjdH0gY29udGV4dAogICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhCiAgICovCgoKICAkLmxhdGVyID0gZnVuY3Rpb24gKGZuLCB3aGVuLCBjb250ZXh0LCBkYXRhKSB7CiAgICB3aGVuID0gd2hlbiB8fCAwOwogICAgdmFyIG0gPSBmbjsKICAgIHZhciBkID0gZGF0YTsKICAgIHZhciBmOwogICAgdmFyIHI7CgogICAgaWYgKHR5cGVvZiBmbiA9PT0gJ3N0cmluZycpIHsKICAgICAgbSA9IGNvbnRleHRbZm5dOwogICAgfQoKICAgIGYgPSBmdW5jdGlvbiBmKCkgewogICAgICBtLmFwcGx5KGNvbnRleHQsICQuaXNBcnJheShkKSA/IGQgOiBbZF0pOwogICAgfTsKCiAgICByID0gc2V0VGltZW91dChmLCB3aGVuKTsKICAgIHJldHVybiB7CiAgICAgIGlkOiByLAogICAgICBjYW5jZWw6IGZ1bmN0aW9uIGNhbmNlbCgpIHsKICAgICAgICBjbGVhclRpbWVvdXQocik7CiAgICAgIH0KICAgIH07CiAgfTsKCiAgJC5ub3cgPSBEYXRlLm5vdyB8fCBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gK25ldyBEYXRlKCk7CiAgfTsKCiAgdmFyIGNsYXNzMnR5cGUgPSB7fTsKICAkLmVhY2goWydCb29sZWFuJywgJ051bWJlcicsICdTdHJpbmcnLCAnRnVuY3Rpb24nLCAnQXJyYXknLCAnRGF0ZScsICdSZWdFeHAnLCAnT2JqZWN0JywgJ0Vycm9yJ10sIGZ1bmN0aW9uIChpLCBuYW1lKSB7CiAgICBjbGFzczJ0eXBlWyJbb2JqZWN0ICIgKyBuYW1lICsgIl0iXSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKICB9KTsKCiAgaWYgKHdpbmRvdy5KU09OKSB7CiAgICAkLnBhcnNlSlNPTiA9IEpTT04ucGFyc2U7CiAgfQogIC8qKgogICAqICQuZm4KICAgKi8KCgogICQuZm4gPSB7CiAgICBlYWNoOiBmdW5jdGlvbiBlYWNoKGNhbGxiYWNrKSB7CiAgICAgIFtdLmV2ZXJ5LmNhbGwodGhpcywgZnVuY3Rpb24gKGVsLCBpZHgpIHsKICAgICAgICByZXR1cm4gY2FsbGJhY2suY2FsbChlbCwgaWR4LCBlbCkgIT09IGZhbHNlOwogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICAvKioKICAgKiDlhbzlrrkgQU1EIOaooeWdlwogICAqKi8KCiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgZGVmaW5lKCdtdWknLCBbXSwgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gJDsKICAgIH0pOwogIH0KCiAgcmV0dXJuICQ7Cn0oZG9jdW1lbnQpOyAvL3dpbmRvdy5tdWkgPSBtdWk7Ci8vJyQnIGluIHdpbmRvdyB8fCAod2luZG93LiQgPSBtdWkpOwoKLyoqCiAqICQub3MKICogQHBhcmFtIHt0eXBlfSAkCiAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAqLwoKCihmdW5jdGlvbiAoJCwgd2luZG93KSB7CiAgZnVuY3Rpb24gZGV0ZWN0KHVhKSB7CiAgICB0aGlzLm9zID0ge307CiAgICB2YXIgZnVuY3MgPSBbZnVuY3Rpb24gKCkgewogICAgICAvL3dlY2hhdAogICAgICB2YXIgd2VjaGF0ID0gdWEubWF0Y2goLyhNaWNyb01lc3NlbmdlcilcLyhbXGRcLl0rKS9pKTsKCiAgICAgIGlmICh3ZWNoYXQpIHsKICAgICAgICAvL3dlY2hhdAogICAgICAgIHRoaXMub3Mud2VjaGF0ID0gewogICAgICAgICAgdmVyc2lvbjogd2VjaGF0WzJdLnJlcGxhY2UoL18vZywgJy4nKQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgLy9hbmRyb2lkCiAgICAgIHZhciBhbmRyb2lkID0gdWEubWF0Y2goLyhBbmRyb2lkKTs/W1xzXC9dKyhbXGQuXSspPy8pOwoKICAgICAgaWYgKGFuZHJvaWQpIHsKICAgICAgICB0aGlzLm9zLmFuZHJvaWQgPSB0cnVlOwogICAgICAgIHRoaXMub3MudmVyc2lvbiA9IGFuZHJvaWRbMl07CiAgICAgICAgdGhpcy5vcy5pc0JhZEFuZHJvaWQgPSAhL0Nocm9tZVwvXGQvLnRlc3Qod2luZG93Lm5hdmlnYXRvci5hcHBWZXJzaW9uKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMub3MuYW5kcm9pZCA9PT0gdHJ1ZTsKICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgLy9pb3MKICAgICAgdmFyIGlwaG9uZSA9IHVhLm1hdGNoKC8oaVBob25lXHNPUylccyhbXGRfXSspLyk7CgogICAgICBpZiAoaXBob25lKSB7CiAgICAgICAgLy9pcGhvbmUKICAgICAgICB0aGlzLm9zLmlvcyA9IHRoaXMub3MuaXBob25lID0gdHJ1ZTsKICAgICAgICB0aGlzLm9zLnZlcnNpb24gPSBpcGhvbmVbMl0ucmVwbGFjZSgvXy9nLCAnLicpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBpcGFkID0gdWEubWF0Y2goLyhpUGFkKS4qT1NccyhbXGRfXSspLyk7CgogICAgICAgIGlmIChpcGFkKSB7CiAgICAgICAgICAvL2lwYWQKICAgICAgICAgIHRoaXMub3MuaW9zID0gdGhpcy5vcy5pcGFkID0gdHJ1ZTsKICAgICAgICAgIHRoaXMub3MudmVyc2lvbiA9IGlwYWRbMl0ucmVwbGFjZSgvXy9nLCAnLicpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMub3MuaW9zID09PSB0cnVlOwogICAgfV07CiAgICBbXS5ldmVyeS5jYWxsKGZ1bmNzLCBmdW5jdGlvbiAoZnVuYykgewogICAgICByZXR1cm4gIWZ1bmMuY2FsbCgkKTsKICAgIH0pOwogIH0KCiAgZGV0ZWN0LmNhbGwoJCwgbmF2aWdhdG9yLnVzZXJBZ2VudCk7Cn0pKG11aSwgd2luZG93KTsKLyoqCiAqICQub3MucGx1cwogKiBAcGFyYW0ge3R5cGV9ICQKICogQHJldHVybnMge3VuZGVmaW5lZH0KICovCgoKKGZ1bmN0aW9uICgkLCBkb2N1bWVudCkgewogIGZ1bmN0aW9uIGRldGVjdCh1YSkgewogICAgdGhpcy5vcyA9IHRoaXMub3MgfHwge307CiAgICB2YXIgcGx1cyA9IHVhLm1hdGNoKC9IdG1sNVBsdXMvaSk7IC8vVE9ETyA1XCtCcm93c2VyPwoKICAgIGlmIChwbHVzKSB7CiAgICAgIHRoaXMub3MucGx1cyA9IHRydWU7CiAgICAgICQoZnVuY3Rpb24gKCkgewogICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgnbXVpLXBsdXMnKTsKICAgICAgfSk7CgogICAgICBpZiAodWEubWF0Y2goL1N0cmVhbUFwcC9pKSkgewogICAgICAgIC8vVE9ETyDmnIDlpb3mnInmtYHlupTnlKjoh6rlt7HnmoTmoIfor4YKICAgICAgICB0aGlzLm9zLnN0cmVhbSA9IHRydWU7CiAgICAgICAgJChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ211aS1wbHVzLXN0cmVhbScpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfQoKICBkZXRlY3QuY2FsbCgkLCBuYXZpZ2F0b3IudXNlckFnZW50KTsKfSkobXVpLCBkb2N1bWVudCk7Ci8qKgogKiDku4Xmj5DkvpvnroDljZXnmoRvbu+8jG9mZijku4XmlK/mjIHkuovku7blp5TmiZjvvIzkuI3mlK/mjIHlvZPliY3lhYPntKDnu5HlrprvvIzlvZPliY3lhYPntKDnu5Hlrpror7fnm7TmjqXkvb/nlKhhZGRFdmVudExpc3RlbmVyLHJlbW92ZUV2ZW50TGlzdGVuZXIpCiAqIEBwYXJhbSB7T2JqZWN0fSAkCiAqLwoKCihmdW5jdGlvbiAoJCkgewogIGlmICgnb250b3VjaHN0YXJ0JyBpbiB3aW5kb3cpIHsKICAgICQuaXNUb3VjaGFibGUgPSB0cnVlOwogICAgJC5FVkVOVF9TVEFSVCA9ICd0b3VjaHN0YXJ0JzsKICAgICQuRVZFTlRfTU9WRSA9ICd0b3VjaG1vdmUnOwogICAgJC5FVkVOVF9FTkQgPSAndG91Y2hlbmQnOwogIH0gZWxzZSB7CiAgICAkLmlzVG91Y2hhYmxlID0gZmFsc2U7CiAgICAkLkVWRU5UX1NUQVJUID0gJ21vdXNlZG93bic7CiAgICAkLkVWRU5UX01PVkUgPSAnbW91c2Vtb3ZlJzsKICAgICQuRVZFTlRfRU5EID0gJ21vdXNldXAnOwogIH0KCiAgJC5FVkVOVF9DQU5DRUwgPSAndG91Y2hjYW5jZWwnOwogICQuRVZFTlRfQ0xJQ0sgPSAnY2xpY2snOwogIHZhciBfbWlkID0gMTsKICB2YXIgZGVsZWdhdGVzID0ge307IC8v6ZyA6KaBd3JhcOeahOWHveaVsAoKICB2YXIgZXZlbnRNZXRob2RzID0gewogICAgcHJldmVudERlZmF1bHQ6ICdpc0RlZmF1bHRQcmV2ZW50ZWQnLAogICAgc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOiAnaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQnLAogICAgc3RvcFByb3BhZ2F0aW9uOiAnaXNQcm9wYWdhdGlvblN0b3BwZWQnCiAgfTsgLy/pu5jorqR0cnVl6L+U5Zue5Ye95pWwCgogIHZhciByZXR1cm5UcnVlID0gZnVuY3Rpb24gcmV0dXJuVHJ1ZSgpIHsKICAgIHJldHVybiB0cnVlOwogIH07IC8v6buY6K6kZmFsc2Xov5Tlm57lh73mlbAKCgogIHZhciByZXR1cm5GYWxzZSA9IGZ1bmN0aW9uIHJldHVybkZhbHNlKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH07IC8vd3JhcOa1j+iniOWZqOS6i+S7tgoKCiAgdmFyIGNvbXBhdGlibGUgPSBmdW5jdGlvbiBjb21wYXRpYmxlKGV2ZW50LCB0YXJnZXQpIHsKICAgIGlmICghZXZlbnQuZGV0YWlsKSB7CiAgICAgIGV2ZW50LmRldGFpbCA9IHsKICAgICAgICBjdXJyZW50VGFyZ2V0OiB0YXJnZXQKICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIGV2ZW50LmRldGFpbC5jdXJyZW50VGFyZ2V0ID0gdGFyZ2V0OwogICAgfQoKICAgICQuZWFjaChldmVudE1ldGhvZHMsIGZ1bmN0aW9uIChuYW1lLCBwcmVkaWNhdGUpIHsKICAgICAgdmFyIHNvdXJjZU1ldGhvZCA9IGV2ZW50W25hbWVdOwoKICAgICAgZXZlbnRbbmFtZV0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpc1twcmVkaWNhdGVdID0gcmV0dXJuVHJ1ZTsKICAgICAgICByZXR1cm4gc291cmNlTWV0aG9kICYmIHNvdXJjZU1ldGhvZC5hcHBseShldmVudCwgYXJndW1lbnRzKTsKICAgICAgfTsKCiAgICAgIGV2ZW50W3ByZWRpY2F0ZV0gPSByZXR1cm5GYWxzZTsKICAgIH0sIHRydWUpOwogICAgcmV0dXJuIGV2ZW50OwogIH07IC8v566A5Y2V55qEd3JhcOWvueixoV9taWQKCgogIHZhciBtaWQgPSBmdW5jdGlvbiBtaWQob2JqKSB7CiAgICByZXR1cm4gb2JqICYmIChvYmouX21pZCB8fCAob2JqLl9taWQgPSBfbWlkKyspKTsKICB9OyAvL+S6i+S7tuWnlOaJmOWvueixoee7keWumueahOS6i+S7tuWbnuiwg+WIl+ihqAoKCiAgdmFyIGRlbGVnYXRlRm5zID0ge307IC8v6L+U5Zue5LqL5Lu25aeU5omY55qEd3JhcOS6i+S7tuWbnuiwgwoKICB2YXIgZGVsZWdhdGVGbiA9IGZ1bmN0aW9uIGRlbGVnYXRlRm4oZWxlbWVudCwgZXZlbnQsIHNlbGVjdG9yLCBjYWxsYmFjaykgewogICAgcmV0dXJuIGZ1bmN0aW9uIChlKSB7CiAgICAgIC8vc2FtZSBldmVudAogICAgICB2YXIgY2FsbGJhY2tPYmpzID0gZGVsZWdhdGVzW2VsZW1lbnQuX21pZF1bZXZlbnRdOwogICAgICB2YXIgaGFuZGxlclF1ZXVlID0gW107CiAgICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDsKICAgICAgdmFyIHNlbGVjdG9yQWxscyA9IHt9OwoKICAgICAgZm9yICg7IHRhcmdldCAmJiB0YXJnZXQgIT09IGRvY3VtZW50OyB0YXJnZXQgPSB0YXJnZXQucGFyZW50Tm9kZSkgewogICAgICAgIGlmICh0YXJnZXQgPT09IGVsZW1lbnQpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKH5bJ2NsaWNrJywgJ3RhcCcsICdkb3VibGV0YXAnLCAnbG9uZ3RhcCcsICdob2xkJ10uaW5kZXhPZihldmVudCkgJiYgKHRhcmdldC5kaXNhYmxlZCB8fCB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtdWktZGlzYWJsZWQnKSkpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgdmFyIG1hdGNoZXMgPSB7fTsKICAgICAgICAkLmVhY2goY2FsbGJhY2tPYmpzLCBmdW5jdGlvbiAoc2VsZWN0b3IsIGNhbGxiYWNrcykgewogICAgICAgICAgLy9zYW1lIHNlbGVjdG9yCiAgICAgICAgICBzZWxlY3RvckFsbHNbc2VsZWN0b3JdIHx8IChzZWxlY3RvckFsbHNbc2VsZWN0b3JdID0gJC5xc2Eoc2VsZWN0b3IsIGVsZW1lbnQpKTsKCiAgICAgICAgICBpZiAoc2VsZWN0b3JBbGxzW3NlbGVjdG9yXSAmJiB+c2VsZWN0b3JBbGxzW3NlbGVjdG9yXS5pbmRleE9mKHRhcmdldCkpIHsKICAgICAgICAgICAgaWYgKCFtYXRjaGVzW3NlbGVjdG9yXSkgewogICAgICAgICAgICAgIG1hdGNoZXNbc2VsZWN0b3JdID0gY2FsbGJhY2tzOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgdHJ1ZSk7CgogICAgICAgIGlmICghJC5pc0VtcHR5T2JqZWN0KG1hdGNoZXMpKSB7CiAgICAgICAgICBoYW5kbGVyUXVldWUucHVzaCh7CiAgICAgICAgICAgIGVsZW1lbnQ6IHRhcmdldCwKICAgICAgICAgICAgaGFuZGxlcnM6IG1hdGNoZXMKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgc2VsZWN0b3JBbGxzID0gbnVsbDsKICAgICAgZSA9IGNvbXBhdGlibGUoZSk7IC8vY29tcGF0aWJsZSBldmVudAoKICAgICAgJC5lYWNoKGhhbmRsZXJRdWV1ZSwgZnVuY3Rpb24gKGluZGV4LCBoYW5kbGVyKSB7CiAgICAgICAgdGFyZ2V0ID0gaGFuZGxlci5lbGVtZW50OwogICAgICAgIHZhciB0YWdOYW1lID0gdGFyZ2V0LnRhZ05hbWU7CgogICAgICAgIGlmIChldmVudCA9PT0gJ3RhcCcgJiYgdGFnTmFtZSAhPT0gJ0lOUFVUJyAmJiB0YWdOYW1lICE9PSAnVEVYVEFSRUEnICYmIHRhZ05hbWUgIT09ICdTRUxFQ1QnKSB7CiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBlLmRldGFpbCAmJiBlLmRldGFpbC5nZXN0dXJlICYmIGUuZGV0YWlsLmdlc3R1cmUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB9CgogICAgICAgICQuZWFjaChoYW5kbGVyLmhhbmRsZXJzLCBmdW5jdGlvbiAoaW5kZXgsIGhhbmRsZXIpIHsKICAgICAgICAgICQuZWFjaChoYW5kbGVyLCBmdW5jdGlvbiAoaW5kZXgsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGlmIChjYWxsYmFjay5jYWxsKHRhcmdldCwgZSkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIHRydWUpOwogICAgICAgIH0sIHRydWUpOwoKICAgICAgICBpZiAoZS5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9LCB0cnVlKTsKICAgIH07CiAgfTsKCiAgdmFyIGZpbmREZWxlZ2F0ZUZuID0gZnVuY3Rpb24gZmluZERlbGVnYXRlRm4oZWxlbWVudCwgZXZlbnQpIHsKICAgIHZhciBkZWxlZ2F0ZUNhbGxiYWNrcyA9IGRlbGVnYXRlRm5zW21pZChlbGVtZW50KV07CiAgICB2YXIgcmVzdWx0ID0gW107CgogICAgaWYgKGRlbGVnYXRlQ2FsbGJhY2tzKSB7CiAgICAgIHJlc3VsdCA9IFtdOwoKICAgICAgaWYgKGV2ZW50KSB7CiAgICAgICAgdmFyIGZpbHRlckZuID0gZnVuY3Rpb24gZmlsdGVyRm4oZm4pIHsKICAgICAgICAgIHJldHVybiBmbi50eXBlID09PSBldmVudDsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gZGVsZWdhdGVDYWxsYmFja3MuZmlsdGVyKGZpbHRlckZuKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXN1bHQgPSBkZWxlZ2F0ZUNhbGxiYWNrczsKICAgICAgfQogICAgfQoKICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgdmFyIHByZXZlbnREZWZhdWx0RXhjZXB0aW9uID0gL14oSU5QVVR8VEVYVEFSRUF8QlVUVE9OfFNFTEVDVCkkLzsKICAvKioKICAgKiBtdWkgZGVsZWdhdGUgZXZlbnRzCiAgICogQHBhcmFtIHt0eXBlfSBldmVudAogICAqIEBwYXJhbSB7dHlwZX0gc2VsZWN0b3IKICAgKiBAcGFyYW0ge3R5cGV9IGNhbGxiYWNrCiAgICogQHJldHVybnMge3VuZGVmaW5lZH0KICAgKi8KCiAgJC5mbi5vbiA9IGZ1bmN0aW9uIChldmVudCwgc2VsZWN0b3IsIGNhbGxiYWNrKSB7CiAgICAvL+S7heaUr+aMgeeugOWNleeahOS6i+S7tuWnlOaJmCzkuLvopoHmmK90YXDkuovku7bkvb/nlKjvvIznsbvkvLxtb3VzZSxmb2N1c+S5i+exu+aaguS4jeWwgeijheaUr+aMgQogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBlbGVtZW50ID0gdGhpczsKICAgICAgbWlkKGVsZW1lbnQpOwogICAgICBtaWQoY2FsbGJhY2spOwogICAgICB2YXIgaXNBZGRFdmVudExpc3RlbmVyID0gZmFsc2U7CiAgICAgIHZhciBkZWxlZ2F0ZUV2ZW50cyA9IGRlbGVnYXRlc1tlbGVtZW50Ll9taWRdIHx8IChkZWxlZ2F0ZXNbZWxlbWVudC5fbWlkXSA9IHt9KTsKICAgICAgdmFyIGRlbGVnYXRlQ2FsbGJhY2tPYmpzID0gZGVsZWdhdGVFdmVudHNbZXZlbnRdIHx8IChkZWxlZ2F0ZUV2ZW50c1tldmVudF0gPSB7fSk7CgogICAgICBpZiAoJC5pc0VtcHR5T2JqZWN0KGRlbGVnYXRlQ2FsbGJhY2tPYmpzKSkgewogICAgICAgIGlzQWRkRXZlbnRMaXN0ZW5lciA9IHRydWU7CiAgICAgIH0KCiAgICAgIHZhciBkZWxlZ2F0ZUNhbGxiYWNrcyA9IGRlbGVnYXRlQ2FsbGJhY2tPYmpzW3NlbGVjdG9yXSB8fCAoZGVsZWdhdGVDYWxsYmFja09ianNbc2VsZWN0b3JdID0gW10pOwogICAgICBkZWxlZ2F0ZUNhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTsKCiAgICAgIGlmIChpc0FkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgICB2YXIgZGVsZWdhdGVGbkFycmF5ID0gZGVsZWdhdGVGbnNbbWlkKGVsZW1lbnQpXTsKCiAgICAgICAgaWYgKCFkZWxlZ2F0ZUZuQXJyYXkpIHsKICAgICAgICAgIGRlbGVnYXRlRm5BcnJheSA9IFtdOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRlbGVnYXRlQ2FsbGJhY2sgPSBkZWxlZ2F0ZUZuKGVsZW1lbnQsIGV2ZW50LCBzZWxlY3RvciwgY2FsbGJhY2spOwogICAgICAgIGRlbGVnYXRlRm5BcnJheS5wdXNoKGRlbGVnYXRlQ2FsbGJhY2spOwogICAgICAgIGRlbGVnYXRlQ2FsbGJhY2suaSA9IGRlbGVnYXRlRm5BcnJheS5sZW5ndGggLSAxOwogICAgICAgIGRlbGVnYXRlQ2FsbGJhY2sudHlwZSA9IGV2ZW50OwogICAgICAgIGRlbGVnYXRlRm5zW21pZChlbGVtZW50KV0gPSBkZWxlZ2F0ZUZuQXJyYXk7CiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBkZWxlZ2F0ZUNhbGxiYWNrKTsKCiAgICAgICAgaWYgKGV2ZW50ID09PSAndGFwJykgewogICAgICAgICAgLy9UT0RPIOmcgOimgeaJvuS4quabtOWlveeahOino+WGs+aWueahiAogICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGlmIChlLnRhcmdldCkgewogICAgICAgICAgICAgIHZhciB0YWdOYW1lID0gZS50YXJnZXQudGFnTmFtZTsKCiAgICAgICAgICAgICAgaWYgKCFwcmV2ZW50RGVmYXVsdEV4Y2VwdGlvbi50ZXN0KHRhZ05hbWUpKSB7CiAgICAgICAgICAgICAgICBpZiAodGFnTmFtZSA9PT0gJ0EnKSB7CiAgICAgICAgICAgICAgICAgIHZhciBocmVmID0gZS50YXJnZXQuaHJlZjsKCiAgICAgICAgICAgICAgICAgIGlmICghKGhyZWYgJiYgfmhyZWYuaW5kZXhPZigndGVsOicpKSkgewogICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9OwoKICAkLmZuLm9mZiA9IGZ1bmN0aW9uIChldmVudCwgc2VsZWN0b3IsIGNhbGxiYWNrKSB7CiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9taWQgPSBtaWQodGhpcyk7CgogICAgICBpZiAoIWV2ZW50KSB7CiAgICAgICAgLy9tdWkoc2VsZWN0b3IpLm9mZigpOwogICAgICAgIGRlbGVnYXRlc1tfbWlkXSAmJiBkZWxldGUgZGVsZWdhdGVzW19taWRdOwogICAgICB9IGVsc2UgaWYgKCFzZWxlY3RvcikgewogICAgICAgIC8vbXVpKHNlbGVjdG9yKS5vZmYoZXZlbnQpOwogICAgICAgIGRlbGVnYXRlc1tfbWlkXSAmJiBkZWxldGUgZGVsZWdhdGVzW19taWRdW2V2ZW50XTsKICAgICAgfSBlbHNlIGlmICghY2FsbGJhY2spIHsKICAgICAgICAvL211aShzZWxlY3Rvcikub2ZmKGV2ZW50LHNlbGVjdG9yKTsKICAgICAgICBkZWxlZ2F0ZXNbX21pZF0gJiYgZGVsZWdhdGVzW19taWRdW2V2ZW50XSAmJiBkZWxldGUgZGVsZWdhdGVzW19taWRdW2V2ZW50XVtzZWxlY3Rvcl07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy9tdWkoc2VsZWN0b3IpLm9mZihldmVudCxzZWxlY3RvcixjYWxsYmFjayk7CiAgICAgICAgdmFyIGRlbGVnYXRlQ2FsbGJhY2tzID0gZGVsZWdhdGVzW19taWRdICYmIGRlbGVnYXRlc1tfbWlkXVtldmVudF0gJiYgZGVsZWdhdGVzW19taWRdW2V2ZW50XVtzZWxlY3Rvcl07CiAgICAgICAgJC5lYWNoKGRlbGVnYXRlQ2FsbGJhY2tzLCBmdW5jdGlvbiAoaW5kZXgsIGRlbGVnYXRlQ2FsbGJhY2spIHsKICAgICAgICAgIGlmIChtaWQoZGVsZWdhdGVDYWxsYmFjaykgPT09IG1pZChjYWxsYmFjaykpIHsKICAgICAgICAgICAgZGVsZWdhdGVDYWxsYmFja3Muc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0sIHRydWUpOwogICAgICB9CgogICAgICBpZiAoZGVsZWdhdGVzW19taWRdKSB7CiAgICAgICAgLy/lpoLmnpxvZmbmjonkuobmiYDmnInlvZPliY1lbGVtZW5055qE5oyH5a6a55qEZXZlbnTkuovku7bvvIzliJlyZW1vdmXmjonlvZPliY1lbGVtZW5055qEZGVsZWdhdGXlm57osIMKICAgICAgICBpZiAoIWRlbGVnYXRlc1tfbWlkXVtldmVudF0gfHwgJC5pc0VtcHR5T2JqZWN0KGRlbGVnYXRlc1tfbWlkXVtldmVudF0pKSB7CiAgICAgICAgICBmaW5kRGVsZWdhdGVGbih0aGlzLCBldmVudCkuZm9yRWFjaChmdW5jdGlvbiAoZm4pIHsKICAgICAgICAgICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKGZuLnR5cGUsIGZuKTsKICAgICAgICAgICAgZGVsZXRlIGRlbGVnYXRlRm5zW19taWRdW2ZuLmldOwogICAgICAgICAgfS5iaW5kKHRoaXMpKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy/lpoLmnpxkZWxlZ2F0ZXNbX21pZF3lt7LkuI3lrZjlnKjvvIzliKDpmaTmiYDmnIkKICAgICAgICBmaW5kRGVsZWdhdGVGbih0aGlzKS5mb3JFYWNoKGZ1bmN0aW9uIChmbikgewogICAgICAgICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKGZuLnR5cGUsIGZuKTsKICAgICAgICAgIGRlbGV0ZSBkZWxlZ2F0ZUZuc1tfbWlkXVtmbi5pXTsKICAgICAgICB9LmJpbmQodGhpcykpOwogICAgICB9CiAgICB9KTsKICB9Owp9KShtdWkpOwovKioKICogbXVpIHRhcmdldChhY3Rpb24+cG9wb3Zlcj5tb2RhbD50YWI+dG9nZ2xlKQogKi8KCgooZnVuY3Rpb24gKCQsIHdpbmRvdywgZG9jdW1lbnQpIHsKICAvKioKICAgKiB0YXJnZXRzCiAgICovCiAgJC50YXJnZXRzID0ge307CiAgLyoqCiAgICogdGFyZ2V0IGhhbmRsZXMKICAgKi8KCiAgJC50YXJnZXRIYW5kbGVzID0gW107CiAgLyoqCiAgICogcmVnaXN0ZXIgdGFyZ2V0CiAgICogQHBhcmFtIHt0eXBlfSB0YXJnZXQKICAgKiBAcmV0dXJucyB7JC50YXJnZXRzfQogICAqLwoKICAkLnJlZ2lzdGVyVGFyZ2V0ID0gZnVuY3Rpb24gKHRhcmdldCkgewogICAgdGFyZ2V0LmluZGV4ID0gdGFyZ2V0LmluZGV4IHx8IDEwMDA7CiAgICAkLnRhcmdldEhhbmRsZXMucHVzaCh0YXJnZXQpOwogICAgJC50YXJnZXRIYW5kbGVzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgcmV0dXJuIGEuaW5kZXggLSBiLmluZGV4OwogICAgfSk7CiAgICByZXR1cm4gJC50YXJnZXRIYW5kbGVzOwogIH07CgogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCQuRVZFTlRfU1RBUlQsIGZ1bmN0aW9uIChldmVudCkgewogICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDsKICAgIHZhciBmb3VuZHMgPSB7fTsKCiAgICBmb3IgKDsgdGFyZ2V0ICYmIHRhcmdldCAhPT0gZG9jdW1lbnQ7IHRhcmdldCA9IHRhcmdldC5wYXJlbnROb2RlKSB7CiAgICAgIHZhciBpc0ZvdW5kID0gZmFsc2U7CiAgICAgICQuZWFjaCgkLnRhcmdldEhhbmRsZXMsIGZ1bmN0aW9uIChpbmRleCwgdGFyZ2V0SGFuZGxlKSB7CiAgICAgICAgdmFyIG5hbWUgPSB0YXJnZXRIYW5kbGUubmFtZTsKCiAgICAgICAgaWYgKCFpc0ZvdW5kICYmICFmb3VuZHNbbmFtZV0gJiYgdGFyZ2V0SGFuZGxlLmhhc093blByb3BlcnR5KCdoYW5kbGUnKSkgewogICAgICAgICAgJC50YXJnZXRzW25hbWVdID0gdGFyZ2V0SGFuZGxlLmhhbmRsZShldmVudCwgdGFyZ2V0KTsKCiAgICAgICAgICBpZiAoJC50YXJnZXRzW25hbWVdKSB7CiAgICAgICAgICAgIGZvdW5kc1tuYW1lXSA9IHRydWU7CgogICAgICAgICAgICBpZiAodGFyZ2V0SGFuZGxlLmlzQ29udGludWUgIT09IHRydWUpIHsKICAgICAgICAgICAgICBpc0ZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoIWZvdW5kc1tuYW1lXSkgewogICAgICAgICAgICBpZiAodGFyZ2V0SGFuZGxlLmlzUmVzZXQgIT09IGZhbHNlKSAkLnRhcmdldHNbbmFtZV0gPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgaWYgKGlzRm91bmQpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogIH0pOwogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkgewogICAgLy/op6PlhrN0b3VjaOS4jmNsaWNr55qEdGFyZ2V05LiN5LiA6Ie055qE6Zeu6aKYKOavlOWmgumTvuaOpei+uee8mOeCueWHu+aXtu+8jHRvdWNo55qEdGFyZ2V05Li6aHRtbO+8jOiAjGNsaWNr55qEdGFyZ2V05Li6QSkKICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7CiAgICB2YXIgaXNGb3VuZCA9IGZhbHNlOwoKICAgIGZvciAoOyB0YXJnZXQgJiYgdGFyZ2V0ICE9PSBkb2N1bWVudDsgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudE5vZGUpIHsKICAgICAgaWYgKHRhcmdldC50YWdOYW1lID09PSAnQScpIHsKICAgICAgICAkLmVhY2goJC50YXJnZXRIYW5kbGVzLCBmdW5jdGlvbiAoaW5kZXgsIHRhcmdldEhhbmRsZSkgewogICAgICAgICAgdmFyIG5hbWUgPSB0YXJnZXRIYW5kbGUubmFtZTsKCiAgICAgICAgICBpZiAodGFyZ2V0SGFuZGxlLmhhc093blByb3BlcnR5KCdoYW5kbGUnKSkgewogICAgICAgICAgICBpZiAodGFyZ2V0SGFuZGxlLmhhbmRsZShldmVudCwgdGFyZ2V0KSkgewogICAgICAgICAgICAgIGlzRm91bmQgPSB0cnVlOwogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGlmIChpc0ZvdW5kKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9KTsKfSkobXVpLCB3aW5kb3csIGRvY3VtZW50KTsKLyoqCiAqIGZpeGVkIHRyaW0KICogQHBhcmFtIHt0eXBlfSB1bmRlZmluZWQKICogQHJldHVybnMge3VuZGVmaW5lZH0KICovCgoKKGZ1bmN0aW9uICh1bmRlZmluZWQpIHsKICBpZiAoU3RyaW5nLnByb3RvdHlwZS50cmltID09PSB1bmRlZmluZWQpIHsKICAgIC8vIGZpeCBmb3IgaU9TIDMuMgogICAgU3RyaW5nLnByb3RvdHlwZS50cmltID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpOwogICAgfTsKICB9CgogIE9iamVjdC5zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiAob2JqLCBwcm90bykgewogICAgb2JqWydfX3Byb3RvX18nXSA9IHByb3RvOwogICAgcmV0dXJuIG9iajsKICB9Owp9KSgpOwovKioKICogZml4ZWQgQ3VzdG9tRXZlbnQKICovCgoKKGZ1bmN0aW9uICgpIHsKICBpZiAodHlwZW9mIHdpbmRvdy5DdXN0b21FdmVudCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgIGZ1bmN0aW9uIF9DdXN0b21FdmVudChldmVudCwgcGFyYW1zKSB7CiAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCB7CiAgICAgICAgYnViYmxlczogZmFsc2UsCiAgICAgICAgY2FuY2VsYWJsZTogZmFsc2UsCiAgICAgICAgZGV0YWlsOiB1bmRlZmluZWQKICAgICAgfTsKICAgICAgdmFyIGV2dCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdFdmVudHMnKTsKICAgICAgdmFyIGJ1YmJsZXMgPSB0cnVlOwoKICAgICAgZm9yICh2YXIgbmFtZSBpbiBwYXJhbXMpIHsKICAgICAgICBuYW1lID09PSAnYnViYmxlcycgPyBidWJibGVzID0gISFwYXJhbXNbbmFtZV0gOiBldnRbbmFtZV0gPSBwYXJhbXNbbmFtZV07CiAgICAgIH0KCiAgICAgIGV2dC5pbml0RXZlbnQoZXZlbnQsIGJ1YmJsZXMsIHRydWUpOwogICAgICByZXR1cm4gZXZ0OwogICAgfQoKICAgIDsKICAgIF9DdXN0b21FdmVudC5wcm90b3R5cGUgPSB3aW5kb3cuRXZlbnQucHJvdG90eXBlOwogICAgd2luZG93LkN1c3RvbUV2ZW50ID0gX0N1c3RvbUV2ZW50OwogIH0KfSkoKTsKLyoKCUEgc2hpbSBmb3Igbm9uIEVTNSBzdXBwb3J0aW5nIGJyb3dzZXJzLgoJQWRkcyBmdW5jdGlvbiBiaW5kIHRvIEZ1bmN0aW9uIHByb3RvdHlwZSwgc28gdGhhdCB5b3UgY2FuIGRvIHBhcnRpYWwgYXBwbGljYXRpb24uCglXb3JrcyBldmVuIHdpdGggdGhlIG5hc3R5IHRoaW5nLCB3aGVyZSB0aGUgZmlyc3Qgd29yZCBpcyB0aGUgb3Bwb3NpdGUgb2YgZXh0cmFuZXQsIHRoZSBzZWNvbmQgb25lIGlzIHRoZSBwcm9mZXNzaW9uIG9mIENvbHVtYnVzLCBhbmQgdGhlIHZlcnNpb24gbnVtYmVyIGlzIDksIGZsaXBwZWQgMTgwIGRlZ3JlZXMuCiovCgoKRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZCB8fCBmdW5jdGlvbiAodG8pIHsKICAvLyBNYWtlIGFuIGFycmF5IG9mIG91ciBhcmd1bWVudHMsIHN0YXJ0aW5nIGZyb20gc2Vjb25kIGFyZ3VtZW50CiAgdmFyIHBhcnRpYWwgPSBBcnJheS5wcm90b3R5cGUuc3BsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSwKICAgICAgLy8gV2UnbGwgbmVlZCB0aGUgb3JpZ2luYWwgZnVuY3Rpb24uCiAgZm4gPSB0aGlzOwoKICB2YXIgYm91bmQgPSBmdW5jdGlvbiBib3VuZCgpIHsKICAgIC8vIEpvaW4gdGhlIGFscmVhZHkgYXBwbGllZCBhcmd1bWVudHMgdG8gdGhlIG5vdyBjYWxsZWQgb25lcyAoYWZ0ZXIgY29udmVydGluZyB0byBhbiBhcnJheSBhZ2FpbikuCiAgICB2YXIgYXJncyA9IHBhcnRpYWwuY29uY2F0KEFycmF5LnByb3RvdHlwZS5zcGxpY2UuY2FsbChhcmd1bWVudHMsIDApKTsgLy8gSWYgbm90IGJlaW5nIGNhbGxlZCBhcyBhIGNvbnN0cnVjdG9yCgogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIGJvdW5kKSkgewogICAgICAvLyByZXR1cm4gdGhlIHJlc3VsdCBvZiB0aGUgZnVuY3Rpb24gY2FsbGVkIGJvdW5kIHRvIHRhcmdldCBhbmQgcGFydGlhbGx5IGFwcGxpZWQuCiAgICAgIHJldHVybiBmbi5hcHBseSh0bywgYXJncyk7CiAgICB9IC8vIElmIGJlaW5nIGNhbGxlZCBhcyBhIGNvbnN0cnVjdG9yLCBhcHBseSB0aGUgZnVuY3Rpb24gYm91bmQgdG8gc2VsZi4KCgogICAgZm4uYXBwbHkodGhpcywgYXJncyk7CiAgfTsgLy8gQXR0YWNoIHRoZSBwcm90b3R5cGUgb2YgdGhlIGZ1bmN0aW9uIHRvIG91ciBuZXdseSBjcmVhdGVkIGZ1bmN0aW9uLgoKCiAgYm91bmQucHJvdG90eXBlID0gZm4ucHJvdG90eXBlOwogIHJldHVybiBib3VuZDsKfTsKLyoqCiAqIG11aSBmaXhlZCBjbGFzc0xpc3QKICogQHBhcmFtIHt0eXBlfSBkb2N1bWVudAogKiBAcmV0dXJucyB7dW5kZWZpbmVkfQogKi8KCgooZnVuY3Rpb24gKGRvY3VtZW50KSB7CiAgaWYgKCEoImNsYXNzTGlzdCIgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgdHlwZW9mIEhUTUxFbGVtZW50ICE9PSAndW5kZWZpbmVkJykgewogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEhUTUxFbGVtZW50LnByb3RvdHlwZSwgJ2NsYXNzTGlzdCcsIHsKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICBmdW5jdGlvbiB1cGRhdGUoZm4pIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgdmFyIGNsYXNzZXMgPSBzZWxmLmNsYXNzTmFtZS5zcGxpdCgvXHMrLyksCiAgICAgICAgICAgICAgICBpbmRleCA9IGNsYXNzZXMuaW5kZXhPZih2YWx1ZSk7CiAgICAgICAgICAgIGZuKGNsYXNzZXMsIGluZGV4LCB2YWx1ZSk7CiAgICAgICAgICAgIHNlbGYuY2xhc3NOYW1lID0gY2xhc3Nlcy5qb2luKCIgIik7CiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgdmFyIHJldCA9IHsKICAgICAgICAgIGFkZDogdXBkYXRlKGZ1bmN0aW9uIChjbGFzc2VzLCBpbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgfmluZGV4IHx8IGNsYXNzZXMucHVzaCh2YWx1ZSk7CiAgICAgICAgICB9KSwKICAgICAgICAgIHJlbW92ZTogdXBkYXRlKGZ1bmN0aW9uIChjbGFzc2VzLCBpbmRleCkgewogICAgICAgICAgICB+aW5kZXggJiYgY2xhc3Nlcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgfSksCiAgICAgICAgICB0b2dnbGU6IHVwZGF0ZShmdW5jdGlvbiAoY2xhc3NlcywgaW5kZXgsIHZhbHVlKSB7CiAgICAgICAgICAgIH5pbmRleCA/IGNsYXNzZXMuc3BsaWNlKGluZGV4LCAxKSA6IGNsYXNzZXMucHVzaCh2YWx1ZSk7CiAgICAgICAgICB9KSwKICAgICAgICAgIGNvbnRhaW5zOiBmdW5jdGlvbiBjb250YWlucyh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gISF+c2VsZi5jbGFzc05hbWUuc3BsaXQoL1xzKy8pLmluZGV4T2YodmFsdWUpOwogICAgICAgICAgfSwKICAgICAgICAgIGl0ZW06IGZ1bmN0aW9uIGl0ZW0oaSkgewogICAgICAgICAgICByZXR1cm4gc2VsZi5jbGFzc05hbWUuc3BsaXQoL1xzKy8pW2ldIHx8IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocmV0LCAnbGVuZ3RoJywgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmNsYXNzTmFtZS5zcGxpdCgvXHMrLykubGVuZ3RoOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiByZXQ7CiAgICAgIH0KICAgIH0pOwogIH0KfSkoZG9jdW1lbnQpOwovKioKICogbXVpIGZpeGVkIHJlcXVlc3RBbmltYXRpb25GcmFtZQogKiBAcGFyYW0ge3R5cGV9IHdpbmRvdwogKiBAcmV0dXJucyB7dW5kZWZpbmVkfQogKi8KCgooZnVuY3Rpb24gKHdpbmRvdykgewogIGlmICghd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSkgewogICAgdmFyIGxhc3RUaW1lID0gMDsKCiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBmdW5jdGlvbiAoY2FsbGJhY2ssIGVsZW1lbnQpIHsKICAgICAgdmFyIGN1cnJUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgIHZhciB0aW1lVG9DYWxsID0gTWF0aC5tYXgoMCwgMTYuNyAtIChjdXJyVGltZSAtIGxhc3RUaW1lKSk7CiAgICAgIHZhciBpZCA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBjYWxsYmFjayhjdXJyVGltZSArIHRpbWVUb0NhbGwpOwogICAgICB9LCB0aW1lVG9DYWxsKTsKICAgICAgbGFzdFRpbWUgPSBjdXJyVGltZSArIHRpbWVUb0NhbGw7CiAgICAgIHJldHVybiBpZDsKICAgIH07CgogICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gd2luZG93LndlYmtpdENhbmNlbEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy53ZWJraXRDYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgZnVuY3Rpb24gKGlkKSB7CiAgICAgIGNsZWFyVGltZW91dChpZCk7CiAgICB9OwogIH0KCiAgOwp9KSh3aW5kb3cpOwovKioKICogZmFzdGNsaWNrKG9ubHkgZm9yIHJhZGlvLGNoZWNrYm94KQogKi8KCgooZnVuY3Rpb24gKCQsIHdpbmRvdywgbmFtZSkgewogIGlmICghJC5vcy5hbmRyb2lkICYmICEkLm9zLmlvcykgewogICAgLy/nm67liY3ku4Xor4bliKthbmRyb2lk5ZKMaW9zCiAgICByZXR1cm47CiAgfQoKICBpZiAod2luZG93LkZhc3RDbGljaykgewogICAgcmV0dXJuOwogIH0KCiAgdmFyIGhhbmRsZSA9IGZ1bmN0aW9uIGhhbmRsZShldmVudCwgdGFyZ2V0KSB7CiAgICBpZiAodGFyZ2V0LnRhZ05hbWUgPT09ICdMQUJFTCcpIHsKICAgICAgaWYgKHRhcmdldC5wYXJlbnROb2RlKSB7CiAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcignaW5wdXQnKTsKICAgICAgfQogICAgfQoKICAgIGlmICh0YXJnZXQgJiYgKHRhcmdldC50eXBlID09PSAncmFkaW8nIHx8IHRhcmdldC50eXBlID09PSAnY2hlY2tib3gnKSkgewogICAgICBpZiAoIXRhcmdldC5kaXNhYmxlZCkgewogICAgICAgIC8vZGlzYWJsZWQKICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH07CgogICQucmVnaXN0ZXJUYXJnZXQoewogICAgbmFtZTogbmFtZSwKICAgIGluZGV4OiA0MCwKICAgIGhhbmRsZTogaGFuZGxlLAogICAgdGFyZ2V0OiBmYWxzZQogIH0pOwoKICB2YXIgZGlzcGF0Y2hFdmVudCA9IGZ1bmN0aW9uIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgIHZhciB0YXJnZXRFbGVtZW50ID0gJC50YXJnZXRzLmNsaWNrOwoKICAgIGlmICh0YXJnZXRFbGVtZW50KSB7CiAgICAgIHZhciBjbGlja0V2ZW50LCB0b3VjaDsgLy8gT24gc29tZSBBbmRyb2lkIGRldmljZXMgYWN0aXZlRWxlbWVudCBuZWVkcyB0byBiZSBibHVycmVkIG90aGVyd2lzZSB0aGUgc3ludGhldGljIGNsaWNrIHdpbGwgaGF2ZSBubyBlZmZlY3QKCiAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgIT09IHRhcmdldEVsZW1lbnQpIHsKICAgICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmJsdXIoKTsKICAgICAgfQoKICAgICAgdG91Y2ggPSBldmVudC5kZXRhaWwuZ2VzdHVyZS5jaGFuZ2VkVG91Y2hlc1swXTsgLy8gU3ludGhlc2lzZSBhIGNsaWNrIGV2ZW50LCB3aXRoIGFuIGV4dHJhIGF0dHJpYnV0ZSBzbyBpdCBjYW4gYmUgdHJhY2tlZAoKICAgICAgY2xpY2tFdmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdNb3VzZUV2ZW50cycpOwogICAgICBjbGlja0V2ZW50LmluaXRNb3VzZUV2ZW50KCdjbGljaycsIHRydWUsIHRydWUsIHdpbmRvdywgMSwgdG91Y2guc2NyZWVuWCwgdG91Y2guc2NyZWVuWSwgdG91Y2guY2xpZW50WCwgdG91Y2guY2xpZW50WSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIG51bGwpOwogICAgICBjbGlja0V2ZW50LmZvcndhcmRlZFRvdWNoRXZlbnQgPSB0cnVlOwogICAgICB0YXJnZXRFbGVtZW50LmRpc3BhdGNoRXZlbnQoY2xpY2tFdmVudCk7CiAgICAgIGV2ZW50LmRldGFpbCAmJiBldmVudC5kZXRhaWwuZ2VzdHVyZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgfQogIH07CgogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0YXAnLCBkaXNwYXRjaEV2ZW50KTsKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZG91YmxldGFwJywgZGlzcGF0Y2hFdmVudCk7IC8v5o2V6I63CgogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkgewogICAgaWYgKCQudGFyZ2V0cy5jbGljaykgewogICAgICBpZiAoIWV2ZW50LmZvcndhcmRlZFRvdWNoRXZlbnQpIHsKICAgICAgICAvL3N0b3AgY2xpY2sKICAgICAgICBpZiAoZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKSB7CiAgICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gUGFydCBvZiB0aGUgaGFjayBmb3IgYnJvd3NlcnMgdGhhdCBkb24ndCBzdXBwb3J0IEV2ZW50I3N0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbgogICAgICAgICAgZXZlbnQucHJvcGFnYXRpb25TdG9wcGVkID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgfSwgdHJ1ZSk7Cn0pKG11aSwgd2luZG93LCAnY2xpY2snKTsKCihmdW5jdGlvbiAoJCwgZG9jdW1lbnQpIHsKICAkKGZ1bmN0aW9uICgpIHsKICAgIGlmICghJC5vcy5pb3MpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBDTEFTU19GT0NVU0lOID0gJ211aS1mb2N1c2luJzsKICAgIHZhciBDTEFTU19CQVJfVEFCID0gJ211aS1iYXItdGFiJzsKICAgIHZhciBDTEFTU19CQVJfRk9PVEVSID0gJ211aS1iYXItZm9vdGVyJzsKICAgIHZhciBDTEFTU19CQVJfRk9PVEVSX1NFQ09OREFSWSA9ICdtdWktYmFyLWZvb3Rlci1zZWNvbmRhcnknOwogICAgdmFyIENMQVNTX0JBUl9GT09URVJfU0VDT05EQVJZX1RBQiA9ICdtdWktYmFyLWZvb3Rlci1zZWNvbmRhcnktdGFiJzsgLy8gdmFyIGNvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuJyArIENMQVNTX0NPTlRFTlQpOwogICAgLy8gaWYgKGNvbnRlbnQpIHsKICAgIC8vIAlkb2N1bWVudC5ib2R5Lmluc2VydEJlZm9yZShjb250ZW50LCBkb2N1bWVudC5ib2R5LmZpcnN0RWxlbWVudENoaWxkKTsKICAgIC8vIH0KCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdmb2N1c2luJywgZnVuY3Rpb24gKGUpIHsKICAgICAgaWYgKCQub3MucGx1cykgewogICAgICAgIC8v5Zyo54i2d2Vidmlld+mHjOi+ueS4jWZpeAogICAgICAgIGlmICh3aW5kb3cucGx1cykgewogICAgICAgICAgaWYgKHBsdXMud2Vidmlldy5jdXJyZW50V2VidmlldygpLmNoaWxkcmVuKCkubGVuZ3RoID4gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgdGFyZ2V0ID0gZS50YXJnZXQ7IC8vVE9ETyDpnIDogIPomZHmiYDmnInplK7nm5jlvLnotbfnmoTmg4XlhrUKCiAgICAgIGlmICh0YXJnZXQudGFnTmFtZSAmJiAodGFyZ2V0LnRhZ05hbWUgPT09ICdURVhUQVJFQScgfHwgdGFyZ2V0LnRhZ05hbWUgPT09ICdJTlBVVCcgJiYgKHRhcmdldC50eXBlID09PSAndGV4dCcgfHwgdGFyZ2V0LnR5cGUgPT09ICdzZWFyY2gnIHx8IHRhcmdldC50eXBlID09PSAnbnVtYmVyJykpKSB7CiAgICAgICAgaWYgKHRhcmdldC5kaXNhYmxlZCB8fCB0YXJnZXQucmVhZE9ubHkpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZChDTEFTU19GT0NVU0lOKTsKICAgICAgICB2YXIgaXNGb290ZXIgPSBmYWxzZTsKCiAgICAgICAgZm9yICg7IHRhcmdldCAmJiB0YXJnZXQgIT09IGRvY3VtZW50OyB0YXJnZXQgPSB0YXJnZXQucGFyZW50Tm9kZSkgewogICAgICAgICAgdmFyIGNsYXNzTGlzdCA9IHRhcmdldC5jbGFzc0xpc3Q7CgogICAgICAgICAgaWYgKGNsYXNzTGlzdCAmJiBjbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfQkFSX1RBQikgfHwgY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX0JBUl9GT09URVIpIHx8IGNsYXNzTGlzdC5jb250YWlucyhDTEFTU19CQVJfRk9PVEVSX1NFQ09OREFSWSkgfHwgY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX0JBUl9GT09URVJfU0VDT05EQVJZX1RBQikpIHsKICAgICAgICAgICAgaXNGb290ZXIgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChpc0Zvb3RlcikgewogICAgICAgICAgdmFyIHNjcm9sbFRvcCA9IGRvY3VtZW50LmJvZHkuc2Nyb2xsSGVpZ2h0OwogICAgICAgICAgdmFyIHNjcm9sbExlZnQgPSBkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQ7CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKHNjcm9sbExlZnQsIHNjcm9sbFRvcCk7CiAgICAgICAgICB9LCAyMCk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3Vzb3V0JywgZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIGNsYXNzTGlzdCA9IGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0OwoKICAgICAgaWYgKGNsYXNzTGlzdC5jb250YWlucyhDTEFTU19GT0NVU0lOKSkgewogICAgICAgIGNsYXNzTGlzdC5yZW1vdmUoQ0xBU1NfRk9DVVNJTik7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0LCBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCk7CiAgICAgICAgfSwgMjApOwogICAgICB9CiAgICB9KTsKICB9KTsKfSkobXVpLCBkb2N1bWVudCk7Ci8qKgogKiBtdWkgbmFtZXNwYWNlKG9wdGltaXphdGlvbikKICogQHBhcmFtIHt0eXBlfSAkCiAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAqLwoKCihmdW5jdGlvbiAoJCkgewogICQubmFtZXNwYWNlID0gJ211aSc7CiAgJC5jbGFzc05hbWVQcmVmaXggPSAkLm5hbWVzcGFjZSArICctJzsKICAkLmNsYXNzU2VsZWN0b3JQcmVmaXggPSAnLicgKyAkLmNsYXNzTmFtZVByZWZpeDsKICAvKioKICAgKiDov5Tlm57mraPnoa7nmoRjbGFzc05hbWUKICAgKiBAcGFyYW0ge3R5cGV9IGNsYXNzTmFtZQogICAqIEByZXR1cm5zIHtTdHJpbmd9CiAgICovCgogICQuY2xhc3NOYW1lID0gZnVuY3Rpb24gKGNsYXNzTmFtZSkgewogICAgcmV0dXJuICQuY2xhc3NOYW1lUHJlZml4ICsgY2xhc3NOYW1lOwogIH07CiAgLyoqCiAgICog6L+U5Zue5q2j56Gu55qEY2xhc3NTZWxlY3RvcgogICAqIEBwYXJhbSB7dHlwZX0gY2xhc3NTZWxlY3RvcgogICAqIEByZXR1cm5zIHtTdHJpbmd9CiAgICovCgoKICAkLmNsYXNzU2VsZWN0b3IgPSBmdW5jdGlvbiAoY2xhc3NTZWxlY3RvcikgewogICAgcmV0dXJuIGNsYXNzU2VsZWN0b3IucmVwbGFjZSgvXC4vZywgJC5jbGFzc1NlbGVjdG9yUHJlZml4KTsKICB9OwogIC8qKgogICAgICAgICAgKiDov5Tlm57mraPnoa7nmoRldmVudE5hbWUKICAgICAgICAgICogQHBhcmFtIHt0eXBlfSBldmVudAogICAgICAgICAgKiBAcGFyYW0ge3R5cGV9IG1vZHVsZQogICAgICAgICAgKiBAcmV0dXJucyB7U3RyaW5nfQogICAgICAgICAgKi8KCgogICQuZXZlbnROYW1lID0gZnVuY3Rpb24gKGV2ZW50LCBtb2R1bGUpIHsKICAgIHJldHVybiBldmVudCArICgkLm5hbWVzcGFjZSA/ICcuJyArICQubmFtZXNwYWNlIDogJycpICsgKG1vZHVsZSA/ICcuJyArIG1vZHVsZSA6ICcnKTsKICB9Owp9KShtdWkpOwovKioKICogbXVpIGdlc3R1cmVzCiAqIEBwYXJhbSB7dHlwZX0gJAogKiBAcGFyYW0ge3R5cGV9IHdpbmRvdwogKiBAcmV0dXJucyB7dW5kZWZpbmVkfQogKi8KCgooZnVuY3Rpb24gKCQsIHdpbmRvdykgewogICQuZ2VzdHVyZXMgPSB7CiAgICBzZXNzaW9uOiB7fQogIH07CiAgLyoqCiAgICogR2VzdHVyZSBwcmV2ZW50RGVmYXVsdAogICAqIEBwYXJhbSB7dHlwZX0gZQogICAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAgICovCgogICQucHJldmVudERlZmF1bHQgPSBmdW5jdGlvbiAoZSkgewogICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogIH07CiAgLyoqCiAgICogR2VzdHVyZSBzdG9wUHJvcGFnYXRpb24KICAgKiBAcGFyYW0ge3R5cGV9IGUKICAgKiBAcmV0dXJucyB7dW5kZWZpbmVkfQogICAqLwoKCiAgJC5zdG9wUHJvcGFnYXRpb24gPSBmdW5jdGlvbiAoZSkgewogICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICB9OwogIC8qKgogICAqIHJlZ2lzdGVyIGdlc3R1cmUKICAgKiBAcGFyYW0ge3R5cGV9IGdlc3R1cmUKICAgKiBAcmV0dXJucyB7JC5nZXN0dXJlc30KICAgKi8KCgogICQuYWRkR2VzdHVyZSA9IGZ1bmN0aW9uIChnZXN0dXJlKSB7CiAgICByZXR1cm4gJC5hZGRBY3Rpb24oJ2dlc3R1cmVzJywgZ2VzdHVyZSk7CiAgfTsKCiAgdmFyIHJvdW5kID0gTWF0aC5yb3VuZDsKICB2YXIgYWJzID0gTWF0aC5hYnM7CiAgdmFyIHNxcnQgPSBNYXRoLnNxcnQ7CiAgdmFyIGF0YW4gPSBNYXRoLmF0YW47CiAgdmFyIGF0YW4yID0gTWF0aC5hdGFuMjsKICAvKioKICAgKiBkaXN0YW5jZQogICAqIEBwYXJhbSB7dHlwZX0gcDEKICAgKiBAcGFyYW0ge3R5cGV9IHAyCiAgICogQHJldHVybnMge051bWJlcn0KICAgKi8KCiAgdmFyIGdldERpc3RhbmNlID0gZnVuY3Rpb24gZ2V0RGlzdGFuY2UocDEsIHAyLCBwcm9wcykgewogICAgaWYgKCFwcm9wcykgewogICAgICBwcm9wcyA9IFsneCcsICd5J107CiAgICB9CgogICAgdmFyIHggPSBwMltwcm9wc1swXV0gLSBwMVtwcm9wc1swXV07CiAgICB2YXIgeSA9IHAyW3Byb3BzWzFdXSAtIHAxW3Byb3BzWzFdXTsKICAgIHJldHVybiBzcXJ0KHggKiB4ICsgeSAqIHkpOwogIH07CiAgLyoqCiAgICogc2NhbGUKICAgKiBAcGFyYW0ge09iamVjdH0gc3RhcnRzCiAgICogQHBhcmFtIHtPYmplY3R9IG1vdmVzCiAgICovCgoKICB2YXIgZ2V0U2NhbGUgPSBmdW5jdGlvbiBnZXRTY2FsZShzdGFydHMsIG1vdmVzKSB7CiAgICBpZiAoc3RhcnRzLmxlbmd0aCA+PSAyICYmIG1vdmVzLmxlbmd0aCA+PSAyKSB7CiAgICAgIHZhciBwcm9wcyA9IFsncGFnZVgnLCAncGFnZVknXTsKICAgICAgcmV0dXJuIGdldERpc3RhbmNlKG1vdmVzWzFdLCBtb3Zlc1swXSwgcHJvcHMpIC8gZ2V0RGlzdGFuY2Uoc3RhcnRzWzFdLCBzdGFydHNbMF0sIHByb3BzKTsKICAgIH0KCiAgICByZXR1cm4gMTsKICB9OwogIC8qKgogICAqIGFuZ2xlCiAgICogQHBhcmFtIHt0eXBlfSBwMQogICAqIEBwYXJhbSB7dHlwZX0gcDIKICAgKiBAcmV0dXJucyB7TnVtYmVyfQogICAqLwoKCiAgdmFyIGdldEFuZ2xlID0gZnVuY3Rpb24gZ2V0QW5nbGUocDEsIHAyLCBwcm9wcykgewogICAgaWYgKCFwcm9wcykgewogICAgICBwcm9wcyA9IFsneCcsICd5J107CiAgICB9CgogICAgdmFyIHggPSBwMltwcm9wc1swXV0gLSBwMVtwcm9wc1swXV07CiAgICB2YXIgeSA9IHAyW3Byb3BzWzFdXSAtIHAxW3Byb3BzWzFdXTsKICAgIHJldHVybiBhdGFuMih5LCB4KSAqIDE4MCAvIE1hdGguUEk7CiAgfTsKICAvKioKICAgKiBkaXJlY3Rpb24KICAgKiBAcGFyYW0ge09iamVjdH0geAogICAqIEBwYXJhbSB7T2JqZWN0fSB5CiAgICovCgoKICB2YXIgZ2V0RGlyZWN0aW9uID0gZnVuY3Rpb24gZ2V0RGlyZWN0aW9uKHgsIHkpIHsKICAgIGlmICh4ID09PSB5KSB7CiAgICAgIHJldHVybiAnJzsKICAgIH0KCiAgICBpZiAoYWJzKHgpID49IGFicyh5KSkgewogICAgICByZXR1cm4geCA+IDAgPyAnbGVmdCcgOiAncmlnaHQnOwogICAgfQoKICAgIHJldHVybiB5ID4gMCA/ICd1cCcgOiAnZG93bic7CiAgfTsKICAvKioKICAgKiByb3RhdGlvbgogICAqIEBwYXJhbSB7T2JqZWN0fSBzdGFydAogICAqIEBwYXJhbSB7T2JqZWN0fSBlbmQKICAgKi8KCgogIHZhciBnZXRSb3RhdGlvbiA9IGZ1bmN0aW9uIGdldFJvdGF0aW9uKHN0YXJ0LCBlbmQpIHsKICAgIHZhciBwcm9wcyA9IFsncGFnZVgnLCAncGFnZVknXTsKICAgIHJldHVybiBnZXRBbmdsZShlbmRbMV0sIGVuZFswXSwgcHJvcHMpIC0gZ2V0QW5nbGUoc3RhcnRbMV0sIHN0YXJ0WzBdLCBwcm9wcyk7CiAgfTsKICAvKioKICAgKiBweCBwZXIgbXMKICAgKiBAcGFyYW0ge09iamVjdH0gZGVsdGFUaW1lCiAgICogQHBhcmFtIHtPYmplY3R9IHgKICAgKiBAcGFyYW0ge09iamVjdH0geQogICAqLwoKCiAgdmFyIGdldFZlbG9jaXR5ID0gZnVuY3Rpb24gZ2V0VmVsb2NpdHkoZGVsdGFUaW1lLCB4LCB5KSB7CiAgICByZXR1cm4gewogICAgICB4OiB4IC8gZGVsdGFUaW1lIHx8IDAsCiAgICAgIHk6IHkgLyBkZWx0YVRpbWUgfHwgMAogICAgfTsKICB9OwogIC8qKgogICAqIGRldGVjdCBnZXN0dXJlcwogICAqIEBwYXJhbSB7dHlwZX0gZXZlbnQKICAgKiBAcGFyYW0ge3R5cGV9IHRvdWNoCiAgICogQHJldHVybnMge3VuZGVmaW5lZH0KICAgKi8KCgogIHZhciBkZXRlY3QgPSBmdW5jdGlvbiBkZXRlY3QoZXZlbnQsIHRvdWNoKSB7CiAgICBpZiAoJC5nZXN0dXJlcy5zdG9wZWQpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgICQuZG9BY3Rpb24oJ2dlc3R1cmVzJywgZnVuY3Rpb24gKGluZGV4LCBnZXN0dXJlKSB7CiAgICAgIGlmICghJC5nZXN0dXJlcy5zdG9wZWQpIHsKICAgICAgICBpZiAoJC5vcHRpb25zLmdlc3R1cmVDb25maWdbZ2VzdHVyZS5uYW1lXSAhPT0gZmFsc2UpIHsKICAgICAgICAgIGdlc3R1cmUuaGFuZGxlKGV2ZW50LCB0b3VjaCk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9OwogIC8qKgogICAqIOaaguaXtuaXoOeUqAogICAqIEBwYXJhbSB7T2JqZWN0fSBub2RlCiAgICogQHBhcmFtIHtPYmplY3R9IHBhcmVudAogICAqLwoKCiAgdmFyIGhhc1BhcmVudCA9IGZ1bmN0aW9uIGhhc1BhcmVudChub2RlLCBwYXJlbnQpIHsKICAgIHdoaWxlIChub2RlKSB7CiAgICAgIGlmIChub2RlID09IHBhcmVudCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlOwogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9OwoKICB2YXIgdW5pcXVlQXJyYXkgPSBmdW5jdGlvbiB1bmlxdWVBcnJheShzcmMsIGtleSwgc29ydCkgewogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIHZhciB2YWx1ZXMgPSBbXTsKICAgIHZhciBpID0gMDsKCiAgICB3aGlsZSAoaSA8IHNyYy5sZW5ndGgpIHsKICAgICAgdmFyIHZhbCA9IGtleSA/IHNyY1tpXVtrZXldIDogc3JjW2ldOwoKICAgICAgaWYgKHZhbHVlcy5pbmRleE9mKHZhbCkgPCAwKSB7CiAgICAgICAgcmVzdWx0cy5wdXNoKHNyY1tpXSk7CiAgICAgIH0KCiAgICAgIHZhbHVlc1tpXSA9IHZhbDsKICAgICAgaSsrOwogICAgfQoKICAgIGlmIChzb3J0KSB7CiAgICAgIGlmICgha2V5KSB7CiAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuc29ydCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLnNvcnQoZnVuY3Rpb24gc29ydFVuaXF1ZUFycmF5KGEsIGIpIHsKICAgICAgICAgIHJldHVybiBhW2tleV0gPiBiW2tleV07CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICB2YXIgZ2V0TXVsdGlDZW50ZXIgPSBmdW5jdGlvbiBnZXRNdWx0aUNlbnRlcih0b3VjaGVzKSB7CiAgICB2YXIgdG91Y2hlc0xlbmd0aCA9IHRvdWNoZXMubGVuZ3RoOwoKICAgIGlmICh0b3VjaGVzTGVuZ3RoID09PSAxKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgeDogcm91bmQodG91Y2hlc1swXS5wYWdlWCksCiAgICAgICAgeTogcm91bmQodG91Y2hlc1swXS5wYWdlWSkKICAgICAgfTsKICAgIH0KCiAgICB2YXIgeCA9IDA7CiAgICB2YXIgeSA9IDA7CiAgICB2YXIgaSA9IDA7CgogICAgd2hpbGUgKGkgPCB0b3VjaGVzTGVuZ3RoKSB7CiAgICAgIHggKz0gdG91Y2hlc1tpXS5wYWdlWDsKICAgICAgeSArPSB0b3VjaGVzW2ldLnBhZ2VZOwogICAgICBpKys7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgeDogcm91bmQoeCAvIHRvdWNoZXNMZW5ndGgpLAogICAgICB5OiByb3VuZCh5IC8gdG91Y2hlc0xlbmd0aCkKICAgIH07CiAgfTsKCiAgdmFyIG11bHRpVG91Y2ggPSBmdW5jdGlvbiBtdWx0aVRvdWNoKCkgewogICAgcmV0dXJuICQub3B0aW9ucy5nZXN0dXJlQ29uZmlnLnBpbmNoOwogIH07CgogIHZhciBjb3B5U2ltcGxlVG91Y2hEYXRhID0gZnVuY3Rpb24gY29weVNpbXBsZVRvdWNoRGF0YSh0b3VjaCkgewogICAgdmFyIHRvdWNoZXMgPSBbXTsKICAgIHZhciBpID0gMDsKCiAgICB3aGlsZSAoaSA8IHRvdWNoLnRvdWNoZXMubGVuZ3RoKSB7CiAgICAgIHRvdWNoZXNbaV0gPSB7CiAgICAgICAgcGFnZVg6IHJvdW5kKHRvdWNoLnRvdWNoZXNbaV0ucGFnZVgpLAogICAgICAgIHBhZ2VZOiByb3VuZCh0b3VjaC50b3VjaGVzW2ldLnBhZ2VZKQogICAgICB9OwogICAgICBpKys7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgdGltZXN0YW1wOiAkLm5vdygpLAogICAgICBnZXN0dXJlOiB0b3VjaC5nZXN0dXJlLAogICAgICB0b3VjaGVzOiB0b3VjaGVzLAogICAgICBjZW50ZXI6IGdldE11bHRpQ2VudGVyKHRvdWNoLnRvdWNoZXMpLAogICAgICBkZWx0YVg6IHRvdWNoLmRlbHRhWCwKICAgICAgZGVsdGFZOiB0b3VjaC5kZWx0YVkKICAgIH07CiAgfTsKCiAgdmFyIGNhbERlbHRhID0gZnVuY3Rpb24gY2FsRGVsdGEodG91Y2gpIHsKICAgIHZhciBzZXNzaW9uID0gJC5nZXN0dXJlcy5zZXNzaW9uOwogICAgdmFyIGNlbnRlciA9IHRvdWNoLmNlbnRlcjsKICAgIHZhciBvZmZzZXQgPSBzZXNzaW9uLm9mZnNldERlbHRhIHx8IHt9OwogICAgdmFyIHByZXZEZWx0YSA9IHNlc3Npb24ucHJldkRlbHRhIHx8IHt9OwogICAgdmFyIHByZXZUb3VjaCA9IHNlc3Npb24ucHJldlRvdWNoIHx8IHt9OwoKICAgIGlmICh0b3VjaC5nZXN0dXJlLnR5cGUgPT09ICQuRVZFTlRfU1RBUlQgfHwgdG91Y2guZ2VzdHVyZS50eXBlID09PSAkLkVWRU5UX0VORCkgewogICAgICBwcmV2RGVsdGEgPSBzZXNzaW9uLnByZXZEZWx0YSA9IHsKICAgICAgICB4OiBwcmV2VG91Y2guZGVsdGFYIHx8IDAsCiAgICAgICAgeTogcHJldlRvdWNoLmRlbHRhWSB8fCAwCiAgICAgIH07CiAgICAgIG9mZnNldCA9IHNlc3Npb24ub2Zmc2V0RGVsdGEgPSB7CiAgICAgICAgeDogY2VudGVyLngsCiAgICAgICAgeTogY2VudGVyLnkKICAgICAgfTsKICAgIH0KCiAgICB0b3VjaC5kZWx0YVggPSBwcmV2RGVsdGEueCArIChjZW50ZXIueCAtIG9mZnNldC54KTsKICAgIHRvdWNoLmRlbHRhWSA9IHByZXZEZWx0YS55ICsgKGNlbnRlci55IC0gb2Zmc2V0LnkpOwogIH07CgogIHZhciBjYWxUb3VjaERhdGEgPSBmdW5jdGlvbiBjYWxUb3VjaERhdGEodG91Y2gpIHsKICAgIHZhciBzZXNzaW9uID0gJC5nZXN0dXJlcy5zZXNzaW9uOwogICAgdmFyIHRvdWNoZXMgPSB0b3VjaC50b3VjaGVzOwogICAgdmFyIHRvdWNoZXNMZW5ndGggPSB0b3VjaGVzLmxlbmd0aDsKCiAgICBpZiAoIXNlc3Npb24uZmlyc3RUb3VjaCkgewogICAgICBzZXNzaW9uLmZpcnN0VG91Y2ggPSBjb3B5U2ltcGxlVG91Y2hEYXRhKHRvdWNoKTsKICAgIH0KCiAgICBpZiAobXVsdGlUb3VjaCgpICYmIHRvdWNoZXNMZW5ndGggPiAxICYmICFzZXNzaW9uLmZpcnN0TXVsdGlUb3VjaCkgewogICAgICBzZXNzaW9uLmZpcnN0TXVsdGlUb3VjaCA9IGNvcHlTaW1wbGVUb3VjaERhdGEodG91Y2gpOwogICAgfSBlbHNlIGlmICh0b3VjaGVzTGVuZ3RoID09PSAxKSB7CiAgICAgIHNlc3Npb24uZmlyc3RNdWx0aVRvdWNoID0gZmFsc2U7CiAgICB9CgogICAgdmFyIGZpcnN0VG91Y2ggPSBzZXNzaW9uLmZpcnN0VG91Y2g7CiAgICB2YXIgZmlyc3RNdWx0aVRvdWNoID0gc2Vzc2lvbi5maXJzdE11bHRpVG91Y2g7CiAgICB2YXIgb2Zmc2V0Q2VudGVyID0gZmlyc3RNdWx0aVRvdWNoID8gZmlyc3RNdWx0aVRvdWNoLmNlbnRlciA6IGZpcnN0VG91Y2guY2VudGVyOwogICAgdmFyIGNlbnRlciA9IHRvdWNoLmNlbnRlciA9IGdldE11bHRpQ2VudGVyKHRvdWNoZXMpOwogICAgdG91Y2gudGltZXN0YW1wID0gJC5ub3coKTsKICAgIHRvdWNoLmRlbHRhVGltZSA9IHRvdWNoLnRpbWVzdGFtcCAtIGZpcnN0VG91Y2gudGltZXN0YW1wOwogICAgdG91Y2guYW5nbGUgPSBnZXRBbmdsZShvZmZzZXRDZW50ZXIsIGNlbnRlcik7CiAgICB0b3VjaC5kaXN0YW5jZSA9IGdldERpc3RhbmNlKG9mZnNldENlbnRlciwgY2VudGVyKTsKICAgIGNhbERlbHRhKHRvdWNoKTsKICAgIHRvdWNoLm9mZnNldERpcmVjdGlvbiA9IGdldERpcmVjdGlvbih0b3VjaC5kZWx0YVgsIHRvdWNoLmRlbHRhWSk7CiAgICB0b3VjaC5zY2FsZSA9IGZpcnN0TXVsdGlUb3VjaCA/IGdldFNjYWxlKGZpcnN0TXVsdGlUb3VjaC50b3VjaGVzLCB0b3VjaGVzKSA6IDE7CiAgICB0b3VjaC5yb3RhdGlvbiA9IGZpcnN0TXVsdGlUb3VjaCA/IGdldFJvdGF0aW9uKGZpcnN0TXVsdGlUb3VjaC50b3VjaGVzLCB0b3VjaGVzKSA6IDA7CiAgICBjYWxJbnRlcnZhbFRvdWNoRGF0YSh0b3VjaCk7CiAgfTsKCiAgdmFyIENBTF9JTlRFUlZBTCA9IDI1OwoKICB2YXIgY2FsSW50ZXJ2YWxUb3VjaERhdGEgPSBmdW5jdGlvbiBjYWxJbnRlcnZhbFRvdWNoRGF0YSh0b3VjaCkgewogICAgdmFyIHNlc3Npb24gPSAkLmdlc3R1cmVzLnNlc3Npb247CiAgICB2YXIgbGFzdCA9IHNlc3Npb24ubGFzdEludGVydmFsIHx8IHRvdWNoOwogICAgdmFyIGRlbHRhVGltZSA9IHRvdWNoLnRpbWVzdGFtcCAtIGxhc3QudGltZXN0YW1wOwogICAgdmFyIHZlbG9jaXR5OwogICAgdmFyIHZlbG9jaXR5WDsKICAgIHZhciB2ZWxvY2l0eVk7CiAgICB2YXIgZGlyZWN0aW9uOwoKICAgIGlmICh0b3VjaC5nZXN0dXJlLnR5cGUgIT0gJC5FVkVOVF9DQU5DRUwgJiYgKGRlbHRhVGltZSA+IENBTF9JTlRFUlZBTCB8fCBsYXN0LnZlbG9jaXR5ID09PSB1bmRlZmluZWQpKSB7CiAgICAgIHZhciBkZWx0YVggPSBsYXN0LmRlbHRhWCAtIHRvdWNoLmRlbHRhWDsKICAgICAgdmFyIGRlbHRhWSA9IGxhc3QuZGVsdGFZIC0gdG91Y2guZGVsdGFZOwogICAgICB2YXIgdiA9IGdldFZlbG9jaXR5KGRlbHRhVGltZSwgZGVsdGFYLCBkZWx0YVkpOwogICAgICB2ZWxvY2l0eVggPSB2Lng7CiAgICAgIHZlbG9jaXR5WSA9IHYueTsKICAgICAgdmVsb2NpdHkgPSBhYnModi54KSA+IGFicyh2LnkpID8gdi54IDogdi55OwogICAgICBkaXJlY3Rpb24gPSBnZXREaXJlY3Rpb24oZGVsdGFYLCBkZWx0YVkpIHx8IGxhc3QuZGlyZWN0aW9uOwogICAgICBzZXNzaW9uLmxhc3RJbnRlcnZhbCA9IHRvdWNoOwogICAgfSBlbHNlIHsKICAgICAgdmVsb2NpdHkgPSBsYXN0LnZlbG9jaXR5OwogICAgICB2ZWxvY2l0eVggPSBsYXN0LnZlbG9jaXR5WDsKICAgICAgdmVsb2NpdHlZID0gbGFzdC52ZWxvY2l0eVk7CiAgICAgIGRpcmVjdGlvbiA9IGxhc3QuZGlyZWN0aW9uOwogICAgfQoKICAgIHRvdWNoLnZlbG9jaXR5ID0gdmVsb2NpdHk7CiAgICB0b3VjaC52ZWxvY2l0eVggPSB2ZWxvY2l0eVg7CiAgICB0b3VjaC52ZWxvY2l0eVkgPSB2ZWxvY2l0eVk7CiAgICB0b3VjaC5kaXJlY3Rpb24gPSBkaXJlY3Rpb247CiAgfTsKCiAgdmFyIHRhcmdldElkcyA9IHt9OwoKICB2YXIgY29udmVydFRvdWNoZXMgPSBmdW5jdGlvbiBjb252ZXJ0VG91Y2hlcyh0b3VjaGVzKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRvdWNoZXMubGVuZ3RoOyBpKyspIHsKICAgICAgIXRvdWNoZXNbJ2lkZW50aWZpZXInXSAmJiAodG91Y2hlc1snaWRlbnRpZmllciddID0gMCk7CiAgICB9CgogICAgcmV0dXJuIHRvdWNoZXM7CiAgfTsKCiAgdmFyIGdldFRvdWNoZXMgPSBmdW5jdGlvbiBnZXRUb3VjaGVzKGV2ZW50LCB0b3VjaCkgewogICAgdmFyIGFsbFRvdWNoZXMgPSBjb252ZXJ0VG91Y2hlcygkLnNsaWNlLmNhbGwoZXZlbnQudG91Y2hlcyB8fCBbZXZlbnRdKSk7CiAgICB2YXIgdHlwZSA9IGV2ZW50LnR5cGU7CiAgICB2YXIgdGFyZ2V0VG91Y2hlcyA9IFtdOwogICAgdmFyIGNoYW5nZWRUYXJnZXRUb3VjaGVzID0gW107IC8v5b2TdG91Y2hzdGFydOaIlnRvdWNobW92ZeS4lHRvdWNoZXPplb/luqbkuLox77yM55u05o6l6I635b6XYWxs5ZKMY2hhbmdlZAoKICAgIGlmICgodHlwZSA9PT0gJC5FVkVOVF9TVEFSVCB8fCB0eXBlID09PSAkLkVWRU5UX01PVkUpICYmIGFsbFRvdWNoZXMubGVuZ3RoID09PSAxKSB7CiAgICAgIHRhcmdldElkc1thbGxUb3VjaGVzWzBdLmlkZW50aWZpZXJdID0gdHJ1ZTsKICAgICAgdGFyZ2V0VG91Y2hlcyA9IGFsbFRvdWNoZXM7CiAgICAgIGNoYW5nZWRUYXJnZXRUb3VjaGVzID0gYWxsVG91Y2hlczsKICAgICAgdG91Y2gudGFyZ2V0ID0gZXZlbnQudGFyZ2V0OwogICAgfSBlbHNlIHsKICAgICAgdmFyIGkgPSAwOwogICAgICB2YXIgdGFyZ2V0VG91Y2hlcyA9IFtdOwogICAgICB2YXIgY2hhbmdlZFRhcmdldFRvdWNoZXMgPSBbXTsKICAgICAgdmFyIGNoYW5nZWRUb3VjaGVzID0gY29udmVydFRvdWNoZXMoJC5zbGljZS5jYWxsKGV2ZW50LmNoYW5nZWRUb3VjaGVzIHx8IFtldmVudF0pKTsKICAgICAgdG91Y2gudGFyZ2V0ID0gZXZlbnQudGFyZ2V0OwogICAgICB2YXIgc2Vzc2lvblRhcmdldCA9ICQuZ2VzdHVyZXMuc2Vzc2lvbi50YXJnZXQgfHwgZXZlbnQudGFyZ2V0OwogICAgICB0YXJnZXRUb3VjaGVzID0gYWxsVG91Y2hlcy5maWx0ZXIoZnVuY3Rpb24gKHRvdWNoKSB7CiAgICAgICAgcmV0dXJuIGhhc1BhcmVudCh0b3VjaC50YXJnZXQsIHNlc3Npb25UYXJnZXQpOwogICAgICB9KTsKCiAgICAgIGlmICh0eXBlID09PSAkLkVWRU5UX1NUQVJUKSB7CiAgICAgICAgaSA9IDA7CgogICAgICAgIHdoaWxlIChpIDwgdGFyZ2V0VG91Y2hlcy5sZW5ndGgpIHsKICAgICAgICAgIHRhcmdldElkc1t0YXJnZXRUb3VjaGVzW2ldLmlkZW50aWZpZXJdID0gdHJ1ZTsKICAgICAgICAgIGkrKzsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGkgPSAwOwoKICAgICAgd2hpbGUgKGkgPCBjaGFuZ2VkVG91Y2hlcy5sZW5ndGgpIHsKICAgICAgICBpZiAodGFyZ2V0SWRzW2NoYW5nZWRUb3VjaGVzW2ldLmlkZW50aWZpZXJdKSB7CiAgICAgICAgICBjaGFuZ2VkVGFyZ2V0VG91Y2hlcy5wdXNoKGNoYW5nZWRUb3VjaGVzW2ldKTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlID09PSAkLkVWRU5UX0VORCB8fCB0eXBlID09PSAkLkVWRU5UX0NBTkNFTCkgewogICAgICAgICAgZGVsZXRlIHRhcmdldElkc1tjaGFuZ2VkVG91Y2hlc1tpXS5pZGVudGlmaWVyXTsKICAgICAgICB9CgogICAgICAgIGkrKzsKICAgICAgfQoKICAgICAgaWYgKCFjaGFuZ2VkVGFyZ2V0VG91Y2hlcy5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KCiAgICB0YXJnZXRUb3VjaGVzID0gdW5pcXVlQXJyYXkodGFyZ2V0VG91Y2hlcy5jb25jYXQoY2hhbmdlZFRhcmdldFRvdWNoZXMpLCAnaWRlbnRpZmllcicsIHRydWUpOwogICAgdmFyIHRvdWNoZXNMZW5ndGggPSB0YXJnZXRUb3VjaGVzLmxlbmd0aDsKICAgIHZhciBjaGFuZ2VkVG91Y2hlc0xlbmd0aCA9IGNoYW5nZWRUYXJnZXRUb3VjaGVzLmxlbmd0aDsKCiAgICBpZiAodHlwZSA9PT0gJC5FVkVOVF9TVEFSVCAmJiB0b3VjaGVzTGVuZ3RoIC0gY2hhbmdlZFRvdWNoZXNMZW5ndGggPT09IDApIHsKICAgICAgLy9maXJzdAogICAgICB0b3VjaC5pc0ZpcnN0ID0gdHJ1ZTsKICAgICAgJC5nZXN0dXJlcy50b3VjaCA9ICQuZ2VzdHVyZXMuc2Vzc2lvbiA9IHsKICAgICAgICB0YXJnZXQ6IGV2ZW50LnRhcmdldAogICAgICB9OwogICAgfQoKICAgIHRvdWNoLmlzRmluYWwgPSAodHlwZSA9PT0gJC5FVkVOVF9FTkQgfHwgdHlwZSA9PT0gJC5FVkVOVF9DQU5DRUwpICYmIHRvdWNoZXNMZW5ndGggLSBjaGFuZ2VkVG91Y2hlc0xlbmd0aCA9PT0gMDsKICAgIHRvdWNoLnRvdWNoZXMgPSB0YXJnZXRUb3VjaGVzOwogICAgdG91Y2guY2hhbmdlZFRvdWNoZXMgPSBjaGFuZ2VkVGFyZ2V0VG91Y2hlczsKICAgIHJldHVybiB0cnVlOwogIH07CgogIHZhciBoYW5kbGVUb3VjaEV2ZW50ID0gZnVuY3Rpb24gaGFuZGxlVG91Y2hFdmVudChldmVudCkgewogICAgdmFyIHRvdWNoID0gewogICAgICBnZXN0dXJlOiBldmVudAogICAgfTsKICAgIHZhciB0b3VjaGVzID0gZ2V0VG91Y2hlcyhldmVudCwgdG91Y2gpOwoKICAgIGlmICghdG91Y2hlcykgewogICAgICByZXR1cm47CiAgICB9CgogICAgY2FsVG91Y2hEYXRhKHRvdWNoKTsKICAgIGRldGVjdChldmVudCwgdG91Y2gpOwogICAgJC5nZXN0dXJlcy5zZXNzaW9uLnByZXZUb3VjaCA9IHRvdWNoOwoKICAgIGlmIChldmVudC50eXBlID09PSAkLkVWRU5UX0VORCAmJiAhJC5pc1RvdWNoYWJsZSkgewogICAgICAkLmdlc3R1cmVzLnRvdWNoID0gJC5nZXN0dXJlcy5zZXNzaW9uID0ge307CiAgICB9CiAgfTsKCiAgdmFyIHN1cHBvcnRzUGFzc2l2ZSA9IGZ1bmN0aW9uIGNoZWNrUGFzc2l2ZUxpc3RlbmVyKCkgewogICAgdmFyIHN1cHBvcnRzUGFzc2l2ZSA9IGZhbHNlOwoKICAgIHRyeSB7CiAgICAgIHZhciBvcHRzID0gT2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LCAncGFzc2l2ZScsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHN1cHBvcnRzUGFzc2l2ZSA9IHRydWU7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Rlc3RQYXNzaXZlTGlzdGVuZXInLCBudWxsLCBvcHRzKTsKICAgIH0gY2F0Y2ggKGUpIHsvLyBObyBzdXBwb3J0CiAgICB9CgogICAgcmV0dXJuIHN1cHBvcnRzUGFzc2l2ZTsKICB9KCk7CgogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCQuRVZFTlRfU1RBUlQsIGhhbmRsZVRvdWNoRXZlbnQpOwogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCQuRVZFTlRfTU9WRSwgaGFuZGxlVG91Y2hFdmVudCwgc3VwcG9ydHNQYXNzaXZlID8gewogICAgcGFzc2l2ZTogZmFsc2UsCiAgICBjYXB0dXJlOiBmYWxzZQogIH0gOiBmYWxzZSk7CiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJC5FVkVOVF9FTkQsIGhhbmRsZVRvdWNoRXZlbnQpOwogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCQuRVZFTlRfQ0FOQ0VMLCBoYW5kbGVUb3VjaEV2ZW50KTsgLy9maXhlZCBoYXNoY2hhbmdlKGFuZHJvaWQpCgogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCQuRVZFTlRfQ0xJQ0ssIGZ1bmN0aW9uIChlKSB7CiAgICAvL1RPRE8g5bqU6K+l5Yik5pat5b2T5YmNdGFyZ2V05piv5LiN5piv5ZyodGFyZ2V0cy5wb3BvdmVy5YaF6YOo77yM6ICM5LiN5piv6Z2e6KaB55u4562JCiAgICBpZiAoKCQub3MuYW5kcm9pZCB8fCAkLm9zLmlvcykgJiYgKCQudGFyZ2V0cy5wb3BvdmVyICYmIGUudGFyZ2V0ID09PSAkLnRhcmdldHMucG9wb3ZlciB8fCAkLnRhcmdldHMudGFiIHx8ICQudGFyZ2V0cy5vZmZjYW52YXMgfHwgJC50YXJnZXRzLm1vZGFsKSkgewogICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICB9CiAgfSwgdHJ1ZSk7IC8v5aKe5Yqg5Y6f55Sf5rua5Yqo6K+G5YirCgogICQuaXNTY3JvbGxpbmcgPSBmYWxzZTsKICB2YXIgc2Nyb2xsaW5nVGltZW91dCA9IG51bGw7CiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGZ1bmN0aW9uICgpIHsKICAgICQuaXNTY3JvbGxpbmcgPSB0cnVlOwogICAgc2Nyb2xsaW5nVGltZW91dCAmJiBjbGVhclRpbWVvdXQoc2Nyb2xsaW5nVGltZW91dCk7CiAgICBzY3JvbGxpbmdUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICQuaXNTY3JvbGxpbmcgPSBmYWxzZTsKICAgIH0sIDI1MCk7CiAgfSk7Cn0pKG11aSwgd2luZG93KTsKLyoqCiAqIG11aSBnZXN0dXJlIGZsaWNrW2xlZnR8cmlnaHR8dXB8ZG93bl0KICogQHBhcmFtIHt0eXBlfSAkCiAqIEBwYXJhbSB7dHlwZX0gbmFtZQogKiBAcmV0dXJucyB7dW5kZWZpbmVkfQogKi8KCgooZnVuY3Rpb24gKCQsIG5hbWUpIHsKICB2YXIgZmxpY2tTdGFydFRpbWUgPSAwOwoKICB2YXIgaGFuZGxlID0gZnVuY3Rpb24gaGFuZGxlKGV2ZW50LCB0b3VjaCkgewogICAgdmFyIHNlc3Npb24gPSAkLmdlc3R1cmVzLnNlc3Npb247CiAgICB2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9uczsKICAgIHZhciBub3cgPSAkLm5vdygpOwoKICAgIHN3aXRjaCAoZXZlbnQudHlwZSkgewogICAgICBjYXNlICQuRVZFTlRfTU9WRToKICAgICAgICBpZiAobm93IC0gZmxpY2tTdGFydFRpbWUgPiAzMDApIHsKICAgICAgICAgIGZsaWNrU3RhcnRUaW1lID0gbm93OwogICAgICAgICAgc2Vzc2lvbi5mbGlja1N0YXJ0ID0gdG91Y2guY2VudGVyOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICQuRVZFTlRfRU5EOgogICAgICBjYXNlICQuRVZFTlRfQ0FOQ0VMOgogICAgICAgIHRvdWNoLmZsaWNrID0gZmFsc2U7CgogICAgICAgIGlmIChzZXNzaW9uLmZsaWNrU3RhcnQgJiYgb3B0aW9ucy5mbGlja01heFRpbWUgPiBub3cgLSBmbGlja1N0YXJ0VGltZSAmJiB0b3VjaC5kaXN0YW5jZSA+IG9wdGlvbnMuZmxpY2tNaW5EaXN0aW5jZSkgewogICAgICAgICAgdG91Y2guZmxpY2sgPSB0cnVlOwogICAgICAgICAgdG91Y2guZmxpY2tUaW1lID0gbm93IC0gZmxpY2tTdGFydFRpbWU7CiAgICAgICAgICB0b3VjaC5mbGlja0Rpc3RhbmNlWCA9IHRvdWNoLmNlbnRlci54IC0gc2Vzc2lvbi5mbGlja1N0YXJ0Lng7CiAgICAgICAgICB0b3VjaC5mbGlja0Rpc3RhbmNlWSA9IHRvdWNoLmNlbnRlci55IC0gc2Vzc2lvbi5mbGlja1N0YXJ0Lnk7CiAgICAgICAgICAkLnRyaWdnZXIoc2Vzc2lvbi50YXJnZXQsIG5hbWUsIHRvdWNoKTsKICAgICAgICAgICQudHJpZ2dlcihzZXNzaW9uLnRhcmdldCwgbmFtZSArIHRvdWNoLmRpcmVjdGlvbiwgdG91Y2gpOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CiAgICB9CiAgfTsKICAvKioKICAgKiBtdWkgZ2VzdHVyZSBmbGljawogICAqLwoKCiAgJC5hZGRHZXN0dXJlKHsKICAgIG5hbWU6IG5hbWUsCiAgICBpbmRleDogNSwKICAgIGhhbmRsZTogaGFuZGxlLAogICAgb3B0aW9uczogewogICAgICBmbGlja01heFRpbWU6IDIwMCwKICAgICAgZmxpY2tNaW5EaXN0aW5jZTogMTAKICAgIH0KICB9KTsKfSkobXVpLCAnZmxpY2snKTsKLyoqCiAqIG11aSBnZXN0dXJlIHN3aXBlW2xlZnR8cmlnaHR8dXB8ZG93bl0KICogQHBhcmFtIHt0eXBlfSAkCiAqIEBwYXJhbSB7dHlwZX0gbmFtZQogKiBAcmV0dXJucyB7dW5kZWZpbmVkfQogKi8KCgooZnVuY3Rpb24gKCQsIG5hbWUpIHsKICB2YXIgaGFuZGxlID0gZnVuY3Rpb24gaGFuZGxlKGV2ZW50LCB0b3VjaCkgewogICAgdmFyIHNlc3Npb24gPSAkLmdlc3R1cmVzLnNlc3Npb247CgogICAgaWYgKGV2ZW50LnR5cGUgPT09ICQuRVZFTlRfRU5EIHx8IGV2ZW50LnR5cGUgPT09ICQuRVZFTlRfQ0FOQ0VMKSB7CiAgICAgIHZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zOwogICAgICB0b3VjaC5zd2lwZSA9IGZhbHNlOyAvL1RPRE8g5ZCO57ut5qC55o2udmVsb2NpdHnorqHnrpcKCiAgICAgIGlmICh0b3VjaC5kaXJlY3Rpb24gJiYgb3B0aW9ucy5zd2lwZU1heFRpbWUgPiB0b3VjaC5kZWx0YVRpbWUgJiYgdG91Y2guZGlzdGFuY2UgPiBvcHRpb25zLnN3aXBlTWluRGlzdGluY2UpIHsKICAgICAgICB0b3VjaC5zd2lwZSA9IHRydWU7CiAgICAgICAgJC50cmlnZ2VyKHNlc3Npb24udGFyZ2V0LCBuYW1lLCB0b3VjaCk7CiAgICAgICAgJC50cmlnZ2VyKHNlc3Npb24udGFyZ2V0LCBuYW1lICsgdG91Y2guZGlyZWN0aW9uLCB0b3VjaCk7CiAgICAgIH0KICAgIH0KICB9OwogIC8qKgogICAqIG11aSBnZXN0dXJlIHN3aXBlCiAgICovCgoKICAkLmFkZEdlc3R1cmUoewogICAgbmFtZTogbmFtZSwKICAgIGluZGV4OiAxMCwKICAgIGhhbmRsZTogaGFuZGxlLAogICAgb3B0aW9uczogewogICAgICBzd2lwZU1heFRpbWU6IDMwMCwKICAgICAgc3dpcGVNaW5EaXN0aW5jZTogMTgKICAgIH0KICB9KTsKfSkobXVpLCAnc3dpcGUnKTsKLyoqCiAqIG11aSBnZXN0dXJlIGRyYWdbc3RhcnR8bGVmdHxyaWdodHx1cHxkb3dufGVuZF0KICogQHBhcmFtIHt0eXBlfSAkCiAqIEBwYXJhbSB7dHlwZX0gbmFtZQogKiBAcmV0dXJucyB7dW5kZWZpbmVkfQogKi8KCgooZnVuY3Rpb24gKCQsIG5hbWUpIHsKICB2YXIgaGFuZGxlID0gZnVuY3Rpb24gaGFuZGxlKGV2ZW50LCB0b3VjaCkgewogICAgdmFyIHNlc3Npb24gPSAkLmdlc3R1cmVzLnNlc3Npb247CgogICAgc3dpdGNoIChldmVudC50eXBlKSB7CiAgICAgIGNhc2UgJC5FVkVOVF9TVEFSVDoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJC5FVkVOVF9NT1ZFOgogICAgICAgIGlmICghdG91Y2guZGlyZWN0aW9uIHx8ICFzZXNzaW9uLnRhcmdldCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gLy/kv67mraNkaXJlY3Rpb24s5Y+v5Zyoc2Vzc2lvbuacn+mXtOiHquihjOmUgeWumuaLluaLveaWueWQke+8jOaWueS+v+W8gOWPkXNjcm9sbOexu+S4jeWQjOaWueWQkeaLluaLveaPkuS7tuW1jOWllwoKCiAgICAgICAgaWYgKHNlc3Npb24ubG9ja0RpcmVjdGlvbiAmJiBzZXNzaW9uLnN0YXJ0RGlyZWN0aW9uKSB7CiAgICAgICAgICBpZiAoc2Vzc2lvbi5zdGFydERpcmVjdGlvbiAmJiBzZXNzaW9uLnN0YXJ0RGlyZWN0aW9uICE9PSB0b3VjaC5kaXJlY3Rpb24pIHsKICAgICAgICAgICAgaWYgKHNlc3Npb24uc3RhcnREaXJlY3Rpb24gPT09ICd1cCcgfHwgc2Vzc2lvbi5zdGFydERpcmVjdGlvbiA9PT0gJ2Rvd24nKSB7CiAgICAgICAgICAgICAgdG91Y2guZGlyZWN0aW9uID0gdG91Y2guZGVsdGFZIDwgMCA/ICd1cCcgOiAnZG93bic7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdG91Y2guZGlyZWN0aW9uID0gdG91Y2guZGVsdGFYIDwgMCA/ICdsZWZ0JyA6ICdyaWdodCc7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghc2Vzc2lvbi5kcmFnKSB7CiAgICAgICAgICBzZXNzaW9uLmRyYWcgPSB0cnVlOwogICAgICAgICAgJC50cmlnZ2VyKHNlc3Npb24udGFyZ2V0LCBuYW1lICsgJ3N0YXJ0JywgdG91Y2gpOwogICAgICAgIH0KCiAgICAgICAgJC50cmlnZ2VyKHNlc3Npb24udGFyZ2V0LCBuYW1lLCB0b3VjaCk7CiAgICAgICAgJC50cmlnZ2VyKHNlc3Npb24udGFyZ2V0LCBuYW1lICsgdG91Y2guZGlyZWN0aW9uLCB0b3VjaCk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICQuRVZFTlRfRU5EOgogICAgICBjYXNlICQuRVZFTlRfQ0FOQ0VMOgogICAgICAgIGlmIChzZXNzaW9uLmRyYWcgJiYgdG91Y2guaXNGaW5hbCkgewogICAgICAgICAgJC50cmlnZ2VyKHNlc3Npb24udGFyZ2V0LCBuYW1lICsgJ2VuZCcsIHRvdWNoKTsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwogICAgfQogIH07CiAgLyoqCiAgICogbXVpIGdlc3R1cmUgZHJhZwogICAqLwoKCiAgJC5hZGRHZXN0dXJlKHsKICAgIG5hbWU6IG5hbWUsCiAgICBpbmRleDogMjAsCiAgICBoYW5kbGU6IGhhbmRsZSwKICAgIG9wdGlvbnM6IHsKICAgICAgZmluZ2VyczogMQogICAgfQogIH0pOwp9KShtdWksICdkcmFnJyk7Ci8qKgogKiBtdWkgZ2VzdHVyZSB0YXAgYW5kIGRvdWJsZVRhcAogKiBAcGFyYW0ge3R5cGV9ICQKICogQHBhcmFtIHt0eXBlfSBuYW1lCiAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAqLwoKCihmdW5jdGlvbiAoJCwgbmFtZSkgewogIHZhciBsYXN0VGFyZ2V0OwogIHZhciBsYXN0VGFwVGltZTsKCiAgdmFyIGhhbmRsZSA9IGZ1bmN0aW9uIGhhbmRsZShldmVudCwgdG91Y2gpIHsKICAgIHZhciBzZXNzaW9uID0gJC5nZXN0dXJlcy5zZXNzaW9uOwogICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgogICAgc3dpdGNoIChldmVudC50eXBlKSB7CiAgICAgIGNhc2UgJC5FVkVOVF9FTkQ6CiAgICAgICAgaWYgKCF0b3VjaC5pc0ZpbmFsKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgdGFyZ2V0ID0gc2Vzc2lvbi50YXJnZXQ7CgogICAgICAgIGlmICghdGFyZ2V0IHx8IHRhcmdldC5kaXNhYmxlZCB8fCB0YXJnZXQuY2xhc3NMaXN0ICYmIHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ211aS1kaXNhYmxlZCcpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAodG91Y2guZGlzdGFuY2UgPCBvcHRpb25zLnRhcE1heERpc3RhbmNlICYmIHRvdWNoLmRlbHRhVGltZSA8IG9wdGlvbnMudGFwTWF4VGltZSkgewogICAgICAgICAgaWYgKCQub3B0aW9ucy5nZXN0dXJlQ29uZmlnLmRvdWJsZXRhcCAmJiBsYXN0VGFyZ2V0ICYmIGxhc3RUYXJnZXQgPT09IHRhcmdldCkgewogICAgICAgICAgICAvL3NhbWUgdGFyZ2V0CiAgICAgICAgICAgIGlmIChsYXN0VGFwVGltZSAmJiB0b3VjaC50aW1lc3RhbXAgLSBsYXN0VGFwVGltZSA8IG9wdGlvbnMudGFwTWF4SW50ZXJ2YWwpIHsKICAgICAgICAgICAgICAkLnRyaWdnZXIodGFyZ2V0LCAnZG91YmxldGFwJywgdG91Y2gpOwogICAgICAgICAgICAgIGxhc3RUYXBUaW1lID0gJC5ub3coKTsKICAgICAgICAgICAgICBsYXN0VGFyZ2V0ID0gdGFyZ2V0OwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgICQudHJpZ2dlcih0YXJnZXQsIG5hbWUsIHRvdWNoKTsKICAgICAgICAgIGxhc3RUYXBUaW1lID0gJC5ub3coKTsKICAgICAgICAgIGxhc3RUYXJnZXQgPSB0YXJnZXQ7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKICAgIH0KICB9OwogIC8qKgogICAqIG11aSBnZXN0dXJlIHRhcAogICAqLwoKCiAgJC5hZGRHZXN0dXJlKHsKICAgIG5hbWU6IG5hbWUsCiAgICBpbmRleDogMzAsCiAgICBoYW5kbGU6IGhhbmRsZSwKICAgIG9wdGlvbnM6IHsKICAgICAgZmluZ2VyczogMSwKICAgICAgdGFwTWF4SW50ZXJ2YWw6IDMwMCwKICAgICAgdGFwTWF4RGlzdGFuY2U6IDUsCiAgICAgIHRhcE1heFRpbWU6IDI1MAogICAgfQogIH0pOwp9KShtdWksICd0YXAnKTsKLyoqCiAqIG11aSBnZXN0dXJlIGxvbmd0YXAKICogQHBhcmFtIHt0eXBlfSAkCiAqIEBwYXJhbSB7dHlwZX0gbmFtZQogKiBAcmV0dXJucyB7dW5kZWZpbmVkfQogKi8KCgooZnVuY3Rpb24gKCQsIG5hbWUpIHsKICB2YXIgdGltZXI7CgogIHZhciBoYW5kbGUgPSBmdW5jdGlvbiBoYW5kbGUoZXZlbnQsIHRvdWNoKSB7CiAgICB2YXIgc2Vzc2lvbiA9ICQuZ2VzdHVyZXMuc2Vzc2lvbjsKICAgIHZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zOwoKICAgIHN3aXRjaCAoZXZlbnQudHlwZSkgewogICAgICBjYXNlICQuRVZFTlRfU1RBUlQ6CiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTsKICAgICAgICB0aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgJC50cmlnZ2VyKHNlc3Npb24udGFyZ2V0LCBuYW1lLCB0b3VjaCk7CiAgICAgICAgfSwgb3B0aW9ucy5ob2xkVGltZW91dCk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICQuRVZFTlRfTU9WRToKICAgICAgICBpZiAodG91Y2guZGlzdGFuY2UgPiBvcHRpb25zLmhvbGRUaHJlc2hvbGQpIHsKICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJC5FVkVOVF9FTkQ6CiAgICAgIGNhc2UgJC5FVkVOVF9DQU5DRUw6CiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTsKICAgICAgICBicmVhazsKICAgIH0KICB9OwogIC8qKgogICAqIG11aSBnZXN0dXJlIGxvbmd0YXAKICAgKi8KCgogICQuYWRkR2VzdHVyZSh7CiAgICBuYW1lOiBuYW1lLAogICAgaW5kZXg6IDEwLAogICAgaGFuZGxlOiBoYW5kbGUsCiAgICBvcHRpb25zOiB7CiAgICAgIGZpbmdlcnM6IDEsCiAgICAgIGhvbGRUaW1lb3V0OiA1MDAsCiAgICAgIGhvbGRUaHJlc2hvbGQ6IDIKICAgIH0KICB9KTsKfSkobXVpLCAnbG9uZ3RhcCcpOwovKioKICogbXVpIGdlc3R1cmUgaG9sZAogKiBAcGFyYW0ge3R5cGV9ICQKICogQHBhcmFtIHt0eXBlfSBuYW1lCiAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAqLwoKCihmdW5jdGlvbiAoJCwgbmFtZSkgewogIHZhciB0aW1lcjsKCiAgdmFyIGhhbmRsZSA9IGZ1bmN0aW9uIGhhbmRsZShldmVudCwgdG91Y2gpIHsKICAgIHZhciBzZXNzaW9uID0gJC5nZXN0dXJlcy5zZXNzaW9uOwogICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgogICAgc3dpdGNoIChldmVudC50eXBlKSB7CiAgICAgIGNhc2UgJC5FVkVOVF9TVEFSVDoKICAgICAgICBpZiAoJC5vcHRpb25zLmdlc3R1cmVDb25maWcuaG9sZCkgewogICAgICAgICAgdGltZXIgJiYgY2xlYXJUaW1lb3V0KHRpbWVyKTsKICAgICAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRvdWNoLmhvbGQgPSB0cnVlOwogICAgICAgICAgICAkLnRyaWdnZXIoc2Vzc2lvbi50YXJnZXQsIG5hbWUsIHRvdWNoKTsKICAgICAgICAgIH0sIG9wdGlvbnMuaG9sZFRpbWVvdXQpOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICQuRVZFTlRfTU9WRToKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJC5FVkVOVF9FTkQ6CiAgICAgIGNhc2UgJC5FVkVOVF9DQU5DRUw6CiAgICAgICAgaWYgKHRpbWVyKSB7CiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpICYmICh0aW1lciA9IG51bGwpOwogICAgICAgICAgJC50cmlnZ2VyKHNlc3Npb24udGFyZ2V0LCAncmVsZWFzZScsIHRvdWNoKTsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwogICAgfQogIH07CiAgLyoqCiAgICogbXVpIGdlc3R1cmUgaG9sZAogICAqLwoKCiAgJC5hZGRHZXN0dXJlKHsKICAgIG5hbWU6IG5hbWUsCiAgICBpbmRleDogMTAsCiAgICBoYW5kbGU6IGhhbmRsZSwKICAgIG9wdGlvbnM6IHsKICAgICAgZmluZ2VyczogMSwKICAgICAgaG9sZFRpbWVvdXQ6IDAKICAgIH0KICB9KTsKfSkobXVpLCAnaG9sZCcpOwovKioKICogbXVpIGdlc3R1cmUgcGluY2gKICogQHBhcmFtIHt0eXBlfSAkCiAqIEBwYXJhbSB7dHlwZX0gbmFtZQogKiBAcmV0dXJucyB7dW5kZWZpbmVkfQogKi8KCgooZnVuY3Rpb24gKCQsIG5hbWUpIHsKICB2YXIgaGFuZGxlID0gZnVuY3Rpb24gaGFuZGxlKGV2ZW50LCB0b3VjaCkgewogICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CiAgICB2YXIgc2Vzc2lvbiA9ICQuZ2VzdHVyZXMuc2Vzc2lvbjsKCiAgICBzd2l0Y2ggKGV2ZW50LnR5cGUpIHsKICAgICAgY2FzZSAkLkVWRU5UX1NUQVJUOgogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAkLkVWRU5UX01PVkU6CiAgICAgICAgaWYgKCQub3B0aW9ucy5nZXN0dXJlQ29uZmlnLnBpbmNoKSB7CiAgICAgICAgICBpZiAodG91Y2gudG91Y2hlcy5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIXNlc3Npb24ucGluY2gpIHsKICAgICAgICAgICAgLy9zdGFydAogICAgICAgICAgICBzZXNzaW9uLnBpbmNoID0gdHJ1ZTsKICAgICAgICAgICAgJC50cmlnZ2VyKHNlc3Npb24udGFyZ2V0LCBuYW1lICsgJ3N0YXJ0JywgdG91Y2gpOwogICAgICAgICAgfQoKICAgICAgICAgICQudHJpZ2dlcihzZXNzaW9uLnRhcmdldCwgbmFtZSwgdG91Y2gpOwogICAgICAgICAgdmFyIHNjYWxlID0gdG91Y2guc2NhbGU7CiAgICAgICAgICB2YXIgcm90YXRpb24gPSB0b3VjaC5yb3RhdGlvbjsKICAgICAgICAgIHZhciBsYXN0U2NhbGUgPSB0eXBlb2YgdG91Y2gubGFzdFNjYWxlID09PSAndW5kZWZpbmVkJyA/IDEgOiB0b3VjaC5sYXN0U2NhbGU7CiAgICAgICAgICB2YXIgc2NhbGVEaWZmID0gMC4wMDAwMDAwMDAwMDE7IC8v6Ziy5q2ic2NhbGXkuI5sYXN0U2NhbGXnm7jnrYnvvIzkuI3op6blj5Hkuovku7bnmoTmg4XlhrXjgIIKCiAgICAgICAgICBpZiAoc2NhbGUgPiBsYXN0U2NhbGUpIHsKICAgICAgICAgICAgLy9vdXQKICAgICAgICAgICAgbGFzdFNjYWxlID0gc2NhbGUgLSBzY2FsZURpZmY7CiAgICAgICAgICAgICQudHJpZ2dlcihzZXNzaW9uLnRhcmdldCwgbmFtZSArICdvdXQnLCB0b3VjaCk7CiAgICAgICAgICB9IC8vaW4KICAgICAgICAgIGVsc2UgaWYgKHNjYWxlIDwgbGFzdFNjYWxlKSB7CiAgICAgICAgICAgICAgbGFzdFNjYWxlID0gc2NhbGUgKyBzY2FsZURpZmY7CiAgICAgICAgICAgICAgJC50cmlnZ2VyKHNlc3Npb24udGFyZ2V0LCBuYW1lICsgJ2luJywgdG91Y2gpOwogICAgICAgICAgICB9CgogICAgICAgICAgaWYgKE1hdGguYWJzKHJvdGF0aW9uKSA+IG9wdGlvbnMubWluUm90YXRpb25BbmdsZSkgewogICAgICAgICAgICAkLnRyaWdnZXIoc2Vzc2lvbi50YXJnZXQsICdyb3RhdGUnLCB0b3VjaCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJC5FVkVOVF9FTkQ6CiAgICAgIGNhc2UgJC5FVkVOVF9DQU5DRUw6CiAgICAgICAgaWYgKCQub3B0aW9ucy5nZXN0dXJlQ29uZmlnLnBpbmNoICYmIHNlc3Npb24ucGluY2ggJiYgdG91Y2gudG91Y2hlcy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgIHNlc3Npb24ucGluY2ggPSBmYWxzZTsKICAgICAgICAgICQudHJpZ2dlcihzZXNzaW9uLnRhcmdldCwgbmFtZSArICdlbmQnLCB0b3VjaCk7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKICAgIH0KICB9OwogIC8qKgogICAqIG11aSBnZXN0dXJlIHBpbmNoCiAgICovCgoKICAkLmFkZEdlc3R1cmUoewogICAgbmFtZTogbmFtZSwKICAgIGluZGV4OiAxMCwKICAgIGhhbmRsZTogaGFuZGxlLAogICAgb3B0aW9uczogewogICAgICBtaW5Sb3RhdGlvbkFuZ2xlOiAwCiAgICB9CiAgfSk7Cn0pKG11aSwgJ3BpbmNoJyk7Ci8qKgogKiBtdWkuaW5pdAogKiBAcGFyYW0ge3R5cGV9ICQKICogQHJldHVybnMge3VuZGVmaW5lZH0KICovCgoKKGZ1bmN0aW9uICgkKSB7CiAgJC5nbG9iYWwgPSAkLm9wdGlvbnMgPSB7CiAgICBnZXN0dXJlQ29uZmlnOiB7CiAgICAgIHRhcDogdHJ1ZSwKICAgICAgZG91YmxldGFwOiBmYWxzZSwKICAgICAgbG9uZ3RhcDogZmFsc2UsCiAgICAgIGhvbGQ6IGZhbHNlLAogICAgICBmbGljazogdHJ1ZSwKICAgICAgc3dpcGU6IHRydWUsCiAgICAgIGRyYWc6IHRydWUsCiAgICAgIHBpbmNoOiBmYWxzZQogICAgfQogIH07CiAgLyoqCiAgICoKICAgKiBAcGFyYW0ge3R5cGV9IG9wdGlvbnMKICAgKiBAcmV0dXJucyB7dW5kZWZpbmVkfQogICAqLwoKICAkLmluaXRHbG9iYWwgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgJC5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwgJC5nbG9iYWwsIG9wdGlvbnMpOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgdmFyIGluaXRzID0ge307CiAgLyoqCiAgICog5Y2V6aG16YWN572uIOWIneWni+WMlgogICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zCiAgICovCgogICQuaW5pdCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAkLm9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCAkLmdsb2JhbCwgb3B0aW9ucyB8fCB7fSk7CiAgICAkLnJlYWR5KGZ1bmN0aW9uICgpIHsKICAgICAgJC5kb0FjdGlvbignaW5pdHMnLCBmdW5jdGlvbiAoaW5kZXgsIGluaXQpIHsKICAgICAgICB2YXIgaXNJbml0ID0gISEoIWluaXRzW2luaXQubmFtZV0gfHwgaW5pdC5yZXBlYXQpOwoKICAgICAgICBpZiAoaXNJbml0KSB7CiAgICAgICAgICBpbml0LmhhbmRsZS5jYWxsKCQpOwogICAgICAgICAgaW5pdHNbaW5pdC5uYW1lXSA9IHRydWU7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKICAvKioKICAgKiDlop7liqDliJ3lp4vljJbmiafooYzmtYHnqIsKICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBpbml0CiAgICovCgoKICAkLmFkZEluaXQgPSBmdW5jdGlvbiAoaW5pdCkgewogICAgcmV0dXJuICQuYWRkQWN0aW9uKCdpbml0cycsIGluaXQpOwogIH07CiAgLyoqCiAgICog5aSE55CGaHRtbDXniYjmnKxzdWJwYWdlcyAKICAgKi8KCgogICQuYWRkSW5pdCh7CiAgICBuYW1lOiAnaWZyYW1lJywKICAgIGluZGV4OiAxMDAsCiAgICBoYW5kbGU6IGZ1bmN0aW9uIGhhbmRsZSgpIHsKICAgICAgdmFyIG9wdGlvbnMgPSAkLm9wdGlvbnM7CiAgICAgIHZhciBzdWJwYWdlcyA9IG9wdGlvbnMuc3VicGFnZXMgfHwgW107CgogICAgICBpZiAoISQub3MucGx1cyAmJiBzdWJwYWdlcy5sZW5ndGgpIHsKICAgICAgICAvL+aaguaXtuWPquWkhOeQhuWNleS4qnN1YnBhZ2XjgILlkI7nu63lj6/ku6XogIPomZHmlK/mjIHlpJrkuKpzdWJwYWdlCiAgICAgICAgY3JlYXRlSWZyYW1lKHN1YnBhZ2VzWzBdKTsKICAgICAgfQogICAgfQogIH0pOwoKICB2YXIgY3JlYXRlSWZyYW1lID0gZnVuY3Rpb24gY3JlYXRlSWZyYW1lKG9wdGlvbnMpIHsKICAgIHZhciB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB3cmFwcGVyLmNsYXNzTmFtZSA9ICdtdWktaWZyYW1lLXdyYXBwZXInOwogICAgdmFyIHN0eWxlcyA9IG9wdGlvbnMuc3R5bGVzIHx8IHt9OwoKICAgIGlmICh0eXBlb2Ygc3R5bGVzLnRvcCAhPT0gJ3N0cmluZycpIHsKICAgICAgc3R5bGVzLnRvcCA9ICcwcHgnOwogICAgfQoKICAgIGlmICh0eXBlb2Ygc3R5bGVzLmJvdHRvbSAhPT0gJ3N0cmluZycpIHsKICAgICAgc3R5bGVzLmJvdHRvbSA9ICcwcHgnOwogICAgfQoKICAgIHdyYXBwZXIuc3R5bGUudG9wID0gc3R5bGVzLnRvcDsKICAgIHdyYXBwZXIuc3R5bGUuYm90dG9tID0gc3R5bGVzLmJvdHRvbTsKICAgIHZhciBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTsKICAgIGlmcmFtZS5zcmMgPSBvcHRpb25zLnVybDsKICAgIGlmcmFtZS5pZCA9IG9wdGlvbnMuaWQgfHwgb3B0aW9ucy51cmw7CiAgICBpZnJhbWUubmFtZSA9IGlmcmFtZS5pZDsKICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoaWZyYW1lKTsKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQod3JhcHBlcik7IC8v55uu5YmN5LuF5aSE55CG5b6u5L+hCgogICAgJC5vcy53ZWNoYXQgJiYgaGFuZGxlU2Nyb2xsKHdyYXBwZXIsIGlmcmFtZSk7CiAgfTsKCiAgZnVuY3Rpb24gaGFuZGxlU2Nyb2xsKHdyYXBwZXIsIGlmcmFtZSkgewogICAgdmFyIGtleSA9ICdNVUlfU0NST0xMX1BPU0lUSU9OXycgKyBkb2N1bWVudC5sb2NhdGlvbi5ocmVmICsgJ18nICsgaWZyYW1lLnNyYzsKICAgIHZhciBzY3JvbGxUb3AgPSBwYXJzZUZsb2F0KGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSkpIHx8IDA7CgogICAgaWYgKHNjcm9sbFRvcCkgewogICAgICAoZnVuY3Rpb24gKHkpIHsKICAgICAgICBpZnJhbWUub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIHkpOwogICAgICAgIH07CiAgICAgIH0pKHNjcm9sbFRvcCk7CiAgICB9CgogICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3Njcm9sbFRvcCA9IHdpbmRvdy5zY3JvbGxZOwoKICAgICAgaWYgKHNjcm9sbFRvcCAhPT0gX3Njcm9sbFRvcCkgewogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgX3Njcm9sbFRvcCArICcnKTsKICAgICAgICBzY3JvbGxUb3AgPSBfc2Nyb2xsVG9wOwogICAgICB9CiAgICB9LCAxMDApOwogIH0KCiAgOwogICQoZnVuY3Rpb24gKCkgewogICAgdmFyIGNsYXNzTGlzdCA9IGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0OwogICAgdmFyIG9zID0gW107CgogICAgaWYgKCQub3MuaW9zKSB7CiAgICAgIG9zLnB1c2goewogICAgICAgIG9zOiAnaW9zJywKICAgICAgICB2ZXJzaW9uOiAkLm9zLnZlcnNpb24KICAgICAgfSk7CiAgICAgIGNsYXNzTGlzdC5hZGQoJ211aS1pb3MnKTsKICAgIH0gZWxzZSBpZiAoJC5vcy5hbmRyb2lkKSB7CiAgICAgIG9zLnB1c2goewogICAgICAgIG9zOiAnYW5kcm9pZCcsCiAgICAgICAgdmVyc2lvbjogJC5vcy52ZXJzaW9uCiAgICAgIH0pOwogICAgICBjbGFzc0xpc3QuYWRkKCdtdWktYW5kcm9pZCcpOwogICAgfQoKICAgIGlmICgkLm9zLndlY2hhdCkgewogICAgICBvcy5wdXNoKHsKICAgICAgICBvczogJ3dlY2hhdCcsCiAgICAgICAgdmVyc2lvbjogJC5vcy53ZWNoYXQudmVyc2lvbgogICAgICB9KTsKICAgICAgY2xhc3NMaXN0LmFkZCgnbXVpLXdlY2hhdCcpOwogICAgfQoKICAgIGlmIChvcy5sZW5ndGgpIHsKICAgICAgJC5lYWNoKG9zLCBmdW5jdGlvbiAoaW5kZXgsIG9zT2JqKSB7CiAgICAgICAgdmFyIHZlcnNpb24gPSAnJzsKICAgICAgICB2YXIgY2xhc3NBcnJheSA9IFtdOwoKICAgICAgICBpZiAob3NPYmoudmVyc2lvbikgewogICAgICAgICAgJC5lYWNoKG9zT2JqLnZlcnNpb24uc3BsaXQoJy4nKSwgZnVuY3Rpb24gKGksIHYpIHsKICAgICAgICAgICAgdmVyc2lvbiA9IHZlcnNpb24gKyAodmVyc2lvbiA/ICctJyA6ICcnKSArIHY7CiAgICAgICAgICAgIGNsYXNzTGlzdC5hZGQoJC5jbGFzc05hbWUob3NPYmoub3MgKyAnLScgKyB2ZXJzaW9uKSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0pOwp9KShtdWkpOwovKioKICogbXVpLmluaXQgNSsKICogQHBhcmFtIHt0eXBlfSAkCiAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAqLwoKCihmdW5jdGlvbiAoJCkgewogIHZhciBkZWZhdWx0T3B0aW9ucyA9IHsKICAgIHN3aXBlQmFjazogZmFsc2UsCiAgICBwcmVsb2FkUGFnZXM6IFtdLAogICAgLy81KyBsYXp5TG9hZCB3ZWJ2aWV3CiAgICBwcmVsb2FkTGltaXQ6IDEwLAogICAgLy/pooTliqDovb3nqpflj6PnmoTmlbDph4/pmZDliLYo5LiA5pem6LaF5Ye677yM5YWI6L+b5YWI5Ye6KQogICAga2V5RXZlbnRCaW5kOiB7CiAgICAgIGJhY2tidXR0b246IHRydWUsCiAgICAgIG1lbnVidXR0b246IHRydWUKICAgIH0sCiAgICB0aXRsZUNvbmZpZzogewogICAgICBoZWlnaHQ6ICI0NHB4IiwKICAgICAgYmFja2dyb3VuZENvbG9yOiAiI2Y3ZjdmNyIsCiAgICAgIC8v5a+86Iiq5qCP6IOM5pmv6ImyCiAgICAgIGJvdHRvbUJvcmRlckNvbG9yOiAiI2NjY2NjYyIsCiAgICAgIC8v5bqV6YOo6L6557q/6aKc6ImyCiAgICAgIHRpdGxlOiB7CiAgICAgICAgLy/moIfpopjphY3nva4KICAgICAgICB0ZXh0OiAiIiwKICAgICAgICAvL+agh+mimOaWh+WtlwogICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICB0b3A6IDAsCiAgICAgICAgICBsZWZ0OiAwLAogICAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICAgIGhlaWdodDogIjEwMCUiCiAgICAgICAgfSwKICAgICAgICBzdHlsZXM6IHsKICAgICAgICAgIGNvbG9yOiAiIzAwMDAwMCIsCiAgICAgICAgICBhbGlnbjogImNlbnRlciIsCiAgICAgICAgICBmYW1pbHk6ICInSGVsdmV0aWNhIE5ldWUnLEhlbHZldGljYSxzYW5zLXNlcmlmIiwKICAgICAgICAgIHNpemU6ICIxN3B4IiwKICAgICAgICAgIHN0eWxlOiAibm9ybWFsIiwKICAgICAgICAgIHdlaWdodDogIm5vcm1hbCIsCiAgICAgICAgICBmb250U3JjOiAiIgogICAgICAgIH0KICAgICAgfSwKICAgICAgYmFjazogewogICAgICAgIGltYWdlOiB7CiAgICAgICAgICBiYXNlNjREYXRhOiAnJywKICAgICAgICAgIGltZ1NyYzogJycsCiAgICAgICAgICBzcHJpdGU6IHsKICAgICAgICAgICAgdG9wOiAnMHB4JywKICAgICAgICAgICAgbGVmdDogJzBweCcsCiAgICAgICAgICAgIHdpZHRoOiAnMTAwJScsCiAgICAgICAgICAgIGhlaWdodDogJzEwMCUnCiAgICAgICAgICB9LAogICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgdG9wOiAiMTBweCIsCiAgICAgICAgICAgIGxlZnQ6ICIxMHB4IiwKICAgICAgICAgICAgd2lkdGg6ICIyNHB4IiwKICAgICAgICAgICAgaGVpZ2h0OiAiMjRweCIKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OyAvL+m7mOiupOmhtemdouWKqOeUuwoKICB2YXIgZGVmYXVsdFNob3cgPSB7CiAgICBldmVudDogInRpdGxlVXBkYXRlIiwKICAgIGF1dG9TaG93OiB0cnVlLAogICAgZHVyYXRpb246IDMwMCwKICAgIGFuaVNob3c6ICdzbGlkZS1pbi1yaWdodCcsCiAgICBleHRyYXM6IHt9CiAgfTsgLy/oi6XmiafooYzkuobmmL7npLrliqjnlLvliJ3lp4vljJbmk43kvZzvvIzliJnopoHopobnm5bpu5jorqTphY3nva4KCiAgaWYgKCQub3B0aW9ucy5zaG93KSB7CiAgICBkZWZhdWx0U2hvdyA9ICQuZXh0ZW5kKHRydWUsIGRlZmF1bHRTaG93LCAkLm9wdGlvbnMuc2hvdyk7CiAgfQoKICAkLmN1cnJlbnRXZWJ2aWV3ID0gbnVsbDsKICAkLmV4dGVuZCh0cnVlLCAkLmdsb2JhbCwgZGVmYXVsdE9wdGlvbnMpOwogICQuZXh0ZW5kKHRydWUsICQub3B0aW9ucywgZGVmYXVsdE9wdGlvbnMpOwogIC8qKgogICAqIOetieW+heWKqOeUu+mFjee9rgogICAqIEBwYXJhbSB7dHlwZX0gb3B0aW9ucwogICAqIEByZXR1cm5zIHtPYmplY3R9CiAgICovCgogICQud2FpdGluZ09wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgcmV0dXJuICQuZXh0ZW5kKHRydWUsIHt9LCB7CiAgICAgIGF1dG9TaG93OiB0cnVlLAogICAgICB0aXRsZTogJycsCiAgICAgIG1vZGFsOiBmYWxzZQogICAgfSwgb3B0aW9ucyk7CiAgfTsKICAvKioKICAgKiDnqpflj6PmmL7npLrphY3nva4KICAgKiBAcGFyYW0ge3R5cGV9IG9wdGlvbnMKICAgKiBAcmV0dXJucyB7T2JqZWN0fQogICAqLwoKCiAgJC5zaG93T3B0aW9ucyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICByZXR1cm4gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRTaG93LCBvcHRpb25zKTsKICB9OwogIC8qKgogICAqIOeql+WPo+m7mOiupOmFjee9rgogICAqIEBwYXJhbSB7dHlwZX0gb3B0aW9ucwogICAqIEByZXR1cm5zIHtPYmplY3R9CiAgICovCgoKICAkLndpbmRvd09wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgcmV0dXJuICQuZXh0ZW5kKHsKICAgICAgc2NhbGFibGU6IGZhbHNlLAogICAgICBib3VuY2U6ICIiIC8vdmVydGljYWwKCiAgICB9LCBvcHRpb25zKTsKICB9OwogIC8qKgogICAqIHBsdXNSZWFkeQogICAqIEBwYXJhbSB7dHlwZX0gY2FsbGJhY2sKICAgKiBAcmV0dXJucyB7X0w2LiR9CiAgICovCgoKICAkLnBsdXNSZWFkeSA9IGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgaWYgKHdpbmRvdy5wbHVzKSB7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIC8v6Kej5YazY2FsbGJhY2vkuI5wbHVzcmVhZHnkuovku7bnmoTmiafooYzml7bmnLrpl67popgo5YW45Z6L5qGI5L6LOnNob3dXYWl0aW5nLGNsb3NlV2FpdGluZykKICAgICAgICBjYWxsYmFjaygpOwogICAgICB9LCAwKTsKICAgIH0gZWxzZSB7CiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInBsdXNyZWFkeSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBjYWxsYmFjaygpOwogICAgICB9LCBmYWxzZSk7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfTsKICAvKioKICAgKiA1KyBldmVudCg1K+ayoeaPkOS+m+S5i+WJjeaIkeiHquW3seWunueOsCkKICAgKiBAcGFyYW0ge3R5cGV9IHdlYnZpZXcKICAgKiBAcGFyYW0ge3R5cGV9IGV2ZW50VHlwZQogICAqIEBwYXJhbSB7dHlwZX0gZGF0YQogICAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAgICovCgoKICAkLmZpcmUgPSBmdW5jdGlvbiAod2VidmlldywgZXZlbnRUeXBlLCBkYXRhKSB7CiAgICBpZiAod2VidmlldykgewogICAgICBpZiAodHlwZW9mIGRhdGEgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgZGF0YSA9ICcnOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkYXRhID09PSAnYm9vbGVhbicgfHwgdHlwZW9mIGRhdGEgPT09ICdudW1iZXInKSB7CiAgICAgICAgd2Vidmlldy5ldmFsSlMoInR5cGVvZiBtdWkhPT0ndW5kZWZpbmVkJyYmbXVpLnJlY2VpdmUoJyIgKyBldmVudFR5cGUgKyAiJywiICsgZGF0YSArICIpIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKCQuaXNQbGFpbk9iamVjdChkYXRhKSB8fCAkLmlzQXJyYXkoZGF0YSkpIHsKICAgICAgICBkYXRhID0gSlNPTi5zdHJpbmdpZnkoZGF0YSB8fCB7fSkucmVwbGFjZSgvXCcvZywgIlxcdTAwMjciKS5yZXBsYWNlKC9cXC9nLCAiXFx1MDA1YyIpOwogICAgICB9CgogICAgICB3ZWJ2aWV3LmV2YWxKUygidHlwZW9mIG11aSE9PSd1bmRlZmluZWQnJiZtdWkucmVjZWl2ZSgnIiArIGV2ZW50VHlwZSArICInLCciICsgZGF0YSArICInKSIpOwogICAgfQogIH07CiAgLyoqCiAgICogNSsgZXZlbnQoNSvmsqHmj5DkvpvkuYvliY3miJHoh6rlt7Hlrp7njrApCiAgICogQHBhcmFtIHt0eXBlfSBldmVudFR5cGUKICAgKiBAcGFyYW0ge3R5cGV9IGRhdGEKICAgKiBAcmV0dXJucyB7dW5kZWZpbmVkfQogICAqLwoKCiAgJC5yZWNlaXZlID0gZnVuY3Rpb24gKGV2ZW50VHlwZSwgZGF0YSkgewogICAgaWYgKGV2ZW50VHlwZSkgewogICAgICB0cnkgewogICAgICAgIGlmIChkYXRhICYmIHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykgewogICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7fQoKICAgICAgJC50cmlnZ2VyKGRvY3VtZW50LCBldmVudFR5cGUsIGRhdGEpOwogICAgfQogIH07CgogIHZhciB0cmlnZ2VyUHJlbG9hZCA9IGZ1bmN0aW9uIHRyaWdnZXJQcmVsb2FkKHdlYnZpZXcpIHsKICAgIGlmICghd2Vidmlldy5wcmVsb2FkZWQpIHsKICAgICAgLy/kv53or4Hku4Xop6blj5HkuIDmrKEKICAgICAgJC5maXJlKHdlYnZpZXcsICdwcmVsb2FkJyk7CiAgICAgIHZhciBsaXN0ID0gd2Vidmlldy5jaGlsZHJlbigpOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgJC5maXJlKGxpc3RbaV0sICdwcmVsb2FkJyk7CiAgICAgIH0KCiAgICAgIHdlYnZpZXcucHJlbG9hZGVkID0gdHJ1ZTsKICAgIH0KICB9OwoKICB2YXIgdHJpZ2dlciA9IGZ1bmN0aW9uIHRyaWdnZXIod2VidmlldywgZXZlbnRUeXBlLCB0aW1lQ2hlY2tlZCkgewogICAgaWYgKHRpbWVDaGVja2VkKSB7CiAgICAgIGlmICghd2Vidmlld1tldmVudFR5cGUgKyAnZWQnXSkgewogICAgICAgICQuZmlyZSh3ZWJ2aWV3LCBldmVudFR5cGUpOwogICAgICAgIHZhciBsaXN0ID0gd2Vidmlldy5jaGlsZHJlbigpOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICQuZmlyZShsaXN0W2ldLCBldmVudFR5cGUpOwogICAgICAgIH0KCiAgICAgICAgd2Vidmlld1tldmVudFR5cGUgKyAnZWQnXSA9IHRydWU7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICQuZmlyZSh3ZWJ2aWV3LCBldmVudFR5cGUpOwogICAgICB2YXIgbGlzdCA9IHdlYnZpZXcuY2hpbGRyZW4oKTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICQuZmlyZShsaXN0W2ldLCBldmVudFR5cGUpOwogICAgICB9CiAgICB9CiAgfTsKICAvKioKICAgKiDmiZPlvIDmlrDnqpflj6MKICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIOimgeaJk+W8gOeahOmhtemdouWcsOWdgAogICAqIEBwYXJhbSB7c3RyaW5nfSBpZCDmjIflrprpobXpnaJJRAogICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zIOWPr+mAiTrlj4LmlbAs562J5b6FLOeql+WPoyzmmL7npLrphY3nva57cGFyYW1zOnt9LHdhaXRpbmc6e30sc3R5bGVzOnt9LHNob3c6e319CiAgICovCgoKICAkLm9wZW5XaW5kb3cgPSBmdW5jdGlvbiAodXJsLCBpZCwgb3B0aW9ucykgewogICAgaWYgKF90eXBlb2YodXJsKSA9PT0gJ29iamVjdCcpIHsKICAgICAgb3B0aW9ucyA9IHVybDsKICAgICAgdXJsID0gb3B0aW9ucy51cmw7CiAgICAgIGlkID0gb3B0aW9ucy5pZCB8fCB1cmw7CiAgICB9IGVsc2UgewogICAgICBpZiAoX3R5cGVvZihpZCkgPT09ICdvYmplY3QnKSB7CiAgICAgICAgb3B0aW9ucyA9IGlkOwogICAgICAgIGlkID0gb3B0aW9ucy5pZCB8fCB1cmw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWQgPSBpZCB8fCB1cmw7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoISQub3MucGx1cykgewogICAgICAvL1RPRE8g5YWI5Li05pe26L+Z5LmI5aSE55CG77ya5omL5py65LiK6aG25bGC6Lez77yMUEPkuIpwYXJlbnTot7MKICAgICAgaWYgKCQub3MuaW9zIHx8ICQub3MuYW5kcm9pZCkgewogICAgICAgIHdpbmRvdy50b3AubG9jYXRpb24uaHJlZiA9IHVybDsKICAgICAgfSBlbHNlIHsKICAgICAgICB3aW5kb3cucGFyZW50LmxvY2F0aW9uLmhyZWYgPSB1cmw7CiAgICAgIH0KCiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoIXdpbmRvdy5wbHVzKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgIHZhciBwYXJhbXMgPSBvcHRpb25zLnBhcmFtcyB8fCB7fTsKICAgIHZhciB3ZWJ2aWV3ID0gbnVsbCwKICAgICAgICB3ZWJ2aWV3Q2FjaGUgPSBudWxsLAogICAgICAgIG5TaG93LAogICAgICAgIG5XYWl0aW5nOwoKICAgIGlmICgkLndlYnZpZXdzW2lkXSkgewogICAgICB3ZWJ2aWV3Q2FjaGUgPSAkLndlYnZpZXdzW2lkXTsgLy93ZWJ2aWV355yf5a6e5a2Y5Zyo77yM5omN6IO96I635Y+WCgogICAgICBpZiAocGx1cy53ZWJ2aWV3LmdldFdlYnZpZXdCeUlkKGlkKSkgewogICAgICAgIHdlYnZpZXcgPSB3ZWJ2aWV3Q2FjaGUud2VidmlldzsKICAgICAgfQogICAgfSBlbHNlIGlmIChvcHRpb25zLmNyZWF0ZU5ldyAhPT0gdHJ1ZSkgewogICAgICB3ZWJ2aWV3ID0gcGx1cy53ZWJ2aWV3LmdldFdlYnZpZXdCeUlkKGlkKTsKICAgIH0KCiAgICBpZiAod2VidmlldykgewogICAgICAvL+W3sue8k+WtmAogICAgICAvL+avj+asoXNob3fpg73pnIDopoHkvKDpgJLliqjnlLvlj4LmlbDvvJsKICAgICAgLy/pooTliqDovb3nmoTliqjnlLvlj4LmlbDkvJjlhYjnuqfvvJpvcGVuV2luZG936YWN572uPnByZWxvYWRQYWdlc+mFjee9rj5tdWnpu5jorqTphY3nva7vvJsKICAgICAgblNob3cgPSB3ZWJ2aWV3Q2FjaGUgPyB3ZWJ2aWV3Q2FjaGUuc2hvdyA6IGRlZmF1bHRTaG93OwogICAgICBuU2hvdyA9IG9wdGlvbnMuc2hvdyA/ICQuZXh0ZW5kKG5TaG93LCBvcHRpb25zLnNob3cpIDogblNob3c7CiAgICAgIG5TaG93LmF1dG9TaG93ICYmIHdlYnZpZXcuc2hvdyhuU2hvdy5hbmlTaG93LCBuU2hvdy5kdXJhdGlvbiwgZnVuY3Rpb24gKCkgewogICAgICAgIHRyaWdnZXJQcmVsb2FkKHdlYnZpZXcpOwogICAgICAgIHRyaWdnZXIod2VidmlldywgJ3BhZ2ViZWZvcmVzaG93JywgZmFsc2UpOwogICAgICB9KTsKCiAgICAgIGlmICh3ZWJ2aWV3Q2FjaGUpIHsKICAgICAgICB3ZWJ2aWV3Q2FjaGUuYWZ0ZXJTaG93TWV0aG9kTmFtZSAmJiB3ZWJ2aWV3LmV2YWxKUyh3ZWJ2aWV3Q2FjaGUuYWZ0ZXJTaG93TWV0aG9kTmFtZSArICcoXCcnICsgSlNPTi5zdHJpbmdpZnkocGFyYW1zKSArICdcJyknKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHdlYnZpZXc7CiAgICB9IGVsc2UgewogICAgICAvL+aWsOeql+WPowogICAgICBpZiAoIXVybCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignd2Vidmlld1snICsgaWQgKyAnXSBkb2VzIG5vdCBleGlzdCcpOwogICAgICB9IC8v5pi+56S6d2FpdGluZwoKCiAgICAgIHZhciB3YWl0aW5nQ29uZmlnID0gJC53YWl0aW5nT3B0aW9ucyhvcHRpb25zLndhaXRpbmcpOwoKICAgICAgaWYgKHdhaXRpbmdDb25maWcuYXV0b1Nob3cpIHsKICAgICAgICBuV2FpdGluZyA9IHBsdXMubmF0aXZlVUkuc2hvd1dhaXRpbmcod2FpdGluZ0NvbmZpZy50aXRsZSwgd2FpdGluZ0NvbmZpZy5vcHRpb25zKTsKICAgICAgfSAvL+WIm+W7uumhtemdogoKCiAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZChvcHRpb25zLCB7CiAgICAgICAgaWQ6IGlkLAogICAgICAgIHVybDogdXJsCiAgICAgIH0pOwogICAgICB3ZWJ2aWV3ID0gJC5jcmVhdGVXaW5kb3cob3B0aW9ucyk7IC8v5pi+56S6CgogICAgICBuU2hvdyA9ICQuc2hvd09wdGlvbnMob3B0aW9ucy5zaG93KTsKCiAgICAgIGlmIChuU2hvdy5hdXRvU2hvdykgewogICAgICAgIHZhciBzaG93V2VidmlldyA9IGZ1bmN0aW9uIHNob3dXZWJ2aWV3KCkgewogICAgICAgICAgLy/lhbPpl63nrYnlvoXmoYYKICAgICAgICAgIGlmIChuV2FpdGluZykgewogICAgICAgICAgICBuV2FpdGluZy5jbG9zZSgpOwogICAgICAgICAgfSAvL+aYvuekuumhtemdogoKCiAgICAgICAgICB3ZWJ2aWV3LnNob3coblNob3cuYW5pU2hvdywgblNob3cuZHVyYXRpb24sIGZ1bmN0aW9uICgpIHt9LCBuU2hvdy5leHRyYXMpOwogICAgICAgICAgb3B0aW9ucy5hZnRlclNob3dNZXRob2ROYW1lICYmIHdlYnZpZXcuZXZhbEpTKG9wdGlvbnMuYWZ0ZXJTaG93TWV0aG9kTmFtZSArICcoXCcnICsgSlNPTi5zdHJpbmdpZnkocGFyYW1zKSArICdcJyknKTsKICAgICAgICB9OyAvL3RpdGxlVXBkYXRl6Kem5Y+R5pe25py65pep5LqObG9hZGVk77yM5pu05o2i5Li6dGl0bGVVcGRhdGXlkI7vvIzlj6/ku6Xmm7Tml6nnmoTmmL7npLp3ZWJ2aWV3CgoKICAgICAgICB3ZWJ2aWV3LmFkZEV2ZW50TGlzdGVuZXIoblNob3cuZXZlbnQsIHNob3dXZWJ2aWV3LCBmYWxzZSk7IC8vbG9hZGVk5LqL5Lu25Y+R55Sf5ZCO77yM6Kem5Y+R6aKE5Yqg6L295ZKMcGFnZWJlZm9yZXNob3fkuovku7YKCiAgICAgICAgd2Vidmlldy5hZGRFdmVudExpc3RlbmVyKCJsb2FkZWQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0cmlnZ2VyUHJlbG9hZCh3ZWJ2aWV3KTsKICAgICAgICAgIHRyaWdnZXIod2VidmlldywgJ3BhZ2ViZWZvcmVzaG93JywgZmFsc2UpOwogICAgICAgIH0sIGZhbHNlKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB3ZWJ2aWV3OwogIH07CgogICQub3BlbldpbmRvd1dpdGhUaXRsZSA9IGZ1bmN0aW9uIChvcHRpb25zLCB0aXRsZUNvbmZpZykgewogICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICB2YXIgdXJsID0gb3B0aW9ucy51cmw7CiAgICB2YXIgaWQgPSBvcHRpb25zLmlkIHx8IHVybDsKCiAgICBpZiAoISQub3MucGx1cykgewogICAgICAvL1RPRE8g5YWI5Li05pe26L+Z5LmI5aSE55CG77ya5omL5py65LiK6aG25bGC6Lez77yMUEPkuIpwYXJlbnTot7MKICAgICAgaWYgKCQub3MuaW9zIHx8ICQub3MuYW5kcm9pZCkgewogICAgICAgIHdpbmRvdy50b3AubG9jYXRpb24uaHJlZiA9IHVybDsKICAgICAgfSBlbHNlIHsKICAgICAgICB3aW5kb3cucGFyZW50LmxvY2F0aW9uLmhyZWYgPSB1cmw7CiAgICAgIH0KCiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoIXdpbmRvdy5wbHVzKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgcGFyYW1zID0gb3B0aW9ucy5wYXJhbXMgfHwge307CiAgICB2YXIgd2VidmlldyA9IG51bGwsCiAgICAgICAgd2Vidmlld0NhY2hlID0gbnVsbCwKICAgICAgICBuU2hvdywKICAgICAgICBuV2FpdGluZzsKCiAgICBpZiAoJC53ZWJ2aWV3c1tpZF0pIHsKICAgICAgd2Vidmlld0NhY2hlID0gJC53ZWJ2aWV3c1tpZF07IC8vd2Vidmlld+ecn+WunuWtmOWcqO+8jOaJjeiDveiOt+WPlgoKICAgICAgaWYgKHBsdXMud2Vidmlldy5nZXRXZWJ2aWV3QnlJZChpZCkpIHsKICAgICAgICB3ZWJ2aWV3ID0gd2Vidmlld0NhY2hlLndlYnZpZXc7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAob3B0aW9ucy5jcmVhdGVOZXcgIT09IHRydWUpIHsKICAgICAgd2VidmlldyA9IHBsdXMud2Vidmlldy5nZXRXZWJ2aWV3QnlJZChpZCk7CiAgICB9CgogICAgaWYgKHdlYnZpZXcpIHsKICAgICAgLy/lt7LnvJPlrZgKICAgICAgLy/mr4/mrKFzaG936YO96ZyA6KaB5Lyg6YCS5Yqo55S75Y+C5pWw77ybCiAgICAgIC8v6aKE5Yqg6L2955qE5Yqo55S75Y+C5pWw5LyY5YWI57qn77yab3BlbldpbmRvd+mFjee9rj5wcmVsb2FkUGFnZXPphY3nva4+bXVp6buY6K6k6YWN572u77ybCiAgICAgIG5TaG93ID0gd2Vidmlld0NhY2hlID8gd2Vidmlld0NhY2hlLnNob3cgOiBkZWZhdWx0U2hvdzsKICAgICAgblNob3cgPSBvcHRpb25zLnNob3cgPyAkLmV4dGVuZChuU2hvdywgb3B0aW9ucy5zaG93KSA6IG5TaG93OwogICAgICBuU2hvdy5hdXRvU2hvdyAmJiB3ZWJ2aWV3LnNob3coblNob3cuYW5pU2hvdywgblNob3cuZHVyYXRpb24sIGZ1bmN0aW9uICgpIHsKICAgICAgICB0cmlnZ2VyUHJlbG9hZCh3ZWJ2aWV3KTsKICAgICAgICB0cmlnZ2VyKHdlYnZpZXcsICdwYWdlYmVmb3Jlc2hvdycsIGZhbHNlKTsKICAgICAgfSk7CgogICAgICBpZiAod2Vidmlld0NhY2hlKSB7CiAgICAgICAgd2Vidmlld0NhY2hlLmFmdGVyU2hvd01ldGhvZE5hbWUgJiYgd2Vidmlldy5ldmFsSlMod2Vidmlld0NhY2hlLmFmdGVyU2hvd01ldGhvZE5hbWUgKyAnKFwnJyArIEpTT04uc3RyaW5naWZ5KHBhcmFtcykgKyAnXCcpJyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB3ZWJ2aWV3OwogICAgfSBlbHNlIHsKICAgICAgLy/mlrDnqpflj6MKICAgICAgaWYgKCF1cmwpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3dlYnZpZXdbJyArIGlkICsgJ10gZG9lcyBub3QgZXhpc3QnKTsKICAgICAgfSAvL+aYvuekundhaXRpbmcKCgogICAgICB2YXIgd2FpdGluZ0NvbmZpZyA9ICQud2FpdGluZ09wdGlvbnMob3B0aW9ucy53YWl0aW5nKTsKCiAgICAgIGlmICh3YWl0aW5nQ29uZmlnLmF1dG9TaG93KSB7CiAgICAgICAgbldhaXRpbmcgPSBwbHVzLm5hdGl2ZVVJLnNob3dXYWl0aW5nKHdhaXRpbmdDb25maWcudGl0bGUsIHdhaXRpbmdDb25maWcub3B0aW9ucyk7CiAgICAgIH0gLy/liJvlu7rpobXpnaIKCgogICAgICBvcHRpb25zID0gJC5leHRlbmQob3B0aW9ucywgewogICAgICAgIGlkOiBpZCwKICAgICAgICB1cmw6IHVybAogICAgICB9KTsKICAgICAgd2VidmlldyA9ICQuY3JlYXRlV2luZG93KG9wdGlvbnMpOwoKICAgICAgaWYgKHRpdGxlQ29uZmlnKSB7CiAgICAgICAgLy/lpITnkIbljp/nlJ/lpLQKICAgICAgICAkLmV4dGVuZCh0cnVlLCAkLm9wdGlvbnMudGl0bGVDb25maWcsIHRpdGxlQ29uZmlnKTsKICAgICAgICB2YXIgdGlkID0gJC5vcHRpb25zLnRpdGxlQ29uZmlnLmlkID8gJC5vcHRpb25zLnRpdGxlQ29uZmlnLmlkIDogaWQgKyAiX3RpdGxlIjsKICAgICAgICB2YXIgdmlldyA9IG5ldyBwbHVzLm5hdGl2ZU9iai5WaWV3KHRpZCwgewogICAgICAgICAgdG9wOiAwLAogICAgICAgICAgaGVpZ2h0OiAkLm9wdGlvbnMudGl0bGVDb25maWcuaGVpZ2h0LAogICAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICAgIGRvY2s6ICJ0b3AiLAogICAgICAgICAgcG9zaXRpb246ICJkb2NrIgogICAgICAgIH0pOwogICAgICAgIHZpZXcuZHJhd1JlY3QoJC5vcHRpb25zLnRpdGxlQ29uZmlnLmJhY2tncm91bmRDb2xvcik7IC8v57uY5Yi26IOM5pmv6ImyCgogICAgICAgIHZhciBfYiA9IHBhcnNlSW50KCQub3B0aW9ucy50aXRsZUNvbmZpZy5oZWlnaHQpIC0gMTsKCiAgICAgICAgdmlldy5kcmF3UmVjdCgkLm9wdGlvbnMudGl0bGVDb25maWcuYm90dG9tQm9yZGVyQ29sb3IsIHsKICAgICAgICAgIHRvcDogX2IgKyAicHgiLAogICAgICAgICAgbGVmdDogIjBweCIKICAgICAgICB9KTsgLy/nu5jliLblupXpg6jovrnnur8KICAgICAgICAvL+e7mOWItuaWh+WtlwoKICAgICAgICBpZiAoJC5vcHRpb25zLnRpdGxlQ29uZmlnLnRpdGxlLnRleHQpIHsKICAgICAgICAgIHZhciBfdGl0bGUgPSAkLm9wdGlvbnMudGl0bGVDb25maWcudGl0bGU7CiAgICAgICAgICB2aWV3LmRyYXdUZXh0KF90aXRsZS50ZXh0LCBfdGl0bGUucG9zaXRpb24sIF90aXRsZS5zdHlsZXMpOwogICAgICAgIH0gLy/ov5Tlm57lm77moIfnu5jliLYKCgogICAgICAgIHZhciBfYmFjayA9ICQub3B0aW9ucy50aXRsZUNvbmZpZy5iYWNrOwogICAgICAgIHZhciBiYWNrQ2xpY2sgPSBudWxsOyAvL+S8mOWFiOWtl+S9kwogICAgICAgIC8v5YW25qyh5piv5Zu+54mHCgogICAgICAgIHZhciBfYmFja0ltYWdlID0gX2JhY2suaW1hZ2U7CgogICAgICAgIGlmIChfYmFja0ltYWdlLmJhc2U2NERhdGEgfHwgX2JhY2tJbWFnZS5pbWdTcmMpIHsKICAgICAgICAgIC8vVE9ETyDmraTlpITpnIDopoHlpITnkIbnmb7liIbmr5TnmoTmg4XlhrUKICAgICAgICAgIGJhY2tDbGljayA9IHsKICAgICAgICAgICAgbGVmdDogcGFyc2VJbnQoX2JhY2tJbWFnZS5wb3NpdGlvbi5sZWZ0KSwKICAgICAgICAgICAgcmlnaHQ6IHBhcnNlSW50KF9iYWNrSW1hZ2UucG9zaXRpb24ubGVmdCkgKyBwYXJzZUludChfYmFja0ltYWdlLnBvc2l0aW9uLndpZHRoKQogICAgICAgICAgfTsKICAgICAgICAgIHZhciBiaXRtYXAgPSBuZXcgcGx1cy5uYXRpdmVPYmouQml0bWFwKGlkICsgIl9iYWNrIik7CgogICAgICAgICAgaWYgKF9iYWNrSW1hZ2UuYmFzZTY0RGF0YSkgewogICAgICAgICAgICAvL+S8mOWFiGJhc2U2NOe8lueggeWtl+espuS4sgogICAgICAgICAgICBiaXRtYXAubG9hZEJhc2U2NERhdGEoX2JhY2tJbWFnZS5iYXNlNjREYXRhKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8v5YW25qyh5Yqg6L295Zu+54mH5paH5Lu2CiAgICAgICAgICAgIGJpdG1hcC5sb2FkKF9iYWNrSW1hZ2UuaW1nU3JjKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2aWV3LmRyYXdCaXRtYXAoYml0bWFwLCBfYmFja0ltYWdlLnNwcml0ZSwgX2JhY2tJbWFnZS5wb3NpdGlvbik7CiAgICAgICAgfSAvL+WkhOeQhueCueWHu+S6i+S7tgoKCiAgICAgICAgdmlldy5zZXRUb3VjaEV2ZW50UmVjdCh7CiAgICAgICAgICB0b3A6ICIwcHgiLAogICAgICAgICAgbGVmdDogIjBweCIsCiAgICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgICAgaGVpZ2h0OiAiMTAwJSIKICAgICAgICB9KTsKICAgICAgICB2aWV3LmludGVyY2VwdFRvdWNoRXZlbnQodHJ1ZSk7CiAgICAgICAgdmlldy5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB2YXIgeCA9IGUuY2xpZW50WDsgLy/ov5Tlm57mjInpkq7ngrnlh7sKCiAgICAgICAgICBpZiAoYmFja0NsaWNrICYmIHggPiBiYWNrQ2xpY2subGVmdCAmJiB4IDwgYmFja0NsaWNrLnJpZ2h0KSB7CiAgICAgICAgICAgIGlmIChfYmFjay5jbGljayAmJiAkLmlzRnVuY3Rpb24oX2JhY2suY2xpY2spKSB7CiAgICAgICAgICAgICAgX2JhY2suY2xpY2soKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB3ZWJ2aWV3LmV2YWxKUygid2luZG93Lm11aSYmbXVpLmJhY2soKTsiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIGZhbHNlKTsKICAgICAgICB3ZWJ2aWV3LmFwcGVuZCh2aWV3KTsKICAgICAgfSAvL+aYvuekugoKCiAgICAgIG5TaG93ID0gJC5zaG93T3B0aW9ucyhvcHRpb25zLnNob3cpOwoKICAgICAgaWYgKG5TaG93LmF1dG9TaG93KSB7CiAgICAgICAgLy90aXRsZVVwZGF0ZeinpuWPkeaXtuacuuaXqeS6jmxvYWRlZO+8jOabtOaNouS4unRpdGxlVXBkYXRl5ZCO77yM5Y+v5Lul5pu05pep55qE5pi+56S6d2VidmlldwogICAgICAgIHdlYnZpZXcuYWRkRXZlbnRMaXN0ZW5lcihuU2hvdy5ldmVudCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgLy/lhbPpl63nrYnlvoXmoYYKICAgICAgICAgIGlmIChuV2FpdGluZykgewogICAgICAgICAgICBuV2FpdGluZy5jbG9zZSgpOwogICAgICAgICAgfSAvL+aYvuekuumhtemdogoKCiAgICAgICAgICB3ZWJ2aWV3LnNob3coblNob3cuYW5pU2hvdywgblNob3cuZHVyYXRpb24sIGZ1bmN0aW9uICgpIHt9LCBuU2hvdy5leHRyYXMpOwogICAgICAgIH0sIGZhbHNlKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB3ZWJ2aWV3OwogIH07CiAgLyoqCiAgICog5qC55o2u6YWN572u5L+h5oGv5Yib5bu65LiA5Liqd2VidmlldwogICAqIEBwYXJhbSB7dHlwZX0gb3B0aW9ucwogICAqIEBwYXJhbSB7dHlwZX0gaXNDcmVhdGUKICAgKiBAcmV0dXJucyB7d2Vidmlld30KICAgKi8KCgogICQuY3JlYXRlV2luZG93ID0gZnVuY3Rpb24gKG9wdGlvbnMsIGlzQ3JlYXRlKSB7CiAgICBpZiAoIXdpbmRvdy5wbHVzKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgaWQgPSBvcHRpb25zLmlkIHx8IG9wdGlvbnMudXJsOwogICAgdmFyIHdlYnZpZXc7CgogICAgaWYgKG9wdGlvbnMucHJlbG9hZCkgewogICAgICBpZiAoJC53ZWJ2aWV3c1tpZF0gJiYgJC53ZWJ2aWV3c1tpZF0ud2Vidmlldy5nZXRVUkwoKSkgewogICAgICAgIC8v5bey57uPY2FjaGUKICAgICAgICB3ZWJ2aWV3ID0gJC53ZWJ2aWV3c1tpZF0ud2VidmlldzsKICAgICAgfSBlbHNlIHsKICAgICAgICAvL+aWsOWinumihOWKoOi9veeql+WPowogICAgICAgIC8v5Yik5pat5piv5ZCm5pC65bimY3JlYXRlTmV35Y+C5pWw77yM6buY6K6k5Li6ZmFsc2UKICAgICAgICBpZiAob3B0aW9ucy5jcmVhdGVOZXcgIT09IHRydWUpIHsKICAgICAgICAgIHdlYnZpZXcgPSBwbHVzLndlYnZpZXcuZ2V0V2Vidmlld0J5SWQoaWQpOwogICAgICAgIH0gLy/kuYvliY3msqHmnInvvIzpgqPlsLHmlrDliJvlu7oJCgoKICAgICAgICBpZiAoIXdlYnZpZXcpIHsKICAgICAgICAgIHdlYnZpZXcgPSBwbHVzLndlYnZpZXcuY3JlYXRlKG9wdGlvbnMudXJsLCBpZCwgJC53aW5kb3dPcHRpb25zKG9wdGlvbnMuc3R5bGVzKSwgJC5leHRlbmQoewogICAgICAgICAgICBwcmVsb2FkOiB0cnVlCiAgICAgICAgICB9LCBvcHRpb25zLmV4dHJhcykpOwoKICAgICAgICAgIGlmIChvcHRpb25zLnN1YnBhZ2VzKSB7CiAgICAgICAgICAgICQuZWFjaChvcHRpb25zLnN1YnBhZ2VzLCBmdW5jdGlvbiAoaW5kZXgsIHN1YnBhZ2UpIHsKICAgICAgICAgICAgICB2YXIgc3VicGFnZUlkID0gc3VicGFnZS5pZCB8fCBzdWJwYWdlLnVybDsKCiAgICAgICAgICAgICAgaWYgKHN1YnBhZ2VJZCkgewogICAgICAgICAgICAgICAgLy/ov4fmu6Tnqbrlr7nosaEKICAgICAgICAgICAgICAgIHZhciBzdWJXZWJ2aWV3ID0gcGx1cy53ZWJ2aWV3LmdldFdlYnZpZXdCeUlkKHN1YnBhZ2VJZCk7CgogICAgICAgICAgICAgICAgaWYgKCFzdWJXZWJ2aWV3KSB7CiAgICAgICAgICAgICAgICAgIC8v5aaC5p6c6K+ld2Vidmlld+S4jeWtmOWcqO+8jOWImeWIm+W7ugogICAgICAgICAgICAgICAgICBzdWJXZWJ2aWV3ID0gcGx1cy53ZWJ2aWV3LmNyZWF0ZShzdWJwYWdlLnVybCwgc3VicGFnZUlkLCAkLndpbmRvd09wdGlvbnMoc3VicGFnZS5zdHlsZXMpLCAkLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgcHJlbG9hZDogdHJ1ZQogICAgICAgICAgICAgICAgICB9LCBzdWJwYWdlLmV4dHJhcykpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHdlYnZpZXcuYXBwZW5kKHN1YldlYnZpZXcpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vVE9ETyDnkIborrrkuIrvvIzlrZB3ZWJ2aWV35Lmf5bqU6K+l6K6h566X5Yiw6aKE5Yqg6L296Zif5YiX5Lit77yM5L2G6L+Z5qC35bCx6bq754Om5LqG77yM6KaB6YCA5b+F6aG76YCA5pW05L2T77yM5ZCm5YiZ5Y+v6IO95Ye6546w6Zeu6aKY77ybCgoKICAgICAgJC53ZWJ2aWV3c1tpZF0gPSB7CiAgICAgICAgd2Vidmlldzogd2VidmlldywKICAgICAgICAvL+ebruWJjeS7hXByZWxvYWTnmoTnvJPlrZh3ZWJ2aWV3CiAgICAgICAgcHJlbG9hZDogdHJ1ZSwKICAgICAgICBzaG93OiAkLnNob3dPcHRpb25zKG9wdGlvbnMuc2hvdyksCiAgICAgICAgYWZ0ZXJTaG93TWV0aG9kTmFtZTogb3B0aW9ucy5hZnRlclNob3dNZXRob2ROYW1lIC8v5bCx5LiN5bqU6K+l55SoZXZhbEpT44CC5bqU6K+l5piv6YCa6L+H5LqL5Lu25raI5oGv6YCa6K6vCgogICAgICB9OyAvL+e0ouW8leivpemihOWKoOi9veeql+WPowoKICAgICAgdmFyIHByZWxvYWRzID0gJC5kYXRhLnByZWxvYWRzOwogICAgICB2YXIgaW5kZXggPSBwcmVsb2Fkcy5pbmRleE9mKGlkKTsKCiAgICAgIGlmICh+aW5kZXgpIHsKICAgICAgICAvL+WIoOmZpOW3suWtmOWcqOeahCjlj5jnm7josIPmlbTmj5LlhaXkvY3nva4pCiAgICAgICAgcHJlbG9hZHMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgfQoKICAgICAgcHJlbG9hZHMucHVzaChpZCk7CgogICAgICBpZiAocHJlbG9hZHMubGVuZ3RoID4gJC5vcHRpb25zLnByZWxvYWRMaW1pdCkgewogICAgICAgIC8v5YWI6L+b5YWI5Ye6CiAgICAgICAgdmFyIGZpcnN0ID0gJC5kYXRhLnByZWxvYWRzLnNoaWZ0KCk7CiAgICAgICAgdmFyIHdlYnZpZXdDYWNoZSA9ICQud2Vidmlld3NbZmlyc3RdOwoKICAgICAgICBpZiAod2Vidmlld0NhY2hlICYmIHdlYnZpZXdDYWNoZS53ZWJ2aWV3KSB7CiAgICAgICAgICAvL+mcgOimgeWwhuiHquW3seaJk+W8gOeahOaJgOaciemhtemdou+8jOWFqOmDqGNsb3Nl77ybCiAgICAgICAgICAvL+WFs+mXreivpemihOWKoOi9vXdlYnZpZXcJCiAgICAgICAgICAkLmNsb3NlQWxsKHdlYnZpZXdDYWNoZS53ZWJ2aWV3KTsKICAgICAgICB9IC8v5Yig6Zmk57yT5a2YCgoKICAgICAgICBkZWxldGUgJC53ZWJ2aWV3c1tmaXJzdF07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmIChpc0NyZWF0ZSAhPT0gZmFsc2UpIHsKICAgICAgICAvL+ebtOaOpeWIm+W7uumdnumihOWKoOi9veeql+WPowogICAgICAgIHdlYnZpZXcgPSBwbHVzLndlYnZpZXcuY3JlYXRlKG9wdGlvbnMudXJsLCBpZCwgJC53aW5kb3dPcHRpb25zKG9wdGlvbnMuc3R5bGVzKSwgb3B0aW9ucy5leHRyYXMpOwoKICAgICAgICBpZiAob3B0aW9ucy5zdWJwYWdlcykgewogICAgICAgICAgJC5lYWNoKG9wdGlvbnMuc3VicGFnZXMsIGZ1bmN0aW9uIChpbmRleCwgc3VicGFnZSkgewogICAgICAgICAgICB2YXIgc3VicGFnZUlkID0gc3VicGFnZS5pZCB8fCBzdWJwYWdlLnVybDsKICAgICAgICAgICAgdmFyIHN1YldlYnZpZXcgPSBwbHVzLndlYnZpZXcuZ2V0V2Vidmlld0J5SWQoc3VicGFnZUlkKTsKCiAgICAgICAgICAgIGlmICghc3ViV2VidmlldykgewogICAgICAgICAgICAgIHN1YldlYnZpZXcgPSBwbHVzLndlYnZpZXcuY3JlYXRlKHN1YnBhZ2UudXJsLCBzdWJwYWdlSWQsICQud2luZG93T3B0aW9ucyhzdWJwYWdlLnN0eWxlcyksIHN1YnBhZ2UuZXh0cmFzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2Vidmlldy5hcHBlbmQoc3ViV2Vidmlldyk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gd2VidmlldzsKICB9OwogIC8qKgogICAqIOmihOWKoOi9vQogICAqLwoKCiAgJC5wcmVsb2FkID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIC8v6LCD55So6aKE5Yqg6L295Ye95pWw77yM5LiN566h5piv5ZCm5Lyg6YCScHJlbG9hZOWPguaVsO+8jOW8uuWItuWPmOS4unRydWUKICAgIGlmICghb3B0aW9ucy5wcmVsb2FkKSB7CiAgICAgIG9wdGlvbnMucHJlbG9hZCA9IHRydWU7CiAgICB9CgogICAgcmV0dXJuICQuY3JlYXRlV2luZG93KG9wdGlvbnMpOwogIH07CiAgLyoqCiAgICrlhbPpl63lvZPliY13ZWJ2aWV35omT5byA55qE5omA5pyJd2Vidmlld++8mwogICAqLwoKCiAgJC5jbG9zZU9wZW5lZCA9IGZ1bmN0aW9uICh3ZWJ2aWV3KSB7CiAgICB2YXIgb3BlbmVkID0gd2Vidmlldy5vcGVuZWQoKTsKCiAgICBpZiAob3BlbmVkKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBvcGVuZWQubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICB2YXIgb3BlbmVkV2VidmlldyA9IG9wZW5lZFtpXTsKICAgICAgICB2YXIgb3Blbl9vcGVuID0gb3BlbmVkV2Vidmlldy5vcGVuZWQoKTsKCiAgICAgICAgaWYgKG9wZW5fb3BlbiAmJiBvcGVuX29wZW4ubGVuZ3RoID4gMCkgewogICAgICAgICAgLy/lhbPpl63miZPlvIDnmoR3ZWJ2aWV3CiAgICAgICAgICAkLmNsb3NlT3BlbmVkKG9wZW5lZFdlYnZpZXcpOyAvL+WFs+mXreiHquW3sQoKICAgICAgICAgIG9wZW5lZFdlYnZpZXcuY2xvc2UoIm5vbmUiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy/lpoLmnpznm7TmjqXlranlrZDoioLngrnvvIzlsLHkuI3nlKjlhbPpl63kuobvvIzlm6DkuLrniLblhbPpl63nmoTml7blgJnvvIzkvJroh6rliqjlhbPpl63lrZDvvJsKICAgICAgICAgIGlmIChvcGVuZWRXZWJ2aWV3LnBhcmVudCgpICE9PSB3ZWJ2aWV3KSB7CiAgICAgICAgICAgIG9wZW5lZFdlYnZpZXcuY2xvc2UoJ25vbmUnKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICAkLmNsb3NlQWxsID0gZnVuY3Rpb24gKHdlYnZpZXcsIGFuaVNob3cpIHsKICAgICQuY2xvc2VPcGVuZWQod2Vidmlldyk7CgogICAgaWYgKGFuaVNob3cpIHsKICAgICAgd2Vidmlldy5jbG9zZShhbmlTaG93KTsKICAgIH0gZWxzZSB7CiAgICAgIHdlYnZpZXcuY2xvc2UoKTsKICAgIH0KICB9OwogIC8qKgogICAqIOaJuemHj+WIm+W7undlYnZpZXcKICAgKiBAcGFyYW0ge3R5cGV9IG9wdGlvbnMKICAgKiBAcmV0dXJucyB7dW5kZWZpbmVkfQogICAqLwoKCiAgJC5jcmVhdGVXaW5kb3dzID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICQuZWFjaChvcHRpb25zLCBmdW5jdGlvbiAoaW5kZXgsIG9wdGlvbikgewogICAgICAvL+WIneWni+WMlumihOWKoOi9veeql+WPoyjliJvlu7op5ZKM6Z2e6aKE5Yqg6L2956qX5Y+jKOS7hemFjee9ru+8jOS4jeWIm+W7uikKICAgICAgJC5jcmVhdGVXaW5kb3cob3B0aW9uLCBmYWxzZSk7CiAgICB9KTsKICB9OwogIC8qKgogICAqIOWIm+W7uuW9k+WJjemhtemdoueahOWtkHdlYnZpZXcKICAgKiBAcGFyYW0ge3R5cGV9IG9wdGlvbnMKICAgKiBAcmV0dXJucyB7d2Vidmlld30KICAgKi8KCgogICQuYXBwZW5kV2VidmlldyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICBpZiAoIXdpbmRvdy5wbHVzKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgaWQgPSBvcHRpb25zLmlkIHx8IG9wdGlvbnMudXJsOwogICAgdmFyIHdlYnZpZXc7CgogICAgaWYgKCEkLndlYnZpZXdzW2lkXSkgewogICAgICAvL+S/neivgeaJp+ihjOS4gOmBjQogICAgICAvL1RPRE8g6L+Z6YeM5Lmf5pyJ6ZqQ5oKj77yM5q+U5aaC5p+Q5Liqd2Vidmlld+S4jeaYr+S9nOS4unN1YnBhZ2XliJvlu7rnmoTvvIzogIzmmK/kvZzkuLp0YXJnZXQgd2Vidmlld+eahOivne+8mwogICAgICBpZiAoIXBsdXMud2Vidmlldy5nZXRXZWJ2aWV3QnlJZChpZCkpIHsKICAgICAgICB3ZWJ2aWV3ID0gcGx1cy53ZWJ2aWV3LmNyZWF0ZShvcHRpb25zLnVybCwgaWQsIG9wdGlvbnMuc3R5bGVzLCBvcHRpb25zLmV4dHJhcyk7CiAgICAgIH0gLy/kuYvliY3nmoTlrp7njrDmlrnmoYjvvJrlrZDnqpflj6Nsb2FkZWTkuYvlkI7lho1hcHBlbmTliLDniLbnqpflj6PkuK3vvJsKICAgICAgLy/pl67popjvvJrpg6jliIblrZDnqpflj6Nsb2FkZWTkuovku7blj5HnlJ/ovoPmmZrvvIzmraTml7bmiafooYzniLbnqpflj6PnmoRjaGlsZHJlbuaWueazleS8mui/lOWbnuepuu+8jOWvvOiHtOeItuWtkOmAmuiur+Wksei0pe+8mwogICAgICAvLyAgICAg5q+U5aaC54i26aG16Z2i5omn6KGM5a6McHJlbG9hZOS6i+S7tuWQju+8jOmcgOinpuWPkeWtkOmhtemdoueahHByZWxvYWTkuovku7bvvIzmraTml7bmnKphcHBlbmTnmoTor53vvIzlsLHml6Dms5Xop6blj5HvvJsKICAgICAgLy/kv67mlLnmlrnlvI/vvJrkuI3lho3nm5Hmjqdsb2FkZWTkuovku7bvvIznm7TmjqVhcHBlbmQKICAgICAgLy9ieSBjaGJAMjAxNTA1MjEKICAgICAgLy8gd2Vidmlldy5hZGRFdmVudExpc3RlbmVyKCdsb2FkZWQnLCBmdW5jdGlvbigpIHsKCgogICAgICBwbHVzLndlYnZpZXcuY3VycmVudFdlYnZpZXcoKS5hcHBlbmQod2Vidmlldyk7IC8vIH0pOwoKICAgICAgJC53ZWJ2aWV3c1tpZF0gPSBvcHRpb25zOwogICAgfQoKICAgIHJldHVybiB3ZWJ2aWV3OwogIH07IC8v5YWo5bGAd2Vidmlld3MKCgogICQud2Vidmlld3MgPSB7fTsgLy/pooTliqDovb3nqpflj6PntKLlvJUKCiAgJC5kYXRhLnByZWxvYWRzID0gW107IC8vJC5jdXJyZW50V2VidmlldwoKICAkLnBsdXNSZWFkeShmdW5jdGlvbiAoKSB7CiAgICAkLmN1cnJlbnRXZWJ2aWV3ID0gcGx1cy53ZWJ2aWV3LmN1cnJlbnRXZWJ2aWV3KCk7CiAgfSk7CiAgJC5hZGRJbml0KHsKICAgIG5hbWU6ICc1KycsCiAgICBpbmRleDogMTAwLAogICAgaGFuZGxlOiBmdW5jdGlvbiBoYW5kbGUoKSB7CiAgICAgIHZhciBvcHRpb25zID0gJC5vcHRpb25zOwogICAgICB2YXIgc3VicGFnZXMgPSBvcHRpb25zLnN1YnBhZ2VzIHx8IFtdOwoKICAgICAgaWYgKCQub3MucGx1cykgewogICAgICAgICQucGx1c1JlYWR5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vVE9ETyAg6L+Z6YeM6ZyA6KaB5Yik5pat5LiA5LiL77yM5pyA5aW9562J5a2Q56qX5Y+j5Yqg6L295a6M5q+V5ZCO77yM5YaN6LCD55So5Li756qX5Y+j55qEc2hvd+aWueazle+8mwogICAgICAgICAgLy/miJbogIXvvJrlnKhvcGVud2luZG935pa55rOV5Lit77yM55uR5ZCs5a6e546w77ybCiAgICAgICAgICAkLmVhY2goc3VicGFnZXMsIGZ1bmN0aW9uIChpbmRleCwgc3VicGFnZSkgewogICAgICAgICAgICAkLmFwcGVuZFdlYnZpZXcoc3VicGFnZSk7CiAgICAgICAgICB9KTsgLy/liKTmlq3mmK/lkKbpppbpobUKCiAgICAgICAgICBpZiAocGx1cy53ZWJ2aWV3LmN1cnJlbnRXZWJ2aWV3KCkgPT09IHBsdXMud2Vidmlldy5nZXRXZWJ2aWV3QnlJZChwbHVzLnJ1bnRpbWUuYXBwaWQpKSB7CiAgICAgICAgICAgIC8v6aaW6aG16ZyA6KaB6Ieq5bex5r+A5rS76aKE5Yqg6L2977ybCiAgICAgICAgICAgIC8vdGltZW91dOWboOS4uuWtkOmhtemdomxvYWRlZOS5i+WQjuaJjWFwcGVuZOeahO+8jOmYsuatouWtkOmhtemdouWwmuacqmFwcGVuZOOAgeS7juiAjOWvvOiHtOWFtnByZWxvYWTmnKrop6blj5HnmoTpl67popjvvJsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdHJpZ2dlclByZWxvYWQocGx1cy53ZWJ2aWV3LmN1cnJlbnRXZWJ2aWV3KCkpOwogICAgICAgICAgICB9LCAzMDApOwogICAgICAgICAgfSAvL+iuvue9rmlvc+mhtumDqOeKtuaAgeagj+minOiJsu+8mwoKCiAgICAgICAgICBpZiAoJC5vcy5pb3MgJiYgJC5vcHRpb25zLnN0YXR1c0JhckJhY2tncm91bmQpIHsKICAgICAgICAgICAgcGx1cy5uYXZpZ2F0b3Iuc2V0U3RhdHVzQmFyQmFja2dyb3VuZCgkLm9wdGlvbnMuc3RhdHVzQmFyQmFja2dyb3VuZCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCQub3MuYW5kcm9pZCAmJiBwYXJzZUZsb2F0KCQub3MudmVyc2lvbikgPCA0LjQpIHsKICAgICAgICAgICAgLy/op6PlhrNBbmRyb2lk5bmz5Y+wNC4054mI5pys5Lul5LiL77yMcmVzdW1l5ZCO77yM54i256qX5L2T5qCH6aKY5bu26L+f5riy5p+T55qE6Zeu6aKY77ybCiAgICAgICAgICAgIGlmIChwbHVzLndlYnZpZXcuY3VycmVudFdlYnZpZXcoKS5wYXJlbnQoKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigicmVzdW1lIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGJvZHkgPSBkb2N1bWVudC5ib2R5OwogICAgICAgICAgICAgICAgYm9keS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIGJvZHkuc3R5bGUuZGlzcGxheSA9ICcnOwogICAgICAgICAgICAgICAgfSwgMTApOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7Ly/lt7LmlK/mjIFpZnJhbWXltYzlhaUKICAgICAgICAvLwkJCQlpZiAoc3VicGFnZXMubGVuZ3RoID4gMCkgewogICAgICAgIC8vCQkJCQl2YXIgZXJyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgLy8JCQkJCWVyci5jbGFzc05hbWUgPSAnbXVpLWVycm9yJzsKICAgICAgICAvLwkJCQkJLy/mloflrZfmj4/ov7AKICAgICAgICAvLwkJCQkJdmFyIHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgLy8JCQkJCXNwYW4uaW5uZXJIVE1MID0gJ+WcqOivpea1j+iniOWZqOS4i++8jOS4jeaUr+aMgeWIm+W7uuWtkOmhtemdou+8jOWFt+S9k+WPguiAgyc7CiAgICAgICAgLy8JCQkJCWVyci5hcHBlbmRDaGlsZChzcGFuKTsKICAgICAgICAvLwkJCQkJdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgLy8JCQkJCWEuaW5uZXJIVE1MID0gJyJtdWnmoYbmnrbpgILnlKjlnLrmma8iJzsKICAgICAgICAvLwkJCQkJYS5ocmVmID0gJ2h0dHA6Ly9hc2suZGNsb3VkLm5ldC5jbi9hcnRpY2xlLzExMyc7CiAgICAgICAgLy8JCQkJCWVyci5hcHBlbmRDaGlsZChhKTsKICAgICAgICAvLwkJCQkJZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlcnIpOwogICAgICAgIC8vCQkJCQljb25zb2xlLmxvZygn5Zyo6K+l5rWP6KeI5Zmo5LiL77yM5LiN5pSv5oyB5Yib5bu65a2Q6aG16Z2iJyk7CiAgICAgICAgLy8JCQkJfQogICAgICB9CiAgICB9CiAgfSk7CiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3ByZWxvYWQnLCBmdW5jdGlvbiAoKSB7CiAgICAvL+WkhOeQhumihOWKoOi9vemDqOWIhgogICAgdmFyIHdlYnZpZXdzID0gJC5vcHRpb25zLnByZWxvYWRQYWdlcyB8fCBbXTsKICAgICQucGx1c1JlYWR5KGZ1bmN0aW9uICgpIHsKICAgICAgJC5lYWNoKHdlYnZpZXdzLCBmdW5jdGlvbiAoaW5kZXgsIHdlYnZpZXcpIHsKICAgICAgICAkLmNyZWF0ZVdpbmRvdygkLmV4dGVuZCh3ZWJ2aWV3LCB7CiAgICAgICAgICBwcmVsb2FkOiB0cnVlCiAgICAgICAgfSkpOwogICAgICB9KTsKICAgIH0pOwogIH0pOwoKICAkLnN1cHBvcnRTdGF0dXNiYXJPZmZzZXQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gJC5vcy5wbHVzICYmICQub3MuaW9zICYmIHBhcnNlRmxvYXQoJC5vcy52ZXJzaW9uKSA+PSA3OwogIH07CgogICQucmVhZHkoZnVuY3Rpb24gKCkgewogICAgLy/moIfor4blvZPliY3njq/looPmlK/mjIFzdGF0dXNiYXIKICAgIGlmICgkLnN1cHBvcnRTdGF0dXNiYXJPZmZzZXQoKSkgewogICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ211aS1zdGF0dXNiYXInKTsKICAgIH0KICB9KTsKfSkobXVpKTsKLyoqCiAqIG11aSBiYWNrCiAqIEBwYXJhbSB7dHlwZX0gJAogKiBAcGFyYW0ge3R5cGV9IHdpbmRvdwogKiBAcmV0dXJucyB7dW5kZWZpbmVkfQogKi8KCgooZnVuY3Rpb24gKCQsIHdpbmRvdykgewogIC8qKgogICAqIHJlZ2lzdGVyIGJhY2sKICAgKiBAcGFyYW0ge3R5cGV9IGJhY2sKICAgKiBAcmV0dXJucyB7JC5nZXN0dXJlc30KICAgKi8KICAkLmFkZEJhY2sgPSBmdW5jdGlvbiAoYmFjaykgewogICAgcmV0dXJuICQuYWRkQWN0aW9uKCdiYWNrcycsIGJhY2spOwogIH07CiAgLyoqCiAgICogZGVmYXVsdAogICAqLwoKCiAgJC5hZGRCYWNrKHsKICAgIG5hbWU6ICdicm93c2VyJywKICAgIGluZGV4OiAxMDAsCiAgICBoYW5kbGU6IGZ1bmN0aW9uIGhhbmRsZSgpIHsKICAgICAgaWYgKHdpbmRvdy5oaXN0b3J5Lmxlbmd0aCA+IDEpIHsKICAgICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9KTsKICAvKioKICAgKiDlkI7pgIAKICAgKi8KCiAgJC5iYWNrID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHR5cGVvZiAkLm9wdGlvbnMuYmVmb3JlYmFjayA9PT0gJ2Z1bmN0aW9uJykgewogICAgICBpZiAoJC5vcHRpb25zLmJlZm9yZWJhY2soKSA9PT0gZmFsc2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KCiAgICAkLmRvQWN0aW9uKCdiYWNrcycpOwogIH07CgogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0YXAnLCBmdW5jdGlvbiAoZSkgewogICAgdmFyIGFjdGlvbiA9ICQudGFyZ2V0cy5hY3Rpb247CgogICAgaWYgKGFjdGlvbiAmJiBhY3Rpb24uY2xhc3NMaXN0LmNvbnRhaW5zKCdtdWktYWN0aW9uLWJhY2snKSkgewogICAgICAkLmJhY2soKTsKICAgICAgJC50YXJnZXRzLmFjdGlvbiA9IGZhbHNlOwogICAgfQogIH0pOwogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzd2lwZXJpZ2h0JywgZnVuY3Rpb24gKGUpIHsKICAgIHZhciBkZXRhaWwgPSBlLmRldGFpbDsKCiAgICBpZiAoJC5vcHRpb25zLnN3aXBlQmFjayA9PT0gdHJ1ZSAmJiBNYXRoLmFicyhkZXRhaWwuYW5nbGUpIDwgMykgewogICAgICAkLmJhY2soKTsKICAgIH0KICB9KTsKfSkobXVpLCB3aW5kb3cpOwovKioKICogbXVpIGJhY2sgNSsKICogQHBhcmFtIHt0eXBlfSAkCiAqIEBwYXJhbSB7dHlwZX0gd2luZG93CiAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAqLwoKCihmdW5jdGlvbiAoJCwgd2luZG93KSB7CiAgaWYgKCQub3MucGx1cyAmJiAkLm9zLmFuZHJvaWQpIHsKICAgICQuYWRkQmFjayh7CiAgICAgIG5hbWU6ICdtdWknLAogICAgICBpbmRleDogNSwKICAgICAgaGFuZGxlOiBmdW5jdGlvbiBoYW5kbGUoKSB7CiAgICAgICAgLy/lkI7nu63ph43mlrDorr7orqHmraTlpITvvIzlsIZiYWNr5pS+5Yiw5ZCE5Liq56m66Ze05YaF6YOo5a6e546wCiAgICAgICAgLy9wb3BvdmVyCiAgICAgICAgaWYgKCQudGFyZ2V0cy5fcG9wb3ZlciAmJiAkLnRhcmdldHMuX3BvcG92ZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdtdWktYWN0aXZlJykpIHsKICAgICAgICAgICQoJC50YXJnZXRzLl9wb3BvdmVyKS5wb3BvdmVyKCdoaWRlJyk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IC8vb2ZmY2FudmFzCgoKICAgICAgICB2YXIgb2ZmQ2FudmFzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm11aS1vZmYtY2FudmFzLXdyYXAubXVpLWFjdGl2ZScpOwoKICAgICAgICBpZiAob2ZmQ2FudmFzKSB7CiAgICAgICAgICAkKG9mZkNhbnZhcykub2ZmQ2FudmFzKCdjbG9zZScpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICB2YXIgcHJldmlld0ltYWdlID0gJC5pc0Z1bmN0aW9uKCQuZ2V0UHJldmlld0ltYWdlKSAmJiAkLmdldFByZXZpZXdJbWFnZSgpOwoKICAgICAgICBpZiAocHJldmlld0ltYWdlICYmIHByZXZpZXdJbWFnZS5pc1Nob3duKCkpIHsKICAgICAgICAgIHByZXZpZXdJbWFnZS5jbG9zZSgpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSAvL3BvcHVwCgoKICAgICAgICByZXR1cm4gJC5jbG9zZVBvcHVwKCk7CiAgICAgIH0KICAgIH0pOwogIH0gLy/pppbmrKHmjInkuItiYWNr5oyJ6ZSu55qE5pe26Ze0CgoKICAkLl9fYmFja19fZmlyc3QgPSBudWxsOwogIC8qKgogICAqIDUrIGJhY2sKICAgKi8KCiAgJC5hZGRCYWNrKHsKICAgIG5hbWU6ICc1KycsCiAgICBpbmRleDogMTAsCiAgICBoYW5kbGU6IGZ1bmN0aW9uIGhhbmRsZSgpIHsKICAgICAgaWYgKCF3aW5kb3cucGx1cykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgdmFyIHdvYmogPSBwbHVzLndlYnZpZXcuY3VycmVudFdlYnZpZXcoKTsKICAgICAgdmFyIHBhcmVudCA9IHdvYmoucGFyZW50KCk7CgogICAgICBpZiAocGFyZW50KSB7CiAgICAgICAgcGFyZW50LmV2YWxKUygnbXVpJiZtdWkuYmFjaygpOycpOwogICAgICB9IGVsc2UgewogICAgICAgIHdvYmouY2FuQmFjayhmdW5jdGlvbiAoZSkgewogICAgICAgICAgLy9ieSBjaGIg5pqC5pe25rOo6YeK77yM5Zyo56Kw5Yiw57G75Ly8cG9wb3ZlcuS5i+exu+eahOmUmueCueeahOaXtuWAme+8jOmcgOWkmuasoeeCueWHu+aJjeiDvei/lOWbnu+8mwogICAgICAgICAgaWYgKGUuY2FuQmFjaykgewogICAgICAgICAgICAvL3dlYnZpZXcgaGlzdG9yeSBiYWNrCiAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LmJhY2soKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vd2VidmlldyBjbG9zZSBvciBoaWRlCiAgICAgICAgICAgIC8vZml4ZWQgYnkgZnh5IOatpOWkhOS4jeW6lOivpeeUqG9wZW5lcuWIpOaWre+8jOWboOS4uueUqOaIt+acieWPr+iDveiHquW3sWNsb3Nl5o6J5b2T5YmN56qX5Y+j55qEb3BlbmVy44CC6L+Z5qC355qE6K+d44CCb3BlbmVy5bCx5Li656m65LqG77yM5a+86Ie05LiN6IO95omn6KGMY2xvc2UKICAgICAgICAgICAgaWYgKHdvYmouaWQgPT09IHBsdXMucnVudGltZS5hcHBpZCkgewogICAgICAgICAgICAgIC8v6aaW6aG1CiAgICAgICAgICAgICAgLy/pppbpobXkuI3lrZjlnKhvcGVuZXLnmoTmg4XlhrXkuIvvvIzlkI7pgIDlrp7pmYXkuIrlupTor6XmmK/pgIDlh7rlupTnlKjvvJsKICAgICAgICAgICAgICAvL+mmluasoeaMiemUru+8jOaPkOekuuKAmOWGjeaMieS4gOasoemAgOWHuuW6lOeUqOKAmQogICAgICAgICAgICAgIGlmICghJC5fX2JhY2tfX2ZpcnN0KSB7CiAgICAgICAgICAgICAgICAkLl9fYmFja19fZmlyc3QgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgICAgICAgICAgIG11aS50b2FzdCgn5YaN5oyJ5LiA5qyh6YCA5Ye65bqU55SoJyk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgJC5fX2JhY2tfX2ZpcnN0ID0gbnVsbDsKICAgICAgICAgICAgICAgIH0sIDIwMDApOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSAkLl9fYmFja19fZmlyc3QgPCAyMDAwKSB7CiAgICAgICAgICAgICAgICAgIHBsdXMucnVudGltZS5xdWl0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8v5YW25LuW6aG16Z2i77yMCiAgICAgICAgICAgICAgaWYgKHdvYmoucHJlbG9hZCkgewogICAgICAgICAgICAgICAgd29iai5oaWRlKCJhdXRvIik7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8v5YWz6Zet6aG16Z2i5pe277yM6ZyA6KaB5bCG5YW25omT5byA55qE5omA5pyJ5a2Q6aG16Z2i5YWo6YOo5YWz6Zet77ybCiAgICAgICAgICAgICAgICAkLmNsb3NlQWxsKHdvYmopOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9KTsKCiAgJC5tZW51ID0gZnVuY3Rpb24gKCkgewogICAgdmFyIG1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXVpLWFjdGlvbi1tZW51Jyk7CgogICAgaWYgKG1lbnUpIHsKICAgICAgJC50cmlnZ2VyKG1lbnUsICQuRVZFTlRfU1RBUlQpOyAvL+S4tOaXtuWkhOeQhm1lbnXml6B0b3VjaHN0YXJ055qE6K+d77yM5om+5LiN5Yiw5b2T5YmNdGFyZ2V0c+eahOmXrumimAoKICAgICAgJC50cmlnZ2VyKG1lbnUsICd0YXAnKTsKICAgIH0gZWxzZSB7CiAgICAgIC8v5omn6KGM54i256qX5Y+j55qEbWVudQogICAgICBpZiAod2luZG93LnBsdXMpIHsKICAgICAgICB2YXIgd29iaiA9ICQuY3VycmVudFdlYnZpZXc7CiAgICAgICAgdmFyIHBhcmVudCA9IHdvYmoucGFyZW50KCk7CgogICAgICAgIGlmIChwYXJlbnQpIHsKICAgICAgICAgIC8v5Y+I5b6XZXZhbEpTCiAgICAgICAgICBwYXJlbnQuZXZhbEpTKCdtdWkmJm11aS5tZW51KCk7Jyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgdmFyIF9fYmFjayA9IGZ1bmN0aW9uIF9fYmFjaygpIHsKICAgICQuYmFjaygpOwogIH07CgogIHZhciBfX21lbnUgPSBmdW5jdGlvbiBfX21lbnUoKSB7CiAgICAkLm1lbnUoKTsKICB9OyAvL+m7mOiupOebkeWQrAoKCiAgJC5wbHVzUmVhZHkoZnVuY3Rpb24gKCkgewogICAgaWYgKCQub3B0aW9ucy5rZXlFdmVudEJpbmQuYmFja2J1dHRvbikgewogICAgICBwbHVzLmtleS5hZGRFdmVudExpc3RlbmVyKCdiYWNrYnV0dG9uJywgX19iYWNrLCBmYWxzZSk7CiAgICB9CgogICAgaWYgKCQub3B0aW9ucy5rZXlFdmVudEJpbmQubWVudWJ1dHRvbikgewogICAgICBwbHVzLmtleS5hZGRFdmVudExpc3RlbmVyKCdtZW51YnV0dG9uJywgX19tZW51LCBmYWxzZSk7CiAgICB9CiAgfSk7IC8v5aSE55CG5oyJ6ZSu55uR5ZCs5LqL5Lu2CgogICQuYWRkSW5pdCh7CiAgICBuYW1lOiAna2V5RXZlbnRCaW5kJywKICAgIGluZGV4OiAxMDAwLAogICAgaGFuZGxlOiBmdW5jdGlvbiBoYW5kbGUoKSB7CiAgICAgICQucGx1c1JlYWR5KGZ1bmN0aW9uICgpIHsKICAgICAgICAvL+WmguaenOS4jeS4unRydWXvvIzliJnnp7vpmaTpu5jorqTnm5HlkKwKICAgICAgICBpZiAoISQub3B0aW9ucy5rZXlFdmVudEJpbmQuYmFja2J1dHRvbikgewogICAgICAgICAgcGx1cy5rZXkucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmFja2J1dHRvbicsIF9fYmFjayk7CiAgICAgICAgfQoKICAgICAgICBpZiAoISQub3B0aW9ucy5rZXlFdmVudEJpbmQubWVudWJ1dHRvbikgewogICAgICAgICAgcGx1cy5rZXkucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVudWJ1dHRvbicsIF9fbWVudSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9KTsKfSkobXVpLCB3aW5kb3cpOwovKioKICogbXVpLmluaXQgcHVsbGRvd25SZWZyZXNoCiAqIEBwYXJhbSB7dHlwZX0gJAogKiBAcmV0dXJucyB7dW5kZWZpbmVkfQogKi8KCgooZnVuY3Rpb24gKCQpIHsKICAkLmFkZEluaXQoewogICAgbmFtZTogJ3B1bGxyZWZyZXNoJywKICAgIGluZGV4OiAxMDAwLAogICAgaGFuZGxlOiBmdW5jdGlvbiBoYW5kbGUoKSB7CiAgICAgIHZhciBvcHRpb25zID0gJC5vcHRpb25zOwogICAgICB2YXIgcHVsbFJlZnJlc2hPcHRpb25zID0gb3B0aW9ucy5wdWxsUmVmcmVzaCB8fCB7fTsKICAgICAgdmFyIGhhc1B1bGxkb3duID0gcHVsbFJlZnJlc2hPcHRpb25zLmRvd24gJiYgcHVsbFJlZnJlc2hPcHRpb25zLmRvd24uaGFzT3duUHJvcGVydHkoJ2NhbGxiYWNrJyk7CiAgICAgIHZhciBoYXNQdWxsdXAgPSBwdWxsUmVmcmVzaE9wdGlvbnMudXAgJiYgcHVsbFJlZnJlc2hPcHRpb25zLnVwLmhhc093blByb3BlcnR5KCdjYWxsYmFjaycpOwoKICAgICAgaWYgKGhhc1B1bGxkb3duIHx8IGhhc1B1bGx1cCkgewogICAgICAgIHZhciBjb250YWluZXIgPSBwdWxsUmVmcmVzaE9wdGlvbnMuY29udGFpbmVyOwoKICAgICAgICBpZiAoY29udGFpbmVyKSB7CiAgICAgICAgICB2YXIgJGNvbnRhaW5lciA9ICQoY29udGFpbmVyKTsKCiAgICAgICAgICBpZiAoJGNvbnRhaW5lci5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgaWYgKCQub3MucGx1cykgewogICAgICAgICAgICAgIC8vNSvnjq/looMKICAgICAgICAgICAgICBpZiAoaGFzUHVsbGRvd24gJiYgcHVsbFJlZnJlc2hPcHRpb25zLmRvd24uc3R5bGUgPT0gImNpcmNsZSIpIHsKICAgICAgICAgICAgICAgIC8v5Y6f55Sf6L2s5ZyICiAgICAgICAgICAgICAgICAkLnBsdXNSZWFkeShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIC8v6L+Z6YeM5pS55YaZJC5mbi5wdWxsUmVmcmVzaAogICAgICAgICAgICAgICAgICAkLmZuLnB1bGxSZWZyZXNoID0gJC5mbi5wdWxsUmVmcmVzaF9uYXRpdmU7CiAgICAgICAgICAgICAgICAgICRjb250YWluZXIucHVsbFJlZnJlc2gocHVsbFJlZnJlc2hPcHRpb25zKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoJC5vcy5hbmRyb2lkKSB7CiAgICAgICAgICAgICAgICAvL+mdnuWOn+eUn+i9rOWciO+8jOS9huaYr0FuZHJvaWTnjq/looMKICAgICAgICAgICAgICAgICQucGx1c1JlYWR5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgLy/ov5nph4zmlLnlhpkkLmZuLnB1bGxSZWZyZXNoCiAgICAgICAgICAgICAgICAgICQuZm4ucHVsbFJlZnJlc2ggPSAkLmZuLnB1bGxSZWZyZXNoX25hdGl2ZTsKICAgICAgICAgICAgICAgICAgdmFyIHdlYnZpZXcgPSBwbHVzLndlYnZpZXcuY3VycmVudFdlYnZpZXcoKTsKCiAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuX19OV2luX0VuYWJsZV9fID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgIC8v5LiN5pSv5oyB5aSad2VidmlldwogICAgICAgICAgICAgICAgICAgICRjb250YWluZXIucHVsbFJlZnJlc2gocHVsbFJlZnJlc2hPcHRpb25zKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaGFzUHVsbHVwKSB7CiAgICAgICAgICAgICAgICAgICAgICAvL+W9k+WJjemhtemdouWIneWni+WMlnB1bGx1cAogICAgICAgICAgICAgICAgICAgICAgdmFyIHVwT3B0aW9ucyA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgdXBPcHRpb25zLnVwID0gcHVsbFJlZnJlc2hPcHRpb25zLnVwOwogICAgICAgICAgICAgICAgICAgICAgdXBPcHRpb25zLndlYnZpZXdJZCA9IHdlYnZpZXcuaWQgfHwgd2Vidmlldy5nZXRVUkwoKTsKICAgICAgICAgICAgICAgICAgICAgICRjb250YWluZXIucHVsbFJlZnJlc2godXBPcHRpb25zKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChoYXNQdWxsZG93bikgewogICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IHdlYnZpZXcucGFyZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgaWQgPSB3ZWJ2aWV3LmlkIHx8IHdlYnZpZXcuZ2V0VVJMKCk7CgogICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWhhc1B1bGx1cCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIC8v5aaC5p6c5rKh5pyJ5LiK5ouJ5Yqg6L2977yM6ZyA6KaB5omL5Yqo5Yid5aeL5YyW5LiA5Liq6buY6K6k55qEcHVsbFJlZnJlc2jvvIzku6Xkvr/lvZPliY3pobXpnaLlrrnlmajlj6/ku6XosIPnlKhlbmRQdWxsZG93blRvUmVmcmVzaOetieaWueazlQogICAgICAgICAgICAgICAgICAgICAgICAgICRjb250YWluZXIucHVsbFJlZnJlc2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2Vidmlld0lkOiBpZAogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZG93bk9wdGlvbnMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgd2Vidmlld0lkOiBpZCAvL+WtkOmhtemdomlkCgogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBkb3duT3B0aW9ucy5kb3duID0gJC5leHRlbmQoe30sIHB1bGxSZWZyZXNoT3B0aW9ucy5kb3duKTsKICAgICAgICAgICAgICAgICAgICAgICAgZG93bk9wdGlvbnMuZG93bi5jYWxsYmFjayA9ICdfQ0FMTEJBQ0snOyAvL+aUueWGmeeItumhtemdoueahCQuZm4ucHVsbFJlZnJlc2gKCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5ldmFsSlMoIm11aS5mbi5wdWxsUmVmcmVzaD1tdWkuZm4ucHVsbFJlZnJlc2hfbmF0aXZlIik7IC8v54i26aG16Z2i5Yid5aeL5YyWcHVsbGRvd24KCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5ldmFsSlMoIm11aSYmbXVpKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tdWktY29udGVudCcpKS5wdWxsUmVmcmVzaCgnIiArIEpTT04uc3RyaW5naWZ5KGRvd25PcHRpb25zKSArICInKSIpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8v6Z2e5Y6f55Sf6L2s5ZyI77yMaU9T546v5aKDCiAgICAgICAgICAgICAgICAkY29udGFpbmVyLnB1bGxSZWZyZXNoKHB1bGxSZWZyZXNoT3B0aW9ucyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICRjb250YWluZXIucHVsbFJlZnJlc2gocHVsbFJlZnJlc2hPcHRpb25zKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0pOwp9KShtdWkpOwovKioKICogbXVpIGFqYXgKICogQHBhcmFtIHt0eXBlfSAkCiAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAqLwoKCihmdW5jdGlvbiAoJCwgd2luZG93LCB1bmRlZmluZWQpIHsKICB2YXIganNvblR5cGUgPSAnYXBwbGljYXRpb24vanNvbic7CiAgdmFyIGh0bWxUeXBlID0gJ3RleHQvaHRtbCc7CiAgdmFyIHJzY3JpcHQgPSAvPHNjcmlwdFxiW148XSooPzooPyE8XC9zY3JpcHQ+KTxbXjxdKikqPFwvc2NyaXB0Pi9naTsKICB2YXIgc2NyaXB0VHlwZVJFID0gL14oPzp0ZXh0fGFwcGxpY2F0aW9uKVwvamF2YXNjcmlwdC9pOwogIHZhciB4bWxUeXBlUkUgPSAvXig/OnRleHR8YXBwbGljYXRpb24pXC94bWwvaTsKICB2YXIgYmxhbmtSRSA9IC9eXHMqJC87CiAgJC5hamF4U2V0dGluZ3MgPSB7CiAgICB0eXBlOiAnR0VUJywKICAgIGJlZm9yZVNlbmQ6ICQubm9vcCwKICAgIHN1Y2Nlc3M6ICQubm9vcCwKICAgIGVycm9yOiAkLm5vb3AsCiAgICBjb21wbGV0ZTogJC5ub29wLAogICAgY29udGV4dDogbnVsbCwKICAgIHhocjogZnVuY3Rpb24geGhyKHByb3RvY29sKSB7CiAgICAgIHJldHVybiBuZXcgd2luZG93LlhNTEh0dHBSZXF1ZXN0KCk7CiAgICB9LAogICAgYWNjZXB0czogewogICAgICBzY3JpcHQ6ICd0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtamF2YXNjcmlwdCcsCiAgICAgIGpzb246IGpzb25UeXBlLAogICAgICB4bWw6ICdhcHBsaWNhdGlvbi94bWwsIHRleHQveG1sJywKICAgICAgaHRtbDogaHRtbFR5cGUsCiAgICAgIHRleHQ6ICd0ZXh0L3BsYWluJwogICAgfSwKICAgIHRpbWVvdXQ6IDAsCiAgICBwcm9jZXNzRGF0YTogdHJ1ZSwKICAgIGNhY2hlOiB0cnVlCiAgfTsKCiAgdmFyIGFqYXhCZWZvcmVTZW5kID0gZnVuY3Rpb24gYWpheEJlZm9yZVNlbmQoeGhyLCBzZXR0aW5ncykgewogICAgdmFyIGNvbnRleHQgPSBzZXR0aW5ncy5jb250ZXh0OwoKICAgIGlmIChzZXR0aW5ncy5iZWZvcmVTZW5kLmNhbGwoY29udGV4dCwgeGhyLCBzZXR0aW5ncykgPT09IGZhbHNlKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9OwoKICB2YXIgYWpheFN1Y2Nlc3MgPSBmdW5jdGlvbiBhamF4U3VjY2VzcyhkYXRhLCB4aHIsIHNldHRpbmdzKSB7CiAgICBzZXR0aW5ncy5zdWNjZXNzLmNhbGwoc2V0dGluZ3MuY29udGV4dCwgZGF0YSwgJ3N1Y2Nlc3MnLCB4aHIpOwogICAgYWpheENvbXBsZXRlKCdzdWNjZXNzJywgeGhyLCBzZXR0aW5ncyk7CiAgfTsgLy8gdHlwZTogInRpbWVvdXQiLCAiZXJyb3IiLCAiYWJvcnQiLCAicGFyc2VyZXJyb3IiCgoKICB2YXIgYWpheEVycm9yID0gZnVuY3Rpb24gYWpheEVycm9yKGVycm9yLCB0eXBlLCB4aHIsIHNldHRpbmdzKSB7CiAgICBzZXR0aW5ncy5lcnJvci5jYWxsKHNldHRpbmdzLmNvbnRleHQsIHhociwgdHlwZSwgZXJyb3IpOwogICAgYWpheENvbXBsZXRlKHR5cGUsIHhociwgc2V0dGluZ3MpOwogIH07IC8vIHN0YXR1czogInN1Y2Nlc3MiLCAibm90bW9kaWZpZWQiLCAiZXJyb3IiLCAidGltZW91dCIsICJhYm9ydCIsICJwYXJzZXJlcnJvciIKCgogIHZhciBhamF4Q29tcGxldGUgPSBmdW5jdGlvbiBhamF4Q29tcGxldGUoc3RhdHVzLCB4aHIsIHNldHRpbmdzKSB7CiAgICBzZXR0aW5ncy5jb21wbGV0ZS5jYWxsKHNldHRpbmdzLmNvbnRleHQsIHhociwgc3RhdHVzKTsKICB9OwoKICB2YXIgc2VyaWFsaXplID0gZnVuY3Rpb24gc2VyaWFsaXplKHBhcmFtcywgb2JqLCB0cmFkaXRpb25hbCwgc2NvcGUpIHsKICAgIHZhciB0eXBlLAogICAgICAgIGFycmF5ID0gJC5pc0FycmF5KG9iaiksCiAgICAgICAgaGFzaCA9ICQuaXNQbGFpbk9iamVjdChvYmopOwogICAgJC5lYWNoKG9iaiwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgdHlwZSA9ICQudHlwZSh2YWx1ZSk7CgogICAgICBpZiAoc2NvcGUpIHsKICAgICAgICBrZXkgPSB0cmFkaXRpb25hbCA/IHNjb3BlIDogc2NvcGUgKyAnWycgKyAoaGFzaCB8fCB0eXBlID09PSAnb2JqZWN0JyB8fCB0eXBlID09PSAnYXJyYXknID8ga2V5IDogJycpICsgJ10nOwogICAgICB9IC8vIGhhbmRsZSBkYXRhIGluIHNlcmlhbGl6ZUFycmF5KCkgZm9ybWF0CgoKICAgICAgaWYgKCFzY29wZSAmJiBhcnJheSkgewogICAgICAgIHBhcmFtcy5hZGQodmFsdWUubmFtZSwgdmFsdWUudmFsdWUpOwogICAgICB9IC8vIHJlY3Vyc2UgaW50byBuZXN0ZWQgb2JqZWN0cwogICAgICBlbHNlIGlmICh0eXBlID09PSAiYXJyYXkiIHx8ICF0cmFkaXRpb25hbCAmJiB0eXBlID09PSAib2JqZWN0IikgewogICAgICAgICAgc2VyaWFsaXplKHBhcmFtcywgdmFsdWUsIHRyYWRpdGlvbmFsLCBrZXkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwYXJhbXMuYWRkKGtleSwgdmFsdWUpOwogICAgICAgIH0KICAgIH0pOwogIH07CgogIHZhciBzZXJpYWxpemVEYXRhID0gZnVuY3Rpb24gc2VyaWFsaXplRGF0YShvcHRpb25zKSB7CiAgICBpZiAob3B0aW9ucy5wcm9jZXNzRGF0YSAmJiBvcHRpb25zLmRhdGEgJiYgdHlwZW9mIG9wdGlvbnMuZGF0YSAhPT0gInN0cmluZyIpIHsKICAgICAgdmFyIGNvbnRlbnRUeXBlID0gb3B0aW9ucy5jb250ZW50VHlwZTsKCiAgICAgIGlmICghY29udGVudFR5cGUgJiYgb3B0aW9ucy5oZWFkZXJzKSB7CiAgICAgICAgY29udGVudFR5cGUgPSBvcHRpb25zLmhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddOwogICAgICB9CgogICAgICBpZiAoY29udGVudFR5cGUgJiYgfmNvbnRlbnRUeXBlLmluZGV4T2YoanNvblR5cGUpKSB7CiAgICAgICAgLy9hcHBsaWNhdGlvbi9qc29uCiAgICAgICAgb3B0aW9ucy5kYXRhID0gSlNPTi5zdHJpbmdpZnkob3B0aW9ucy5kYXRhKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvcHRpb25zLmRhdGEgPSAkLnBhcmFtKG9wdGlvbnMuZGF0YSwgb3B0aW9ucy50cmFkaXRpb25hbCk7CiAgICAgIH0KICAgIH0KCiAgICBpZiAob3B0aW9ucy5kYXRhICYmICghb3B0aW9ucy50eXBlIHx8IG9wdGlvbnMudHlwZS50b1VwcGVyQ2FzZSgpID09PSAnR0VUJykpIHsKICAgICAgb3B0aW9ucy51cmwgPSBhcHBlbmRRdWVyeShvcHRpb25zLnVybCwgb3B0aW9ucy5kYXRhKTsKICAgICAgb3B0aW9ucy5kYXRhID0gdW5kZWZpbmVkOwogICAgfQogIH07CgogIHZhciBhcHBlbmRRdWVyeSA9IGZ1bmN0aW9uIGFwcGVuZFF1ZXJ5KHVybCwgcXVlcnkpIHsKICAgIGlmIChxdWVyeSA9PT0gJycpIHsKICAgICAgcmV0dXJuIHVybDsKICAgIH0KCiAgICByZXR1cm4gKHVybCArICcmJyArIHF1ZXJ5KS5yZXBsYWNlKC9bJj9dezEsMn0vLCAnPycpOwogIH07CgogIHZhciBtaW1lVG9EYXRhVHlwZSA9IGZ1bmN0aW9uIG1pbWVUb0RhdGFUeXBlKG1pbWUpIHsKICAgIGlmIChtaW1lKSB7CiAgICAgIG1pbWUgPSBtaW1lLnNwbGl0KCc7JywgMilbMF07CiAgICB9CgogICAgcmV0dXJuIG1pbWUgJiYgKG1pbWUgPT09IGh0bWxUeXBlID8gJ2h0bWwnIDogbWltZSA9PT0ganNvblR5cGUgPyAnanNvbicgOiBzY3JpcHRUeXBlUkUudGVzdChtaW1lKSA/ICdzY3JpcHQnIDogeG1sVHlwZVJFLnRlc3QobWltZSkgJiYgJ3htbCcpIHx8ICd0ZXh0JzsKICB9OwoKICB2YXIgcGFyc2VBcmd1bWVudHMgPSBmdW5jdGlvbiBwYXJzZUFyZ3VtZW50cyh1cmwsIGRhdGEsIHN1Y2Nlc3MsIGRhdGFUeXBlKSB7CiAgICBpZiAoJC5pc0Z1bmN0aW9uKGRhdGEpKSB7CiAgICAgIGRhdGFUeXBlID0gc3VjY2Vzcywgc3VjY2VzcyA9IGRhdGEsIGRhdGEgPSB1bmRlZmluZWQ7CiAgICB9CgogICAgaWYgKCEkLmlzRnVuY3Rpb24oc3VjY2VzcykpIHsKICAgICAgZGF0YVR5cGUgPSBzdWNjZXNzLCBzdWNjZXNzID0gdW5kZWZpbmVkOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIHVybDogdXJsLAogICAgICBkYXRhOiBkYXRhLAogICAgICBzdWNjZXNzOiBzdWNjZXNzLAogICAgICBkYXRhVHlwZTogZGF0YVR5cGUKICAgIH07CiAgfTsKCiAgJC5hamF4ID0gZnVuY3Rpb24gKHVybCwgb3B0aW9ucykgewogICAgaWYgKF90eXBlb2YodXJsKSA9PT0gIm9iamVjdCIpIHsKICAgICAgb3B0aW9ucyA9IHVybDsKICAgICAgdXJsID0gdW5kZWZpbmVkOwogICAgfQoKICAgIHZhciBzZXR0aW5ncyA9IG9wdGlvbnMgfHwge307CiAgICBzZXR0aW5ncy51cmwgPSB1cmwgfHwgc2V0dGluZ3MudXJsOwoKICAgIGZvciAodmFyIGtleSBpbiAkLmFqYXhTZXR0aW5ncykgewogICAgICBpZiAoc2V0dGluZ3Nba2V5XSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgc2V0dGluZ3Nba2V5XSA9ICQuYWpheFNldHRpbmdzW2tleV07CiAgICAgIH0KICAgIH0KCiAgICBzZXJpYWxpemVEYXRhKHNldHRpbmdzKTsKICAgIHZhciBkYXRhVHlwZSA9IHNldHRpbmdzLmRhdGFUeXBlOwoKICAgIGlmIChzZXR0aW5ncy5jYWNoZSA9PT0gZmFsc2UgfHwgKCFvcHRpb25zIHx8IG9wdGlvbnMuY2FjaGUgIT09IHRydWUpICYmICdzY3JpcHQnID09PSBkYXRhVHlwZSkgewogICAgICBzZXR0aW5ncy51cmwgPSBhcHBlbmRRdWVyeShzZXR0aW5ncy51cmwsICdfPScgKyAkLm5vdygpKTsKICAgIH0KCiAgICB2YXIgbWltZSA9IHNldHRpbmdzLmFjY2VwdHNbZGF0YVR5cGUgJiYgZGF0YVR5cGUudG9Mb3dlckNhc2UoKV07CiAgICB2YXIgaGVhZGVycyA9IHt9OwoKICAgIHZhciBzZXRIZWFkZXIgPSBmdW5jdGlvbiBzZXRIZWFkZXIobmFtZSwgdmFsdWUpIHsKICAgICAgaGVhZGVyc1tuYW1lLnRvTG93ZXJDYXNlKCldID0gW25hbWUsIHZhbHVlXTsKICAgIH07CgogICAgdmFyIHByb3RvY29sID0gL14oW1x3LV0rOilcL1wvLy50ZXN0KHNldHRpbmdzLnVybCkgPyBSZWdFeHAuJDEgOiB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2w7CiAgICB2YXIgeGhyID0gc2V0dGluZ3MueGhyKHNldHRpbmdzKTsKCiAgICBpZiAobG9jYXRpb24ucHJvdG9jb2wgPT09ICdmaWxlOicgJiYgJC5vcy5pb3MgJiYgd2luZG93LndlYmtpdCAmJiB3aW5kb3cud2Via2l0Lm1lc3NhZ2VIYW5kbGVycyAmJiAhKHhociBpbnN0YW5jZW9mIHBsdXMubmV0LlhNTEh0dHBSZXF1ZXN0KSkgewogICAgICBjb25zb2xlLmVycm9yKCLlvZPliY3ov5DooYznjq/looPkuLpXS1dlYnZpZXfvvIzpnIDlnKhwbHVzUmVhZHnkuovku7bop6blj5HlkI7lho3osIPnlKhtdWkuYWpheO+8jOWQpuWImeWPr+iDveS8muaJp+ihjOWksei0peaIluaKpVNjcmlwdCBlcnJvcueahOmUmeivryIpOwogICAgfQoKICAgIHZhciBuYXRpdmVTZXRIZWFkZXIgPSB4aHIuc2V0UmVxdWVzdEhlYWRlcjsKICAgIHZhciBhYm9ydFRpbWVvdXQ7CiAgICBzZXRIZWFkZXIoJ1gtUmVxdWVzdGVkLVdpdGgnLCAnWE1MSHR0cFJlcXVlc3QnKTsKICAgIHNldEhlYWRlcignQWNjZXB0JywgbWltZSB8fCAnKi8qJyk7CgogICAgaWYgKCEhKG1pbWUgPSBzZXR0aW5ncy5taW1lVHlwZSB8fCBtaW1lKSkgewogICAgICBpZiAobWltZS5pbmRleE9mKCcsJykgPiAtMSkgewogICAgICAgIG1pbWUgPSBtaW1lLnNwbGl0KCcsJywgMilbMF07CiAgICAgIH0KCiAgICAgIHhoci5vdmVycmlkZU1pbWVUeXBlICYmIHhoci5vdmVycmlkZU1pbWVUeXBlKG1pbWUpOwogICAgfQoKICAgIGlmIChzZXR0aW5ncy5jb250ZW50VHlwZSB8fCBzZXR0aW5ncy5jb250ZW50VHlwZSAhPT0gZmFsc2UgJiYgc2V0dGluZ3MuZGF0YSAmJiBzZXR0aW5ncy50eXBlLnRvVXBwZXJDYXNlKCkgIT09ICdHRVQnKSB7CiAgICAgIHNldEhlYWRlcignQ29udGVudC1UeXBlJywgc2V0dGluZ3MuY29udGVudFR5cGUgfHwgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcpOwogICAgfQoKICAgIGlmIChzZXR0aW5ncy5oZWFkZXJzKSB7CiAgICAgIGZvciAodmFyIG5hbWUgaW4gc2V0dGluZ3MuaGVhZGVycykgewogICAgICAgIHNldEhlYWRlcihuYW1lLCBzZXR0aW5ncy5oZWFkZXJzW25hbWVdKTsKICAgICAgfQogICAgfQoKICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyID0gc2V0SGVhZGVyOwoKICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCkgewogICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSAkLm5vb3A7CiAgICAgICAgY2xlYXJUaW1lb3V0KGFib3J0VGltZW91dCk7CiAgICAgICAgdmFyIHJlc3VsdCwKICAgICAgICAgICAgZXJyb3IgPSBmYWxzZTsKICAgICAgICB2YXIgaXNMb2NhbCA9IHByb3RvY29sID09PSAnZmlsZTonOwoKICAgICAgICBpZiAoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCB8fCB4aHIuc3RhdHVzID09PSAzMDQgfHwgeGhyLnN0YXR1cyA9PT0gMCAmJiBpc0xvY2FsICYmIHhoci5yZXNwb25zZVRleHQpIHsKICAgICAgICAgIGRhdGFUeXBlID0gZGF0YVR5cGUgfHwgbWltZVRvRGF0YVR5cGUoc2V0dGluZ3MubWltZVR5cGUgfHwgeGhyLmdldFJlc3BvbnNlSGVhZGVyKCdjb250ZW50LXR5cGUnKSk7CiAgICAgICAgICByZXN1bHQgPSB4aHIucmVzcG9uc2VUZXh0OwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIGh0dHA6Ly9wZXJmZWN0aW9ua2lsbHMuY29tL2dsb2JhbC1ldmFsLXdoYXQtYXJlLXRoZS1vcHRpb25zLwogICAgICAgICAgICBpZiAoZGF0YVR5cGUgPT09ICdzY3JpcHQnKSB7CiAgICAgICAgICAgICAgKDEsIGV2YWwpKHJlc3VsdCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YVR5cGUgPT09ICd4bWwnKSB7CiAgICAgICAgICAgICAgcmVzdWx0ID0geGhyLnJlc3BvbnNlWE1MOwogICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGFUeXBlID09PSAnanNvbicpIHsKICAgICAgICAgICAgICByZXN1bHQgPSBibGFua1JFLnRlc3QocmVzdWx0KSA/IG51bGwgOiAkLnBhcnNlSlNPTihyZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGVycm9yID0gZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZXJyb3IpIHsKICAgICAgICAgICAgYWpheEVycm9yKGVycm9yLCAncGFyc2VyZXJyb3InLCB4aHIsIHNldHRpbmdzKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFqYXhTdWNjZXNzKHJlc3VsdCwgeGhyLCBzZXR0aW5ncyk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBzdGF0dXMgPSB4aHIuc3RhdHVzID8gJ2Vycm9yJyA6ICdhYm9ydCc7CiAgICAgICAgICB2YXIgc3RhdHVzVGV4dCA9IHhoci5zdGF0dXNUZXh0IHx8IG51bGw7CgogICAgICAgICAgaWYgKGlzTG9jYWwpIHsKICAgICAgICAgICAgc3RhdHVzID0gJ2Vycm9yJzsKICAgICAgICAgICAgc3RhdHVzVGV4dCA9ICc0MDQnOwogICAgICAgICAgfQoKICAgICAgICAgIGFqYXhFcnJvcihzdGF0dXNUZXh0LCBzdGF0dXMsIHhociwgc2V0dGluZ3MpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICBpZiAoYWpheEJlZm9yZVNlbmQoeGhyLCBzZXR0aW5ncykgPT09IGZhbHNlKSB7CiAgICAgIHhoci5hYm9ydCgpOwogICAgICBhamF4RXJyb3IobnVsbCwgJ2Fib3J0JywgeGhyLCBzZXR0aW5ncyk7CiAgICAgIHJldHVybiB4aHI7CiAgICB9CgogICAgaWYgKHNldHRpbmdzLnhockZpZWxkcykgewogICAgICBmb3IgKHZhciBuYW1lIGluIHNldHRpbmdzLnhockZpZWxkcykgewogICAgICAgIHhocltuYW1lXSA9IHNldHRpbmdzLnhockZpZWxkc1tuYW1lXTsKICAgICAgfQogICAgfQoKICAgIHZhciBhc3luYyA9ICdhc3luYycgaW4gc2V0dGluZ3MgPyBzZXR0aW5ncy5hc3luYyA6IHRydWU7CiAgICB4aHIub3BlbihzZXR0aW5ncy50eXBlLnRvVXBwZXJDYXNlKCksIHNldHRpbmdzLnVybCwgYXN5bmMsIHNldHRpbmdzLnVzZXJuYW1lLCBzZXR0aW5ncy5wYXNzd29yZCk7CgogICAgZm9yICh2YXIgbmFtZSBpbiBoZWFkZXJzKSB7CiAgICAgIGlmIChoZWFkZXJzLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgICAgbmF0aXZlU2V0SGVhZGVyLmFwcGx5KHhociwgaGVhZGVyc1tuYW1lXSk7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoc2V0dGluZ3MudGltZW91dCA+IDApIHsKICAgICAgYWJvcnRUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9ICQubm9vcDsKICAgICAgICB4aHIuYWJvcnQoKTsKICAgICAgICBhamF4RXJyb3IobnVsbCwgJ3RpbWVvdXQnLCB4aHIsIHNldHRpbmdzKTsKICAgICAgfSwgc2V0dGluZ3MudGltZW91dCk7CiAgICB9CgogICAgeGhyLnNlbmQoc2V0dGluZ3MuZGF0YSA/IHNldHRpbmdzLmRhdGEgOiBudWxsKTsKICAgIHJldHVybiB4aHI7CiAgfTsKCiAgJC5wYXJhbSA9IGZ1bmN0aW9uIChvYmosIHRyYWRpdGlvbmFsKSB7CiAgICB2YXIgcGFyYW1zID0gW107CgogICAgcGFyYW1zLmFkZCA9IGZ1bmN0aW9uIChrLCB2KSB7CiAgICAgIHRoaXMucHVzaChlbmNvZGVVUklDb21wb25lbnQoaykgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQodikpOwogICAgfTsKCiAgICBzZXJpYWxpemUocGFyYW1zLCBvYmosIHRyYWRpdGlvbmFsKTsKICAgIHJldHVybiBwYXJhbXMuam9pbignJicpLnJlcGxhY2UoLyUyMC9nLCAnKycpOwogIH07CgogICQuZ2V0ID0gZnVuY3Rpb24gKCkKICAvKiB1cmwsIGRhdGEsIHN1Y2Nlc3MsIGRhdGFUeXBlICovCiAgewogICAgcmV0dXJuICQuYWpheChwYXJzZUFyZ3VtZW50cy5hcHBseShudWxsLCBhcmd1bWVudHMpKTsKICB9OwoKICAkLnBvc3QgPSBmdW5jdGlvbiAoKQogIC8qIHVybCwgZGF0YSwgc3VjY2VzcywgZGF0YVR5cGUgKi8KICB7CiAgICB2YXIgb3B0aW9ucyA9IHBhcnNlQXJndW1lbnRzLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7CiAgICBvcHRpb25zLnR5cGUgPSAnUE9TVCc7CiAgICByZXR1cm4gJC5hamF4KG9wdGlvbnMpOwogIH07CgogICQuZ2V0SlNPTiA9IGZ1bmN0aW9uICgpCiAgLyogdXJsLCBkYXRhLCBzdWNjZXNzICovCiAgewogICAgdmFyIG9wdGlvbnMgPSBwYXJzZUFyZ3VtZW50cy5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgb3B0aW9ucy5kYXRhVHlwZSA9ICdqc29uJzsKICAgIHJldHVybiAkLmFqYXgob3B0aW9ucyk7CiAgfTsKCiAgJC5mbi5sb2FkID0gZnVuY3Rpb24gKHVybCwgZGF0YSwgc3VjY2VzcykgewogICAgaWYgKCF0aGlzLmxlbmd0aCkgcmV0dXJuIHRoaXM7CiAgICB2YXIgc2VsZiA9IHRoaXMsCiAgICAgICAgcGFydHMgPSB1cmwuc3BsaXQoL1xzLyksCiAgICAgICAgc2VsZWN0b3IsCiAgICAgICAgb3B0aW9ucyA9IHBhcnNlQXJndW1lbnRzKHVybCwgZGF0YSwgc3VjY2VzcyksCiAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zLnN1Y2Nlc3M7CiAgICBpZiAocGFydHMubGVuZ3RoID4gMSkgb3B0aW9ucy51cmwgPSBwYXJ0c1swXSwgc2VsZWN0b3IgPSBwYXJ0c1sxXTsKCiAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgaWYgKHNlbGVjdG9yKSB7CiAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGRpdi5pbm5lckhUTUwgPSByZXNwb25zZS5yZXBsYWNlKHJzY3JpcHQsICIiKTsKICAgICAgICB2YXIgc2VsZWN0b3JEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB2YXIgY2hpbGRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOwoKICAgICAgICBpZiAoY2hpbGRzICYmIGNoaWxkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gY2hpbGRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHNlbGVjdG9yRGl2LmFwcGVuZENoaWxkKGNoaWxkc1tpXSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBzZWxmWzBdLmlubmVySFRNTCA9IHNlbGVjdG9yRGl2LmlubmVySFRNTDsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZWxmWzBdLmlubmVySFRNTCA9IHJlc3BvbnNlOwogICAgICB9CgogICAgICBjYWxsYmFjayAmJiBjYWxsYmFjay5hcHBseShzZWxmLCBhcmd1bWVudHMpOwogICAgfTsKCiAgICAkLmFqYXgob3B0aW9ucyk7CiAgICByZXR1cm4gdGhpczsKICB9Owp9KShtdWksIHdpbmRvdyk7Ci8qKgogKiA1KyBhamF4CiAqLwoKCihmdW5jdGlvbiAoJCkgewogIHZhciBvcmlnaW5BbmNob3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgb3JpZ2luQW5jaG9yLmhyZWYgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsKICAkLnBsdXNSZWFkeShmdW5jdGlvbiAoKSB7CiAgICAkLmFqYXhTZXR0aW5ncyA9ICQuZXh0ZW5kKCQuYWpheFNldHRpbmdzLCB7CiAgICAgIHhocjogZnVuY3Rpb24geGhyKHNldHRpbmdzKSB7CiAgICAgICAgaWYgKHNldHRpbmdzLmNyb3NzRG9tYWluKSB7CiAgICAgICAgICAvL+W8uuWItuS9v+eUqHBsdXPot6jln58KICAgICAgICAgIHJldHVybiBuZXcgcGx1cy5uZXQuWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICB9IC8v5LuF5Zyod2Vidmlld+eahHVybOS4uui/nOeoi+aWh+S7tu+8jOS4lGFqYXjor7fmsYLnmoTotYTmupDkuI3lkIzmupDkuIvkvb/nlKhwbHVzLm5ldC5YTUxIdHRwUmVxdWVzdAoKCiAgICAgICAgaWYgKG9yaWdpbkFuY2hvci5wcm90b2NvbCAhPT0gJ2ZpbGU6JykgewogICAgICAgICAgdmFyIHVybEFuY2hvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgICAgIHVybEFuY2hvci5ocmVmID0gc2V0dGluZ3MudXJsOwogICAgICAgICAgdXJsQW5jaG9yLmhyZWYgPSB1cmxBbmNob3IuaHJlZjsKICAgICAgICAgIHNldHRpbmdzLmNyb3NzRG9tYWluID0gb3JpZ2luQW5jaG9yLnByb3RvY29sICsgJy8vJyArIG9yaWdpbkFuY2hvci5ob3N0ICE9PSB1cmxBbmNob3IucHJvdG9jb2wgKyAnLy8nICsgdXJsQW5jaG9yLmhvc3Q7CgogICAgICAgICAgaWYgKHNldHRpbmdzLmNyb3NzRG9tYWluKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgcGx1cy5uZXQuWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgkLm9zLmlvcyAmJiB3aW5kb3cud2Via2l0ICYmIHdpbmRvdy53ZWJraXQubWVzc2FnZUhhbmRsZXJzKSB7CiAgICAgICAgICAvL3drd2Vidmlld+S4i+WQjOagt+S9v+eUqDUrIHhocgogICAgICAgICAgcmV0dXJuIG5ldyBwbHVzLm5ldC5YTUxIdHRwUmVxdWVzdCgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5ldyB3aW5kb3cuWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgfQogICAgfSk7CiAgfSk7Cn0pKG11aSk7Ci8qKgogKiBtdWkgbGF5b3V0KG9mZnNldFsscG9zaXRpb24sd2lkdGgsaGVpZ2h0Li4uXSkKICogQHBhcmFtIHt0eXBlfSAkCiAqIEBwYXJhbSB7dHlwZX0gd2luZG93CiAqIEBwYXJhbSB7dHlwZX0gdW5kZWZpbmVkCiAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAqLwoKCihmdW5jdGlvbiAoJCwgd2luZG93LCB1bmRlZmluZWQpIHsKICAkLm9mZnNldCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICB2YXIgYm94ID0gewogICAgICB0b3A6IDAsCiAgICAgIGxlZnQ6IDAKICAgIH07CgogICAgaWYgKF90eXBlb2YoZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QpICE9PSB1bmRlZmluZWQpIHsKICAgICAgYm94ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICB0b3A6IGJveC50b3AgKyB3aW5kb3cucGFnZVlPZmZzZXQgLSBlbGVtZW50LmNsaWVudFRvcCwKICAgICAgbGVmdDogYm94LmxlZnQgKyB3aW5kb3cucGFnZVhPZmZzZXQgLSBlbGVtZW50LmNsaWVudExlZnQKICAgIH07CiAgfTsKfSkobXVpLCB3aW5kb3cpOwovKioKICogbXVpIGFuaW1hdGlvbgogKi8KCgooZnVuY3Rpb24gKCQsIHdpbmRvdykgewogIC8qKgogICAqIHNjcm9sbFRvCiAgICovCiAgJC5zY3JvbGxUbyA9IGZ1bmN0aW9uIChzY3JvbGxUb3AsIGR1cmF0aW9uLCBjYWxsYmFjaykgewogICAgZHVyYXRpb24gPSBkdXJhdGlvbiB8fCAxMDAwOwoKICAgIHZhciBzY3JvbGwgPSBmdW5jdGlvbiBzY3JvbGwoZHVyYXRpb24pIHsKICAgICAgaWYgKGR1cmF0aW9uIDw9IDApIHsKICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgc2Nyb2xsVG9wKTsKICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGRpc3RhaW5jZSA9IHNjcm9sbFRvcCAtIHdpbmRvdy5zY3JvbGxZOwogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgd2luZG93LnNjcm9sbFkgKyBkaXN0YWluY2UgLyBkdXJhdGlvbiAqIDEwKTsKICAgICAgICBzY3JvbGwoZHVyYXRpb24gLSAxMCk7CiAgICAgIH0sIDE2LjcpOwogICAgfTsKCiAgICBzY3JvbGwoZHVyYXRpb24pOwogIH07CgogICQuYW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbiAoY2IpIHsKICAgIHZhciBhcmdzLCBpc1F1ZXVlZCwgY29udGV4dDsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgIGNvbnRleHQgPSB0aGlzOwoKICAgICAgaWYgKCFpc1F1ZXVlZCkgewogICAgICAgIGlzUXVldWVkID0gdHJ1ZTsKICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgICAgY2IuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgICAgICBpc1F1ZXVlZCA9IGZhbHNlOwogICAgICAgIH0pOwogICAgICB9CiAgICB9OwogIH07Cn0pKG11aSwgd2luZG93KTsKCihmdW5jdGlvbiAoJCkgewogIHZhciBpbml0aWFsaXppbmcgPSBmYWxzZSwKICAgICAgZm5UZXN0ID0gL3h5ei8udGVzdChmdW5jdGlvbiAoKSB7CiAgICB4eXo7CiAgfSkgPyAvXGJfc3VwZXJcYi8gOiAvLiovOwoKICB2YXIgQ2xhc3MgPSBmdW5jdGlvbiBDbGFzcygpIHt9OwoKICBDbGFzcy5leHRlbmQgPSBmdW5jdGlvbiAocHJvcCkgewogICAgdmFyIF9zdXBlciA9IHRoaXMucHJvdG90eXBlOwogICAgaW5pdGlhbGl6aW5nID0gdHJ1ZTsKICAgIHZhciBwcm90b3R5cGUgPSBuZXcgdGhpcygpOwogICAgaW5pdGlhbGl6aW5nID0gZmFsc2U7CgogICAgZm9yICh2YXIgbmFtZSBpbiBwcm9wKSB7CiAgICAgIHByb3RvdHlwZVtuYW1lXSA9IHR5cGVvZiBwcm9wW25hbWVdID09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIF9zdXBlcltuYW1lXSA9PSAiZnVuY3Rpb24iICYmIGZuVGVzdC50ZXN0KHByb3BbbmFtZV0pID8gZnVuY3Rpb24gKG5hbWUsIGZuKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB0bXAgPSB0aGlzLl9zdXBlcjsKICAgICAgICAgIHRoaXMuX3N1cGVyID0gX3N1cGVyW25hbWVdOwogICAgICAgICAgdmFyIHJldCA9IGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB0aGlzLl9zdXBlciA9IHRtcDsKICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfTsKICAgICAgfShuYW1lLCBwcm9wW25hbWVdKSA6IHByb3BbbmFtZV07CiAgICB9CgogICAgZnVuY3Rpb24gQ2xhc3MoKSB7CiAgICAgIGlmICghaW5pdGlhbGl6aW5nICYmIHRoaXMuaW5pdCkgdGhpcy5pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9CgogICAgQ2xhc3MucHJvdG90eXBlID0gcHJvdG90eXBlOwogICAgQ2xhc3MucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ2xhc3M7CiAgICBDbGFzcy5leHRlbmQgPSBhcmd1bWVudHMuY2FsbGVlOwogICAgcmV0dXJuIENsYXNzOwogIH07CgogICQuQ2xhc3MgPSBDbGFzczsKfSkobXVpKTsKCihmdW5jdGlvbiAoJCwgZG9jdW1lbnQsIHVuZGVmaW5lZCkgewogIHZhciBDTEFTU19QVUxMX1RPUF9QT0NLRVQgPSAnbXVpLXB1bGwtdG9wLXBvY2tldCc7CiAgdmFyIENMQVNTX1BVTExfQk9UVE9NX1BPQ0tFVCA9ICdtdWktcHVsbC1ib3R0b20tcG9ja2V0JzsKICB2YXIgQ0xBU1NfUFVMTCA9ICdtdWktcHVsbCc7CiAgdmFyIENMQVNTX1BVTExfTE9BRElORyA9ICdtdWktcHVsbC1sb2FkaW5nJzsKICB2YXIgQ0xBU1NfUFVMTF9DQVBUSU9OID0gJ211aS1wdWxsLWNhcHRpb24nOwogIHZhciBDTEFTU19QVUxMX0NBUFRJT05fRE9XTiA9ICdtdWktcHVsbC1jYXB0aW9uLWRvd24nOwogIHZhciBDTEFTU19QVUxMX0NBUFRJT05fUkVGUkVTSCA9ICdtdWktcHVsbC1jYXB0aW9uLXJlZnJlc2gnOwogIHZhciBDTEFTU19QVUxMX0NBUFRJT05fTk9NT1JFID0gJ211aS1wdWxsLWNhcHRpb24tbm9tb3JlJzsKICB2YXIgQ0xBU1NfSUNPTiA9ICdtdWktaWNvbic7CiAgdmFyIENMQVNTX1NQSU5ORVIgPSAnbXVpLXNwaW5uZXInOwogIHZhciBDTEFTU19JQ09OX1BVTExET1dOID0gJ211aS1pY29uLXB1bGxkb3duJzsKICB2YXIgQ0xBU1NfQkxPQ0sgPSAnbXVpLWJsb2NrJzsKICB2YXIgQ0xBU1NfSElEREVOID0gJ211aS1oaWRkZW4nOwogIHZhciBDTEFTU19WSVNJQklMSVRZID0gJ211aS12aXNpYmlsaXR5JzsKICB2YXIgQ0xBU1NfTE9BRElOR19VUCA9IENMQVNTX1BVTExfTE9BRElORyArICcgJyArIENMQVNTX0lDT04gKyAnICcgKyBDTEFTU19JQ09OX1BVTExET1dOOwogIHZhciBDTEFTU19MT0FESU5HX0RPV04gPSBDTEFTU19QVUxMX0xPQURJTkcgKyAnICcgKyBDTEFTU19JQ09OICsgJyAnICsgQ0xBU1NfSUNPTl9QVUxMRE9XTjsKICB2YXIgQ0xBU1NfTE9BRElORyA9IENMQVNTX1BVTExfTE9BRElORyArICcgJyArIENMQVNTX0lDT04gKyAnICcgKyBDTEFTU19TUElOTkVSOwogIHZhciBwb2NrZXRIdG1sID0gWyc8ZGl2IGNsYXNzPSInICsgQ0xBU1NfUFVMTCArICciPicsICc8ZGl2IGNsYXNzPSJ7aWNvbn0iPjwvZGl2PicsICc8ZGl2IGNsYXNzPSInICsgQ0xBU1NfUFVMTF9DQVBUSU9OICsgJyI+e2NvbnRlbnRyZWZyZXNofTwvZGl2PicsICc8L2Rpdj4nXS5qb2luKCcnKTsKICB2YXIgUHVsbFJlZnJlc2ggPSB7CiAgICBpbml0OiBmdW5jdGlvbiBpbml0KGVsZW1lbnQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5fc3VwZXIoZWxlbWVudCwgJC5leHRlbmQodHJ1ZSwgewogICAgICAgIHNjcm9sbFk6IHRydWUsCiAgICAgICAgc2Nyb2xsWDogZmFsc2UsCiAgICAgICAgaW5kaWNhdG9yczogdHJ1ZSwKICAgICAgICBkZWNlbGVyYXRpb246IDAuMDAzLAogICAgICAgIGRvd246IHsKICAgICAgICAgIGhlaWdodDogNTAsCiAgICAgICAgICBjb250ZW50aW5pdDogJ+S4i+aLieWPr+S7peWIt+aWsCcsCiAgICAgICAgICBjb250ZW50ZG93bjogJ+S4i+aLieWPr+S7peWIt+aWsCcsCiAgICAgICAgICBjb250ZW50b3ZlcjogJ+mHiuaUvueri+WNs+WIt+aWsCcsCiAgICAgICAgICBjb250ZW50cmVmcmVzaDogJ+ato+WcqOWIt+aWsC4uLicKICAgICAgICB9LAogICAgICAgIHVwOiB7CiAgICAgICAgICBoZWlnaHQ6IDUwLAogICAgICAgICAgYXV0bzogZmFsc2UsCiAgICAgICAgICBjb250ZW50aW5pdDogJ+S4iuaLieaYvuekuuabtOWkmicsCiAgICAgICAgICBjb250ZW50ZG93bjogJ+S4iuaLieaYvuekuuabtOWkmicsCiAgICAgICAgICBjb250ZW50cmVmcmVzaDogJ+ato+WcqOWKoOi9vS4uLicsCiAgICAgICAgICBjb250ZW50bm9tb3JlOiAn5rKh5pyJ5pu05aSa5pWw5o2u5LqGJywKICAgICAgICAgIGR1cmF0aW9uOiAzMDAKICAgICAgICB9CiAgICAgIH0sIG9wdGlvbnMpKTsKICAgIH0sCiAgICBfaW5pdDogZnVuY3Rpb24gX2luaXQoKSB7CiAgICAgIHRoaXMuX3N1cGVyKCk7CgogICAgICB0aGlzLl9pbml0UG9ja2V0KCk7CiAgICB9LAogICAgX2luaXRQdWxsZG93blJlZnJlc2g6IGZ1bmN0aW9uIF9pbml0UHVsbGRvd25SZWZyZXNoKCkgewogICAgICB0aGlzLnB1bGxkb3duID0gdHJ1ZTsKCiAgICAgIGlmICh0aGlzLnRvcFBvY2tldCkgewogICAgICAgIHRoaXMucHVsbFBvY2tldCA9IHRoaXMudG9wUG9ja2V0OwogICAgICAgIHRoaXMucHVsbFBvY2tldC5jbGFzc0xpc3QuYWRkKENMQVNTX0JMT0NLKTsKICAgICAgICB0aGlzLnB1bGxQb2NrZXQuY2xhc3NMaXN0LmFkZChDTEFTU19WSVNJQklMSVRZKTsKICAgICAgICB0aGlzLnB1bGxDYXB0aW9uID0gdGhpcy50b3BDYXB0aW9uOwogICAgICAgIHRoaXMucHVsbExvYWRpbmcgPSB0aGlzLnRvcExvYWRpbmc7CiAgICAgIH0KICAgIH0sCiAgICBfaW5pdFB1bGx1cFJlZnJlc2g6IGZ1bmN0aW9uIF9pbml0UHVsbHVwUmVmcmVzaCgpIHsKICAgICAgdGhpcy5wdWxsZG93biA9IGZhbHNlOwoKICAgICAgaWYgKHRoaXMuYm90dG9tUG9ja2V0KSB7CiAgICAgICAgdGhpcy5wdWxsUG9ja2V0ID0gdGhpcy5ib3R0b21Qb2NrZXQ7CiAgICAgICAgdGhpcy5wdWxsUG9ja2V0LmNsYXNzTGlzdC5hZGQoQ0xBU1NfQkxPQ0spOwogICAgICAgIHRoaXMucHVsbFBvY2tldC5jbGFzc0xpc3QuYWRkKENMQVNTX1ZJU0lCSUxJVFkpOwogICAgICAgIHRoaXMucHVsbENhcHRpb24gPSB0aGlzLmJvdHRvbUNhcHRpb247CiAgICAgICAgdGhpcy5wdWxsTG9hZGluZyA9IHRoaXMuYm90dG9tTG9hZGluZzsKICAgICAgfQogICAgfSwKICAgIF9pbml0UG9ja2V0OiBmdW5jdGlvbiBfaW5pdFBvY2tldCgpIHsKICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgogICAgICBpZiAob3B0aW9ucy5kb3duICYmIG9wdGlvbnMuZG93bi5oYXNPd25Qcm9wZXJ0eSgnY2FsbGJhY2snKSkgewogICAgICAgIHRoaXMudG9wUG9ja2V0ID0gdGhpcy5zY3JvbGxlci5xdWVyeVNlbGVjdG9yKCcuJyArIENMQVNTX1BVTExfVE9QX1BPQ0tFVCk7CgogICAgICAgIGlmICghdGhpcy50b3BQb2NrZXQpIHsKICAgICAgICAgIHRoaXMudG9wUG9ja2V0ID0gdGhpcy5fY3JlYXRlUG9ja2V0KENMQVNTX1BVTExfVE9QX1BPQ0tFVCwgb3B0aW9ucy5kb3duLCBDTEFTU19MT0FESU5HX0RPV04pOwogICAgICAgICAgdGhpcy53cmFwcGVyLmluc2VydEJlZm9yZSh0aGlzLnRvcFBvY2tldCwgdGhpcy53cmFwcGVyLmZpcnN0Q2hpbGQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy50b3BMb2FkaW5nID0gdGhpcy50b3BQb2NrZXQucXVlcnlTZWxlY3RvcignLicgKyBDTEFTU19QVUxMX0xPQURJTkcpOwogICAgICAgIHRoaXMudG9wQ2FwdGlvbiA9IHRoaXMudG9wUG9ja2V0LnF1ZXJ5U2VsZWN0b3IoJy4nICsgQ0xBU1NfUFVMTF9DQVBUSU9OKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMudXAgJiYgb3B0aW9ucy51cC5oYXNPd25Qcm9wZXJ0eSgnY2FsbGJhY2snKSkgewogICAgICAgIHRoaXMuYm90dG9tUG9ja2V0ID0gdGhpcy5zY3JvbGxlci5xdWVyeVNlbGVjdG9yKCcuJyArIENMQVNTX1BVTExfQk9UVE9NX1BPQ0tFVCk7CgogICAgICAgIGlmICghdGhpcy5ib3R0b21Qb2NrZXQpIHsKICAgICAgICAgIHRoaXMuYm90dG9tUG9ja2V0ID0gdGhpcy5fY3JlYXRlUG9ja2V0KENMQVNTX1BVTExfQk9UVE9NX1BPQ0tFVCwgb3B0aW9ucy51cCwgQ0xBU1NfTE9BRElORyk7CiAgICAgICAgICB0aGlzLnNjcm9sbGVyLmFwcGVuZENoaWxkKHRoaXMuYm90dG9tUG9ja2V0KTsKICAgICAgICB9CgogICAgICAgIHRoaXMuYm90dG9tTG9hZGluZyA9IHRoaXMuYm90dG9tUG9ja2V0LnF1ZXJ5U2VsZWN0b3IoJy4nICsgQ0xBU1NfUFVMTF9MT0FESU5HKTsKICAgICAgICB0aGlzLmJvdHRvbUNhcHRpb24gPSB0aGlzLmJvdHRvbVBvY2tldC5xdWVyeVNlbGVjdG9yKCcuJyArIENMQVNTX1BVTExfQ0FQVElPTik7IC8vVE9ETyBvbmx5IGZvciBoNQoKICAgICAgICB0aGlzLndyYXBwZXIuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsYm90dG9tJywgdGhpcyk7CiAgICAgIH0KICAgIH0sCiAgICBfY3JlYXRlUG9ja2V0OiBmdW5jdGlvbiBfY3JlYXRlUG9ja2V0KGNsYXp6LCBvcHRpb25zLCBpY29uQ2xhc3MpIHsKICAgICAgdmFyIHBvY2tldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBwb2NrZXQuY2xhc3NOYW1lID0gY2xheno7CiAgICAgIHBvY2tldC5pbm5lckhUTUwgPSBwb2NrZXRIdG1sLnJlcGxhY2UoJ3tjb250ZW50cmVmcmVzaH0nLCBvcHRpb25zLmNvbnRlbnRpbml0KS5yZXBsYWNlKCd7aWNvbn0nLCBpY29uQ2xhc3MpOwogICAgICByZXR1cm4gcG9ja2V0OwogICAgfSwKICAgIF9yZXNldFB1bGxEb3duTG9hZGluZzogZnVuY3Rpb24gX3Jlc2V0UHVsbERvd25Mb2FkaW5nKCkgewogICAgICB2YXIgbG9hZGluZyA9IHRoaXMucHVsbExvYWRpbmc7CgogICAgICBpZiAobG9hZGluZykgewogICAgICAgIHRoaXMucHVsbENhcHRpb24uaW5uZXJIVE1MID0gdGhpcy5vcHRpb25zLmRvd24uY29udGVudGRvd247CiAgICAgICAgbG9hZGluZy5zdHlsZS53ZWJraXRUcmFuc2l0aW9uID0gIiI7CiAgICAgICAgbG9hZGluZy5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSAiIjsKICAgICAgICBsb2FkaW5nLnN0eWxlLndlYmtpdEFuaW1hdGlvbiA9ICIiOwogICAgICAgIGxvYWRpbmcuY2xhc3NOYW1lID0gQ0xBU1NfTE9BRElOR19ET1dOOwogICAgICB9CiAgICB9LAogICAgX3NldENhcHRpb25DbGFzczogZnVuY3Rpb24gX3NldENhcHRpb25DbGFzcyhpc1B1bGxkb3duLCBjYXB0aW9uLCB0aXRsZSkgewogICAgICBpZiAoIWlzUHVsbGRvd24pIHsKICAgICAgICBzd2l0Y2ggKHRpdGxlKSB7CiAgICAgICAgICBjYXNlIHRoaXMub3B0aW9ucy51cC5jb250ZW50ZG93bjoKICAgICAgICAgICAgY2FwdGlvbi5jbGFzc05hbWUgPSBDTEFTU19QVUxMX0NBUFRJT04gKyAnICcgKyBDTEFTU19QVUxMX0NBUFRJT05fRE9XTjsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSB0aGlzLm9wdGlvbnMudXAuY29udGVudHJlZnJlc2g6CiAgICAgICAgICAgIGNhcHRpb24uY2xhc3NOYW1lID0gQ0xBU1NfUFVMTF9DQVBUSU9OICsgJyAnICsgQ0xBU1NfUFVMTF9DQVBUSU9OX1JFRlJFU0g7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgdGhpcy5vcHRpb25zLnVwLmNvbnRlbnRub21vcmU6CiAgICAgICAgICAgIGNhcHRpb24uY2xhc3NOYW1lID0gQ0xBU1NfUFVMTF9DQVBUSU9OICsgJyAnICsgQ0xBU1NfUFVMTF9DQVBUSU9OX05PTU9SRTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgX3NldENhcHRpb246IGZ1bmN0aW9uIF9zZXRDYXB0aW9uKHRpdGxlLCByZXNldCkgewogICAgICBpZiAodGhpcy5sb2FkaW5nKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9uczsKICAgICAgdmFyIHBvY2tldCA9IHRoaXMucHVsbFBvY2tldDsKICAgICAgdmFyIGNhcHRpb24gPSB0aGlzLnB1bGxDYXB0aW9uOwogICAgICB2YXIgbG9hZGluZyA9IHRoaXMucHVsbExvYWRpbmc7CiAgICAgIHZhciBpc1B1bGxkb3duID0gdGhpcy5wdWxsZG93bjsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgaWYgKHBvY2tldCkgewogICAgICAgIGlmIChyZXNldCkgewogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNhcHRpb24uaW5uZXJIVE1MID0gc2VsZi5sYXN0VGl0bGUgPSB0aXRsZTsKCiAgICAgICAgICAgIGlmIChpc1B1bGxkb3duKSB7CiAgICAgICAgICAgICAgbG9hZGluZy5jbGFzc05hbWUgPSBDTEFTU19MT0FESU5HX0RPV047CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc2VsZi5fc2V0Q2FwdGlvbkNsYXNzKGZhbHNlLCBjYXB0aW9uLCB0aXRsZSk7CgogICAgICAgICAgICAgIGxvYWRpbmcuY2xhc3NOYW1lID0gQ0xBU1NfTE9BRElORzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9hZGluZy5zdHlsZS53ZWJraXRBbmltYXRpb24gPSAiIjsKICAgICAgICAgICAgbG9hZGluZy5zdHlsZS53ZWJraXRUcmFuc2l0aW9uID0gIiI7CiAgICAgICAgICAgIGxvYWRpbmcuc3R5bGUud2Via2l0VHJhbnNmb3JtID0gIiI7CiAgICAgICAgICB9LCAxMDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodGl0bGUgIT09IHRoaXMubGFzdFRpdGxlKSB7CiAgICAgICAgICAgIGNhcHRpb24uaW5uZXJIVE1MID0gdGl0bGU7CgogICAgICAgICAgICBpZiAoaXNQdWxsZG93bikgewogICAgICAgICAgICAgIGlmICh0aXRsZSA9PT0gb3B0aW9ucy5kb3duLmNvbnRlbnRyZWZyZXNoKSB7CiAgICAgICAgICAgICAgICBsb2FkaW5nLmNsYXNzTmFtZSA9IENMQVNTX0xPQURJTkc7CiAgICAgICAgICAgICAgICBsb2FkaW5nLnN0eWxlLndlYmtpdEFuaW1hdGlvbiA9ICJzcGlubmVyLXNwaW4gMXMgc3RlcC1lbmQgaW5maW5pdGUiOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodGl0bGUgPT09IG9wdGlvbnMuZG93bi5jb250ZW50b3ZlcikgewogICAgICAgICAgICAgICAgbG9hZGluZy5jbGFzc05hbWUgPSBDTEFTU19MT0FESU5HX1VQOwogICAgICAgICAgICAgICAgbG9hZGluZy5zdHlsZS53ZWJraXRUcmFuc2l0aW9uID0gIi13ZWJraXQtdHJhbnNmb3JtIDAuM3MgZWFzZS1pbiI7CiAgICAgICAgICAgICAgICBsb2FkaW5nLnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICJyb3RhdGUoMTgwZGVnKSI7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aXRsZSA9PT0gb3B0aW9ucy5kb3duLmNvbnRlbnRkb3duKSB7CiAgICAgICAgICAgICAgICBsb2FkaW5nLmNsYXNzTmFtZSA9IENMQVNTX0xPQURJTkdfRE9XTjsKICAgICAgICAgICAgICAgIGxvYWRpbmcuc3R5bGUud2Via2l0VHJhbnNpdGlvbiA9ICItd2Via2l0LXRyYW5zZm9ybSAwLjNzIGVhc2UtaW4iOwogICAgICAgICAgICAgICAgbG9hZGluZy5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSAicm90YXRlKDBkZWcpIjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKHRpdGxlID09PSBvcHRpb25zLnVwLmNvbnRlbnRyZWZyZXNoKSB7CiAgICAgICAgICAgICAgICBsb2FkaW5nLmNsYXNzTmFtZSA9IENMQVNTX0xPQURJTkcgKyAnICcgKyBDTEFTU19WSVNJQklMSVRZOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsb2FkaW5nLmNsYXNzTmFtZSA9IENMQVNTX0xPQURJTkcgKyAnICcgKyBDTEFTU19ISURERU47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzZWxmLl9zZXRDYXB0aW9uQ2xhc3MoZmFsc2UsIGNhcHRpb24sIHRpdGxlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5sYXN0VGl0bGUgPSB0aXRsZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwogICQuUHVsbFJlZnJlc2ggPSBQdWxsUmVmcmVzaDsKfSkobXVpLCBkb2N1bWVudCk7CgooZnVuY3Rpb24gKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkgewogIHZhciBDTEFTU19TQ1JPTEwgPSAnbXVpLXNjcm9sbCc7CiAgdmFyIENMQVNTX1NDUk9MTEJBUiA9ICdtdWktc2Nyb2xsYmFyJzsKICB2YXIgQ0xBU1NfSU5ESUNBVE9SID0gJ211aS1zY3JvbGxiYXItaW5kaWNhdG9yJzsKICB2YXIgQ0xBU1NfU0NST0xMQkFSX1ZFUlRJQ0FMID0gQ0xBU1NfU0NST0xMQkFSICsgJy12ZXJ0aWNhbCc7CiAgdmFyIENMQVNTX1NDUk9MTEJBUl9IT1JJWk9OVEFMID0gQ0xBU1NfU0NST0xMQkFSICsgJy1ob3Jpem9udGFsJzsKICB2YXIgQ0xBU1NfQUNUSVZFID0gJ211aS1hY3RpdmUnOwogIHZhciBlYXNlID0gewogICAgcXVhZHJhdGljOiB7CiAgICAgIHN0eWxlOiAnY3ViaWMtYmV6aWVyKDAuMjUsIDAuNDYsIDAuNDUsIDAuOTQpJywKICAgICAgZm46IGZ1bmN0aW9uIGZuKGspIHsKICAgICAgICByZXR1cm4gayAqICgyIC0gayk7CiAgICAgIH0KICAgIH0sCiAgICBjaXJjdWxhcjogewogICAgICBzdHlsZTogJ2N1YmljLWJlemllcigwLjEsIDAuNTcsIDAuMSwgMSknLAogICAgICBmbjogZnVuY3Rpb24gZm4oaykgewogICAgICAgIHJldHVybiBNYXRoLnNxcnQoMSAtIC0tayAqIGspOwogICAgICB9CiAgICB9LAogICAgb3V0Q2lyYzogewogICAgICBzdHlsZTogJ2N1YmljLWJlemllcigwLjA3NSwgMC44MiwgMC4xNjUsIDEpJwogICAgfSwKICAgIG91dEN1YmljOiB7CiAgICAgIHN0eWxlOiAnY3ViaWMtYmV6aWVyKDAuMTY1LCAwLjg0LCAwLjQ0LCAxKScKICAgIH0KICB9OwogIHZhciBTY3JvbGwgPSAkLkNsYXNzLmV4dGVuZCh7CiAgICBpbml0OiBmdW5jdGlvbiBpbml0KGVsZW1lbnQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy53cmFwcGVyID0gdGhpcy5lbGVtZW50ID0gZWxlbWVudDsKICAgICAgdGhpcy5zY3JvbGxlciA9IHRoaXMud3JhcHBlci5jaGlsZHJlblswXTsKICAgICAgdGhpcy5zY3JvbGxlclN0eWxlID0gdGhpcy5zY3JvbGxlciAmJiB0aGlzLnNjcm9sbGVyLnN0eWxlOwogICAgICB0aGlzLnN0b3BwZWQgPSBmYWxzZTsKICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwgewogICAgICAgIHNjcm9sbFk6IHRydWUsCiAgICAgICAgLy/mmK/lkKbnq5blkJHmu5rliqgKICAgICAgICBzY3JvbGxYOiBmYWxzZSwKICAgICAgICAvL+aYr+WQpuaoquWQkea7muWKqAogICAgICAgIHN0YXJ0WDogMCwKICAgICAgICAvL+WIneWni+WMluaXtua7muWKqOiHs3gKICAgICAgICBzdGFydFk6IDAsCiAgICAgICAgLy/liJ3lp4vljJbml7bmu5rliqjoh7N5CiAgICAgICAgaW5kaWNhdG9yczogdHJ1ZSwKICAgICAgICAvL+aYr+WQpuaYvuekuua7muWKqOadoQogICAgICAgIHN0b3BQcm9wYWdhdGlvbjogZmFsc2UsCiAgICAgICAgaGFyZHdhcmVBY2NlbGVyYXRlZDogdHJ1ZSwKICAgICAgICBmaXhlZEJhZEFuZG9yaWQ6IGZhbHNlLAogICAgICAgIHByZXZlbnREZWZhdWx0RXhjZXB0aW9uOiB7CiAgICAgICAgICB0YWdOYW1lOiAvXihJTlBVVHxURVhUQVJFQXxCVVRUT058U0VMRUNUfFZJREVPKSQvCiAgICAgICAgfSwKICAgICAgICBtb21lbnR1bTogdHJ1ZSwKICAgICAgICBzbmFwWDogMC41LAogICAgICAgIC8v5qiq5ZCR5YiH5o2i6Led56a7KOS7peW9k+WJjeWuueWZqOWuveW6puS4uuWfuuWHhikKICAgICAgICBzbmFwOiBmYWxzZSwKICAgICAgICAvL+WbvueJh+i9ruaSre+8jOaLluaLveW8j+mAiemhueWNoQogICAgICAgIGJvdW5jZTogdHJ1ZSwKICAgICAgICAvL+aYr+WQpuWQr+eUqOWbnuW8uQogICAgICAgIGJvdW5jZVRpbWU6IDUwMCwKICAgICAgICAvL+WbnuW8ueWKqOeUu+aXtumXtAogICAgICAgIGJvdW5jZUVhc2luZzogZWFzZS5vdXRDaXJjLAogICAgICAgIC8v5Zue5by55Yqo55S75puy57q/CiAgICAgICAgc2Nyb2xsVGltZTogNTAwLAogICAgICAgIHNjcm9sbEVhc2luZzogZWFzZS5vdXRDdWJpYywKICAgICAgICAvL+i9ruaSreWKqOeUu+absue6vwogICAgICAgIGRpcmVjdGlvbkxvY2tUaHJlc2hvbGQ6IDUsCiAgICAgICAgcGFyYWxsYXhFbGVtZW50OiBmYWxzZSwKICAgICAgICAvL+inhuW3ruWFg+e0oAogICAgICAgIHBhcmFsbGF4UmF0aW86IDAuNQogICAgICB9LCBvcHRpb25zKTsKICAgICAgdGhpcy54ID0gMDsKICAgICAgdGhpcy55ID0gMDsKICAgICAgdGhpcy50cmFuc2xhdGVaID0gdGhpcy5vcHRpb25zLmhhcmR3YXJlQWNjZWxlcmF0ZWQgPyAnIHRyYW5zbGF0ZVooMCknIDogJyc7CgogICAgICB0aGlzLl9pbml0KCk7CgogICAgICBpZiAodGhpcy5zY3JvbGxlcikgewogICAgICAgIHRoaXMucmVmcmVzaCgpOyAvLwkJCQlpZiAodGhpcy5vcHRpb25zLnN0YXJ0WCAhPT0gMCB8fCB0aGlzLm9wdGlvbnMuc3RhcnRZICE9PSAwKSB7IC8v6ZyA6KaB5Yik5pat5ZCX77yf5ZCO57ut5qC55o2u5a6e6ZmF5oOF5Ya15YaN55yL55yLCgogICAgICAgIHRoaXMuc2Nyb2xsVG8odGhpcy5vcHRpb25zLnN0YXJ0WCwgdGhpcy5vcHRpb25zLnN0YXJ0WSk7IC8vCQkJCX0KICAgICAgfQogICAgfSwKICAgIF9pbml0OiBmdW5jdGlvbiBfaW5pdCgpIHsKICAgICAgdGhpcy5faW5pdFBhcmFsbGF4KCk7CgogICAgICB0aGlzLl9pbml0SW5kaWNhdG9ycygpOwoKICAgICAgdGhpcy5faW5pdEV2ZW50KCk7CiAgICB9LAogICAgX2luaXRQYXJhbGxheDogZnVuY3Rpb24gX2luaXRQYXJhbGxheCgpIHsKICAgICAgaWYgKHRoaXMub3B0aW9ucy5wYXJhbGxheEVsZW1lbnQpIHsKICAgICAgICB0aGlzLnBhcmFsbGF4RWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLnBhcmFsbGF4RWxlbWVudCk7CiAgICAgICAgdGhpcy5wYXJhbGxheFN0eWxlID0gdGhpcy5wYXJhbGxheEVsZW1lbnQuc3R5bGU7CiAgICAgICAgdGhpcy5wYXJhbGxheEhlaWdodCA9IHRoaXMucGFyYWxsYXhFbGVtZW50Lm9mZnNldEhlaWdodDsKICAgICAgICB0aGlzLnBhcmFsbGF4SW1nU3R5bGUgPSB0aGlzLnBhcmFsbGF4RWxlbWVudC5xdWVyeVNlbGVjdG9yKCdpbWcnKS5zdHlsZTsKICAgICAgfQogICAgfSwKICAgIF9pbml0SW5kaWNhdG9yczogZnVuY3Rpb24gX2luaXRJbmRpY2F0b3JzKCkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHNlbGYuaW5kaWNhdG9ycyA9IFtdOwoKICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuaW5kaWNhdG9ycykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGluZGljYXRvcnMgPSBbXSwKICAgICAgICAgIGluZGljYXRvcjsgLy8gVmVydGljYWwgc2Nyb2xsYmFyCgogICAgICBpZiAoc2VsZi5vcHRpb25zLnNjcm9sbFkpIHsKICAgICAgICBpbmRpY2F0b3IgPSB7CiAgICAgICAgICBlbDogdGhpcy5fY3JlYXRlU2Nyb2xsQmFyKENMQVNTX1NDUk9MTEJBUl9WRVJUSUNBTCksCiAgICAgICAgICBsaXN0ZW5YOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgdGhpcy53cmFwcGVyLmFwcGVuZENoaWxkKGluZGljYXRvci5lbCk7CiAgICAgICAgaW5kaWNhdG9ycy5wdXNoKGluZGljYXRvcik7CiAgICAgIH0gLy8gSG9yaXpvbnRhbCBzY3JvbGxiYXIKCgogICAgICBpZiAodGhpcy5vcHRpb25zLnNjcm9sbFgpIHsKICAgICAgICBpbmRpY2F0b3IgPSB7CiAgICAgICAgICBlbDogdGhpcy5fY3JlYXRlU2Nyb2xsQmFyKENMQVNTX1NDUk9MTEJBUl9IT1JJWk9OVEFMKSwKICAgICAgICAgIGxpc3Rlblk6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0aGlzLndyYXBwZXIuYXBwZW5kQ2hpbGQoaW5kaWNhdG9yLmVsKTsKICAgICAgICBpbmRpY2F0b3JzLnB1c2goaW5kaWNhdG9yKTsKICAgICAgfQoKICAgICAgZm9yICh2YXIgaSA9IGluZGljYXRvcnMubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgdGhpcy5pbmRpY2F0b3JzLnB1c2gobmV3IEluZGljYXRvcih0aGlzLCBpbmRpY2F0b3JzW2ldKSk7CiAgICAgIH0KICAgIH0sCiAgICBfaW5pdFNuYXA6IGZ1bmN0aW9uIF9pbml0U25hcCgpIHsKICAgICAgdGhpcy5jdXJyZW50UGFnZSA9IHt9OwogICAgICB0aGlzLnBhZ2VzID0gW107CiAgICAgIHZhciBzbmFwcyA9IHRoaXMuc25hcHM7CiAgICAgIHZhciBsZW5ndGggPSBzbmFwcy5sZW5ndGg7CiAgICAgIHZhciBtID0gMDsKICAgICAgdmFyIG4gPSAtMTsKICAgICAgdmFyIHggPSAwOwogICAgICB2YXIgbGVmdFggPSAwOwogICAgICB2YXIgcmlnaHRYID0gMDsKICAgICAgdmFyIHNuYXBYID0gMDsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgc25hcCA9IHNuYXBzW2ldOwogICAgICAgIHZhciBvZmZzZXRMZWZ0ID0gc25hcC5vZmZzZXRMZWZ0OwogICAgICAgIHZhciBvZmZzZXRXaWR0aCA9IHNuYXAub2Zmc2V0V2lkdGg7CgogICAgICAgIGlmIChpID09PSAwIHx8IG9mZnNldExlZnQgPD0gc25hcHNbaSAtIDFdLm9mZnNldExlZnQpIHsKICAgICAgICAgIG0gPSAwOwogICAgICAgICAgbisrOwogICAgICAgIH0KCiAgICAgICAgaWYgKCF0aGlzLnBhZ2VzW21dKSB7CiAgICAgICAgICB0aGlzLnBhZ2VzW21dID0gW107CiAgICAgICAgfQoKICAgICAgICB4ID0gdGhpcy5fZ2V0U25hcFgob2Zmc2V0TGVmdCk7CiAgICAgICAgc25hcFggPSBNYXRoLnJvdW5kKG9mZnNldFdpZHRoICogdGhpcy5vcHRpb25zLnNuYXBYKTsKICAgICAgICBsZWZ0WCA9IHggLSBzbmFwWDsKICAgICAgICByaWdodFggPSB4IC0gb2Zmc2V0V2lkdGggKyBzbmFwWDsKICAgICAgICB0aGlzLnBhZ2VzW21dW25dID0gewogICAgICAgICAgeDogeCwKICAgICAgICAgIGxlZnRYOiBsZWZ0WCwKICAgICAgICAgIHJpZ2h0WDogcmlnaHRYLAogICAgICAgICAgcGFnZVg6IG0sCiAgICAgICAgICBlbGVtZW50OiBzbmFwCiAgICAgICAgfTsKCiAgICAgICAgaWYgKHNuYXAuY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX0FDVElWRSkpIHsKICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSB0aGlzLnBhZ2VzW21dWzBdOwogICAgICAgIH0KCiAgICAgICAgaWYgKHggPj0gdGhpcy5tYXhTY3JvbGxYKSB7CiAgICAgICAgICBtKys7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLm9wdGlvbnMuc3RhcnRYID0gdGhpcy5jdXJyZW50UGFnZS54IHx8IDA7CiAgICB9LAogICAgX2dldFNuYXBYOiBmdW5jdGlvbiBfZ2V0U25hcFgob2Zmc2V0TGVmdCkgewogICAgICByZXR1cm4gTWF0aC5tYXgoTWF0aC5taW4oMCwgLW9mZnNldExlZnQgKyB0aGlzLndyYXBwZXJXaWR0aCAvIDIpLCB0aGlzLm1heFNjcm9sbFgpOwogICAgfSwKICAgIF9nb3RvUGFnZTogZnVuY3Rpb24gX2dvdG9QYWdlKGluZGV4KSB7CiAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSB0aGlzLnBhZ2VzW01hdGgubWluKGluZGV4LCB0aGlzLnBhZ2VzLmxlbmd0aCAtIDEpXVswXTsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLnNuYXBzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgaWYgKGkgPT09IGluZGV4KSB7CiAgICAgICAgICB0aGlzLnNuYXBzW2ldLmNsYXNzTGlzdC5hZGQoQ0xBU1NfQUNUSVZFKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5zbmFwc1tpXS5jbGFzc0xpc3QucmVtb3ZlKENMQVNTX0FDVElWRSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnNjcm9sbFRvKHRoaXMuY3VycmVudFBhZ2UueCwgMCwgdGhpcy5vcHRpb25zLnNjcm9sbFRpbWUpOwogICAgfSwKICAgIF9uZWFyZXN0U25hcDogZnVuY3Rpb24gX25lYXJlc3RTbmFwKHgpIHsKICAgICAgaWYgKCF0aGlzLnBhZ2VzLmxlbmd0aCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB4OiAwLAogICAgICAgICAgcGFnZVg6IDAKICAgICAgICB9OwogICAgICB9CgogICAgICB2YXIgaSA9IDA7CiAgICAgIHZhciBsZW5ndGggPSB0aGlzLnBhZ2VzLmxlbmd0aDsKCiAgICAgIGlmICh4ID4gMCkgewogICAgICAgIHggPSAwOwogICAgICB9IGVsc2UgaWYgKHggPCB0aGlzLm1heFNjcm9sbFgpIHsKICAgICAgICB4ID0gdGhpcy5tYXhTY3JvbGxYOwogICAgICB9CgogICAgICBmb3IgKDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIG5lYXJlc3RYID0gdGhpcy5kaXJlY3Rpb24gPT09ICdsZWZ0JyA/IHRoaXMucGFnZXNbaV1bMF0ubGVmdFggOiB0aGlzLnBhZ2VzW2ldWzBdLnJpZ2h0WDsKCiAgICAgICAgaWYgKHggPj0gbmVhcmVzdFgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLnBhZ2VzW2ldWzBdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICB4OiAwLAogICAgICAgIHBhZ2VYOiAwCiAgICAgIH07CiAgICB9LAogICAgX2luaXRFdmVudDogZnVuY3Rpb24gX2luaXRFdmVudChkZXRhY2gpIHsKICAgICAgdmFyIGFjdGlvbiA9IGRldGFjaCA/ICdyZW1vdmVFdmVudExpc3RlbmVyJyA6ICdhZGRFdmVudExpc3RlbmVyJzsKICAgICAgd2luZG93W2FjdGlvbl0oJ29yaWVudGF0aW9uY2hhbmdlJywgdGhpcyk7CiAgICAgIHdpbmRvd1thY3Rpb25dKCdyZXNpemUnLCB0aGlzKTsKICAgICAgdGhpcy5zY3JvbGxlclthY3Rpb25dKCd3ZWJraXRUcmFuc2l0aW9uRW5kJywgdGhpcyk7CiAgICAgIHRoaXMud3JhcHBlclthY3Rpb25dKCQuRVZFTlRfU1RBUlQsIHRoaXMpOwogICAgICB0aGlzLndyYXBwZXJbYWN0aW9uXSgkLkVWRU5UX0NBTkNFTCwgdGhpcyk7CiAgICAgIHRoaXMud3JhcHBlclthY3Rpb25dKCQuRVZFTlRfRU5ELCB0aGlzKTsKICAgICAgdGhpcy53cmFwcGVyW2FjdGlvbl0oJ2RyYWcnLCB0aGlzKTsKICAgICAgdGhpcy53cmFwcGVyW2FjdGlvbl0oJ2RyYWdlbmQnLCB0aGlzKTsKICAgICAgdGhpcy53cmFwcGVyW2FjdGlvbl0oJ2ZsaWNrJywgdGhpcyk7CiAgICAgIHRoaXMud3JhcHBlclthY3Rpb25dKCdzY3JvbGxlbmQnLCB0aGlzKTsKCiAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2Nyb2xsWCkgewogICAgICAgIHRoaXMud3JhcHBlclthY3Rpb25dKCdzd2lwZXJpZ2h0JywgdGhpcyk7CiAgICAgIH0KCiAgICAgIHZhciBzZWdtZW50ZWRDb250cm9sID0gdGhpcy53cmFwcGVyLnF1ZXJ5U2VsZWN0b3IoJy5tdWktc2VnbWVudGVkLWNvbnRyb2wnKTsKCiAgICAgIGlmIChzZWdtZW50ZWRDb250cm9sKSB7CiAgICAgICAgLy/pnaDvvIzov5nkuKpidWfmjpLmn6XkuobkuIDkuIvljYjvvIzpmLvmraJoYXNo6Lez6L2s77yM5LiA5pemaGFzaOi3s+i9rOS8muWvvOiHtOWPr+aLluaLvemAiemhueWNoeeahHRhYuS4jeingQogICAgICAgIG11aShzZWdtZW50ZWRDb250cm9sKVtkZXRhY2ggPyAnb2ZmJyA6ICdvbiddKCdjbGljaycsICdhJywgJC5wcmV2ZW50RGVmYXVsdCk7CiAgICAgIH0KCiAgICAgIHRoaXMud3JhcHBlclthY3Rpb25dKCdzY3JvbGxzdGFydCcsIHRoaXMpOwogICAgICB0aGlzLndyYXBwZXJbYWN0aW9uXSgncmVmcmVzaCcsIHRoaXMpOwogICAgfSwKICAgIF9oYW5kbGVJbmRpY2F0b3JTY3JvbGxlbmQ6IGZ1bmN0aW9uIF9oYW5kbGVJbmRpY2F0b3JTY3JvbGxlbmQoKSB7CiAgICAgIHRoaXMuaW5kaWNhdG9ycy5tYXAoZnVuY3Rpb24gKGluZGljYXRvcikgewogICAgICAgIGluZGljYXRvci5mYWRlKCk7CiAgICAgIH0pOwogICAgfSwKICAgIF9oYW5kbGVJbmRpY2F0b3JTY3JvbGxzdGFydDogZnVuY3Rpb24gX2hhbmRsZUluZGljYXRvclNjcm9sbHN0YXJ0KCkgewogICAgICB0aGlzLmluZGljYXRvcnMubWFwKGZ1bmN0aW9uIChpbmRpY2F0b3IpIHsKICAgICAgICBpbmRpY2F0b3IuZmFkZSgxKTsKICAgICAgfSk7CiAgICB9LAogICAgX2hhbmRsZUluZGljYXRvclJlZnJlc2g6IGZ1bmN0aW9uIF9oYW5kbGVJbmRpY2F0b3JSZWZyZXNoKCkgewogICAgICB0aGlzLmluZGljYXRvcnMubWFwKGZ1bmN0aW9uIChpbmRpY2F0b3IpIHsKICAgICAgICBpbmRpY2F0b3IucmVmcmVzaCgpOwogICAgICB9KTsKICAgIH0sCiAgICBoYW5kbGVFdmVudDogZnVuY3Rpb24gaGFuZGxlRXZlbnQoZSkgewogICAgICBpZiAodGhpcy5zdG9wcGVkKSB7CiAgICAgICAgdGhpcy5yZXNldFBvc2l0aW9uKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBzd2l0Y2ggKGUudHlwZSkgewogICAgICAgIGNhc2UgJC5FVkVOVF9TVEFSVDoKICAgICAgICAgIHRoaXMuX3N0YXJ0KGUpOwoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdkcmFnJzoKICAgICAgICAgIHRoaXMub3B0aW9ucy5zdG9wUHJvcGFnYXRpb24gJiYgZS5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgICAgICB0aGlzLl9kcmFnKGUpOwoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdkcmFnZW5kJzoKICAgICAgICBjYXNlICdmbGljayc6CiAgICAgICAgICB0aGlzLm9wdGlvbnMuc3RvcFByb3BhZ2F0aW9uICYmIGUuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICAgICAgdGhpcy5fZmxpY2soZSk7CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJC5FVkVOVF9DQU5DRUw6CiAgICAgICAgY2FzZSAkLkVWRU5UX0VORDoKICAgICAgICAgIHRoaXMuX2VuZChlKTsKCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnd2Via2l0VHJhbnNpdGlvbkVuZCc6CiAgICAgICAgICB0aGlzLnRyYW5zaXRpb25UaW1lciAmJiB0aGlzLnRyYW5zaXRpb25UaW1lci5jYW5jZWwoKTsKCiAgICAgICAgICB0aGlzLl90cmFuc2l0aW9uRW5kKGUpOwoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdzY3JvbGxzdGFydCc6CiAgICAgICAgICB0aGlzLl9oYW5kbGVJbmRpY2F0b3JTY3JvbGxzdGFydChlKTsKCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnc2Nyb2xsZW5kJzoKICAgICAgICAgIHRoaXMuX2hhbmRsZUluZGljYXRvclNjcm9sbGVuZChlKTsKCiAgICAgICAgICB0aGlzLl9zY3JvbGxlbmQoZSk7CgogICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdvcmllbnRhdGlvbmNoYW5nZSc6CiAgICAgICAgY2FzZSAncmVzaXplJzoKICAgICAgICAgIHRoaXMuX3Jlc2l6ZSgpOwoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdzd2lwZXJpZ2h0JzoKICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAncmVmcmVzaCc6CiAgICAgICAgICB0aGlzLl9oYW5kbGVJbmRpY2F0b3JSZWZyZXNoKGUpOwoKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAogICAgX3N0YXJ0OiBmdW5jdGlvbiBfc3RhcnQoZSkgewogICAgICB0aGlzLm1vdmVkID0gdGhpcy5uZWVkUmVzZXQgPSBmYWxzZTsKCiAgICAgIHRoaXMuX3RyYW5zaXRpb25UaW1lKCk7CgogICAgICBpZiAodGhpcy5pc0luVHJhbnNpdGlvbikgewogICAgICAgIHRoaXMubmVlZFJlc2V0ID0gdHJ1ZTsKICAgICAgICB0aGlzLmlzSW5UcmFuc2l0aW9uID0gZmFsc2U7CiAgICAgICAgdmFyIHBvcyA9ICQucGFyc2VUcmFuc2xhdGVNYXRyaXgoJC5nZXRTdHlsZXModGhpcy5zY3JvbGxlciwgJ3dlYmtpdFRyYW5zZm9ybScpKTsKICAgICAgICB0aGlzLnNldFRyYW5zbGF0ZShNYXRoLnJvdW5kKHBvcy54KSwgTWF0aC5yb3VuZChwb3MueSkpOyAvLwkJCQl0aGlzLnJlc2V0UG9zaXRpb24oKTsgLy9yZXNldAoKICAgICAgICAkLnRyaWdnZXIodGhpcy5zY3JvbGxlciwgJ3Njcm9sbGVuZCcsIHRoaXMpOyAvLwkJCQllLnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KCiAgICAgIHRoaXMucmVMYXlvdXQoKTsKICAgICAgJC50cmlnZ2VyKHRoaXMuc2Nyb2xsZXIsICdiZWZvcmVzY3JvbGxzdGFydCcsIHRoaXMpOwogICAgfSwKICAgIF9nZXREaXJlY3Rpb25CeUFuZ2xlOiBmdW5jdGlvbiBfZ2V0RGlyZWN0aW9uQnlBbmdsZShhbmdsZSkgewogICAgICBpZiAoYW5nbGUgPCAtODAgJiYgYW5nbGUgPiAtMTAwKSB7CiAgICAgICAgcmV0dXJuICd1cCc7CiAgICAgIH0gZWxzZSBpZiAoYW5nbGUgPj0gODAgJiYgYW5nbGUgPCAxMDApIHsKICAgICAgICByZXR1cm4gJ2Rvd24nOwogICAgICB9IGVsc2UgaWYgKGFuZ2xlID49IDE3MCB8fCBhbmdsZSA8PSAtMTcwKSB7CiAgICAgICAgcmV0dXJuICdsZWZ0JzsKICAgICAgfSBlbHNlIGlmIChhbmdsZSA+PSAtMzUgJiYgYW5nbGUgPD0gMTApIHsKICAgICAgICByZXR1cm4gJ3JpZ2h0JzsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAogICAgX2RyYWc6IGZ1bmN0aW9uIF9kcmFnKGUpIHsKICAgICAgLy8JCQlpZiAodGhpcy5uZWVkUmVzZXQpIHsKICAgICAgLy8JCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsgLy9kaXNhYmxlIHBhcmVudCBkcmFnKG5lc3RlZCBzY3JvbGxlcikKICAgICAgLy8JCQkJcmV0dXJuOwogICAgICAvLwkJCX0KICAgICAgdmFyIGRldGFpbCA9IGUuZGV0YWlsOwoKICAgICAgaWYgKHRoaXMub3B0aW9ucy5zY3JvbGxZIHx8IGRldGFpbC5kaXJlY3Rpb24gPT09ICd1cCcgfHwgZGV0YWlsLmRpcmVjdGlvbiA9PT0gJ2Rvd24nKSB7CiAgICAgICAgLy/lpoLmnpzmmK/nq5blkJHmu5rliqjmiJbmiYvlir/mlrnlkJHmmK/kuIrmiJbkuIsKICAgICAgICAvL2lvczggaGFjawogICAgICAgIGlmICgkLm9zLmlvcyAmJiBwYXJzZUZsb2F0KCQub3MudmVyc2lvbikgPj0gOCkgewogICAgICAgICAgLy/lpJp3ZWJ2aWV35pe277yM56a75byA5b2T5YmNd2Vidmlld+S8muWvvOiHtOWQjue7rXRvdWNo5LqL5Lu25LiN6Kem5Y+RCiAgICAgICAgICB2YXIgY2xpZW50WSA9IGRldGFpbC5nZXN0dXJlLnRvdWNoZXNbMF0uY2xpZW50WTsgLy/kuIvmi4nliLfmlrAgb3Ig5LiK5ouJ5Yqg6L29CgogICAgICAgICAgaWYgKGNsaWVudFkgKyAxMCA+IHdpbmRvdy5pbm5lckhlaWdodCB8fCBjbGllbnRZIDwgMTApIHsKICAgICAgICAgICAgdGhpcy5yZXNldFBvc2l0aW9uKHRoaXMub3B0aW9ucy5ib3VuY2VUaW1lKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIGlzUHJldmVudERlZmF1bHQgPSBpc1JldHVybiA9IGZhbHNlOwoKICAgICAgdmFyIGRpcmVjdGlvbiA9IHRoaXMuX2dldERpcmVjdGlvbkJ5QW5nbGUoZGV0YWlsLmFuZ2xlKTsKCiAgICAgIGlmIChkZXRhaWwuZGlyZWN0aW9uID09PSAnbGVmdCcgfHwgZGV0YWlsLmRpcmVjdGlvbiA9PT0gJ3JpZ2h0JykgewogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2Nyb2xsWCkgewogICAgICAgICAgaXNQcmV2ZW50RGVmYXVsdCA9IHRydWU7CgogICAgICAgICAgaWYgKCF0aGlzLm1vdmVkKSB7CiAgICAgICAgICAgIC8v6K+G5Yir6KeS5bqmKOivpeinkuW6puWvvOiHtOi9ruaSreS4jeeBteaVjykKICAgICAgICAgICAgLy8JCQkJCQlpZiAoZGlyZWN0aW9uICE9PSAnbGVmdCcgJiYgZGlyZWN0aW9uICE9PSAncmlnaHQnKSB7CiAgICAgICAgICAgIC8vCQkJCQkJCWlzUmV0dXJuID0gdHJ1ZTsKICAgICAgICAgICAgLy8JCQkJCQl9IGVsc2UgewogICAgICAgICAgICAkLmdlc3R1cmVzLnNlc3Npb24ubG9ja0RpcmVjdGlvbiA9IHRydWU7IC8v6ZSB5a6a5pa55ZCRCgogICAgICAgICAgICAkLmdlc3R1cmVzLnNlc3Npb24uc3RhcnREaXJlY3Rpb24gPSBkZXRhaWwuZGlyZWN0aW9uOyAvLwkJCQkJCX0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5zY3JvbGxZICYmICF0aGlzLm1vdmVkKSB7CiAgICAgICAgICBpc1JldHVybiA9IHRydWU7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGRldGFpbC5kaXJlY3Rpb24gPT09ICd1cCcgfHwgZGV0YWlsLmRpcmVjdGlvbiA9PT0gJ2Rvd24nKSB7CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zY3JvbGxZKSB7CiAgICAgICAgICBpc1ByZXZlbnREZWZhdWx0ID0gdHJ1ZTsgLy8JCQkJCWlmICghdGhpcy5tb3ZlZCkgeyAvL+ivhuWIq+inkuW6piznq5blkJHmu5rliqjkvLzkuY7msqHlv4XopoHov5vooYzlsI/op5Lluqbpqozor4EKICAgICAgICAgIC8vCQkJCQkJaWYgKGRpcmVjdGlvbiAhPT0gJ3VwJyAmJiBkaXJlY3Rpb24gIT09ICdkb3duJykgewogICAgICAgICAgLy8JCQkJCQkJaXNSZXR1cm4gPSB0cnVlOwogICAgICAgICAgLy8JCQkJCQl9CiAgICAgICAgICAvLwkJCQkJfQoKICAgICAgICAgIGlmICghdGhpcy5tb3ZlZCkgewogICAgICAgICAgICAkLmdlc3R1cmVzLnNlc3Npb24ubG9ja0RpcmVjdGlvbiA9IHRydWU7IC8v6ZSB5a6a5pa55ZCRCgogICAgICAgICAgICAkLmdlc3R1cmVzLnNlc3Npb24uc3RhcnREaXJlY3Rpb24gPSBkZXRhaWwuZGlyZWN0aW9uOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodGhpcy5vcHRpb25zLnNjcm9sbFggJiYgIXRoaXMubW92ZWQpIHsKICAgICAgICAgIGlzUmV0dXJuID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaXNSZXR1cm4gPSB0cnVlOwogICAgICB9CgogICAgICBpZiAodGhpcy5tb3ZlZCB8fCBpc1ByZXZlbnREZWZhdWx0KSB7CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsgLy/pmLvmraLlhpLms6Eoc2Nyb2xs57G75bWM5aWXKQoKICAgICAgICBkZXRhaWwuZ2VzdHVyZSAmJiBkZXRhaWwuZ2VzdHVyZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9CgogICAgICBpZiAoaXNSZXR1cm4pIHsKICAgICAgICAvL+emgeatoumdnuazleaWueWQkea7muWKqAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCF0aGlzLm1vdmVkKSB7CiAgICAgICAgJC50cmlnZ2VyKHRoaXMuc2Nyb2xsZXIsICdzY3JvbGxzdGFydCcsIHRoaXMpOwogICAgICB9IGVsc2UgewogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7IC8vbW92Zeacn+mXtOmYu+atouWGkuazoShzY3JvbGzltYzlpZcpCiAgICAgIH0KCiAgICAgIHZhciBkZWx0YVggPSAwOwogICAgICB2YXIgZGVsdGFZID0gMDsKCiAgICAgIGlmICghdGhpcy5tb3ZlZCkgewogICAgICAgIC8vc3RhcnQKICAgICAgICBkZWx0YVggPSBkZXRhaWwuZGVsdGFYOwogICAgICAgIGRlbHRhWSA9IGRldGFpbC5kZWx0YVk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy9tb3ZlCiAgICAgICAgZGVsdGFYID0gZGV0YWlsLmRlbHRhWCAtICQuZ2VzdHVyZXMuc2Vzc2lvbi5wcmV2VG91Y2guZGVsdGFYOwogICAgICAgIGRlbHRhWSA9IGRldGFpbC5kZWx0YVkgLSAkLmdlc3R1cmVzLnNlc3Npb24ucHJldlRvdWNoLmRlbHRhWTsKICAgICAgfQoKICAgICAgdmFyIGFic0RlbHRhWCA9IE1hdGguYWJzKGRldGFpbC5kZWx0YVgpOwogICAgICB2YXIgYWJzRGVsdGFZID0gTWF0aC5hYnMoZGV0YWlsLmRlbHRhWSk7CgogICAgICBpZiAoYWJzRGVsdGFYID4gYWJzRGVsdGFZICsgdGhpcy5vcHRpb25zLmRpcmVjdGlvbkxvY2tUaHJlc2hvbGQpIHsKICAgICAgICBkZWx0YVkgPSAwOwogICAgICB9IGVsc2UgaWYgKGFic0RlbHRhWSA+PSBhYnNEZWx0YVggKyB0aGlzLm9wdGlvbnMuZGlyZWN0aW9uTG9ja1RocmVzaG9sZCkgewogICAgICAgIGRlbHRhWCA9IDA7CiAgICAgIH0KCiAgICAgIGRlbHRhWCA9IHRoaXMuaGFzSG9yaXpvbnRhbFNjcm9sbCA/IGRlbHRhWCA6IDA7CiAgICAgIGRlbHRhWSA9IHRoaXMuaGFzVmVydGljYWxTY3JvbGwgPyBkZWx0YVkgOiAwOwogICAgICB2YXIgbmV3WCA9IHRoaXMueCArIGRlbHRhWDsKICAgICAgdmFyIG5ld1kgPSB0aGlzLnkgKyBkZWx0YVk7IC8vIFNsb3cgZG93biBpZiBvdXRzaWRlIG9mIHRoZSBib3VuZGFyaWVzCgogICAgICBpZiAobmV3WCA+IDAgfHwgbmV3WCA8IHRoaXMubWF4U2Nyb2xsWCkgewogICAgICAgIG5ld1ggPSB0aGlzLm9wdGlvbnMuYm91bmNlID8gdGhpcy54ICsgZGVsdGFYIC8gMyA6IG5ld1ggPiAwID8gMCA6IHRoaXMubWF4U2Nyb2xsWDsKICAgICAgfQoKICAgICAgaWYgKG5ld1kgPiAwIHx8IG5ld1kgPCB0aGlzLm1heFNjcm9sbFkpIHsKICAgICAgICBuZXdZID0gdGhpcy5vcHRpb25zLmJvdW5jZSA/IHRoaXMueSArIGRlbHRhWSAvIDMgOiBuZXdZID4gMCA/IDAgOiB0aGlzLm1heFNjcm9sbFk7CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHsKICAgICAgICB0aGlzLl91cGRhdGVUcmFuc2xhdGUoKTsKICAgICAgfQoKICAgICAgdGhpcy5kaXJlY3Rpb24gPSBkZXRhaWwuZGVsdGFYID4gMCA/ICdyaWdodCcgOiAnbGVmdCc7CiAgICAgIHRoaXMubW92ZWQgPSB0cnVlOwogICAgICB0aGlzLnggPSBuZXdYOwogICAgICB0aGlzLnkgPSBuZXdZOwogICAgICAkLnRyaWdnZXIodGhpcy5zY3JvbGxlciwgJ3Njcm9sbCcsIHRoaXMpOwogICAgfSwKICAgIF9mbGljazogZnVuY3Rpb24gX2ZsaWNrKGUpIHsKICAgICAgLy8JCQlpZiAoIXRoaXMubW92ZWQgfHwgdGhpcy5uZWVkUmVzZXQpIHsKICAgICAgLy8JCQkJcmV0dXJuOwogICAgICAvLwkJCX0KICAgICAgaWYgKCF0aGlzLm1vdmVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICB2YXIgZGV0YWlsID0gZS5kZXRhaWw7CgogICAgICB0aGlzLl9jbGVhclJlcXVlc3RBbmltYXRpb25GcmFtZSgpOwoKICAgICAgaWYgKGUudHlwZSA9PT0gJ2RyYWdlbmQnICYmIGRldGFpbC5mbGljaykgewogICAgICAgIC8vZHJhZ2VuZAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIG5ld1ggPSBNYXRoLnJvdW5kKHRoaXMueCk7CiAgICAgIHZhciBuZXdZID0gTWF0aC5yb3VuZCh0aGlzLnkpOwogICAgICB0aGlzLmlzSW5UcmFuc2l0aW9uID0gZmFsc2U7IC8vIHJlc2V0IGlmIHdlIGFyZSBvdXRzaWRlIG9mIHRoZSBib3VuZGFyaWVzCgogICAgICBpZiAodGhpcy5yZXNldFBvc2l0aW9uKHRoaXMub3B0aW9ucy5ib3VuY2VUaW1lKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5zY3JvbGxUbyhuZXdYLCBuZXdZKTsgLy8gZW5zdXJlcyB0aGF0IHRoZSBsYXN0IHBvc2l0aW9uIGlzIHJvdW5kZWQKCiAgICAgIGlmIChlLnR5cGUgPT09ICdkcmFnZW5kJykgewogICAgICAgIC8vZHJhZ2VuZAogICAgICAgICQudHJpZ2dlcih0aGlzLnNjcm9sbGVyLCAnc2Nyb2xsZW5kJywgdGhpcyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdGltZSA9IDA7CiAgICAgIHZhciBlYXNpbmcgPSAnJzsgLy8gc3RhcnQgbW9tZW50dW0gYW5pbWF0aW9uIGlmIG5lZWRlZAoKICAgICAgaWYgKHRoaXMub3B0aW9ucy5tb21lbnR1bSAmJiBkZXRhaWwuZmxpY2tUaW1lIDwgMzAwKSB7CiAgICAgICAgbW9tZW50dW1YID0gdGhpcy5oYXNIb3Jpem9udGFsU2Nyb2xsID8gdGhpcy5fbW9tZW50dW0odGhpcy54LCBkZXRhaWwuZmxpY2tEaXN0YW5jZVgsIGRldGFpbC5mbGlja1RpbWUsIHRoaXMubWF4U2Nyb2xsWCwgdGhpcy5vcHRpb25zLmJvdW5jZSA/IHRoaXMud3JhcHBlcldpZHRoIDogMCwgdGhpcy5vcHRpb25zLmRlY2VsZXJhdGlvbikgOiB7CiAgICAgICAgICBkZXN0aW5hdGlvbjogbmV3WCwKICAgICAgICAgIGR1cmF0aW9uOiAwCiAgICAgICAgfTsKICAgICAgICBtb21lbnR1bVkgPSB0aGlzLmhhc1ZlcnRpY2FsU2Nyb2xsID8gdGhpcy5fbW9tZW50dW0odGhpcy55LCBkZXRhaWwuZmxpY2tEaXN0YW5jZVksIGRldGFpbC5mbGlja1RpbWUsIHRoaXMubWF4U2Nyb2xsWSwgdGhpcy5vcHRpb25zLmJvdW5jZSA/IHRoaXMud3JhcHBlckhlaWdodCA6IDAsIHRoaXMub3B0aW9ucy5kZWNlbGVyYXRpb24pIDogewogICAgICAgICAgZGVzdGluYXRpb246IG5ld1ksCiAgICAgICAgICBkdXJhdGlvbjogMAogICAgICAgIH07CiAgICAgICAgbmV3WCA9IG1vbWVudHVtWC5kZXN0aW5hdGlvbjsKICAgICAgICBuZXdZID0gbW9tZW50dW1ZLmRlc3RpbmF0aW9uOwogICAgICAgIHRpbWUgPSBNYXRoLm1heChtb21lbnR1bVguZHVyYXRpb24sIG1vbWVudHVtWS5kdXJhdGlvbik7CiAgICAgICAgdGhpcy5pc0luVHJhbnNpdGlvbiA9IHRydWU7CiAgICAgIH0KCiAgICAgIGlmIChuZXdYICE9IHRoaXMueCB8fCBuZXdZICE9IHRoaXMueSkgewogICAgICAgIGlmIChuZXdYID4gMCB8fCBuZXdYIDwgdGhpcy5tYXhTY3JvbGxYIHx8IG5ld1kgPiAwIHx8IG5ld1kgPCB0aGlzLm1heFNjcm9sbFkpIHsKICAgICAgICAgIGVhc2luZyA9IGVhc2UucXVhZHJhdGljOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5zY3JvbGxUbyhuZXdYLCBuZXdZLCB0aW1lLCBlYXNpbmcpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgJC50cmlnZ2VyKHRoaXMuc2Nyb2xsZXIsICdzY3JvbGxlbmQnLCB0aGlzKTsgLy8JCQllLnN0b3BQcm9wYWdhdGlvbigpOwogICAgfSwKICAgIF9lbmQ6IGZ1bmN0aW9uIF9lbmQoZSkgewogICAgICB0aGlzLm5lZWRSZXNldCA9IGZhbHNlOwoKICAgICAgaWYgKCF0aGlzLm1vdmVkICYmIHRoaXMubmVlZFJlc2V0IHx8IGUudHlwZSA9PT0gJC5FVkVOVF9DQU5DRUwpIHsKICAgICAgICB0aGlzLnJlc2V0UG9zaXRpb24oKTsKICAgICAgfQogICAgfSwKICAgIF90cmFuc2l0aW9uRW5kOiBmdW5jdGlvbiBfdHJhbnNpdGlvbkVuZChlKSB7CiAgICAgIGlmIChlLnRhcmdldCAhPSB0aGlzLnNjcm9sbGVyIHx8ICF0aGlzLmlzSW5UcmFuc2l0aW9uKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLl90cmFuc2l0aW9uVGltZSgpOwoKICAgICAgaWYgKCF0aGlzLnJlc2V0UG9zaXRpb24odGhpcy5vcHRpb25zLmJvdW5jZVRpbWUpKSB7CiAgICAgICAgdGhpcy5pc0luVHJhbnNpdGlvbiA9IGZhbHNlOwogICAgICAgICQudHJpZ2dlcih0aGlzLnNjcm9sbGVyLCAnc2Nyb2xsZW5kJywgdGhpcyk7CiAgICAgIH0KICAgIH0sCiAgICBfc2Nyb2xsZW5kOiBmdW5jdGlvbiBfc2Nyb2xsZW5kKGUpIHsKICAgICAgaWYgKHRoaXMueSA9PT0gMCAmJiB0aGlzLm1heFNjcm9sbFkgPT09IDAgfHwgTWF0aC5hYnModGhpcy55KSA+IDAgJiYgdGhpcy55IDw9IHRoaXMubWF4U2Nyb2xsWSkgewogICAgICAgICQudHJpZ2dlcih0aGlzLnNjcm9sbGVyLCAnc2Nyb2xsYm90dG9tJywgdGhpcyk7CiAgICAgIH0KICAgIH0sCiAgICBfcmVzaXplOiBmdW5jdGlvbiBfcmVzaXplKCkgewogICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGF0LnJlc2l6ZVRpbWVvdXQpOwogICAgICB0aGF0LnJlc2l6ZVRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGF0LnJlZnJlc2goKTsKICAgICAgfSwgdGhhdC5vcHRpb25zLnJlc2l6ZVBvbGxpbmcpOwogICAgfSwKICAgIF90cmFuc2l0aW9uVGltZTogZnVuY3Rpb24gX3RyYW5zaXRpb25UaW1lKHRpbWUpIHsKICAgICAgdGltZSA9IHRpbWUgfHwgMDsKICAgICAgdGhpcy5zY3JvbGxlclN0eWxlWyd3ZWJraXRUcmFuc2l0aW9uRHVyYXRpb24nXSA9IHRpbWUgKyAnbXMnOwoKICAgICAgaWYgKHRoaXMucGFyYWxsYXhFbGVtZW50ICYmIHRoaXMub3B0aW9ucy5zY3JvbGxZKSB7CiAgICAgICAgLy/nm67liY3ku4XmlK/mjIHnq5blkJHop4blt67mlYjmnpwKICAgICAgICB0aGlzLnBhcmFsbGF4U3R5bGVbJ3dlYmtpdFRyYW5zaXRpb25EdXJhdGlvbiddID0gdGltZSArICdtcyc7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLm9wdGlvbnMuZml4ZWRCYWRBbmRvcmlkICYmICF0aW1lICYmICQub3MuaXNCYWRBbmRyb2lkKSB7CiAgICAgICAgdGhpcy5zY3JvbGxlclN0eWxlWyd3ZWJraXRUcmFuc2l0aW9uRHVyYXRpb24nXSA9ICcwLjAwMXMnOwoKICAgICAgICBpZiAodGhpcy5wYXJhbGxheEVsZW1lbnQgJiYgdGhpcy5vcHRpb25zLnNjcm9sbFkpIHsKICAgICAgICAgIC8v55uu5YmN5LuF5pSv5oyB56uW5ZCR6KeG5beu5pWI5p6cCiAgICAgICAgICB0aGlzLnBhcmFsbGF4U3R5bGVbJ3dlYmtpdFRyYW5zaXRpb25EdXJhdGlvbiddID0gJzAuMDAxcyc7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy5pbmRpY2F0b3JzKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMuaW5kaWNhdG9ycy5sZW5ndGg7IGktLTspIHsKICAgICAgICAgIHRoaXMuaW5kaWNhdG9yc1tpXS50cmFuc2l0aW9uVGltZSh0aW1lKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aW1lKSB7CiAgICAgICAgLy/oh6rlrprkuYl0aW1lcu+8jOS/neivgXdlYmtpdFRyYW5zaXRpb25FbmTlp4vnu4jop6blj5EKICAgICAgICB0aGlzLnRyYW5zaXRpb25UaW1lciAmJiB0aGlzLnRyYW5zaXRpb25UaW1lci5jYW5jZWwoKTsKICAgICAgICB0aGlzLnRyYW5zaXRpb25UaW1lciA9ICQubGF0ZXIoZnVuY3Rpb24gKCkgewogICAgICAgICAgJC50cmlnZ2VyKHRoaXMuc2Nyb2xsZXIsICd3ZWJraXRUcmFuc2l0aW9uRW5kJyk7CiAgICAgICAgfSwgdGltZSArIDEwMCwgdGhpcyk7CiAgICAgIH0KICAgIH0sCiAgICBfdHJhbnNpdGlvblRpbWluZ0Z1bmN0aW9uOiBmdW5jdGlvbiBfdHJhbnNpdGlvblRpbWluZ0Z1bmN0aW9uKGVhc2luZykgewogICAgICB0aGlzLnNjcm9sbGVyU3R5bGVbJ3dlYmtpdFRyYW5zaXRpb25UaW1pbmdGdW5jdGlvbiddID0gZWFzaW5nOwoKICAgICAgaWYgKHRoaXMucGFyYWxsYXhFbGVtZW50ICYmIHRoaXMub3B0aW9ucy5zY3JvbGxZKSB7CiAgICAgICAgLy/nm67liY3ku4XmlK/mjIHnq5blkJHop4blt67mlYjmnpwKICAgICAgICB0aGlzLnBhcmFsbGF4U3R5bGVbJ3dlYmtpdFRyYW5zaXRpb25EdXJhdGlvbiddID0gZWFzaW5nOwogICAgICB9CgogICAgICBpZiAodGhpcy5pbmRpY2F0b3JzKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMuaW5kaWNhdG9ycy5sZW5ndGg7IGktLTspIHsKICAgICAgICAgIHRoaXMuaW5kaWNhdG9yc1tpXS50cmFuc2l0aW9uVGltaW5nRnVuY3Rpb24oZWFzaW5nKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBfdHJhbnNsYXRlOiBmdW5jdGlvbiBfdHJhbnNsYXRlKHgsIHkpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgIH0sCiAgICBfY2xlYXJSZXF1ZXN0QW5pbWF0aW9uRnJhbWU6IGZ1bmN0aW9uIF9jbGVhclJlcXVlc3RBbmltYXRpb25GcmFtZSgpIHsKICAgICAgaWYgKHRoaXMucmVxdWVzdEFuaW1hdGlvbkZyYW1lKSB7CiAgICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpOwogICAgICAgIHRoaXMucmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gbnVsbDsKICAgICAgfQogICAgfSwKICAgIF91cGRhdGVUcmFuc2xhdGU6IGZ1bmN0aW9uIF91cGRhdGVUcmFuc2xhdGUoKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgIGlmIChzZWxmLnggIT09IHNlbGYubGFzdFggfHwgc2VsZi55ICE9PSBzZWxmLmxhc3RZKSB7CiAgICAgICAgc2VsZi5zZXRUcmFuc2xhdGUoc2VsZi54LCBzZWxmLnkpOwogICAgICB9CgogICAgICBzZWxmLnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgc2VsZi5fdXBkYXRlVHJhbnNsYXRlKCk7CiAgICAgIH0pOwogICAgfSwKICAgIF9jcmVhdGVTY3JvbGxCYXI6IGZ1bmN0aW9uIF9jcmVhdGVTY3JvbGxCYXIoY2xhenopIHsKICAgICAgdmFyIHNjcm9sbGJhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICB2YXIgaW5kaWNhdG9yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIHNjcm9sbGJhci5jbGFzc05hbWUgPSBDTEFTU19TQ1JPTExCQVIgKyAnICcgKyBjbGF6ejsKICAgICAgaW5kaWNhdG9yLmNsYXNzTmFtZSA9IENMQVNTX0lORElDQVRPUjsKICAgICAgc2Nyb2xsYmFyLmFwcGVuZENoaWxkKGluZGljYXRvcik7CgogICAgICBpZiAoY2xhenogPT09IENMQVNTX1NDUk9MTEJBUl9WRVJUSUNBTCkgewogICAgICAgIHRoaXMuc2Nyb2xsYmFyWSA9IHNjcm9sbGJhcjsKICAgICAgICB0aGlzLnNjcm9sbGJhckluZGljYXRvclkgPSBpbmRpY2F0b3I7CiAgICAgIH0gZWxzZSBpZiAoY2xhenogPT09IENMQVNTX1NDUk9MTEJBUl9IT1JJWk9OVEFMKSB7CiAgICAgICAgdGhpcy5zY3JvbGxiYXJYID0gc2Nyb2xsYmFyOwogICAgICAgIHRoaXMuc2Nyb2xsYmFySW5kaWNhdG9yWCA9IGluZGljYXRvcjsKICAgICAgfQoKICAgICAgdGhpcy53cmFwcGVyLmFwcGVuZENoaWxkKHNjcm9sbGJhcik7CiAgICAgIHJldHVybiBzY3JvbGxiYXI7CiAgICB9LAogICAgX3ByZXZlbnREZWZhdWx0RXhjZXB0aW9uOiBmdW5jdGlvbiBfcHJldmVudERlZmF1bHRFeGNlcHRpb24oZWwsIGV4Y2VwdGlvbnMpIHsKICAgICAgZm9yICh2YXIgaSBpbiBleGNlcHRpb25zKSB7CiAgICAgICAgaWYgKGV4Y2VwdGlvbnNbaV0udGVzdChlbFtpXSkpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIF9yZUxheW91dDogZnVuY3Rpb24gX3JlTGF5b3V0KCkgewogICAgICBpZiAoIXRoaXMuaGFzSG9yaXpvbnRhbFNjcm9sbCkgewogICAgICAgIHRoaXMubWF4U2Nyb2xsWCA9IDA7CiAgICAgICAgdGhpcy5zY3JvbGxlcldpZHRoID0gdGhpcy53cmFwcGVyV2lkdGg7CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5oYXNWZXJ0aWNhbFNjcm9sbCkgewogICAgICAgIHRoaXMubWF4U2Nyb2xsWSA9IDA7CiAgICAgICAgdGhpcy5zY3JvbGxlckhlaWdodCA9IHRoaXMud3JhcHBlckhlaWdodDsKICAgICAgfQoKICAgICAgdGhpcy5pbmRpY2F0b3JzLm1hcChmdW5jdGlvbiAoaW5kaWNhdG9yKSB7CiAgICAgICAgaW5kaWNhdG9yLnJlZnJlc2goKTsKICAgICAgfSk7IC8v5Lul6Ziyc2xpZGVy57G75bWM5aWX5L2/55SoCgogICAgICBpZiAodGhpcy5vcHRpb25zLnNuYXAgJiYgdHlwZW9mIHRoaXMub3B0aW9ucy5zbmFwID09PSAnc3RyaW5nJykgewogICAgICAgIHZhciBpdGVtcyA9IHRoaXMuc2Nyb2xsZXIucXVlcnlTZWxlY3RvckFsbCh0aGlzLm9wdGlvbnMuc25hcCk7CiAgICAgICAgdGhpcy5pdGVtTGVuZ3RoID0gMDsKICAgICAgICB0aGlzLnNuYXBzID0gW107CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBpdGVtcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgdmFyIGl0ZW0gPSBpdGVtc1tpXTsKCiAgICAgICAgICBpZiAoaXRlbS5wYXJlbnROb2RlID09PSB0aGlzLnNjcm9sbGVyKSB7CiAgICAgICAgICAgIHRoaXMuaXRlbUxlbmd0aCsrOwogICAgICAgICAgICB0aGlzLnNuYXBzLnB1c2goaXRlbSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9pbml0U25hcCgpOyAvL+mcgOimgeavj+asoemDvV9pbml0U25hcOS5iOOAguWFtuWunmluaXTnmoTml7blgJnmiafooYzkuIDmrKHvvIzlkI7nu61yZXNpemXnmoTml7blgJnmiafooYzkuIDmrKHlsLHooYzkuoblkKcu5YWI6L+Z5LmI5YGa5ZCn77yM5aaC5p6c5b2x5ZON5oCn6IO977yM5YaN6LCD5pW0CgogICAgICB9CiAgICB9LAogICAgX21vbWVudHVtOiBmdW5jdGlvbiBfbW9tZW50dW0oY3VycmVudCwgZGlzdGFuY2UsIHRpbWUsIGxvd2VyTWFyZ2luLCB3cmFwcGVyU2l6ZSwgZGVjZWxlcmF0aW9uKSB7CiAgICAgIHZhciBzcGVlZCA9IHBhcnNlRmxvYXQoTWF0aC5hYnMoZGlzdGFuY2UpIC8gdGltZSksCiAgICAgICAgICBkZXN0aW5hdGlvbiwKICAgICAgICAgIGR1cmF0aW9uOwogICAgICBkZWNlbGVyYXRpb24gPSBkZWNlbGVyYXRpb24gPT09IHVuZGVmaW5lZCA/IDAuMDAwNiA6IGRlY2VsZXJhdGlvbjsKICAgICAgZGVzdGluYXRpb24gPSBjdXJyZW50ICsgc3BlZWQgKiBzcGVlZCAvICgyICogZGVjZWxlcmF0aW9uKSAqIChkaXN0YW5jZSA8IDAgPyAtMSA6IDEpOwogICAgICBkdXJhdGlvbiA9IHNwZWVkIC8gZGVjZWxlcmF0aW9uOwoKICAgICAgaWYgKGRlc3RpbmF0aW9uIDwgbG93ZXJNYXJnaW4pIHsKICAgICAgICBkZXN0aW5hdGlvbiA9IHdyYXBwZXJTaXplID8gbG93ZXJNYXJnaW4gLSB3cmFwcGVyU2l6ZSAvIDIuNSAqIChzcGVlZCAvIDgpIDogbG93ZXJNYXJnaW47CiAgICAgICAgZGlzdGFuY2UgPSBNYXRoLmFicyhkZXN0aW5hdGlvbiAtIGN1cnJlbnQpOwogICAgICAgIGR1cmF0aW9uID0gZGlzdGFuY2UgLyBzcGVlZDsKICAgICAgfSBlbHNlIGlmIChkZXN0aW5hdGlvbiA+IDApIHsKICAgICAgICBkZXN0aW5hdGlvbiA9IHdyYXBwZXJTaXplID8gd3JhcHBlclNpemUgLyAyLjUgKiAoc3BlZWQgLyA4KSA6IDA7CiAgICAgICAgZGlzdGFuY2UgPSBNYXRoLmFicyhjdXJyZW50KSArIGRlc3RpbmF0aW9uOwogICAgICAgIGR1cmF0aW9uID0gZGlzdGFuY2UgLyBzcGVlZDsKICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICBkZXN0aW5hdGlvbjogTWF0aC5yb3VuZChkZXN0aW5hdGlvbiksCiAgICAgICAgZHVyYXRpb246IGR1cmF0aW9uCiAgICAgIH07CiAgICB9LAogICAgX2dldFRyYW5zbGF0ZVN0cjogZnVuY3Rpb24gX2dldFRyYW5zbGF0ZVN0cih4LCB5KSB7CiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaGFyZHdhcmVBY2NlbGVyYXRlZCkgewogICAgICAgIHJldHVybiAndHJhbnNsYXRlM2QoJyArIHggKyAncHgsJyArIHkgKyAncHgsMHB4KSAnICsgdGhpcy50cmFuc2xhdGVaOwogICAgICB9CgogICAgICByZXR1cm4gJ3RyYW5zbGF0ZSgnICsgeCArICdweCwnICsgeSArICdweCkgJzsKICAgIH0sCiAgICAvL0FQSQogICAgc2V0U3RvcHBlZDogZnVuY3Rpb24gc2V0U3RvcHBlZChzdG9wcGVkKSB7CiAgICAgIC8vIHRoaXMuc3RvcHBlZCA9ICEhc3RvcHBlZDsKICAgICAgLy8gZml4ZWQgaW9z5Y+Md2Vidmlld+aooeW8j+S4i+aLieWIt+aWsAogICAgICBpZiAoc3RvcHBlZCkgewogICAgICAgIHRoaXMuZGlzYWJsZVB1bGx1cFRvUmVmcmVzaCgpOwogICAgICAgIHRoaXMuZGlzYWJsZVB1bGxkb3duVG9SZWZyZXNoKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5lbmFibGVQdWxsdXBUb1JlZnJlc2goKTsKICAgICAgICB0aGlzLmVuYWJsZVB1bGxkb3duVG9SZWZyZXNoKCk7CiAgICAgIH0KICAgIH0sCiAgICBzZXRUcmFuc2xhdGU6IGZ1bmN0aW9uIHNldFRyYW5zbGF0ZSh4LCB5KSB7CiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMuc2Nyb2xsZXJTdHlsZVsnd2Via2l0VHJhbnNmb3JtJ10gPSB0aGlzLl9nZXRUcmFuc2xhdGVTdHIoeCwgeSk7CgogICAgICBpZiAodGhpcy5wYXJhbGxheEVsZW1lbnQgJiYgdGhpcy5vcHRpb25zLnNjcm9sbFkpIHsKICAgICAgICAvL+ebruWJjeS7heaUr+aMgeerluWQkeinhuW3ruaViOaenAogICAgICAgIHZhciBwYXJhbGxheFkgPSB5ICogdGhpcy5vcHRpb25zLnBhcmFsbGF4UmF0aW87CiAgICAgICAgdmFyIHNjYWxlID0gMSArIHBhcmFsbGF4WSAvICgodGhpcy5wYXJhbGxheEhlaWdodCAtIHBhcmFsbGF4WSkgLyAyKTsKCiAgICAgICAgaWYgKHNjYWxlID4gMSkgewogICAgICAgICAgdGhpcy5wYXJhbGxheEltZ1N0eWxlWydvcGFjaXR5J10gPSAxIC0gcGFyYWxsYXhZIC8gMTAwICogdGhpcy5vcHRpb25zLnBhcmFsbGF4UmF0aW87CiAgICAgICAgICB0aGlzLnBhcmFsbGF4U3R5bGVbJ3dlYmtpdFRyYW5zZm9ybSddID0gdGhpcy5fZ2V0VHJhbnNsYXRlU3RyKDAsIC1wYXJhbGxheFkpICsgJyBzY2FsZSgnICsgc2NhbGUgKyAnLCcgKyBzY2FsZSArICcpJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5wYXJhbGxheEltZ1N0eWxlWydvcGFjaXR5J10gPSAxOwogICAgICAgICAgdGhpcy5wYXJhbGxheFN0eWxlWyd3ZWJraXRUcmFuc2Zvcm0nXSA9IHRoaXMuX2dldFRyYW5zbGF0ZVN0cigwLCAtMSkgKyAnIHNjYWxlKDEsMSknOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuaW5kaWNhdG9ycykgewogICAgICAgIGZvciAodmFyIGkgPSB0aGlzLmluZGljYXRvcnMubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICB0aGlzLmluZGljYXRvcnNbaV0udXBkYXRlUG9zaXRpb24oKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubGFzdFggPSB0aGlzLng7CiAgICAgIHRoaXMubGFzdFkgPSB0aGlzLnk7CiAgICAgICQudHJpZ2dlcih0aGlzLnNjcm9sbGVyLCAnc2Nyb2xsJywgdGhpcyk7CiAgICB9LAogICAgcmVMYXlvdXQ6IGZ1bmN0aW9uIHJlTGF5b3V0KCkgewogICAgICB0aGlzLndyYXBwZXIub2Zmc2V0SGVpZ2h0OwogICAgICB2YXIgcGFkZGluZ0xlZnQgPSBwYXJzZUZsb2F0KCQuZ2V0U3R5bGVzKHRoaXMud3JhcHBlciwgJ3BhZGRpbmctbGVmdCcpKSB8fCAwOwogICAgICB2YXIgcGFkZGluZ1JpZ2h0ID0gcGFyc2VGbG9hdCgkLmdldFN0eWxlcyh0aGlzLndyYXBwZXIsICdwYWRkaW5nLXJpZ2h0JykpIHx8IDA7CiAgICAgIHZhciBwYWRkaW5nVG9wID0gcGFyc2VGbG9hdCgkLmdldFN0eWxlcyh0aGlzLndyYXBwZXIsICdwYWRkaW5nLXRvcCcpKSB8fCAwOwogICAgICB2YXIgcGFkZGluZ0JvdHRvbSA9IHBhcnNlRmxvYXQoJC5nZXRTdHlsZXModGhpcy53cmFwcGVyLCAncGFkZGluZy1ib3R0b20nKSkgfHwgMDsKICAgICAgdmFyIGNsaWVudFdpZHRoID0gdGhpcy53cmFwcGVyLmNsaWVudFdpZHRoOwogICAgICB2YXIgY2xpZW50SGVpZ2h0ID0gdGhpcy53cmFwcGVyLmNsaWVudEhlaWdodDsKICAgICAgdGhpcy5zY3JvbGxlcldpZHRoID0gdGhpcy5zY3JvbGxlci5vZmZzZXRXaWR0aDsKICAgICAgdGhpcy5zY3JvbGxlckhlaWdodCA9IHRoaXMuc2Nyb2xsZXIub2Zmc2V0SGVpZ2h0OwogICAgICB0aGlzLndyYXBwZXJXaWR0aCA9IGNsaWVudFdpZHRoIC0gcGFkZGluZ0xlZnQgLSBwYWRkaW5nUmlnaHQ7CiAgICAgIHRoaXMud3JhcHBlckhlaWdodCA9IGNsaWVudEhlaWdodCAtIHBhZGRpbmdUb3AgLSBwYWRkaW5nQm90dG9tOwogICAgICB0aGlzLm1heFNjcm9sbFggPSBNYXRoLm1pbih0aGlzLndyYXBwZXJXaWR0aCAtIHRoaXMuc2Nyb2xsZXJXaWR0aCwgMCk7CiAgICAgIHRoaXMubWF4U2Nyb2xsWSA9IE1hdGgubWluKHRoaXMud3JhcHBlckhlaWdodCAtIHRoaXMuc2Nyb2xsZXJIZWlnaHQsIDApOwogICAgICB0aGlzLmhhc0hvcml6b250YWxTY3JvbGwgPSB0aGlzLm9wdGlvbnMuc2Nyb2xsWCAmJiB0aGlzLm1heFNjcm9sbFggPCAwOwogICAgICB0aGlzLmhhc1ZlcnRpY2FsU2Nyb2xsID0gdGhpcy5vcHRpb25zLnNjcm9sbFkgJiYgdGhpcy5tYXhTY3JvbGxZIDwgMDsKCiAgICAgIHRoaXMuX3JlTGF5b3V0KCk7CiAgICB9LAogICAgcmVzZXRQb3NpdGlvbjogZnVuY3Rpb24gcmVzZXRQb3NpdGlvbih0aW1lKSB7CiAgICAgIHZhciB4ID0gdGhpcy54LAogICAgICAgICAgeSA9IHRoaXMueTsKICAgICAgdGltZSA9IHRpbWUgfHwgMDsKCiAgICAgIGlmICghdGhpcy5oYXNIb3Jpem9udGFsU2Nyb2xsIHx8IHRoaXMueCA+IDApIHsKICAgICAgICB4ID0gMDsKICAgICAgfSBlbHNlIGlmICh0aGlzLnggPCB0aGlzLm1heFNjcm9sbFgpIHsKICAgICAgICB4ID0gdGhpcy5tYXhTY3JvbGxYOwogICAgICB9CgogICAgICBpZiAoIXRoaXMuaGFzVmVydGljYWxTY3JvbGwgfHwgdGhpcy55ID4gMCkgewogICAgICAgIHkgPSAwOwogICAgICB9IGVsc2UgaWYgKHRoaXMueSA8IHRoaXMubWF4U2Nyb2xsWSkgewogICAgICAgIHkgPSB0aGlzLm1heFNjcm9sbFk7CiAgICAgIH0KCiAgICAgIGlmICh4ID09IHRoaXMueCAmJiB5ID09IHRoaXMueSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgdGhpcy5zY3JvbGxUbyh4LCB5LCB0aW1lLCB0aGlzLm9wdGlvbnMuc2Nyb2xsRWFzaW5nKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAogICAgX3JlSW5pdDogZnVuY3Rpb24gX3JlSW5pdCgpIHsKICAgICAgdmFyIGdyb3VwcyA9IHRoaXMud3JhcHBlci5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIENMQVNTX1NDUk9MTCk7CgogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgaWYgKGdyb3Vwc1tpXS5wYXJlbnROb2RlID09PSB0aGlzLndyYXBwZXIpIHsKICAgICAgICAgIHRoaXMuc2Nyb2xsZXIgPSBncm91cHNbaV07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuc2Nyb2xsZXJTdHlsZSA9IHRoaXMuc2Nyb2xsZXIgJiYgdGhpcy5zY3JvbGxlci5zdHlsZTsKICAgIH0sCiAgICByZWZyZXNoOiBmdW5jdGlvbiByZWZyZXNoKCkgewogICAgICB0aGlzLl9yZUluaXQoKTsKCiAgICAgIHRoaXMucmVMYXlvdXQoKTsKICAgICAgJC50cmlnZ2VyKHRoaXMuc2Nyb2xsZXIsICdyZWZyZXNoJywgdGhpcyk7CiAgICAgIHRoaXMucmVzZXRQb3NpdGlvbigpOwogICAgfSwKICAgIHNjcm9sbFRvOiBmdW5jdGlvbiBzY3JvbGxUbyh4LCB5LCB0aW1lLCBlYXNpbmcpIHsKICAgICAgdmFyIGVhc2luZyA9IGVhc2luZyB8fCBlYXNlLmNpcmN1bGFyOyAvLwkJCXRoaXMuaXNJblRyYW5zaXRpb24gPSB0aW1lID4gMCAmJiAodGhpcy5sYXN0WCAhPSB4IHx8IHRoaXMubGFzdFkgIT0geSk7CiAgICAgIC8v5pqC5LiN5Lil5qC85Yik5pateCx577yM5ZCm5YiZ5Lya5a+86Ie06YOo5YiG54mI5pys5LiK5LiN5q2j5bi46Kem5Y+R6L2u5pKtCgogICAgICB0aGlzLmlzSW5UcmFuc2l0aW9uID0gdGltZSA+IDA7CgogICAgICBpZiAodGhpcy5pc0luVHJhbnNpdGlvbikgewogICAgICAgIHRoaXMuX2NsZWFyUmVxdWVzdEFuaW1hdGlvbkZyYW1lKCk7CgogICAgICAgIHRoaXMuX3RyYW5zaXRpb25UaW1pbmdGdW5jdGlvbihlYXNpbmcuc3R5bGUpOwoKICAgICAgICB0aGlzLl90cmFuc2l0aW9uVGltZSh0aW1lKTsKCiAgICAgICAgdGhpcy5zZXRUcmFuc2xhdGUoeCwgeSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZXRUcmFuc2xhdGUoeCwgeSk7CiAgICAgIH0KICAgIH0sCiAgICBzY3JvbGxUb0JvdHRvbTogZnVuY3Rpb24gc2Nyb2xsVG9Cb3R0b20odGltZSwgZWFzaW5nKSB7CiAgICAgIHRpbWUgPSB0aW1lIHx8IHRoaXMub3B0aW9ucy5zY3JvbGxUaW1lOwogICAgICB0aGlzLnNjcm9sbFRvKDAsIHRoaXMubWF4U2Nyb2xsWSwgdGltZSwgZWFzaW5nKTsKICAgIH0sCiAgICBnb3RvUGFnZTogZnVuY3Rpb24gZ290b1BhZ2UoaW5kZXgpIHsKICAgICAgdGhpcy5fZ290b1BhZ2UoaW5kZXgpOwogICAgfSwKICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgIHRoaXMuX2luaXRFdmVudCh0cnVlKTsgLy9kZXRhY2gKCgogICAgICBkZWxldGUgJC5kYXRhW3RoaXMud3JhcHBlci5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2Nyb2xsJyldOwogICAgICB0aGlzLndyYXBwZXIuc2V0QXR0cmlidXRlKCdkYXRhLXNjcm9sbCcsICcnKTsKICAgIH0KICB9KTsgLy9JbmRpY2F0b3IKCiAgdmFyIEluZGljYXRvciA9IGZ1bmN0aW9uIEluZGljYXRvcihzY3JvbGxlciwgb3B0aW9ucykgewogICAgdGhpcy53cmFwcGVyID0gdHlwZW9mIG9wdGlvbnMuZWwgPT0gJ3N0cmluZycgPyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMuZWwpIDogb3B0aW9ucy5lbDsKICAgIHRoaXMud3JhcHBlclN0eWxlID0gdGhpcy53cmFwcGVyLnN0eWxlOwogICAgdGhpcy5pbmRpY2F0b3IgPSB0aGlzLndyYXBwZXIuY2hpbGRyZW5bMF07CiAgICB0aGlzLmluZGljYXRvclN0eWxlID0gdGhpcy5pbmRpY2F0b3Iuc3R5bGU7CiAgICB0aGlzLnNjcm9sbGVyID0gc2Nyb2xsZXI7CiAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7CiAgICAgIGxpc3Rlblg6IHRydWUsCiAgICAgIGxpc3Rlblk6IHRydWUsCiAgICAgIGZhZGU6IGZhbHNlLAogICAgICBzcGVlZFJhdGlvWDogMCwKICAgICAgc3BlZWRSYXRpb1k6IDAKICAgIH0sIG9wdGlvbnMpOwogICAgdGhpcy5zaXplUmF0aW9YID0gMTsKICAgIHRoaXMuc2l6ZVJhdGlvWSA9IDE7CiAgICB0aGlzLm1heFBvc1ggPSAwOwogICAgdGhpcy5tYXhQb3NZID0gMDsKCiAgICBpZiAodGhpcy5vcHRpb25zLmZhZGUpIHsKICAgICAgdGhpcy53cmFwcGVyU3R5bGVbJ3dlYmtpdFRyYW5zZm9ybSddID0gdGhpcy5zY3JvbGxlci50cmFuc2xhdGVaOwogICAgICB0aGlzLndyYXBwZXJTdHlsZVsnd2Via2l0VHJhbnNpdGlvbkR1cmF0aW9uJ10gPSB0aGlzLm9wdGlvbnMuZml4ZWRCYWRBbmRvcmlkICYmICQub3MuaXNCYWRBbmRyb2lkID8gJzAuMDAxcycgOiAnMG1zJzsKICAgICAgdGhpcy53cmFwcGVyU3R5bGUub3BhY2l0eSA9ICcwJzsKICAgIH0KICB9OwoKICBJbmRpY2F0b3IucHJvdG90eXBlID0gewogICAgaGFuZGxlRXZlbnQ6IGZ1bmN0aW9uIGhhbmRsZUV2ZW50KGUpIHt9LAogICAgdHJhbnNpdGlvblRpbWU6IGZ1bmN0aW9uIHRyYW5zaXRpb25UaW1lKHRpbWUpIHsKICAgICAgdGltZSA9IHRpbWUgfHwgMDsKICAgICAgdGhpcy5pbmRpY2F0b3JTdHlsZVsnd2Via2l0VHJhbnNpdGlvbkR1cmF0aW9uJ10gPSB0aW1lICsgJ21zJzsKCiAgICAgIGlmICh0aGlzLnNjcm9sbGVyLm9wdGlvbnMuZml4ZWRCYWRBbmRvcmlkICYmICF0aW1lICYmICQub3MuaXNCYWRBbmRyb2lkKSB7CiAgICAgICAgdGhpcy5pbmRpY2F0b3JTdHlsZVsnd2Via2l0VHJhbnNpdGlvbkR1cmF0aW9uJ10gPSAnMC4wMDFzJzsKICAgICAgfQogICAgfSwKICAgIHRyYW5zaXRpb25UaW1pbmdGdW5jdGlvbjogZnVuY3Rpb24gdHJhbnNpdGlvblRpbWluZ0Z1bmN0aW9uKGVhc2luZykgewogICAgICB0aGlzLmluZGljYXRvclN0eWxlWyd3ZWJraXRUcmFuc2l0aW9uVGltaW5nRnVuY3Rpb24nXSA9IGVhc2luZzsKICAgIH0sCiAgICByZWZyZXNoOiBmdW5jdGlvbiByZWZyZXNoKCkgewogICAgICB0aGlzLnRyYW5zaXRpb25UaW1lKCk7CgogICAgICBpZiAodGhpcy5vcHRpb25zLmxpc3RlblggJiYgIXRoaXMub3B0aW9ucy5saXN0ZW5ZKSB7CiAgICAgICAgdGhpcy5pbmRpY2F0b3JTdHlsZS5kaXNwbGF5ID0gdGhpcy5zY3JvbGxlci5oYXNIb3Jpem9udGFsU2Nyb2xsID8gJ2Jsb2NrJyA6ICdub25lJzsKICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMubGlzdGVuWSAmJiAhdGhpcy5vcHRpb25zLmxpc3RlblgpIHsKICAgICAgICB0aGlzLmluZGljYXRvclN0eWxlLmRpc3BsYXkgPSB0aGlzLnNjcm9sbGVyLmhhc1ZlcnRpY2FsU2Nyb2xsID8gJ2Jsb2NrJyA6ICdub25lJzsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmluZGljYXRvclN0eWxlLmRpc3BsYXkgPSB0aGlzLnNjcm9sbGVyLmhhc0hvcml6b250YWxTY3JvbGwgfHwgdGhpcy5zY3JvbGxlci5oYXNWZXJ0aWNhbFNjcm9sbCA/ICdibG9jaycgOiAnbm9uZSc7CiAgICAgIH0KCiAgICAgIHRoaXMud3JhcHBlci5vZmZzZXRIZWlnaHQ7IC8vIGZvcmNlIHJlZnJlc2gKCiAgICAgIGlmICh0aGlzLm9wdGlvbnMubGlzdGVuWCkgewogICAgICAgIHRoaXMud3JhcHBlcldpZHRoID0gdGhpcy53cmFwcGVyLmNsaWVudFdpZHRoOwogICAgICAgIHRoaXMuaW5kaWNhdG9yV2lkdGggPSBNYXRoLm1heChNYXRoLnJvdW5kKHRoaXMud3JhcHBlcldpZHRoICogdGhpcy53cmFwcGVyV2lkdGggLyAodGhpcy5zY3JvbGxlci5zY3JvbGxlcldpZHRoIHx8IHRoaXMud3JhcHBlcldpZHRoIHx8IDEpKSwgOCk7CiAgICAgICAgdGhpcy5pbmRpY2F0b3JTdHlsZS53aWR0aCA9IHRoaXMuaW5kaWNhdG9yV2lkdGggKyAncHgnOwogICAgICAgIHRoaXMubWF4UG9zWCA9IHRoaXMud3JhcHBlcldpZHRoIC0gdGhpcy5pbmRpY2F0b3JXaWR0aDsKICAgICAgICB0aGlzLm1pbkJvdW5kYXJ5WCA9IDA7CiAgICAgICAgdGhpcy5tYXhCb3VuZGFyeVggPSB0aGlzLm1heFBvc1g7CiAgICAgICAgdGhpcy5zaXplUmF0aW9YID0gdGhpcy5vcHRpb25zLnNwZWVkUmF0aW9YIHx8IHRoaXMuc2Nyb2xsZXIubWF4U2Nyb2xsWCAmJiB0aGlzLm1heFBvc1ggLyB0aGlzLnNjcm9sbGVyLm1heFNjcm9sbFg7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLm9wdGlvbnMubGlzdGVuWSkgewogICAgICAgIHRoaXMud3JhcHBlckhlaWdodCA9IHRoaXMud3JhcHBlci5jbGllbnRIZWlnaHQ7CiAgICAgICAgdGhpcy5pbmRpY2F0b3JIZWlnaHQgPSBNYXRoLm1heChNYXRoLnJvdW5kKHRoaXMud3JhcHBlckhlaWdodCAqIHRoaXMud3JhcHBlckhlaWdodCAvICh0aGlzLnNjcm9sbGVyLnNjcm9sbGVySGVpZ2h0IHx8IHRoaXMud3JhcHBlckhlaWdodCB8fCAxKSksIDgpOwogICAgICAgIHRoaXMuaW5kaWNhdG9yU3R5bGUuaGVpZ2h0ID0gdGhpcy5pbmRpY2F0b3JIZWlnaHQgKyAncHgnOwogICAgICAgIHRoaXMubWF4UG9zWSA9IHRoaXMud3JhcHBlckhlaWdodCAtIHRoaXMuaW5kaWNhdG9ySGVpZ2h0OwogICAgICAgIHRoaXMubWluQm91bmRhcnlZID0gMDsKICAgICAgICB0aGlzLm1heEJvdW5kYXJ5WSA9IHRoaXMubWF4UG9zWTsKICAgICAgICB0aGlzLnNpemVSYXRpb1kgPSB0aGlzLm9wdGlvbnMuc3BlZWRSYXRpb1kgfHwgdGhpcy5zY3JvbGxlci5tYXhTY3JvbGxZICYmIHRoaXMubWF4UG9zWSAvIHRoaXMuc2Nyb2xsZXIubWF4U2Nyb2xsWTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVQb3NpdGlvbigpOwogICAgfSwKICAgIHVwZGF0ZVBvc2l0aW9uOiBmdW5jdGlvbiB1cGRhdGVQb3NpdGlvbigpIHsKICAgICAgdmFyIHggPSB0aGlzLm9wdGlvbnMubGlzdGVuWCAmJiBNYXRoLnJvdW5kKHRoaXMuc2l6ZVJhdGlvWCAqIHRoaXMuc2Nyb2xsZXIueCkgfHwgMCwKICAgICAgICAgIHkgPSB0aGlzLm9wdGlvbnMubGlzdGVuWSAmJiBNYXRoLnJvdW5kKHRoaXMuc2l6ZVJhdGlvWSAqIHRoaXMuc2Nyb2xsZXIueSkgfHwgMDsKCiAgICAgIGlmICh4IDwgdGhpcy5taW5Cb3VuZGFyeVgpIHsKICAgICAgICB0aGlzLndpZHRoID0gTWF0aC5tYXgodGhpcy5pbmRpY2F0b3JXaWR0aCArIHgsIDgpOwogICAgICAgIHRoaXMuaW5kaWNhdG9yU3R5bGUud2lkdGggPSB0aGlzLndpZHRoICsgJ3B4JzsKICAgICAgICB4ID0gdGhpcy5taW5Cb3VuZGFyeVg7CiAgICAgIH0gZWxzZSBpZiAoeCA+IHRoaXMubWF4Qm91bmRhcnlYKSB7CiAgICAgICAgdGhpcy53aWR0aCA9IE1hdGgubWF4KHRoaXMuaW5kaWNhdG9yV2lkdGggLSAoeCAtIHRoaXMubWF4UG9zWCksIDgpOwogICAgICAgIHRoaXMuaW5kaWNhdG9yU3R5bGUud2lkdGggPSB0aGlzLndpZHRoICsgJ3B4JzsKICAgICAgICB4ID0gdGhpcy5tYXhQb3NYICsgdGhpcy5pbmRpY2F0b3JXaWR0aCAtIHRoaXMud2lkdGg7CiAgICAgIH0gZWxzZSBpZiAodGhpcy53aWR0aCAhPSB0aGlzLmluZGljYXRvcldpZHRoKSB7CiAgICAgICAgdGhpcy53aWR0aCA9IHRoaXMuaW5kaWNhdG9yV2lkdGg7CiAgICAgICAgdGhpcy5pbmRpY2F0b3JTdHlsZS53aWR0aCA9IHRoaXMud2lkdGggKyAncHgnOwogICAgICB9CgogICAgICBpZiAoeSA8IHRoaXMubWluQm91bmRhcnlZKSB7CiAgICAgICAgdGhpcy5oZWlnaHQgPSBNYXRoLm1heCh0aGlzLmluZGljYXRvckhlaWdodCArIHkgKiAzLCA4KTsKICAgICAgICB0aGlzLmluZGljYXRvclN0eWxlLmhlaWdodCA9IHRoaXMuaGVpZ2h0ICsgJ3B4JzsKICAgICAgICB5ID0gdGhpcy5taW5Cb3VuZGFyeVk7CiAgICAgIH0gZWxzZSBpZiAoeSA+IHRoaXMubWF4Qm91bmRhcnlZKSB7CiAgICAgICAgdGhpcy5oZWlnaHQgPSBNYXRoLm1heCh0aGlzLmluZGljYXRvckhlaWdodCAtICh5IC0gdGhpcy5tYXhQb3NZKSAqIDMsIDgpOwogICAgICAgIHRoaXMuaW5kaWNhdG9yU3R5bGUuaGVpZ2h0ID0gdGhpcy5oZWlnaHQgKyAncHgnOwogICAgICAgIHkgPSB0aGlzLm1heFBvc1kgKyB0aGlzLmluZGljYXRvckhlaWdodCAtIHRoaXMuaGVpZ2h0OwogICAgICB9IGVsc2UgaWYgKHRoaXMuaGVpZ2h0ICE9IHRoaXMuaW5kaWNhdG9ySGVpZ2h0KSB7CiAgICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLmluZGljYXRvckhlaWdodDsKICAgICAgICB0aGlzLmluZGljYXRvclN0eWxlLmhlaWdodCA9IHRoaXMuaGVpZ2h0ICsgJ3B4JzsKICAgICAgfQoKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy5pbmRpY2F0b3JTdHlsZVsnd2Via2l0VHJhbnNmb3JtJ10gPSB0aGlzLnNjcm9sbGVyLl9nZXRUcmFuc2xhdGVTdHIoeCwgeSk7CiAgICB9LAogICAgZmFkZTogZnVuY3Rpb24gZmFkZSh2YWwsIGhvbGQpIHsKICAgICAgaWYgKGhvbGQgJiYgIXRoaXMudmlzaWJsZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZmFkZVRpbWVvdXQpOwogICAgICB0aGlzLmZhZGVUaW1lb3V0ID0gbnVsbDsKICAgICAgdmFyIHRpbWUgPSB2YWwgPyAyNTAgOiA1MDAsCiAgICAgICAgICBkZWxheSA9IHZhbCA/IDAgOiAzMDA7CiAgICAgIHZhbCA9IHZhbCA/ICcxJyA6ICcwJzsKICAgICAgdGhpcy53cmFwcGVyU3R5bGVbJ3dlYmtpdFRyYW5zaXRpb25EdXJhdGlvbiddID0gdGltZSArICdtcyc7CiAgICAgIHRoaXMuZmFkZVRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICB0aGlzLndyYXBwZXJTdHlsZS5vcGFjaXR5ID0gdmFsOwogICAgICAgIHRoaXMudmlzaWJsZSA9ICt2YWw7CiAgICAgIH0uYmluZCh0aGlzLCB2YWwpLCBkZWxheSk7CiAgICB9CiAgfTsKICAkLlNjcm9sbCA9IFNjcm9sbDsKCiAgJC5mbi5zY3JvbGwgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgdmFyIHNjcm9sbEFwaXMgPSBbXTsKICAgIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBzY3JvbGxBcGkgPSBudWxsOwogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHZhciBpZCA9IHNlbGYuZ2V0QXR0cmlidXRlKCdkYXRhLXNjcm9sbCcpOwoKICAgICAgaWYgKCFpZCkgewogICAgICAgIGlkID0gKyskLnV1aWQ7CgogICAgICAgIHZhciBfb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBvcHRpb25zKTsKCiAgICAgICAgaWYgKHNlbGYuY2xhc3NMaXN0LmNvbnRhaW5zKCdtdWktc2VnbWVudGVkLWNvbnRyb2wnKSkgewogICAgICAgICAgX29wdGlvbnMgPSAkLmV4dGVuZChfb3B0aW9ucywgewogICAgICAgICAgICBzY3JvbGxZOiBmYWxzZSwKICAgICAgICAgICAgc2Nyb2xsWDogdHJ1ZSwKICAgICAgICAgICAgaW5kaWNhdG9yczogZmFsc2UsCiAgICAgICAgICAgIHNuYXA6ICcubXVpLWNvbnRyb2wtaXRlbScKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgJC5kYXRhW2lkXSA9IHNjcm9sbEFwaSA9IG5ldyBTY3JvbGwoc2VsZiwgX29wdGlvbnMpOwogICAgICAgIHNlbGYuc2V0QXR0cmlidXRlKCdkYXRhLXNjcm9sbCcsIGlkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzY3JvbGxBcGkgPSAkLmRhdGFbaWRdOwogICAgICB9CgogICAgICBzY3JvbGxBcGlzLnB1c2goc2Nyb2xsQXBpKTsKICAgIH0pOwogICAgcmV0dXJuIHNjcm9sbEFwaXMubGVuZ3RoID09PSAxID8gc2Nyb2xsQXBpc1swXSA6IHNjcm9sbEFwaXM7CiAgfTsKfSkobXVpLCB3aW5kb3csIGRvY3VtZW50KTsKCihmdW5jdGlvbiAoJCwgd2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7CiAgdmFyIENMQVNTX1ZJU0lCSUxJVFkgPSAnbXVpLXZpc2liaWxpdHknOwogIHZhciBDTEFTU19ISURERU4gPSAnbXVpLWhpZGRlbic7CiAgdmFyIFB1bGxSZWZyZXNoID0gJC5TY3JvbGwuZXh0ZW5kKCQuZXh0ZW5kKHsKICAgIGhhbmRsZUV2ZW50OiBmdW5jdGlvbiBoYW5kbGVFdmVudChlKSB7CiAgICAgIHRoaXMuX3N1cGVyKGUpOwoKICAgICAgaWYgKGUudHlwZSA9PT0gJ3Njcm9sbGJvdHRvbScpIHsKICAgICAgICBpZiAoZS50YXJnZXQgPT09IHRoaXMuc2Nyb2xsZXIpIHsKICAgICAgICAgIHRoaXMuX3Njcm9sbGJvdHRvbSgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIF9zY3JvbGxib3R0b206IGZ1bmN0aW9uIF9zY3JvbGxib3R0b20oKSB7CiAgICAgIGlmICghdGhpcy5wdWxsZG93biAmJiAhdGhpcy5sb2FkaW5nKSB7CiAgICAgICAgdGhpcy5wdWxsZG93biA9IGZhbHNlOwoKICAgICAgICB0aGlzLl9pbml0UHVsbHVwUmVmcmVzaCgpOwoKICAgICAgICB0aGlzLnB1bGx1cExvYWRpbmcoKTsKICAgICAgfQogICAgfSwKICAgIF9zdGFydDogZnVuY3Rpb24gX3N0YXJ0KGUpIHsKICAgICAgLy/ku4XkuIvmi4nliLfmlrDlnKhzdGFydOmYu+atoum7mOiupOS6i+S7tgogICAgICBpZiAoZS50b3VjaGVzICYmIGUudG91Y2hlcy5sZW5ndGggJiYgZS50b3VjaGVzWzBdLmNsaWVudFggPiAzMCkgewogICAgICAgIGUudGFyZ2V0ICYmICF0aGlzLl9wcmV2ZW50RGVmYXVsdEV4Y2VwdGlvbihlLnRhcmdldCwgdGhpcy5vcHRpb25zLnByZXZlbnREZWZhdWx0RXhjZXB0aW9uKSAmJiBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5sb2FkaW5nKSB7CiAgICAgICAgdGhpcy5wdWxsZG93biA9IHRoaXMucHVsbFBvY2tldCA9IHRoaXMucHVsbENhcHRpb24gPSB0aGlzLnB1bGxMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIHRoaXMuX3N1cGVyKGUpOwogICAgfSwKICAgIF9kcmFnOiBmdW5jdGlvbiBfZHJhZyhlKSB7CiAgICAgIGlmICh0aGlzLnkgPj0gMCAmJiB0aGlzLmRpc2FibGVQdWxsZG93biAmJiBlLmRldGFpbC5kaXJlY3Rpb24gPT09ICdkb3duJykgewogICAgICAgIC8v56aB55So5LiL5ouJ5Yi35pawCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLl9zdXBlcihlKTsKCiAgICAgIGlmICghdGhpcy5wdWxsZG93biAmJiAhdGhpcy5sb2FkaW5nICYmIHRoaXMudG9wUG9ja2V0ICYmIGUuZGV0YWlsLmRpcmVjdGlvbiA9PT0gJ2Rvd24nICYmIHRoaXMueSA+PSAwKSB7CiAgICAgICAgdGhpcy5faW5pdFB1bGxkb3duUmVmcmVzaCgpOwogICAgICB9CgogICAgICBpZiAodGhpcy5wdWxsZG93bikgewogICAgICAgIHRoaXMuX3NldENhcHRpb24odGhpcy55ID4gdGhpcy5vcHRpb25zLmRvd24uaGVpZ2h0ID8gdGhpcy5vcHRpb25zLmRvd24uY29udGVudG92ZXIgOiB0aGlzLm9wdGlvbnMuZG93bi5jb250ZW50ZG93bik7CiAgICAgIH0KICAgIH0sCiAgICBfcmVMYXlvdXQ6IGZ1bmN0aW9uIF9yZUxheW91dCgpIHsKICAgICAgdGhpcy5oYXNWZXJ0aWNhbFNjcm9sbCA9IHRydWU7CgogICAgICB0aGlzLl9zdXBlcigpOwogICAgfSwKICAgIC8vQVBJCiAgICByZXNldFBvc2l0aW9uOiBmdW5jdGlvbiByZXNldFBvc2l0aW9uKHRpbWUpIHsKICAgICAgaWYgKHRoaXMucHVsbGRvd24gJiYgIXRoaXMuZGlzYWJsZVB1bGxkb3duKSB7CiAgICAgICAgaWYgKHRoaXMueSA+PSB0aGlzLm9wdGlvbnMuZG93bi5oZWlnaHQpIHsKICAgICAgICAgIHRoaXMucHVsbGRvd25Mb2FkaW5nKHVuZGVmaW5lZCwgdGltZSB8fCAwKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAhdGhpcy5sb2FkaW5nICYmIHRoaXMudG9wUG9ja2V0LmNsYXNzTGlzdC5yZW1vdmUoQ0xBU1NfVklTSUJJTElUWSk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5fc3VwZXIodGltZSk7CiAgICB9LAogICAgcHVsbGRvd25Mb2FkaW5nOiBmdW5jdGlvbiBwdWxsZG93bkxvYWRpbmcoeSwgdGltZSkgewogICAgICB0eXBlb2YgeSA9PT0gJ3VuZGVmaW5lZCcgJiYgKHkgPSB0aGlzLm9wdGlvbnMuZG93bi5oZWlnaHQpOyAvL+m7mOiupOmrmOW6pgoKICAgICAgdGhpcy5zY3JvbGxUbygwLCB5LCB0aW1lLCB0aGlzLm9wdGlvbnMuYm91bmNlRWFzaW5nKTsKCiAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8JCQlpZiAoIXRoaXMucHVsbGRvd24pIHsKCgogICAgICB0aGlzLl9pbml0UHVsbGRvd25SZWZyZXNoKCk7IC8vCQkJfQoKCiAgICAgIHRoaXMuX3NldENhcHRpb24odGhpcy5vcHRpb25zLmRvd24uY29udGVudHJlZnJlc2gpOwoKICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKICAgICAgdGhpcy5pbmRpY2F0b3JzLm1hcChmdW5jdGlvbiAoaW5kaWNhdG9yKSB7CiAgICAgICAgaW5kaWNhdG9yLmZhZGUoMCk7CiAgICAgIH0pOwogICAgICB2YXIgY2FsbGJhY2sgPSB0aGlzLm9wdGlvbnMuZG93bi5jYWxsYmFjazsKICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbCh0aGlzKTsKICAgIH0sCiAgICBlbmRQdWxsZG93blRvUmVmcmVzaDogZnVuY3Rpb24gZW5kUHVsbGRvd25Ub1JlZnJlc2goKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgIGlmIChzZWxmLnRvcFBvY2tldCAmJiBzZWxmLmxvYWRpbmcgJiYgdGhpcy5wdWxsZG93bikgewogICAgICAgIHNlbGYuc2Nyb2xsVG8oMCwgMCwgc2VsZi5vcHRpb25zLmJvdW5jZVRpbWUsIHNlbGYub3B0aW9ucy5ib3VuY2VFYXNpbmcpOwogICAgICAgIHNlbGYubG9hZGluZyA9IGZhbHNlOwoKICAgICAgICBzZWxmLl9zZXRDYXB0aW9uKHNlbGYub3B0aW9ucy5kb3duLmNvbnRlbnRkb3duLCB0cnVlKTsKCiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBzZWxmLmxvYWRpbmcgfHwgc2VsZi50b3BQb2NrZXQuY2xhc3NMaXN0LnJlbW92ZShDTEFTU19WSVNJQklMSVRZKTsKICAgICAgICB9LCAzNTApOwogICAgICB9CiAgICB9LAogICAgcHVsbHVwTG9hZGluZzogZnVuY3Rpb24gcHVsbHVwTG9hZGluZyhjYWxsYmFjaywgeCwgdGltZSkgewogICAgICB4ID0geCB8fCAwOwogICAgICB0aGlzLnNjcm9sbFRvKHgsIHRoaXMubWF4U2Nyb2xsWSwgdGltZSwgdGhpcy5vcHRpb25zLmJvdW5jZUVhc2luZyk7CgogICAgICBpZiAodGhpcy5sb2FkaW5nKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLl9pbml0UHVsbHVwUmVmcmVzaCgpOwoKICAgICAgdGhpcy5fc2V0Q2FwdGlvbih0aGlzLm9wdGlvbnMudXAuY29udGVudHJlZnJlc2gpOwoKICAgICAgdGhpcy5pbmRpY2F0b3JzLm1hcChmdW5jdGlvbiAoaW5kaWNhdG9yKSB7CiAgICAgICAgaW5kaWNhdG9yLmZhZGUoMCk7CiAgICAgIH0pOwogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwogICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IHRoaXMub3B0aW9ucy51cC5jYWxsYmFjazsKICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbCh0aGlzKTsKICAgIH0sCiAgICBlbmRQdWxsdXBUb1JlZnJlc2g6IGZ1bmN0aW9uIGVuZFB1bGx1cFRvUmVmcmVzaChmaW5pc2hlZCkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICBpZiAoc2VsZi5ib3R0b21Qb2NrZXQpIHsKICAgICAgICAvLyAmJiBzZWxmLmxvYWRpbmcgJiYgIXRoaXMucHVsbGRvd24KICAgICAgICBzZWxmLmxvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgaWYgKGZpbmlzaGVkKSB7CiAgICAgICAgICB0aGlzLmZpbmlzaGVkID0gdHJ1ZTsKCiAgICAgICAgICBzZWxmLl9zZXRDYXB0aW9uKHNlbGYub3B0aW9ucy51cC5jb250ZW50bm9tb3JlKTsgLy8JCQkJCXNlbGYuYm90dG9tUG9ja2V0LmNsYXNzTGlzdC5yZW1vdmUoQ0xBU1NfVklTSUJJTElUWSk7CiAgICAgICAgICAvLwkJCQkJc2VsZi5ib3R0b21Qb2NrZXQuY2xhc3NMaXN0LmFkZChDTEFTU19ISURERU4pOwoKCiAgICAgICAgICBzZWxmLndyYXBwZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsYm90dG9tJywgc2VsZik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNlbGYuX3NldENhcHRpb24oc2VsZi5vcHRpb25zLnVwLmNvbnRlbnRkb3duKTsgLy8JCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgoKICAgICAgICAgIHNlbGYubG9hZGluZyB8fCBzZWxmLmJvdHRvbVBvY2tldC5jbGFzc0xpc3QucmVtb3ZlKENMQVNTX1ZJU0lCSUxJVFkpOyAvLwkJCQkJfSwgMzAwKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBkaXNhYmxlUHVsbHVwVG9SZWZyZXNoOiBmdW5jdGlvbiBkaXNhYmxlUHVsbHVwVG9SZWZyZXNoKCkgewogICAgICB0aGlzLl9pbml0UHVsbHVwUmVmcmVzaCgpOwoKICAgICAgdGhpcy5ib3R0b21Qb2NrZXQuY2xhc3NOYW1lID0gJ211aS1wdWxsLWJvdHRvbS1wb2NrZXQnICsgJyAnICsgQ0xBU1NfSElEREVOOwogICAgICB0aGlzLndyYXBwZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsYm90dG9tJywgdGhpcyk7CiAgICB9LAogICAgZGlzYWJsZVB1bGxkb3duVG9SZWZyZXNoOiBmdW5jdGlvbiBkaXNhYmxlUHVsbGRvd25Ub1JlZnJlc2goKSB7CiAgICAgIHRoaXMuX2luaXRQdWxsZG93blJlZnJlc2goKTsKCiAgICAgIHRoaXMudG9wUG9ja2V0LmNsYXNzTmFtZSA9ICdtdWktcHVsbC10b3AtcG9ja2V0JyArICcgJyArIENMQVNTX0hJRERFTjsKICAgICAgdGhpcy5kaXNhYmxlUHVsbGRvd24gPSB0cnVlOwogICAgfSwKICAgIGVuYWJsZVB1bGxkb3duVG9SZWZyZXNoOiBmdW5jdGlvbiBlbmFibGVQdWxsZG93blRvUmVmcmVzaCgpIHsKICAgICAgdGhpcy5faW5pdFB1bGxkb3duUmVmcmVzaCgpOwoKICAgICAgdGhpcy50b3BQb2NrZXQuY2xhc3NMaXN0LnJlbW92ZShDTEFTU19ISURERU4pOwoKICAgICAgdGhpcy5fc2V0Q2FwdGlvbih0aGlzLm9wdGlvbnMuZG93bi5jb250ZW50ZG93bik7CgogICAgICB0aGlzLmRpc2FibGVQdWxsZG93biA9IGZhbHNlOwogICAgfSwKICAgIGVuYWJsZVB1bGx1cFRvUmVmcmVzaDogZnVuY3Rpb24gZW5hYmxlUHVsbHVwVG9SZWZyZXNoKCkgewogICAgICB0aGlzLl9pbml0UHVsbHVwUmVmcmVzaCgpOwoKICAgICAgdGhpcy5ib3R0b21Qb2NrZXQuY2xhc3NMaXN0LnJlbW92ZShDTEFTU19ISURERU4pOwoKICAgICAgdGhpcy5fc2V0Q2FwdGlvbih0aGlzLm9wdGlvbnMudXAuY29udGVudGRvd24pOwoKICAgICAgdGhpcy53cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbGJvdHRvbScsIHRoaXMpOwogICAgfSwKICAgIHJlZnJlc2g6IGZ1bmN0aW9uIHJlZnJlc2goaXNSZXNldCkgewogICAgICBpZiAoaXNSZXNldCAmJiB0aGlzLmZpbmlzaGVkKSB7CiAgICAgICAgdGhpcy5lbmFibGVQdWxsdXBUb1JlZnJlc2goKTsKICAgICAgICB0aGlzLmZpbmlzaGVkID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIHRoaXMuX3N1cGVyKCk7CiAgICB9CiAgfSwgJC5QdWxsUmVmcmVzaCkpOwoKICAkLmZuLnB1bGxSZWZyZXNoID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMSkgewogICAgICB2YXIgc2VsZiA9IHRoaXNbMF07CiAgICAgIHZhciBwdWxsUmVmcmVzaEFwaSA9IG51bGw7CiAgICAgIHZhciBpZCA9IHNlbGYuZ2V0QXR0cmlidXRlKCdkYXRhLXB1bGxyZWZyZXNoJyk7CgogICAgICBpZiAoIWlkICYmIHR5cGVvZiBvcHRpb25zID09PSAndW5kZWZpbmVkJykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogICAgICBpZiAoIWlkKSB7CiAgICAgICAgaWQgPSArKyQudXVpZDsKICAgICAgICAkLmRhdGFbaWRdID0gcHVsbFJlZnJlc2hBcGkgPSBuZXcgUHVsbFJlZnJlc2goc2VsZiwgb3B0aW9ucyk7CiAgICAgICAgc2VsZi5zZXRBdHRyaWJ1dGUoJ2RhdGEtcHVsbHJlZnJlc2gnLCBpZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHVsbFJlZnJlc2hBcGkgPSAkLmRhdGFbaWRdOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5kb3duICYmIG9wdGlvbnMuZG93bi5hdXRvKSB7CiAgICAgICAgLy/lpoLmnpzorr7nva7kuoZhdXRv77yM5YiZ6Ieq5Yqo5LiL5ouJ5LiA5qyhCiAgICAgICAgcHVsbFJlZnJlc2hBcGkucHVsbGRvd25Mb2FkaW5nKG9wdGlvbnMuZG93bi5hdXRvWSk7CiAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy51cCAmJiBvcHRpb25zLnVwLmF1dG8pIHsKICAgICAgICAvL+WmguaenOiuvue9ruS6hmF1dG/vvIzliJnoh6rliqjkuIrmi4nkuIDmrKEKICAgICAgICBwdWxsUmVmcmVzaEFwaS5wdWxsdXBMb2FkaW5nKCk7CiAgICAgIH0gLy/mmoLkuI3mj5Dkvpvov5nnp43osIPnlKjmlrnlvI/lkKcJCQkKICAgICAgLy8JCQlpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgIC8vCQkJCXZhciBtZXRob2RWYWx1ZSA9IHB1bGxSZWZyZXNoQXBpW29wdGlvbnNdLmFwcGx5KHB1bGxSZWZyZXNoQXBpLCAkLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgICAgIC8vCQkJCWlmIChtZXRob2RWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIC8vCQkJCQlyZXR1cm4gbWV0aG9kVmFsdWU7CiAgICAgIC8vCQkJCX0KICAgICAgLy8JCQl9CgoKICAgICAgcmV0dXJuIHB1bGxSZWZyZXNoQXBpOwogICAgfQogIH07Cn0pKG11aSwgd2luZG93LCBkb2N1bWVudCk7Ci8qKgogKiBzbmFwIOmHjeaehAogKiBAcGFyYW0ge09iamVjdH0gJAogKiBAcGFyYW0ge09iamVjdH0gd2luZG93CiAqLwoKCihmdW5jdGlvbiAoJCwgd2luZG93KSB7CiAgdmFyIENMQVNTX1NMSURFUiA9ICdtdWktc2xpZGVyJzsKICB2YXIgQ0xBU1NfU0xJREVSX0dST1VQID0gJ211aS1zbGlkZXItZ3JvdXAnOwogIHZhciBDTEFTU19TTElERVJfTE9PUCA9ICdtdWktc2xpZGVyLWxvb3AnOwogIHZhciBDTEFTU19TTElERVJfSU5ESUNBVE9SID0gJ211aS1zbGlkZXItaW5kaWNhdG9yJzsKICB2YXIgQ0xBU1NfQUNUSU9OX1BSRVZJT1VTID0gJ211aS1hY3Rpb24tcHJldmlvdXMnOwogIHZhciBDTEFTU19BQ1RJT05fTkVYVCA9ICdtdWktYWN0aW9uLW5leHQnOwogIHZhciBDTEFTU19TTElERVJfSVRFTSA9ICdtdWktc2xpZGVyLWl0ZW0nOwogIHZhciBDTEFTU19BQ1RJVkUgPSAnbXVpLWFjdGl2ZSc7CiAgdmFyIFNFTEVDVE9SX1NMSURFUl9JVEVNID0gJy4nICsgQ0xBU1NfU0xJREVSX0lURU07CiAgdmFyIFNFTEVDVE9SX1NMSURFUl9JTkRJQ0FUT1IgPSAnLicgKyBDTEFTU19TTElERVJfSU5ESUNBVE9SOwogIHZhciBTRUxFQ1RPUl9TTElERVJfUFJPR1JFU1NfQkFSID0gJy5tdWktc2xpZGVyLXByb2dyZXNzLWJhcic7CiAgdmFyIFNsaWRlciA9ICQuU2xpZGVyID0gJC5TY3JvbGwuZXh0ZW5kKHsKICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoZWxlbWVudCwgb3B0aW9ucykgewogICAgICB0aGlzLl9zdXBlcihlbGVtZW50LCAkLmV4dGVuZCh0cnVlLCB7CiAgICAgICAgZmluZ2VyczogMSwKICAgICAgICBpbnRlcnZhbDogMCwKICAgICAgICAvL+iuvue9ruS4ujDvvIzliJnkuI3lrprml7bova7mkq0KICAgICAgICBzY3JvbGxZOiBmYWxzZSwKICAgICAgICBzY3JvbGxYOiB0cnVlLAogICAgICAgIGluZGljYXRvcnM6IGZhbHNlLAogICAgICAgIHNjcm9sbFRpbWU6IDEwMDAsCiAgICAgICAgc3RhcnRYOiBmYWxzZSwKICAgICAgICBzbGlkZVRpbWU6IDAsCiAgICAgICAgLy/mu5HliqjliqjnlLvml7bpl7QKICAgICAgICBzbmFwOiBTRUxFQ1RPUl9TTElERVJfSVRFTQogICAgICB9LCBvcHRpb25zKSk7CgogICAgICBpZiAodGhpcy5vcHRpb25zLnN0YXJ0WCkgey8vCQkJCSQudHJpZ2dlcih0aGlzLndyYXBwZXIsICdzY3JvbGxlbmQnLCB0aGlzKTsKICAgICAgfQogICAgfSwKICAgIF9pbml0OiBmdW5jdGlvbiBfaW5pdCgpIHsKICAgICAgdGhpcy5fcmVJbml0KCk7CgogICAgICBpZiAodGhpcy5zY3JvbGxlcikgewogICAgICAgIHRoaXMuc2Nyb2xsZXJTdHlsZSA9IHRoaXMuc2Nyb2xsZXIuc3R5bGU7CiAgICAgICAgdGhpcy5wcm9ncmVzc0JhciA9IHRoaXMud3JhcHBlci5xdWVyeVNlbGVjdG9yKFNFTEVDVE9SX1NMSURFUl9QUk9HUkVTU19CQVIpOwoKICAgICAgICBpZiAodGhpcy5wcm9ncmVzc0JhcikgewogICAgICAgICAgdGhpcy5wcm9ncmVzc0JhcldpZHRoID0gdGhpcy5wcm9ncmVzc0Jhci5vZmZzZXRXaWR0aDsKICAgICAgICAgIHRoaXMucHJvZ3Jlc3NCYXJTdHlsZSA9IHRoaXMucHJvZ3Jlc3NCYXIuc3R5bGU7CiAgICAgICAgfSAvL+W/mOiusOi/meS4quS7o+eggeaYr+W5suS7gOS5iOeahOS6hu+8nwogICAgICAgIC8vCQkJCXRoaXMueCA9IHRoaXMuX2dldFNjcm9sbCgpOwogICAgICAgIC8vCQkJCWlmICh0aGlzLm9wdGlvbnMuc3RhcnRYID09PSBmYWxzZSkgewogICAgICAgIC8vCQkJCQl0aGlzLm9wdGlvbnMuc3RhcnRYID0gdGhpcy54OwogICAgICAgIC8vCQkJCX0KICAgICAgICAvL+agueaNrmFjdGl2ZeS/ruato3N0YXJ0WAoKCiAgICAgICAgdGhpcy5fc3VwZXIoKTsKCiAgICAgICAgdGhpcy5faW5pdFRpbWVyKCk7CiAgICAgIH0KICAgIH0sCiAgICBfdHJpZ2dlclNsaWRlOiBmdW5jdGlvbiBfdHJpZ2dlclNsaWRlKCkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHNlbGYuaXNJblRyYW5zaXRpb24gPSBmYWxzZTsKICAgICAgdmFyIHBhZ2UgPSBzZWxmLmN1cnJlbnRQYWdlOwogICAgICBzZWxmLnNsaWRlTnVtYmVyID0gc2VsZi5fZml4ZWRTbGlkZU51bWJlcigpOwoKICAgICAgaWYgKHNlbGYubG9vcCkgewogICAgICAgIGlmIChzZWxmLnNsaWRlTnVtYmVyID09PSAwKSB7CiAgICAgICAgICBzZWxmLnNldFRyYW5zbGF0ZShzZWxmLnBhZ2VzWzFdWzBdLngsIDApOwogICAgICAgIH0gZWxzZSBpZiAoc2VsZi5zbGlkZU51bWJlciA9PT0gc2VsZi5pdGVtTGVuZ3RoIC0gMykgewogICAgICAgICAgc2VsZi5zZXRUcmFuc2xhdGUoc2VsZi5wYWdlc1tzZWxmLml0ZW1MZW5ndGggLSAyXVswXS54LCAwKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChzZWxmLmxhc3RTbGlkZU51bWJlciAhPSBzZWxmLnNsaWRlTnVtYmVyKSB7CiAgICAgICAgc2VsZi5sYXN0U2xpZGVOdW1iZXIgPSBzZWxmLnNsaWRlTnVtYmVyOwogICAgICAgIHNlbGYubGFzdFBhZ2UgPSBzZWxmLmN1cnJlbnRQYWdlOwogICAgICAgICQudHJpZ2dlcihzZWxmLndyYXBwZXIsICdzbGlkZScsIHsKICAgICAgICAgIHNsaWRlTnVtYmVyOiBzZWxmLnNsaWRlTnVtYmVyCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHNlbGYuX2luaXRUaW1lcigpOwogICAgfSwKICAgIF9oYW5kbGVTbGlkZTogZnVuY3Rpb24gX2hhbmRsZVNsaWRlKGUpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgaWYgKGUudGFyZ2V0ICE9PSBzZWxmLndyYXBwZXIpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBkZXRhaWwgPSBlLmRldGFpbDsKICAgICAgZGV0YWlsLnNsaWRlTnVtYmVyID0gZGV0YWlsLnNsaWRlTnVtYmVyIHx8IDA7CiAgICAgIHZhciB0ZW1wcyA9IHNlbGYuc2Nyb2xsZXIucXVlcnlTZWxlY3RvckFsbChTRUxFQ1RPUl9TTElERVJfSVRFTSk7CiAgICAgIHZhciBpdGVtcyA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRlbXBzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgdmFyIGl0ZW0gPSB0ZW1wc1tpXTsKCiAgICAgICAgaWYgKGl0ZW0ucGFyZW50Tm9kZSA9PT0gc2VsZi5zY3JvbGxlcikgewogICAgICAgICAgaXRlbXMucHVzaChpdGVtKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBfc2xpZGVOdW1iZXIgPSBkZXRhaWwuc2xpZGVOdW1iZXI7CgogICAgICBpZiAoc2VsZi5sb29wKSB7CiAgICAgICAgX3NsaWRlTnVtYmVyICs9IDE7CiAgICAgIH0KCiAgICAgIGlmICghc2VsZi53cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygnbXVpLXNlZ21lbnRlZC1jb250cm9sJykpIHsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gaXRlbXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIHZhciBpdGVtID0gaXRlbXNbaV07CgogICAgICAgICAgaWYgKGl0ZW0ucGFyZW50Tm9kZSA9PT0gc2VsZi5zY3JvbGxlcikgewogICAgICAgICAgICBpZiAoaSA9PT0gX3NsaWRlTnVtYmVyKSB7CiAgICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKENMQVNTX0FDVElWRSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKENMQVNTX0FDVElWRSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBpbmRpY2F0b3JXcmFwID0gc2VsZi53cmFwcGVyLnF1ZXJ5U2VsZWN0b3IoJy5tdWktc2xpZGVyLWluZGljYXRvcicpOwoKICAgICAgaWYgKGluZGljYXRvcldyYXApIHsKICAgICAgICBpZiAoaW5kaWNhdG9yV3JhcC5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2Nyb2xsJykpIHsKICAgICAgICAgIC8vc2Nyb2xsCiAgICAgICAgICAkKGluZGljYXRvcldyYXApLnNjcm9sbCgpLmdvdG9QYWdlKGRldGFpbC5zbGlkZU51bWJlcik7CiAgICAgICAgfQoKICAgICAgICB2YXIgaW5kaWNhdG9ycyA9IGluZGljYXRvcldyYXAucXVlcnlTZWxlY3RvckFsbCgnLm11aS1pbmRpY2F0b3InKTsKCiAgICAgICAgaWYgKGluZGljYXRvcnMubGVuZ3RoID4gMCkgewogICAgICAgICAgLy/lm77niYfova7mkq0KICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBpbmRpY2F0b3JzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIGluZGljYXRvcnNbaV0uY2xhc3NMaXN0W2kgPT09IGRldGFpbC5zbGlkZU51bWJlciA/ICdhZGQnIDogJ3JlbW92ZSddKENMQVNTX0FDVElWRSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBudW1iZXIgPSBpbmRpY2F0b3JXcmFwLnF1ZXJ5U2VsZWN0b3IoJy5tdWktbnVtYmVyIHNwYW4nKTsKCiAgICAgICAgICBpZiAobnVtYmVyKSB7CiAgICAgICAgICAgIC8v5Zu+5paH6KGo5qC8CiAgICAgICAgICAgIG51bWJlci5pbm5lclRleHQgPSBkZXRhaWwuc2xpZGVOdW1iZXIgKyAxOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy9zZWdtZW50ZWQgY29udHJvbHMKICAgICAgICAgICAgdmFyIGNvbnRyb2xJdGVtcyA9IGluZGljYXRvcldyYXAucXVlcnlTZWxlY3RvckFsbCgnLm11aS1jb250cm9sLWl0ZW0nKTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBjb250cm9sSXRlbXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgICBjb250cm9sSXRlbXNbaV0uY2xhc3NMaXN0W2kgPT09IGRldGFpbC5zbGlkZU51bWJlciA/ICdhZGQnIDogJ3JlbW92ZSddKENMQVNTX0FDVElWRSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9LAogICAgX2hhbmRsZVRhYlNob3c6IGZ1bmN0aW9uIF9oYW5kbGVUYWJTaG93KGUpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBzZWxmLmdvdG9JdGVtKGUuZGV0YWlsLnRhYk51bWJlciB8fCAwLCBzZWxmLm9wdGlvbnMuc2xpZGVUaW1lKTsKICAgIH0sCiAgICBfaGFuZGxlSW5kaWNhdG9yVGFwOiBmdW5jdGlvbiBfaGFuZGxlSW5kaWNhdG9yVGFwKGV2ZW50KSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDsKCiAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX0FDVElPTl9QUkVWSU9VUykgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19BQ1RJT05fTkVYVCkpIHsKICAgICAgICBzZWxmW3RhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfQUNUSU9OX1BSRVZJT1VTKSA/ICdwcmV2SXRlbScgOiAnbmV4dEl0ZW0nXSgpOwogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICB9CiAgICB9LAogICAgX2luaXRFdmVudDogZnVuY3Rpb24gX2luaXRFdmVudChkZXRhY2gpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgc2VsZi5fc3VwZXIoZGV0YWNoKTsKCiAgICAgIHZhciBhY3Rpb24gPSBkZXRhY2ggPyAncmVtb3ZlRXZlbnRMaXN0ZW5lcicgOiAnYWRkRXZlbnRMaXN0ZW5lcic7CiAgICAgIHNlbGYud3JhcHBlclthY3Rpb25dKCdzbGlkZScsIHRoaXMpOwogICAgICBzZWxmLndyYXBwZXJbYWN0aW9uXSgkLmV2ZW50TmFtZSgnc2hvd24nLCAndGFiJyksIHRoaXMpOwogICAgfSwKICAgIGhhbmRsZUV2ZW50OiBmdW5jdGlvbiBoYW5kbGVFdmVudChlKSB7CiAgICAgIHRoaXMuX3N1cGVyKGUpOwoKICAgICAgc3dpdGNoIChlLnR5cGUpIHsKICAgICAgICBjYXNlICdzbGlkZSc6CiAgICAgICAgICB0aGlzLl9oYW5kbGVTbGlkZShlKTsKCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAkLmV2ZW50TmFtZSgnc2hvd24nLCAndGFiJyk6CiAgICAgICAgICBpZiAofnRoaXMuc25hcHMuaW5kZXhPZihlLnRhcmdldCkpIHsKICAgICAgICAgICAgLy/pgb/lhY3ltYzlpZfnm5HlkKzplJnor6/nmoR0YWIgc2hvdwogICAgICAgICAgICB0aGlzLl9oYW5kbGVUYWJTaG93KGUpOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAogICAgX3Njcm9sbGVuZDogZnVuY3Rpb24gX3Njcm9sbGVuZChlKSB7CiAgICAgIHRoaXMuX3N1cGVyKGUpOwoKICAgICAgdGhpcy5fdHJpZ2dlclNsaWRlKGUpOwogICAgfSwKICAgIF9kcmFnOiBmdW5jdGlvbiBfZHJhZyhlKSB7CiAgICAgIHRoaXMuX3N1cGVyKGUpOwoKICAgICAgdmFyIGRpcmVjdGlvbiA9IGUuZGV0YWlsLmRpcmVjdGlvbjsKCiAgICAgIGlmIChkaXJlY3Rpb24gPT09ICdsZWZ0JyB8fCBkaXJlY3Rpb24gPT09ICdyaWdodCcpIHsKICAgICAgICAvL+aLluaLveacn+mXtOWPlua2iOWumuaXtgogICAgICAgIHZhciBzbGlkZXJzaG93VGltZXIgPSB0aGlzLndyYXBwZXIuZ2V0QXR0cmlidXRlKCdkYXRhLXNsaWRlcnNob3dUaW1lcicpOwogICAgICAgIHNsaWRlcnNob3dUaW1lciAmJiB3aW5kb3cuY2xlYXJUaW1lb3V0KHNsaWRlcnNob3dUaW1lcik7CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgfQogICAgfSwKICAgIF9pbml0VGltZXI6IGZ1bmN0aW9uIF9pbml0VGltZXIoKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIHNsaWRlciA9IHNlbGYud3JhcHBlcjsKICAgICAgdmFyIGludGVydmFsID0gc2VsZi5vcHRpb25zLmludGVydmFsOwogICAgICB2YXIgc2xpZGVyc2hvd1RpbWVyID0gc2xpZGVyLmdldEF0dHJpYnV0ZSgnZGF0YS1zbGlkZXJzaG93VGltZXInKTsKICAgICAgc2xpZGVyc2hvd1RpbWVyICYmIHdpbmRvdy5jbGVhclRpbWVvdXQoc2xpZGVyc2hvd1RpbWVyKTsKCiAgICAgIGlmIChpbnRlcnZhbCkgewogICAgICAgIHNsaWRlcnNob3dUaW1lciA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICghc2xpZGVyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy/ku4VzbGlkZXLmmL7npLrnirbmgIHov5vooYzoh6rliqjova7mkq0KCgogICAgICAgICAgaWYgKCEhKHNsaWRlci5vZmZzZXRXaWR0aCB8fCBzbGlkZXIub2Zmc2V0SGVpZ2h0KSkgewogICAgICAgICAgICBzZWxmLm5leHRJdGVtKHRydWUpOyAvL+S4i+S4gOS4qgogICAgICAgICAgfQoKICAgICAgICAgIHNlbGYuX2luaXRUaW1lcigpOwogICAgICAgIH0sIGludGVydmFsKTsKICAgICAgICBzbGlkZXIuc2V0QXR0cmlidXRlKCdkYXRhLXNsaWRlcnNob3dUaW1lcicsIHNsaWRlcnNob3dUaW1lcik7CiAgICAgIH0KICAgIH0sCiAgICBfZml4ZWRTbGlkZU51bWJlcjogZnVuY3Rpb24gX2ZpeGVkU2xpZGVOdW1iZXIocGFnZSkgewogICAgICBwYWdlID0gcGFnZSB8fCB0aGlzLmN1cnJlbnRQYWdlOwogICAgICB2YXIgc2xpZGVOdW1iZXIgPSBwYWdlLnBhZ2VYOwoKICAgICAgaWYgKHRoaXMubG9vcCkgewogICAgICAgIGlmIChwYWdlLnBhZ2VYID09PSAwKSB7CiAgICAgICAgICBzbGlkZU51bWJlciA9IHRoaXMuaXRlbUxlbmd0aCAtIDM7CiAgICAgICAgfSBlbHNlIGlmIChwYWdlLnBhZ2VYID09PSB0aGlzLml0ZW1MZW5ndGggLSAxKSB7CiAgICAgICAgICBzbGlkZU51bWJlciA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNsaWRlTnVtYmVyID0gcGFnZS5wYWdlWCAtIDE7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gc2xpZGVOdW1iZXI7CiAgICB9LAogICAgX3JlTGF5b3V0OiBmdW5jdGlvbiBfcmVMYXlvdXQoKSB7CiAgICAgIHRoaXMuaGFzSG9yaXpvbnRhbFNjcm9sbCA9IHRydWU7CiAgICAgIHRoaXMubG9vcCA9IHRoaXMuc2Nyb2xsZXIuY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX1NMSURFUl9MT09QKTsKCiAgICAgIHRoaXMuX3N1cGVyKCk7CiAgICB9LAogICAgX2dldFNjcm9sbDogZnVuY3Rpb24gX2dldFNjcm9sbCgpIHsKICAgICAgdmFyIHJlc3VsdCA9ICQucGFyc2VUcmFuc2xhdGVNYXRyaXgoJC5nZXRTdHlsZXModGhpcy5zY3JvbGxlciwgJ3dlYmtpdFRyYW5zZm9ybScpKTsKICAgICAgcmV0dXJuIHJlc3VsdCA/IHJlc3VsdC54IDogMDsKICAgIH0sCiAgICBfdHJhbnNpdGlvbkVuZDogZnVuY3Rpb24gX3RyYW5zaXRpb25FbmQoZSkgewogICAgICBpZiAoZS50YXJnZXQgIT09IHRoaXMuc2Nyb2xsZXIgfHwgIXRoaXMuaXNJblRyYW5zaXRpb24pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuX3RyYW5zaXRpb25UaW1lKCk7CgogICAgICB0aGlzLmlzSW5UcmFuc2l0aW9uID0gZmFsc2U7CiAgICAgICQudHJpZ2dlcih0aGlzLndyYXBwZXIsICdzY3JvbGxlbmQnLCB0aGlzKTsKICAgIH0sCiAgICBfZmxpY2s6IGZ1bmN0aW9uIF9mbGljayhlKSB7CiAgICAgIGlmICghdGhpcy5tb3ZlZCkgewogICAgICAgIC8v5pegbW92ZWQKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBkZXRhaWwgPSBlLmRldGFpbDsKICAgICAgdmFyIGRpcmVjdGlvbiA9IGRldGFpbC5kaXJlY3Rpb247CgogICAgICB0aGlzLl9jbGVhclJlcXVlc3RBbmltYXRpb25GcmFtZSgpOwoKICAgICAgdGhpcy5pc0luVHJhbnNpdGlvbiA9IHRydWU7IC8vCQkJaWYgKGRpcmVjdGlvbiA9PT0gJ3VwJyB8fCBkaXJlY3Rpb24gPT09ICdkb3duJykgewogICAgICAvLwkJCQl0aGlzLnJlc2V0UG9zaXRpb24odGhpcy5vcHRpb25zLmJvdW5jZVRpbWUpOwogICAgICAvLwkJCQlyZXR1cm47CiAgICAgIC8vCQkJfQoKICAgICAgaWYgKGUudHlwZSA9PT0gJ2ZsaWNrJykgewogICAgICAgIGlmIChkZXRhaWwuZGVsdGFUaW1lIDwgMjAwKSB7CiAgICAgICAgICAvL2ZsaWNr77yM5aSq5a655piT6Kem5Y+R77yM6aKd5aSW5qCh6aqM5LiA5LiLZGVsdGFUaW1lCiAgICAgICAgICB0aGlzLnggPSB0aGlzLl9nZXRQYWdlKHRoaXMuc2xpZGVOdW1iZXIgKyAoZGlyZWN0aW9uID09PSAncmlnaHQnID8gLTEgOiAxKSwgdHJ1ZSkueDsKICAgICAgICB9CgogICAgICAgIHRoaXMucmVzZXRQb3NpdGlvbih0aGlzLm9wdGlvbnMuYm91bmNlVGltZSk7CiAgICAgIH0gZWxzZSBpZiAoZS50eXBlID09PSAnZHJhZ2VuZCcgJiYgIWRldGFpbC5mbGljaykgewogICAgICAgIHRoaXMucmVzZXRQb3NpdGlvbih0aGlzLm9wdGlvbnMuYm91bmNlVGltZSk7CiAgICAgIH0KCiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9LAogICAgX2luaXRTbmFwOiBmdW5jdGlvbiBfaW5pdFNuYXAoKSB7CiAgICAgIHRoaXMuc2Nyb2xsZXJXaWR0aCA9IHRoaXMuaXRlbUxlbmd0aCAqIHRoaXMuc2Nyb2xsZXJXaWR0aDsKICAgICAgdGhpcy5tYXhTY3JvbGxYID0gTWF0aC5taW4odGhpcy53cmFwcGVyV2lkdGggLSB0aGlzLnNjcm9sbGVyV2lkdGgsIDApOwoKICAgICAgdGhpcy5fc3VwZXIoKTsKCiAgICAgIGlmICghdGhpcy5jdXJyZW50UGFnZS54KSB7CiAgICAgICAgLy/lvZNzbGlkZXLlpITkuo7pmpDol4/nirbmgIHml7bvvIzlr7zoh7RzbmFw6K6h566X5piv6ZSZ6K+v55qE77yM5Li05pe25YWI6L+Z5LmI5Yik5pat5LiA5LiL77yM5ZCO57ut6KaB6ICD6JmR6Kej5Yaz5omA5pyJc2Nyb2xs5Zyo6ZqQ6JeP54q25oCB5LiL5Yid5aeL5YyW5bGe5oCn5LiN5q2j56Gu55qE6Zeu6aKYCiAgICAgICAgdmFyIGN1cnJlbnRQYWdlID0gdGhpcy5wYWdlc1t0aGlzLmxvb3AgPyAxIDogMF07CiAgICAgICAgY3VycmVudFBhZ2UgPSBjdXJyZW50UGFnZSB8fCB0aGlzLnBhZ2VzWzBdOwoKICAgICAgICBpZiAoIWN1cnJlbnRQYWdlKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gY3VycmVudFBhZ2VbMF07CiAgICAgICAgdGhpcy5zbGlkZU51bWJlciA9IDA7CiAgICAgICAgdGhpcy5sYXN0U2xpZGVOdW1iZXIgPSB0eXBlb2YgdGhpcy5sYXN0U2xpZGVOdW1iZXIgPT09ICd1bmRlZmluZWQnID8gMCA6IHRoaXMubGFzdFNsaWRlTnVtYmVyOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2xpZGVOdW1iZXIgPSB0aGlzLl9maXhlZFNsaWRlTnVtYmVyKCk7CiAgICAgICAgdGhpcy5sYXN0U2xpZGVOdW1iZXIgPSB0eXBlb2YgdGhpcy5sYXN0U2xpZGVOdW1iZXIgPT09ICd1bmRlZmluZWQnID8gdGhpcy5zbGlkZU51bWJlciA6IHRoaXMubGFzdFNsaWRlTnVtYmVyOwogICAgICB9CgogICAgICB0aGlzLm9wdGlvbnMuc3RhcnRYID0gdGhpcy5jdXJyZW50UGFnZS54IHx8IDA7CiAgICB9LAogICAgX2dldFNuYXBYOiBmdW5jdGlvbiBfZ2V0U25hcFgob2Zmc2V0TGVmdCkgewogICAgICByZXR1cm4gTWF0aC5tYXgoLW9mZnNldExlZnQsIHRoaXMubWF4U2Nyb2xsWCk7CiAgICB9LAogICAgX2dldFBhZ2U6IGZ1bmN0aW9uIF9nZXRQYWdlKHNsaWRlTnVtYmVyLCBpc0ZsaWNrKSB7CiAgICAgIGlmICh0aGlzLmxvb3ApIHsKICAgICAgICBpZiAoc2xpZGVOdW1iZXIgPiB0aGlzLml0ZW1MZW5ndGggLSAoaXNGbGljayA/IDIgOiAzKSkgewogICAgICAgICAgc2xpZGVOdW1iZXIgPSAxOwogICAgICAgICAgdGltZSA9IDA7CiAgICAgICAgfSBlbHNlIGlmIChzbGlkZU51bWJlciA8IChpc0ZsaWNrID8gLTEgOiAwKSkgewogICAgICAgICAgc2xpZGVOdW1iZXIgPSB0aGlzLml0ZW1MZW5ndGggLSAyOwogICAgICAgICAgdGltZSA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNsaWRlTnVtYmVyICs9IDE7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmICghaXNGbGljaykgewogICAgICAgICAgaWYgKHNsaWRlTnVtYmVyID4gdGhpcy5pdGVtTGVuZ3RoIC0gMSkgewogICAgICAgICAgICBzbGlkZU51bWJlciA9IDA7CiAgICAgICAgICAgIHRpbWUgPSAwOwogICAgICAgICAgfSBlbHNlIGlmIChzbGlkZU51bWJlciA8IDApIHsKICAgICAgICAgICAgc2xpZGVOdW1iZXIgPSB0aGlzLml0ZW1MZW5ndGggLSAxOwogICAgICAgICAgICB0aW1lID0gMDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHNsaWRlTnVtYmVyID0gTWF0aC5taW4oTWF0aC5tYXgoMCwgc2xpZGVOdW1iZXIpLCB0aGlzLml0ZW1MZW5ndGggLSAxKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMucGFnZXNbc2xpZGVOdW1iZXJdWzBdOwogICAgfSwKICAgIF9nb3RvSXRlbTogZnVuY3Rpb24gX2dvdG9JdGVtKHNsaWRlTnVtYmVyLCB0aW1lKSB7CiAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSB0aGlzLl9nZXRQYWdlKHNsaWRlTnVtYmVyLCB0cnVlKTsgLy/mraTlpITkvKB0cnVl44CC5Y+v5L+d6K+B56iL5bqP5YiH5o2i5pe277yM5Yqo55S75LiO5Lq65omL5pON5L2c5LiA6Ie0KOesrOS4gOW8oO+8jOacgOWQjuS4gOW8oOeahOWIh+aNouWKqOeUuykKCiAgICAgIHRoaXMuc2Nyb2xsVG8odGhpcy5jdXJyZW50UGFnZS54LCAwLCB0aW1lLCB0aGlzLm9wdGlvbnMuc2Nyb2xsRWFzaW5nKTsKCiAgICAgIGlmICh0aW1lID09PSAwKSB7CiAgICAgICAgJC50cmlnZ2VyKHRoaXMud3JhcHBlciwgJ3Njcm9sbGVuZCcsIHRoaXMpOwogICAgICB9CiAgICB9LAogICAgLy9BUEkKICAgIHNldFRyYW5zbGF0ZTogZnVuY3Rpb24gc2V0VHJhbnNsYXRlKHgsIHkpIHsKICAgICAgdGhpcy5fc3VwZXIoeCwgeSk7CgogICAgICB2YXIgcHJvZ3Jlc3NCYXIgPSB0aGlzLnByb2dyZXNzQmFyOwoKICAgICAgaWYgKHByb2dyZXNzQmFyKSB7CiAgICAgICAgdGhpcy5wcm9ncmVzc0JhclN0eWxlLndlYmtpdFRyYW5zZm9ybSA9IHRoaXMuX2dldFRyYW5zbGF0ZVN0cigteCAqICh0aGlzLnByb2dyZXNzQmFyV2lkdGggLyB0aGlzLndyYXBwZXJXaWR0aCksIDApOwogICAgICB9CiAgICB9LAogICAgcmVzZXRQb3NpdGlvbjogZnVuY3Rpb24gcmVzZXRQb3NpdGlvbih0aW1lKSB7CiAgICAgIHRpbWUgPSB0aW1lIHx8IDA7CgogICAgICBpZiAodGhpcy54ID4gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgIH0gZWxzZSBpZiAodGhpcy54IDwgdGhpcy5tYXhTY3JvbGxYKSB7CiAgICAgICAgdGhpcy54ID0gdGhpcy5tYXhTY3JvbGxYOwogICAgICB9CgogICAgICB0aGlzLmN1cnJlbnRQYWdlID0gdGhpcy5fbmVhcmVzdFNuYXAodGhpcy54KTsKICAgICAgdGhpcy5zY3JvbGxUbyh0aGlzLmN1cnJlbnRQYWdlLngsIDAsIHRpbWUsIHRoaXMub3B0aW9ucy5zY3JvbGxFYXNpbmcpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCiAgICBnb3RvSXRlbTogZnVuY3Rpb24gZ290b0l0ZW0oc2xpZGVOdW1iZXIsIHRpbWUpIHsKICAgICAgdGhpcy5fZ290b0l0ZW0oc2xpZGVOdW1iZXIsIHR5cGVvZiB0aW1lID09PSAndW5kZWZpbmVkJyA/IHRoaXMub3B0aW9ucy5zY3JvbGxUaW1lIDogdGltZSk7CiAgICB9LAogICAgbmV4dEl0ZW06IGZ1bmN0aW9uIG5leHRJdGVtKCkgewogICAgICB0aGlzLl9nb3RvSXRlbSh0aGlzLnNsaWRlTnVtYmVyICsgMSwgdGhpcy5vcHRpb25zLnNjcm9sbFRpbWUpOwogICAgfSwKICAgIHByZXZJdGVtOiBmdW5jdGlvbiBwcmV2SXRlbSgpIHsKICAgICAgdGhpcy5fZ290b0l0ZW0odGhpcy5zbGlkZU51bWJlciAtIDEsIHRoaXMub3B0aW9ucy5zY3JvbGxUaW1lKTsKICAgIH0sCiAgICBnZXRTbGlkZU51bWJlcjogZnVuY3Rpb24gZ2V0U2xpZGVOdW1iZXIoKSB7CiAgICAgIHJldHVybiB0aGlzLnNsaWRlTnVtYmVyIHx8IDA7CiAgICB9LAogICAgX3JlSW5pdDogZnVuY3Rpb24gX3JlSW5pdCgpIHsKICAgICAgdmFyIGdyb3VwcyA9IHRoaXMud3JhcHBlci5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIENMQVNTX1NMSURFUl9HUk9VUCk7CgogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgaWYgKGdyb3Vwc1tpXS5wYXJlbnROb2RlID09PSB0aGlzLndyYXBwZXIpIHsKICAgICAgICAgIHRoaXMuc2Nyb2xsZXIgPSBncm91cHNbaV07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuc2Nyb2xsZXJTdHlsZSA9IHRoaXMuc2Nyb2xsZXIgJiYgdGhpcy5zY3JvbGxlci5zdHlsZTsKCiAgICAgIGlmICh0aGlzLnByb2dyZXNzQmFyKSB7CiAgICAgICAgdGhpcy5wcm9ncmVzc0JhcldpZHRoID0gdGhpcy5wcm9ncmVzc0Jhci5vZmZzZXRXaWR0aDsKICAgICAgICB0aGlzLnByb2dyZXNzQmFyU3R5bGUgPSB0aGlzLnByb2dyZXNzQmFyLnN0eWxlOwogICAgICB9CiAgICB9LAogICAgcmVmcmVzaDogZnVuY3Rpb24gcmVmcmVzaChvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgJC5leHRlbmQodGhpcy5vcHRpb25zLCBvcHRpb25zKTsKCiAgICAgICAgdGhpcy5fc3VwZXIoKTsKCiAgICAgICAgdGhpcy5faW5pdFRpbWVyKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5fc3VwZXIoKTsKICAgICAgfQogICAgfSwKICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgIHRoaXMuX2luaXRFdmVudCh0cnVlKTsgLy9kZXRhY2gKCgogICAgICBkZWxldGUgJC5kYXRhW3RoaXMud3JhcHBlci5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2xpZGVyJyldOwogICAgICB0aGlzLndyYXBwZXIuc2V0QXR0cmlidXRlKCdkYXRhLXNsaWRlcicsICcnKTsKICAgIH0KICB9KTsKCiAgJC5mbi5zbGlkZXIgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgdmFyIHNsaWRlciA9IG51bGw7CiAgICB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICB2YXIgc2xpZGVyRWxlbWVudCA9IHRoaXM7CgogICAgICBpZiAoIXRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX1NMSURFUikpIHsKICAgICAgICBzbGlkZXJFbGVtZW50ID0gdGhpcy5xdWVyeVNlbGVjdG9yKCcuJyArIENMQVNTX1NMSURFUik7CiAgICAgIH0KCiAgICAgIGlmIChzbGlkZXJFbGVtZW50ICYmIHNsaWRlckVsZW1lbnQucXVlcnlTZWxlY3RvcihTRUxFQ1RPUl9TTElERVJfSVRFTSkpIHsKICAgICAgICB2YXIgaWQgPSBzbGlkZXJFbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1zbGlkZXInKTsKCiAgICAgICAgaWYgKCFpZCkgewogICAgICAgICAgaWQgPSArKyQudXVpZDsKICAgICAgICAgICQuZGF0YVtpZF0gPSBzbGlkZXIgPSBuZXcgU2xpZGVyKHNsaWRlckVsZW1lbnQsIG9wdGlvbnMpOwogICAgICAgICAgc2xpZGVyRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2xpZGVyJywgaWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzbGlkZXIgPSAkLmRhdGFbaWRdOwoKICAgICAgICAgIGlmIChzbGlkZXIgJiYgb3B0aW9ucykgewogICAgICAgICAgICBzbGlkZXIucmVmcmVzaChvcHRpb25zKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHNsaWRlcjsKICB9OwoKICAkLnJlYWR5KGZ1bmN0aW9uICgpIHsKICAgIC8vCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgJCgnLm11aS1zbGlkZXInKS5zbGlkZXIoKTsKICAgICQoJy5tdWktc2Nyb2xsLXdyYXBwZXIubXVpLXNsaWRlci1pbmRpY2F0b3IubXVpLXNlZ21lbnRlZC1jb250cm9sJykuc2Nyb2xsKHsKICAgICAgc2Nyb2xsWTogZmFsc2UsCiAgICAgIHNjcm9sbFg6IHRydWUsCiAgICAgIGluZGljYXRvcnM6IGZhbHNlLAogICAgICBzbmFwOiAnLm11aS1jb250cm9sLWl0ZW0nCiAgICB9KTsgLy8JCX0sIDUwMCk7IC8v5Li05pe25aSE55CGc2xpZGVy5a695bqm6K6h566X5LiN5q2j56Gu55qE6Zeu6aKYKOWIneatpeehruiupOaYr3Njcm9sbGJhcuWvvOiHtOeahCkKICB9KTsKfSkobXVpLCB3aW5kb3cpOwovKioKICogcHVsbFJlZnJlc2ggNSsKICogQHBhcmFtIHt0eXBlfSAkCiAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAqLwoKCihmdW5jdGlvbiAoJCwgZG9jdW1lbnQpIHsKICBpZiAoISQub3MucGx1cykgewogICAgLy/ku4XlnKg1K2FuZHJvaWTmlK/mjIHlpJp3ZWJ2aWV355qE5L2/55SoCiAgICByZXR1cm47CiAgfQoKICAkLnBsdXNSZWFkeShmdW5jdGlvbiAoKSB7CiAgICBpZiAod2luZG93Ll9fTldpbl9FbmFibGVfXyA9PT0gZmFsc2UpIHsKICAgICAgLy/kuI3mlK/mjIHlpJp3ZWJ2aWV377yM5YiZ5LiN55SoNSvkuIvmi4nliLfmlrAKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBDTEFTU19QTFVTX1BVTExSRUZSRVNIID0gJ211aS1wbHVzLXB1bGxyZWZyZXNoJzsKICAgIHZhciBDTEFTU19WSVNJQklMSVRZID0gJ211aS12aXNpYmlsaXR5JzsKICAgIHZhciBDTEFTU19ISURERU4gPSAnbXVpLWhpZGRlbic7CiAgICB2YXIgQ0xBU1NfQkxPQ0sgPSAnbXVpLWJsb2NrJzsKICAgIHZhciBDTEFTU19QVUxMX0NBUFRJT04gPSAnbXVpLXB1bGwtY2FwdGlvbic7CiAgICB2YXIgQ0xBU1NfUFVMTF9DQVBUSU9OX0RPV04gPSAnbXVpLXB1bGwtY2FwdGlvbi1kb3duJzsKICAgIHZhciBDTEFTU19QVUxMX0NBUFRJT05fUkVGUkVTSCA9ICdtdWktcHVsbC1jYXB0aW9uLXJlZnJlc2gnOwogICAgdmFyIENMQVNTX1BVTExfQ0FQVElPTl9OT01PUkUgPSAnbXVpLXB1bGwtY2FwdGlvbi1ub21vcmUnOwogICAgdmFyIFBsdXNQdWxsUmVmcmVzaCA9ICQuQ2xhc3MuZXh0ZW5kKHsKICAgICAgaW5pdDogZnVuY3Rpb24gaW5pdChlbGVtZW50LCBvcHRpb25zKSB7CiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDsKICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwogICAgICAgIHRoaXMud3JhcHBlciA9IHRoaXMuc2Nyb2xsZXIgPSBlbGVtZW50OwoKICAgICAgICB0aGlzLl9pbml0KCk7CgogICAgICAgIHRoaXMuX2luaXRQdWxsZG93blJlZnJlc2hFdmVudCgpOwogICAgICB9LAogICAgICBfaW5pdDogZnVuY3Rpb24gX2luaXQoKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOyAvL2RvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3BsdXNzY3JvbGxib3R0b20nLCB0aGlzKTsKCiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWd1cCcsIHNlbGYpOwogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInBsdXNzY3JvbGxib3R0b20iLCBzZWxmKTsKICAgICAgICBzZWxmLnNjcm9sbEludGVydmFsID0gd2luZG93LnNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChzZWxmLmlzU2Nyb2xsICYmICFzZWxmLmxvYWRpbmcpIHsKICAgICAgICAgICAgaWYgKHdpbmRvdy5wYWdlWU9mZnNldCArIHdpbmRvdy5pbm5lckhlaWdodCArIDEwID49IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxIZWlnaHQpIHsKICAgICAgICAgICAgICBzZWxmLmlzU2Nyb2xsID0gZmFsc2U7IC8v5pS+5Zyo6L+Z6YeM5piv5Zug5Li65b+r6YCf5rua5Yqo55qE6K+d77yM5pyJ5Y+v6IO95qOA5rWL5pe277yM6L+Y5rKh5Yiw5bqV77yM5omA5Lul5Y+q6KaB5pyJ5rua5Yqo77yM5rKh5Yiw5bqV5LmL5YmN5LiA55u05qOA5rWL6auY5bqm5Y+Y5YyWCgogICAgICAgICAgICAgIGlmIChzZWxmLmJvdHRvbVBvY2tldCkgewogICAgICAgICAgICAgICAgc2VsZi5wdWxsdXBMb2FkaW5nKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgMTAwKTsKICAgICAgfSwKICAgICAgX2luaXRQdWxsZG93blJlZnJlc2hFdmVudDogZnVuY3Rpb24gX2luaXRQdWxsZG93blJlZnJlc2hFdmVudCgpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgJC5wbHVzUmVhZHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5kb3duLnN0eWxlID09ICJjaXJjbGUiKSB7CiAgICAgICAgICAgIC8v5Y2Vd2Vidmlld+OAgeWOn+eUn+i9rOWciAogICAgICAgICAgICBzZWxmLm9wdGlvbnMud2VidmlldyA9IHBsdXMud2Vidmlldy5jdXJyZW50V2VidmlldygpOwogICAgICAgICAgICBzZWxmLm9wdGlvbnMud2Vidmlldy5zZXRQdWxsVG9SZWZyZXNoKHsKICAgICAgICAgICAgICBzdXBwb3J0OiB0cnVlLAogICAgICAgICAgICAgIGNvbG9yOiBzZWxmLm9wdGlvbnMuZG93bi5jb2xvciB8fCAnIzJCRDAwOScsCiAgICAgICAgICAgICAgaGVpZ2h0OiBzZWxmLm9wdGlvbnMuZG93bi5oZWlnaHQgfHwgJzUwcHgnLAogICAgICAgICAgICAgIHJhbmdlOiBzZWxmLm9wdGlvbnMuZG93bi5yYW5nZSB8fCAnMTAwcHgnLAogICAgICAgICAgICAgIHN0eWxlOiAnY2lyY2xlJywKICAgICAgICAgICAgICBvZmZzZXQ6IHNlbGYub3B0aW9ucy5kb3duLm9mZnNldCB8fCAnMHB4JwogICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgc2VsZi5vcHRpb25zLmRvd24uY2FsbGJhY2soKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHNlbGYudG9wUG9ja2V0ICYmIHNlbGYub3B0aW9ucy53ZWJ2aWV3SWQpIHsKICAgICAgICAgICAgdmFyIHdlYnZpZXcgPSBwbHVzLndlYnZpZXcuZ2V0V2Vidmlld0J5SWQoc2VsZi5vcHRpb25zLndlYnZpZXdJZCk7IC8v5a2Q56qX5Y+jCgogICAgICAgICAgICBpZiAoIXdlYnZpZXcpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNlbGYub3B0aW9ucy53ZWJ2aWV3ID0gd2VidmlldzsKICAgICAgICAgICAgdmFyIGRvd25PcHRpb25zID0gc2VsZi5vcHRpb25zLmRvd247CiAgICAgICAgICAgIHZhciBoZWlnaHQgPSBkb3duT3B0aW9ucy5oZWlnaHQ7CiAgICAgICAgICAgIHdlYnZpZXcuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIGF0dHJXZWJ2aWV3SWQgPSBzZWxmLm9wdGlvbnMud2Vidmlld0lkICYmIHNlbGYub3B0aW9ucy53ZWJ2aWV3SWQucmVwbGFjZSgvXC8vZywgIl8iKTsgLy/mm7/mjaLmiYDmnIkiLyIgCgogICAgICAgICAgICAgIHNlbGYuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtcHVsbHJlZnJlc2gtcGx1cy0nICsgYXR0cldlYnZpZXdJZCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB3ZWJ2aWV3LmFkZEV2ZW50TGlzdGVuZXIoImRyYWdCb3VuY2UiLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIGlmICghc2VsZi5wdWxsZG93bikgewogICAgICAgICAgICAgICAgc2VsZi5faW5pdFB1bGxkb3duUmVmcmVzaCgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzZWxmLnB1bGxQb2NrZXQuY2xhc3NMaXN0LmFkZChDTEFTU19CTE9DSyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzd2l0Y2ggKGUuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICBjYXNlICJiZWZvcmVDaGFuZ2VPZmZzZXQiOgogICAgICAgICAgICAgICAgICAvL+S4i+aLieWPr+WIt+aWsOeKtuaAgQogICAgICAgICAgICAgICAgICBzZWxmLl9zZXRDYXB0aW9uKGRvd25PcHRpb25zLmNvbnRlbnRkb3duKTsKCiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGNhc2UgImFmdGVyQ2hhbmdlT2Zmc2V0IjoKICAgICAgICAgICAgICAgICAgLy/mnb7lvIDlj6/liLfmlrDnirbmgIEKICAgICAgICAgICAgICAgICAgc2VsZi5fc2V0Q2FwdGlvbihkb3duT3B0aW9ucy5jb250ZW50b3Zlcik7CgogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICJkcmFnRW5kQWZ0ZXJDaGFuZ2VPZmZzZXQiOgogICAgICAgICAgICAgICAgICAvL+ato+WcqOWIt+aWsOeKtuaAgQogICAgICAgICAgICAgICAgICAvL+aJp+ihjOS4i+aLieWIt+aWsOaJgOWcqHdlYnZpZXfnmoTlm57osIPlh73mlbAKICAgICAgICAgICAgICAgICAgd2Vidmlldy5ldmFsSlMoIndpbmRvdy5tdWkmJm11aS5vcHRpb25zLnB1bGxSZWZyZXNoLmRvd24uY2FsbGJhY2soKSIpOwoKICAgICAgICAgICAgICAgICAgc2VsZi5fc2V0Q2FwdGlvbihkb3duT3B0aW9ucy5jb250ZW50cmVmcmVzaCk7CgogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIGZhbHNlKTsKICAgICAgICAgICAgd2Vidmlldy5zZXRCb3VuY2UoewogICAgICAgICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICAgICAgICB0b3A6IGhlaWdodCAqIDIgKyAncHgnCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBjaGFuZ2VvZmZzZXQ6IHsKICAgICAgICAgICAgICAgIHRvcDogaGVpZ2h0ICsgJ3B4JwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGhhbmRsZUV2ZW50OiBmdW5jdGlvbiBoYW5kbGVFdmVudChlKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICBpZiAoc2VsZi5zdG9wcGVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBzZWxmLmlzU2Nyb2xsID0gZmFsc2U7CgogICAgICAgIGlmIChlLnR5cGUgPT09ICdkcmFndXAnIHx8IGUudHlwZSA9PT0gJ3BsdXNzY3JvbGxib3R0b20nKSB7CiAgICAgICAgICBzZWxmLmlzU2Nyb2xsID0gdHJ1ZTsKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBzZWxmLmlzU2Nyb2xsID0gZmFsc2U7CiAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pLmV4dGVuZCgkLmV4dGVuZCh7CiAgICAgIHNldFN0b3BwZWQ6IGZ1bmN0aW9uIHNldFN0b3BwZWQoc3RvcHBlZCkgewogICAgICAgIC8v6K+l5pa55rOV5piv5a2Q6aG16Z2i6LCD55So55qECiAgICAgICAgdGhpcy5zdG9wcGVkID0gISFzdG9wcGVkOyAvLyBUT0RPIOatpOWkhOmcgOimgeiuvue9ruW9k+WJjXdlYnZpZXfnmoRib3VuY2XkuLpub25lLOebruWJjTUr5pyJQlVHCgogICAgICAgIGlmICh0aGlzLnN0b3BwZWQpIHsKICAgICAgICAgIHRoaXMuZGlzYWJsZVB1bGx1cFRvUmVmcmVzaCgpOwogICAgICAgICAgdGhpcy5kaXNhYmxlUHVsbGRvd25Ub1JlZnJlc2goKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5lbmFibGVQdWxsdXBUb1JlZnJlc2goKTsKICAgICAgICAgIHRoaXMuZW5hYmxlUHVsbGRvd25Ub1JlZnJlc2goKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGJlZ2luUHVsbGRvd246IGZ1bmN0aW9uIGJlZ2luUHVsbGRvd24oKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICQucGx1c1JlYWR5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8v6L+Z6YeM5bu25pe255qE55uu55qE5piv5Li65LqG5L+d6K+B5LiL5ouJ5Yi35paw57uE5Lu25Yid5aeL5YyW5a6M5oiQ77yM5ZCO57ut5bqU6K+l5YGa5oiQ5pyJ54q25oCB55qECiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5kb3duLnN0eWxlID09ICJjaXJjbGUiKSB7CiAgICAgICAgICAgICAgLy/ljZV3ZWJ2aWV35LiL5ouJ5Yi35pawCiAgICAgICAgICAgICAgcGx1cy53ZWJ2aWV3LmN1cnJlbnRXZWJ2aWV3KCkuYmVnaW5QdWxsVG9SZWZyZXNoKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy/lj4x3ZWJ2aWV35qih5byPCiAgICAgICAgICAgICAgdmFyIHdlYnZpZXcgPSBzZWxmLm9wdGlvbnMud2VidmlldzsKCiAgICAgICAgICAgICAgaWYgKHdlYnZpZXcpIHsKICAgICAgICAgICAgICAgIHdlYnZpZXcuc2V0Qm91bmNlKHsKICAgICAgICAgICAgICAgICAgb2Zmc2V0OiB7CiAgICAgICAgICAgICAgICAgICAgdG9wOiBzZWxmLm9wdGlvbnMuZG93bi5oZWlnaHQgKyAicHgiCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgMTUpOwogICAgICAgIH0uYmluZCh0aGlzKSk7CiAgICAgIH0sCiAgICAgIHB1bGxkb3duTG9hZGluZzogZnVuY3Rpb24gcHVsbGRvd25Mb2FkaW5nKCkgewogICAgICAgIC8v6K+l5pa55rOV5piv5a2Q6aG16Z2i6LCD55So55qE77yM5YW85a656ICB55qE5Y6G5Y+yQVBJCiAgICAgICAgdGhpcy5iZWdpblB1bGxkb3duKCk7CiAgICAgIH0sCiAgICAgIF9wdWxsZG93bkxvYWRpbmc6IGZ1bmN0aW9uIF9wdWxsZG93bkxvYWRpbmcoKSB7CiAgICAgICAgLy/or6Xmlrnms5XmmK/niLbpobXpnaLosIPnlKjnmoQKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgJC5wbHVzUmVhZHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIGNoaWxkV2VidmlldyA9IHBsdXMud2Vidmlldy5nZXRXZWJ2aWV3QnlJZChzZWxmLm9wdGlvbnMud2Vidmlld0lkKTsKICAgICAgICAgIGNoaWxkV2VidmlldyAmJiBjaGlsZFdlYnZpZXcuc2V0Qm91bmNlKHsKICAgICAgICAgICAgb2Zmc2V0OiB7CiAgICAgICAgICAgICAgdG9wOiBzZWxmLm9wdGlvbnMuZG93bi5oZWlnaHQgKyAicHgiCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBlbmRQdWxsZG93bjogZnVuY3Rpb24gZW5kUHVsbGRvd24oKSB7CiAgICAgICAgdmFyIF93diA9IHBsdXMud2Vidmlldy5jdXJyZW50V2VidmlldygpOyAvL+WPjHdlYnZpZXfnmoTkuIvmi4nliLfmlrDvvIzpnIDopoHkv67mlLnniLbnqpflj6Pmj5DnpLrkv6Hmga8KCgogICAgICAgIGlmIChfd3YucGFyZW50KCkgJiYgdGhpcy5vcHRpb25zLmRvd24uc3R5bGUgIT09ICJjaXJjbGUiKSB7CiAgICAgICAgICBfd3YucGFyZW50KCkuZXZhbEpTKCJtdWkmJm11aShkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXVpLWNvbnRlbnQnKSkucHVsbFJlZnJlc2goJyIgKyBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgIHdlYnZpZXdJZDogX3d2LmlkCiAgICAgICAgICB9KSArICInKS5fZW5kUHVsbGRvd25Ub1JlZnJlc2goKSIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfd3YuZW5kUHVsbFRvUmVmcmVzaCgpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZW5kUHVsbGRvd25Ub1JlZnJlc2g6IGZ1bmN0aW9uIGVuZFB1bGxkb3duVG9SZWZyZXNoKCkgewogICAgICAgIC8v6K+l5pa55rOV5piv5a2Q6aG16Z2i6LCD55So55qE77yM5YW85a656ICB55qE5Y6G5Y+yQVBJCiAgICAgICAgdGhpcy5lbmRQdWxsZG93bigpOwogICAgICB9LAogICAgICBfZW5kUHVsbGRvd25Ub1JlZnJlc2g6IGZ1bmN0aW9uIF9lbmRQdWxsZG93blRvUmVmcmVzaCgpIHsKICAgICAgICAvL+ivpeaWueazleaYr+eItumhtemdouiwg+eUqOeahAogICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgaWYgKHNlbGYudG9wUG9ja2V0ICYmIHNlbGYub3B0aW9ucy53ZWJ2aWV3KSB7CiAgICAgICAgICBzZWxmLm9wdGlvbnMud2Vidmlldy5lbmRQdWxsVG9SZWZyZXNoKCk7IC8v5LiL5ouJ5Yi35paw5omA5Zyod2Vidmlld+WbnuW8uQoKICAgICAgICAgIHNlbGYubG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgIHNlbGYuX3NldENhcHRpb24oc2VsZi5vcHRpb25zLmRvd24uY29udGVudGRvd24sIHRydWUpOwoKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBzZWxmLmxvYWRpbmcgfHwgc2VsZi50b3BQb2NrZXQuY2xhc3NMaXN0LnJlbW92ZShDTEFTU19CTE9DSyk7CiAgICAgICAgICB9LCAzNTApOwogICAgICAgIH0KICAgICAgfSwKICAgICAgYmVnaW5QdWxsdXA6IGZ1bmN0aW9uIGJlZ2luUHVsbHVwKGNhbGxiYWNrKSB7CiAgICAgICAgLy/lvIDlp4vkuIrmi4nliqDovb0KICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgaWYgKHNlbGYuaXNMb2FkaW5nKSByZXR1cm47CiAgICAgICAgc2VsZi5pc0xvYWRpbmcgPSB0cnVlOwoKICAgICAgICBpZiAoc2VsZi5wdWxsZG93biAhPT0gZmFsc2UpIHsKICAgICAgICAgIHNlbGYuX2luaXRQdWxsdXBSZWZyZXNoKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMucHVsbFBvY2tldC5jbGFzc0xpc3QuYWRkKENMQVNTX0JMT0NLKTsKICAgICAgICB9CgogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgc2VsZi5wdWxsTG9hZGluZy5jbGFzc0xpc3QuYWRkKENMQVNTX1ZJU0lCSUxJVFkpOwogICAgICAgICAgc2VsZi5wdWxsTG9hZGluZy5jbGFzc0xpc3QucmVtb3ZlKENMQVNTX0hJRERFTik7CiAgICAgICAgICBzZWxmLnB1bGxDYXB0aW9uLmlubmVySFRNTCA9ICcnOyAvL+S/ruatozUr6YeM6L6556ys5LiA5qyh5Yqg6L295pe277yM5paH5a2X5pi+56S655qEYnVnKOi/mOS8muaYvuekuuWHuuadpeS4quKAnOWkmuKAnSznjJzmtYvlupTor6XmmK/muLLmn5Ppl67popjlr7zoh7TnmoQpCgogICAgICAgICAgc2VsZi5wdWxsQ2FwdGlvbi5jbGFzc05hbWUgPSBDTEFTU19QVUxMX0NBUFRJT04gKyAnICcgKyBDTEFTU19QVUxMX0NBUFRJT05fUkVGUkVTSDsKICAgICAgICAgIHNlbGYucHVsbENhcHRpb24uaW5uZXJIVE1MID0gc2VsZi5vcHRpb25zLnVwLmNvbnRlbnRyZWZyZXNoOwogICAgICAgICAgY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBzZWxmLm9wdGlvbnMudXAuY2FsbGJhY2s7CiAgICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjay5jYWxsKHNlbGYpOwogICAgICAgIH0sIDMwMCk7CiAgICAgIH0sCiAgICAgIHB1bGx1cExvYWRpbmc6IGZ1bmN0aW9uIHB1bGx1cExvYWRpbmcoY2FsbGJhY2spIHsKICAgICAgICAvL+WFvOWuueiAgeeahEFQSQogICAgICAgIHRoaXMuYmVnaW5QdWxsdXAoY2FsbGJhY2spOwogICAgICB9LAogICAgICBlbmRQdWxsdXA6IGZ1bmN0aW9uIGVuZFB1bGx1cChmaW5pc2hlZCkgewogICAgICAgIC8v5LiK5ouJ5Yqg6L2957uT5p2fCiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICBpZiAoc2VsZi5wdWxsTG9hZGluZykgewogICAgICAgICAgc2VsZi5wdWxsTG9hZGluZy5jbGFzc0xpc3QucmVtb3ZlKENMQVNTX1ZJU0lCSUxJVFkpOwogICAgICAgICAgc2VsZi5wdWxsTG9hZGluZy5jbGFzc0xpc3QuYWRkKENMQVNTX0hJRERFTik7CiAgICAgICAgICBzZWxmLmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgIGlmIChmaW5pc2hlZCkgewogICAgICAgICAgICBzZWxmLmZpbmlzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgc2VsZi5wdWxsQ2FwdGlvbi5jbGFzc05hbWUgPSBDTEFTU19QVUxMX0NBUFRJT04gKyAnICcgKyBDTEFTU19QVUxMX0NBUFRJT05fTk9NT1JFOwogICAgICAgICAgICBzZWxmLnB1bGxDYXB0aW9uLmlubmVySFRNTCA9IHNlbGYub3B0aW9ucy51cC5jb250ZW50bm9tb3JlOyAvL+WPlua2iDUr55qEcGx1c3Njcm9sbGJvdHRvbeS6i+S7tgoKICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncGx1c3Njcm9sbGJvdHRvbScsIHNlbGYpOwogICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignZHJhZ3VwJywgc2VsZik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvL+WIneWni+WMluaXtumakOiXj++8jOWQjue7reS4jeWGjemakOiXjwogICAgICAgICAgICBzZWxmLnB1bGxDYXB0aW9uLmNsYXNzTmFtZSA9IENMQVNTX1BVTExfQ0FQVElPTiArICcgJyArIENMQVNTX1BVTExfQ0FQVElPTl9ET1dOOwogICAgICAgICAgICBzZWxmLnB1bGxDYXB0aW9uLmlubmVySFRNTCA9IHNlbGYub3B0aW9ucy51cC5jb250ZW50ZG93bjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIGVuZFB1bGx1cFRvUmVmcmVzaDogZnVuY3Rpb24gZW5kUHVsbHVwVG9SZWZyZXNoKGZpbmlzaGVkKSB7CiAgICAgICAgLy/kuIrmi4nliqDovb3nu5PmnZ/vvIzlhbzlrrnogIHnmoRBUEkKICAgICAgICB0aGlzLmVuZFB1bGx1cChmaW5pc2hlZCk7CiAgICAgIH0sCiAgICAgIGRpc2FibGVQdWxsZG93blRvUmVmcmVzaDogZnVuY3Rpb24gZGlzYWJsZVB1bGxkb3duVG9SZWZyZXNoKCkgewogICAgICAgIHZhciB3ZWJ2aWV3ID0gcGx1cy53ZWJ2aWV3LmN1cnJlbnRXZWJ2aWV3KCk7CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZG93bi5zdHlsZSAmJiB0aGlzLm9wdGlvbnMuZG93bi5zdHlsZSA9PSAnY2lyY2xlJykgewogICAgICAgICAgLy8g5Y2Vd2Vidmlld+aooeW8j+emgeatouWOn+eUn+S4i+aLieWIt+aWsAogICAgICAgICAgdGhpcy5vcHRpb25zLndlYnZpZXcuc2V0UHVsbFRvUmVmcmVzaCh7CiAgICAgICAgICAgIHN1cHBvcnQ6IGZhbHNlLAogICAgICAgICAgICBzdHlsZTogJ2NpcmNsZScKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyDlj4x3ZWJ2aWV35qih5byP56aB5q2i5LiL5ouJ5Yi35pawCiAgICAgICAgICB3ZWJ2aWV3LnNldFN0eWxlKHsKICAgICAgICAgICAgYm91bmNlOiAnbm9uZScKICAgICAgICAgIH0pOwogICAgICAgICAgd2Vidmlldy5zZXRCb3VuY2UoewogICAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICAgIHRvcDogJ25vbmUnCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZW5hYmxlUHVsbGRvd25Ub1JlZnJlc2g6IGZ1bmN0aW9uIGVuYWJsZVB1bGxkb3duVG9SZWZyZXNoKCkgewogICAgICAgIHZhciBzZWxmID0gdGhpcywKICAgICAgICAgICAgd2VidmlldyA9IHBsdXMud2Vidmlldy5jdXJyZW50V2VidmlldygpLAogICAgICAgICAgICBoZWlnaHQgPSB0aGlzLm9wdGlvbnMuZG93bi5oZWlnaHQ7IC8vIOWNlXdlYnZpZXfmqKHlvI/npoHmraLljp/nlJ/kuIvmi4nliLfmlrAKCiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5kb3duLnN0eWxlICYmIHRoaXMub3B0aW9ucy5kb3duLnN0eWxlID09ICdjaXJjbGUnKSB7CiAgICAgICAgICB3ZWJ2aWV3LnNldFB1bGxUb1JlZnJlc2goewogICAgICAgICAgICBzdXBwb3J0OiB0cnVlLAogICAgICAgICAgICBoZWlnaHQ6IGhlaWdodCB8fCAnNTBweCcsCiAgICAgICAgICAgIHJhbmdlOiBzZWxmLm9wdGlvbnMuZG93bi5yYW5nZSB8fCAnMTAwcHgnLAogICAgICAgICAgICBzdHlsZTogJ2NpcmNsZScsCiAgICAgICAgICAgIG9mZnNldDogc2VsZi5vcHRpb25zLmRvd24ub2Zmc2V0IHx8ICcwcHgnCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8g6YeN5paw5Yid5aeL5YyW5Y+Md2Vidmlld+aooeW8j+S4i+aLieWIt+aWsAogICAgICAgICAgd2Vidmlldy5zZXRTdHlsZSh7CiAgICAgICAgICAgIGJvdW5jZTogJ3ZlcnRpY2FsJwogICAgICAgICAgfSk7CiAgICAgICAgICB3ZWJ2aWV3LnNldEJvdW5jZSh7CiAgICAgICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICAgICAgdG9wOiBoZWlnaHQgKiAyICsgJ3B4JwogICAgICAgICAgICB9LAogICAgICAgICAgICBjaGFuZ2VvZmZzZXQ6IHsKICAgICAgICAgICAgICB0b3A6IGhlaWdodCArICdweCcKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBkaXNhYmxlUHVsbHVwVG9SZWZyZXNoOiBmdW5jdGlvbiBkaXNhYmxlUHVsbHVwVG9SZWZyZXNoKCkgewogICAgICAgIHRoaXMuX2luaXRQdWxsdXBSZWZyZXNoKCk7CgogICAgICAgIHRoaXMuYm90dG9tUG9ja2V0LmNsYXNzTmFtZSA9ICdtdWktcHVsbC1ib3R0b20tcG9ja2V0JyArICcgJyArIENMQVNTX0hJRERFTjsKICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignZHJhZ3VwJywgdGhpcyk7CiAgICAgIH0sCiAgICAgIGVuYWJsZVB1bGx1cFRvUmVmcmVzaDogZnVuY3Rpb24gZW5hYmxlUHVsbHVwVG9SZWZyZXNoKCkgewogICAgICAgIHRoaXMuX2luaXRQdWxsdXBSZWZyZXNoKCk7CgogICAgICAgIHRoaXMuYm90dG9tUG9ja2V0LmNsYXNzTGlzdC5yZW1vdmUoQ0xBU1NfSElEREVOKTsKICAgICAgICB0aGlzLnB1bGxDYXB0aW9uLmNsYXNzTmFtZSA9IENMQVNTX1BVTExfQ0FQVElPTiArICcgJyArIENMQVNTX1BVTExfQ0FQVElPTl9ET1dOOwogICAgICAgIHRoaXMucHVsbENhcHRpb24uaW5uZXJIVE1MID0gdGhpcy5vcHRpb25zLnVwLmNvbnRlbnRkb3duOwogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInBsdXNzY3JvbGxib3R0b20iLCB0aGlzKTsKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3VwJywgdGhpcyk7CiAgICAgIH0sCiAgICAgIHNjcm9sbFRvOiBmdW5jdGlvbiBzY3JvbGxUbyh4LCB5LCB0aW1lKSB7CiAgICAgICAgJC5zY3JvbGxUbyh5LCB0aW1lKTsKICAgICAgfSwKICAgICAgc2Nyb2xsVG9Cb3R0b206IGZ1bmN0aW9uIHNjcm9sbFRvQm90dG9tKHRpbWUpIHsKICAgICAgICAkLnNjcm9sbFRvKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxIZWlnaHQsIHRpbWUpOwogICAgICB9LAogICAgICByZWZyZXNoOiBmdW5jdGlvbiByZWZyZXNoKGlzUmVzZXQpIHsKICAgICAgICBpZiAoaXNSZXNldCAmJiB0aGlzLmZpbmlzaGVkKSB7CiAgICAgICAgICB0aGlzLmVuYWJsZVB1bGx1cFRvUmVmcmVzaCgpOwogICAgICAgICAgdGhpcy5maW5pc2hlZCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgfSwgJC5QdWxsUmVmcmVzaCkpOyAvL292ZXJyaWRlIGg1IHB1bGxSZWZyZXNoCgogICAgJC5mbi5wdWxsUmVmcmVzaF9uYXRpdmUgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICB2YXIgc2VsZjsKCiAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHNlbGYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBzZWxmLmNsYXNzTmFtZSA9ICdtdWktY29udGVudCc7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzZWxmKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZWxmID0gdGhpc1swXTsKICAgICAgfQoKICAgICAgdmFyIGFyZ3MgPSBvcHRpb25zOyAvL+S4gOS4queItumcgOimgeaUr+aMgeWkmuS4quWtkOS4i+aLieWIt+aWsAoKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgb3B0aW9ucyA9ICQucGFyc2VKU09OKG9wdGlvbnMpOwogICAgICB9CgogICAgICA7CiAgICAgICFvcHRpb25zLndlYnZpZXdJZCAmJiAob3B0aW9ucy53ZWJ2aWV3SWQgPSBwbHVzLndlYnZpZXcuY3VycmVudFdlYnZpZXcoKS5pZCB8fCBwbHVzLndlYnZpZXcuY3VycmVudFdlYnZpZXcoKS5nZXRVUkwoKSk7CiAgICAgIHZhciBwdWxsUmVmcmVzaEFwaSA9IG51bGw7CiAgICAgIHZhciBhdHRyV2Vidmlld0lkID0gb3B0aW9ucy53ZWJ2aWV3SWQgJiYgb3B0aW9ucy53ZWJ2aWV3SWQucmVwbGFjZSgvXC8vZywgIl8iKTsgLy/mm7/mjaLmiYDmnIkiLyIKCiAgICAgIHZhciBpZCA9IHNlbGYuZ2V0QXR0cmlidXRlKCdkYXRhLXB1bGxyZWZyZXNoLXBsdXMtJyArIGF0dHJXZWJ2aWV3SWQpOwoKICAgICAgaWYgKCFpZCAmJiB0eXBlb2YgYXJncyA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmICghaWQpIHsKICAgICAgICAvL+mBv+WFjemHjeWkjeWIneWni+WMljUrIHB1bGxyZWZyZXNoCiAgICAgICAgaWQgPSArKyQudXVpZDsKICAgICAgICBzZWxmLnNldEF0dHJpYnV0ZSgnZGF0YS1wdWxscmVmcmVzaC1wbHVzLScgKyBhdHRyV2Vidmlld0lkLCBpZCk7CiAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKENMQVNTX1BMVVNfUFVMTFJFRlJFU0gpOwogICAgICAgICQuZGF0YVtpZF0gPSBwdWxsUmVmcmVzaEFwaSA9IG5ldyBQbHVzUHVsbFJlZnJlc2goc2VsZiwgb3B0aW9ucyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHVsbFJlZnJlc2hBcGkgPSAkLmRhdGFbaWRdOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5kb3duICYmIG9wdGlvbnMuZG93bi5hdXRvKSB7CiAgICAgICAgLy/lpoLmnpzorr7nva7kuoZhdXRv77yM5YiZ6Ieq5Yqo5LiL5ouJ5LiA5qyhCiAgICAgICAgLy9wdWxsUmVmcmVzaEFwaS5fcHVsbGRvd25Mb2FkaW5nKCk7IC8vcGFyZW50IHdlYnZpZXcKICAgICAgICBwdWxsUmVmcmVzaEFwaS5iZWdpblB1bGxkb3duKCk7CiAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy51cCAmJiBvcHRpb25zLnVwLmF1dG8pIHsKICAgICAgICAvL+WmguaenOiuvue9ruS6hmF1dG/vvIzliJnoh6rliqjkuIrmi4nkuIDmrKEKICAgICAgICBwdWxsUmVmcmVzaEFwaS5iZWdpblB1bGx1cCgpOwogICAgICB9CgogICAgICByZXR1cm4gcHVsbFJlZnJlc2hBcGk7CiAgICB9OwogIH0pOwp9KShtdWksIGRvY3VtZW50KTsKLyoqCiAqIG9mZi1jYW52YXMKICogQHBhcmFtIHt0eXBlfSAkCiAqIEBwYXJhbSB7dHlwZX0gd2luZG93CiAqIEBwYXJhbSB7dHlwZX0gZG9jdW1lbnQKICogQHBhcmFtIHt0eXBlfSBhY3Rpb24KICogQHJldHVybnMge3VuZGVmaW5lZH0KICovCgoKKGZ1bmN0aW9uICgkLCB3aW5kb3csIGRvY3VtZW50LCBuYW1lKSB7CiAgdmFyIENMQVNTX09GRl9DQU5WQVNfTEVGVCA9ICdtdWktb2ZmLWNhbnZhcy1sZWZ0JzsKICB2YXIgQ0xBU1NfT0ZGX0NBTlZBU19SSUdIVCA9ICdtdWktb2ZmLWNhbnZhcy1yaWdodCc7CiAgdmFyIENMQVNTX0FDVElPTl9CQUNLRFJPUCA9ICdtdWktb2ZmLWNhbnZhcy1iYWNrZHJvcCc7CiAgdmFyIENMQVNTX09GRl9DQU5WQVNfV1JBUCA9ICdtdWktb2ZmLWNhbnZhcy13cmFwJzsKICB2YXIgQ0xBU1NfU0xJREVfSU4gPSAnbXVpLXNsaWRlLWluJzsKICB2YXIgQ0xBU1NfQUNUSVZFID0gJ211aS1hY3RpdmUnOwogIHZhciBDTEFTU19UUkFOU0lUSU9OSU5HID0gJ211aS10cmFuc2l0aW9uaW5nJzsKICB2YXIgU0VMRUNUT1JfSU5ORVJfV1JBUCA9ICcubXVpLWlubmVyLXdyYXAnOwogIHZhciBPZmZDYW52YXMgPSAkLkNsYXNzLmV4dGVuZCh7CiAgICBpbml0OiBmdW5jdGlvbiBpbml0KGVsZW1lbnQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy53cmFwcGVyID0gdGhpcy5lbGVtZW50ID0gZWxlbWVudDsKICAgICAgdGhpcy5zY3JvbGxlciA9IHRoaXMud3JhcHBlci5xdWVyeVNlbGVjdG9yKFNFTEVDVE9SX0lOTkVSX1dSQVApOwogICAgICB0aGlzLmNsYXNzTGlzdCA9IHRoaXMud3JhcHBlci5jbGFzc0xpc3Q7CgogICAgICBpZiAodGhpcy5zY3JvbGxlcikgewogICAgICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHsKICAgICAgICAgIGRyYWdUaHJlc2hvbGRYOiAxMCwKICAgICAgICAgIHNjYWxlOiAwLjgsCiAgICAgICAgICBvcGFjaXR5OiAwLjEsCiAgICAgICAgICBwcmV2ZW50RGVmYXVsdEV4Y2VwdGlvbjogewogICAgICAgICAgICB0YWdOYW1lOiAvXihJTlBVVHxURVhUQVJFQXxCVVRUT058U0VMRUNUfFZJREVPKSQvCiAgICAgICAgICB9CiAgICAgICAgfSwgb3B0aW9ucyk7CiAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCdtdWktZnVsbHNjcmVlbicpOyAvL2Z1bGxzY3JlZW4KCiAgICAgICAgdGhpcy5yZWZyZXNoKCk7CiAgICAgICAgdGhpcy5pbml0RXZlbnQoKTsKICAgICAgfQogICAgfSwKICAgIF9wcmV2ZW50RGVmYXVsdEV4Y2VwdGlvbjogZnVuY3Rpb24gX3ByZXZlbnREZWZhdWx0RXhjZXB0aW9uKGVsLCBleGNlcHRpb25zKSB7CiAgICAgIGZvciAodmFyIGkgaW4gZXhjZXB0aW9ucykgewogICAgICAgIGlmIChleGNlcHRpb25zW2ldLnRlc3QoZWxbaV0pKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICByZWZyZXNoOiBmdW5jdGlvbiByZWZyZXNoKG9mZkNhbnZhcykgewogICAgICAvLwkJCW9mZkNhbnZhcyAmJiAhb2ZmQ2FudmFzLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19BQ1RJVkUpICYmIHRoaXMuY2xhc3NMaXN0LnJlbW92ZShDTEFTU19BQ1RJVkUpOwogICAgICB0aGlzLnNsaWRlSW4gPSB0aGlzLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19TTElERV9JTik7CiAgICAgIHRoaXMuc2NhbGFibGUgPSB0aGlzLmNsYXNzTGlzdC5jb250YWlucygnbXVpLXNjYWxhYmxlJykgJiYgIXRoaXMuc2xpZGVJbjsKICAgICAgdGhpcy5zY3JvbGxlciA9IHRoaXMud3JhcHBlci5xdWVyeVNlbGVjdG9yKFNFTEVDVE9SX0lOTkVSX1dSQVApOyAvLwkJCSFvZmZDYW52YXMgJiYgdGhpcy5zY3JvbGxlci5jbGFzc0xpc3QucmVtb3ZlKENMQVNTX1RSQU5TSVRJT05JTkcpOwogICAgICAvLwkJCSFvZmZDYW52YXMgJiYgdGhpcy5zY3JvbGxlci5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJycpOwoKICAgICAgdGhpcy5vZmZDYW52YXNMZWZ0cyA9IHRoaXMud3JhcHBlci5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIENMQVNTX09GRl9DQU5WQVNfTEVGVCk7CiAgICAgIHRoaXMub2ZmQ2FudmFzUmlnaHRzID0gdGhpcy53cmFwcGVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgQ0xBU1NfT0ZGX0NBTlZBU19SSUdIVCk7CgogICAgICBpZiAob2ZmQ2FudmFzKSB7CiAgICAgICAgaWYgKG9mZkNhbnZhcy5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfT0ZGX0NBTlZBU19MRUZUKSkgewogICAgICAgICAgdGhpcy5vZmZDYW52YXNMZWZ0ID0gb2ZmQ2FudmFzOwogICAgICAgIH0gZWxzZSBpZiAob2ZmQ2FudmFzLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19PRkZfQ0FOVkFTX1JJR0hUKSkgewogICAgICAgICAgdGhpcy5vZmZDYW52YXNSaWdodCA9IG9mZkNhbnZhczsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5vZmZDYW52YXNSaWdodCA9IHRoaXMud3JhcHBlci5xdWVyeVNlbGVjdG9yKCcuJyArIENMQVNTX09GRl9DQU5WQVNfUklHSFQpOwogICAgICAgIHRoaXMub2ZmQ2FudmFzTGVmdCA9IHRoaXMud3JhcHBlci5xdWVyeVNlbGVjdG9yKCcuJyArIENMQVNTX09GRl9DQU5WQVNfTEVGVCk7CiAgICAgIH0KCiAgICAgIHRoaXMub2ZmQ2FudmFzUmlnaHRXaWR0aCA9IHRoaXMub2ZmQ2FudmFzTGVmdFdpZHRoID0gMDsKICAgICAgdGhpcy5vZmZDYW52YXNMZWZ0U2xpZGVJbiA9IHRoaXMub2ZmQ2FudmFzUmlnaHRTbGlkZUluID0gZmFsc2U7CgogICAgICBpZiAodGhpcy5vZmZDYW52YXNSaWdodCkgewogICAgICAgIHRoaXMub2ZmQ2FudmFzUmlnaHRXaWR0aCA9IHRoaXMub2ZmQ2FudmFzUmlnaHQub2Zmc2V0V2lkdGg7CiAgICAgICAgdGhpcy5vZmZDYW52YXNSaWdodFNsaWRlSW4gPSB0aGlzLnNsaWRlSW4gJiYgdGhpcy5vZmZDYW52YXNSaWdodC5wYXJlbnROb2RlID09PSB0aGlzLndyYXBwZXI7IC8vCQkJCXRoaXMub2ZmQ2FudmFzUmlnaHQuY2xhc3NMaXN0LnJlbW92ZShDTEFTU19UUkFOU0lUSU9OSU5HKTsKICAgICAgICAvLwkJCQl0aGlzLm9mZkNhbnZhc1JpZ2h0LmNsYXNzTGlzdC5yZW1vdmUoQ0xBU1NfQUNUSVZFKTsKICAgICAgICAvLwkJCQl0aGlzLm9mZkNhbnZhc1JpZ2h0LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnJyk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLm9mZkNhbnZhc0xlZnQpIHsKICAgICAgICB0aGlzLm9mZkNhbnZhc0xlZnRXaWR0aCA9IHRoaXMub2ZmQ2FudmFzTGVmdC5vZmZzZXRXaWR0aDsKICAgICAgICB0aGlzLm9mZkNhbnZhc0xlZnRTbGlkZUluID0gdGhpcy5zbGlkZUluICYmIHRoaXMub2ZmQ2FudmFzTGVmdC5wYXJlbnROb2RlID09PSB0aGlzLndyYXBwZXI7IC8vCQkJCXRoaXMub2ZmQ2FudmFzTGVmdC5jbGFzc0xpc3QucmVtb3ZlKENMQVNTX1RSQU5TSVRJT05JTkcpOwogICAgICAgIC8vCQkJCXRoaXMub2ZmQ2FudmFzTGVmdC5jbGFzc0xpc3QucmVtb3ZlKENMQVNTX0FDVElWRSk7CiAgICAgICAgLy8JCQkJdGhpcy5vZmZDYW52YXNMZWZ0LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnJyk7CiAgICAgIH0KCiAgICAgIHRoaXMuYmFja2Ryb3AgPSB0aGlzLnNjcm9sbGVyLnF1ZXJ5U2VsZWN0b3IoJy4nICsgQ0xBU1NfQUNUSU9OX0JBQ0tEUk9QKTsKICAgICAgdGhpcy5vcHRpb25zLmRyYWdUaHJlc2hvbGRYID0gdGhpcy5vcHRpb25zLmRyYWdUaHJlc2hvbGRYIHx8IDEwOwogICAgICB0aGlzLnZpc2libGUgPSBmYWxzZTsKICAgICAgdGhpcy5zdGFydFggPSBudWxsOwogICAgICB0aGlzLmxhc3RYID0gbnVsbDsKICAgICAgdGhpcy5vZmZzZXRYID0gbnVsbDsKICAgICAgdGhpcy5sYXN0VHJhbnNsYXRlWCA9IG51bGw7CiAgICB9LAogICAgaGFuZGxlRXZlbnQ6IGZ1bmN0aW9uIGhhbmRsZUV2ZW50KGUpIHsKICAgICAgc3dpdGNoIChlLnR5cGUpIHsKICAgICAgICBjYXNlICQuRVZFTlRfU1RBUlQ6CiAgICAgICAgICBlLnRhcmdldCAmJiAhdGhpcy5fcHJldmVudERlZmF1bHRFeGNlcHRpb24oZS50YXJnZXQsIHRoaXMub3B0aW9ucy5wcmV2ZW50RGVmYXVsdEV4Y2VwdGlvbikgJiYgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ3dlYmtpdFRyYW5zaXRpb25FbmQnOgogICAgICAgICAgLy/mnInkuKpidWfpnIDopoHlpITnkIbvvIzpnIDopoHogIPomZHlgYforr7msqHmnInop6blj5F3ZWJraXRUcmFuc2l0aW9uRW5k55qE5oOF5Ya1CiAgICAgICAgICBpZiAoZS50YXJnZXQgPT09IHRoaXMuc2Nyb2xsZXIpIHsKICAgICAgICAgICAgdGhpcy5fZGlzcGF0Y2hFdmVudCgpOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdkcmFnJzoKICAgICAgICAgIHZhciBkZXRhaWwgPSBlLmRldGFpbDsKCiAgICAgICAgICBpZiAoIXRoaXMuc3RhcnRYKSB7CiAgICAgICAgICAgIHRoaXMuc3RhcnRYID0gZGV0YWlsLmNlbnRlci54OwogICAgICAgICAgICB0aGlzLmxhc3RYID0gdGhpcy5zdGFydFg7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmxhc3RYID0gZGV0YWlsLmNlbnRlci54OwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghdGhpcy5pc0RyYWdnaW5nICYmIE1hdGguYWJzKHRoaXMubGFzdFggLSB0aGlzLnN0YXJ0WCkgPiB0aGlzLm9wdGlvbnMuZHJhZ1RocmVzaG9sZFggJiYgKGRldGFpbC5kaXJlY3Rpb24gPT09ICdsZWZ0JyB8fCBkZXRhaWwuZGlyZWN0aW9uID09PSAncmlnaHQnKSkgewogICAgICAgICAgICBpZiAodGhpcy5zbGlkZUluKSB7CiAgICAgICAgICAgICAgdGhpcy5zY3JvbGxlciA9IHRoaXMud3JhcHBlci5xdWVyeVNlbGVjdG9yKFNFTEVDVE9SX0lOTkVSX1dSQVApOwoKICAgICAgICAgICAgICBpZiAodGhpcy5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfQUNUSVZFKSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMub2ZmQ2FudmFzUmlnaHQgJiYgdGhpcy5vZmZDYW52YXNSaWdodC5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfQUNUSVZFKSkgewogICAgICAgICAgICAgICAgICB0aGlzLm9mZkNhbnZhcyA9IHRoaXMub2ZmQ2FudmFzUmlnaHQ7CiAgICAgICAgICAgICAgICAgIHRoaXMub2ZmQ2FudmFzV2lkdGggPSB0aGlzLm9mZkNhbnZhc1JpZ2h0V2lkdGg7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLm9mZkNhbnZhcyA9IHRoaXMub2ZmQ2FudmFzTGVmdDsKICAgICAgICAgICAgICAgICAgdGhpcy5vZmZDYW52YXNXaWR0aCA9IHRoaXMub2ZmQ2FudmFzTGVmdFdpZHRoOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoZGV0YWlsLmRpcmVjdGlvbiA9PT0gJ2xlZnQnICYmIHRoaXMub2ZmQ2FudmFzUmlnaHQpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5vZmZDYW52YXMgPSB0aGlzLm9mZkNhbnZhc1JpZ2h0OwogICAgICAgICAgICAgICAgICB0aGlzLm9mZkNhbnZhc1dpZHRoID0gdGhpcy5vZmZDYW52YXNSaWdodFdpZHRoOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkZXRhaWwuZGlyZWN0aW9uID09PSAncmlnaHQnICYmIHRoaXMub2ZmQ2FudmFzTGVmdCkgewogICAgICAgICAgICAgICAgICB0aGlzLm9mZkNhbnZhcyA9IHRoaXMub2ZmQ2FudmFzTGVmdDsKICAgICAgICAgICAgICAgICAgdGhpcy5vZmZDYW52YXNXaWR0aCA9IHRoaXMub2ZmQ2FudmFzTGVmdFdpZHRoOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxlciA9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmICh0aGlzLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19BQ1RJVkUpKSB7CiAgICAgICAgICAgICAgICBpZiAoZGV0YWlsLmRpcmVjdGlvbiA9PT0gJ2xlZnQnKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMub2ZmQ2FudmFzID0gdGhpcy5vZmZDYW52YXNMZWZ0OwogICAgICAgICAgICAgICAgICB0aGlzLm9mZkNhbnZhc1dpZHRoID0gdGhpcy5vZmZDYW52YXNMZWZ0V2lkdGg7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLm9mZkNhbnZhcyA9IHRoaXMub2ZmQ2FudmFzUmlnaHQ7CiAgICAgICAgICAgICAgICAgIHRoaXMub2ZmQ2FudmFzV2lkdGggPSB0aGlzLm9mZkNhbnZhc1JpZ2h0V2lkdGg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChkZXRhaWwuZGlyZWN0aW9uID09PSAncmlnaHQnKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMub2ZmQ2FudmFzID0gdGhpcy5vZmZDYW52YXNMZWZ0OwogICAgICAgICAgICAgICAgICB0aGlzLm9mZkNhbnZhc1dpZHRoID0gdGhpcy5vZmZDYW52YXNMZWZ0V2lkdGg7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLm9mZkNhbnZhcyA9IHRoaXMub2ZmQ2FudmFzUmlnaHQ7CiAgICAgICAgICAgICAgICAgIHRoaXMub2ZmQ2FudmFzV2lkdGggPSB0aGlzLm9mZkNhbnZhc1JpZ2h0V2lkdGg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5vZmZDYW52YXMgJiYgdGhpcy5zY3JvbGxlcikgewogICAgICAgICAgICAgIHRoaXMuc3RhcnRYID0gdGhpcy5sYXN0WDsKICAgICAgICAgICAgICB0aGlzLmlzRHJhZ2dpbmcgPSB0cnVlOwogICAgICAgICAgICAgICQuZ2VzdHVyZXMuc2Vzc2lvbi5sb2NrRGlyZWN0aW9uID0gdHJ1ZTsgLy/plIHlrprmlrnlkJEKCiAgICAgICAgICAgICAgJC5nZXN0dXJlcy5zZXNzaW9uLnN0YXJ0RGlyZWN0aW9uID0gZGV0YWlsLmRpcmVjdGlvbjsKICAgICAgICAgICAgICB0aGlzLm9mZkNhbnZhcy5jbGFzc0xpc3QucmVtb3ZlKENMQVNTX1RSQU5TSVRJT05JTkcpOwogICAgICAgICAgICAgIHRoaXMuc2Nyb2xsZXIuY2xhc3NMaXN0LnJlbW92ZShDTEFTU19UUkFOU0lUSU9OSU5HKTsKICAgICAgICAgICAgICB0aGlzLm9mZnNldFggPSB0aGlzLmdldFRyYW5zbGF0ZVgoKTsKCiAgICAgICAgICAgICAgdGhpcy5faW5pdE9mZkNhbnZhc1Zpc2libGUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLmlzRHJhZ2dpbmcpIHsKICAgICAgICAgICAgdGhpcy51cGRhdGVUcmFuc2xhdGUodGhpcy5vZmZzZXRYICsgKHRoaXMubGFzdFggLSB0aGlzLnN0YXJ0WCkpOwogICAgICAgICAgICBkZXRhaWwuZ2VzdHVyZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdkcmFnZW5kJzoKICAgICAgICAgIGlmICh0aGlzLmlzRHJhZ2dpbmcpIHsKICAgICAgICAgICAgdmFyIGRldGFpbCA9IGUuZGV0YWlsOwogICAgICAgICAgICB2YXIgZGlyZWN0aW9uID0gZGV0YWlsLmRpcmVjdGlvbjsKICAgICAgICAgICAgdGhpcy5pc0RyYWdnaW5nID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMub2ZmQ2FudmFzLmNsYXNzTGlzdC5hZGQoQ0xBU1NfVFJBTlNJVElPTklORyk7CiAgICAgICAgICAgIHRoaXMuc2Nyb2xsZXIuY2xhc3NMaXN0LmFkZChDTEFTU19UUkFOU0lUSU9OSU5HKTsKICAgICAgICAgICAgdmFyIHJhdGlvID0gMDsKICAgICAgICAgICAgdmFyIHggPSB0aGlzLmdldFRyYW5zbGF0ZVgoKTsKCiAgICAgICAgICAgIGlmICghdGhpcy5zbGlkZUluKSB7CiAgICAgICAgICAgICAgaWYgKHggPj0gMCkgewogICAgICAgICAgICAgICAgcmF0aW8gPSB0aGlzLm9mZkNhbnZhc0xlZnRXaWR0aCAmJiB4IC8gdGhpcy5vZmZDYW52YXNMZWZ0V2lkdGggfHwgMDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmF0aW8gPSB0aGlzLm9mZkNhbnZhc1JpZ2h0V2lkdGggJiYgeCAvIHRoaXMub2ZmQ2FudmFzUmlnaHRXaWR0aCB8fCAwOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJhdGlvID09PSAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLm9wZW5QZXJjZW50YWdlKDApOwoKICAgICAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoRXZlbnQoKTsgLy/mraTlpITkuI3op6blj5F3ZWJraXRUcmFuc2l0aW9uRW5kLOaJgOS7peaJi+WKqGRpc3BhdGNoCgoKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT09ICdyaWdodCcgJiYgcmF0aW8gPj0gMCAmJiAocmF0aW8gPj0gMC41IHx8IGRldGFpbC5zd2lwZSkpIHsKICAgICAgICAgICAgICAgIC8v5Y+z5ruR5omT5byACiAgICAgICAgICAgICAgICB0aGlzLm9wZW5QZXJjZW50YWdlKDEwMCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdyaWdodCcgJiYgcmF0aW8gPCAwICYmIChyYXRpbyA+IC0wLjUgfHwgZGV0YWlsLnN3aXBlKSkgewogICAgICAgICAgICAgICAgLy/lj7Pmu5HlhbPpl60KICAgICAgICAgICAgICAgIHRoaXMub3BlblBlcmNlbnRhZ2UoMCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdyaWdodCcgJiYgcmF0aW8gPiAwICYmIHJhdGlvIDwgMC41KSB7CiAgICAgICAgICAgICAgICAvL+WPs+a7kei/mOWOn+WFs+mXrQogICAgICAgICAgICAgICAgdGhpcy5vcGVuUGVyY2VudGFnZSgwKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gJ3JpZ2h0JyAmJiByYXRpbyA8IDAuNSkgewogICAgICAgICAgICAgICAgLy/lj7Pmu5Hov5jljp/miZPlvIAKICAgICAgICAgICAgICAgIHRoaXMub3BlblBlcmNlbnRhZ2UoLTEwMCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdsZWZ0JyAmJiByYXRpbyA8PSAwICYmIChyYXRpbyA8PSAtMC41IHx8IGRldGFpbC5zd2lwZSkpIHsKICAgICAgICAgICAgICAgIC8v5bem5ruR5omT5byACiAgICAgICAgICAgICAgICB0aGlzLm9wZW5QZXJjZW50YWdlKC0xMDApOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSAnbGVmdCcgJiYgcmF0aW8gPiAwICYmIChyYXRpbyA8PSAwLjUgfHwgZGV0YWlsLnN3aXBlKSkgewogICAgICAgICAgICAgICAgLy/lt6bmu5HlhbPpl60KICAgICAgICAgICAgICAgIHRoaXMub3BlblBlcmNlbnRhZ2UoMCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdsZWZ0JyAmJiByYXRpbyA8IDAgJiYgcmF0aW8gPj0gLTAuNSkgewogICAgICAgICAgICAgICAgLy/lt6bmu5Hov5jljp/lhbPpl60KICAgICAgICAgICAgICAgIHRoaXMub3BlblBlcmNlbnRhZ2UoMCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdsZWZ0JyAmJiByYXRpbyA+IDAuNSkgewogICAgICAgICAgICAgICAgLy/lt6bmu5Hov5jljp/miZPlvIAKICAgICAgICAgICAgICAgIHRoaXMub3BlblBlcmNlbnRhZ2UoMTAwKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy/pu5jorqTlhbPpl60KICAgICAgICAgICAgICAgIHRoaXMub3BlblBlcmNlbnRhZ2UoMCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocmF0aW8gPT09IDEgfHwgcmF0aW8gPT09IC0xKSB7CiAgICAgICAgICAgICAgICAvL+atpOWkhOS4jeinpuWPkXdlYmtpdFRyYW5zaXRpb25FbmQs5omA5Lul5omL5YqoZGlzcGF0Y2gKICAgICAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoRXZlbnQoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKHggPj0gMCkgewogICAgICAgICAgICAgICAgcmF0aW8gPSB0aGlzLm9mZkNhbnZhc1JpZ2h0V2lkdGggJiYgeCAvIHRoaXMub2ZmQ2FudmFzUmlnaHRXaWR0aCB8fCAwOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByYXRpbyA9IHRoaXMub2ZmQ2FudmFzTGVmdFdpZHRoICYmIHggLyB0aGlzLm9mZkNhbnZhc0xlZnRXaWR0aCB8fCAwOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ3JpZ2h0JyAmJiByYXRpbyA8PSAwICYmIChyYXRpbyA+PSAtMC41IHx8IGRldGFpbC5zd2lwZSkpIHsKICAgICAgICAgICAgICAgIC8v5Y+z5ruR5omT5byACiAgICAgICAgICAgICAgICB0aGlzLm9wZW5QZXJjZW50YWdlKDEwMCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdyaWdodCcgJiYgcmF0aW8gPiAwICYmIChyYXRpbyA+PSAwLjUgfHwgZGV0YWlsLnN3aXBlKSkgewogICAgICAgICAgICAgICAgLy/lj7Pmu5HlhbPpl60KICAgICAgICAgICAgICAgIHRoaXMub3BlblBlcmNlbnRhZ2UoMCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdyaWdodCcgJiYgcmF0aW8gPD0gLTAuNSkgewogICAgICAgICAgICAgICAgLy/lj7Pmu5Hov5jljp/lhbPpl60KICAgICAgICAgICAgICAgIHRoaXMub3BlblBlcmNlbnRhZ2UoMCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdyaWdodCcgJiYgcmF0aW8gPiAwICYmIHJhdGlvIDw9IDAuNSkgewogICAgICAgICAgICAgICAgLy/lj7Pmu5Hov5jljp/miZPlvIAKICAgICAgICAgICAgICAgIHRoaXMub3BlblBlcmNlbnRhZ2UoLTEwMCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdsZWZ0JyAmJiByYXRpbyA+PSAwICYmIChyYXRpbyA8PSAwLjUgfHwgZGV0YWlsLnN3aXBlKSkgewogICAgICAgICAgICAgICAgLy/lt6bmu5HmiZPlvIAKICAgICAgICAgICAgICAgIHRoaXMub3BlblBlcmNlbnRhZ2UoLTEwMCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdsZWZ0JyAmJiByYXRpbyA8IDAgJiYgKHJhdGlvIDw9IC0wLjUgfHwgZGV0YWlsLnN3aXBlKSkgewogICAgICAgICAgICAgICAgLy/lt6bmu5HlhbPpl60KICAgICAgICAgICAgICAgIHRoaXMub3BlblBlcmNlbnRhZ2UoMCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdsZWZ0JyAmJiByYXRpbyA+PSAwLjUpIHsKICAgICAgICAgICAgICAgIC8v5bem5ruR6L+Y5Y6f5YWz6ZetCiAgICAgICAgICAgICAgICB0aGlzLm9wZW5QZXJjZW50YWdlKDApOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSAnbGVmdCcgJiYgcmF0aW8gPj0gLTAuNSAmJiByYXRpbyA8IDApIHsKICAgICAgICAgICAgICAgIC8v5bem5ruR6L+Y5Y6f5omT5byACiAgICAgICAgICAgICAgICB0aGlzLm9wZW5QZXJjZW50YWdlKDEwMCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMub3BlblBlcmNlbnRhZ2UoMCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocmF0aW8gPT09IDEgfHwgcmF0aW8gPT09IC0xIHx8IHJhdGlvID09PSAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9kaXNwYXRjaEV2ZW50KCk7CgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAogICAgX2Rpc3BhdGNoRXZlbnQ6IGZ1bmN0aW9uIF9kaXNwYXRjaEV2ZW50KCkgewogICAgICBpZiAodGhpcy5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfQUNUSVZFKSkgewogICAgICAgICQudHJpZ2dlcih0aGlzLndyYXBwZXIsICdzaG93bicsIHRoaXMpOwogICAgICB9IGVsc2UgewogICAgICAgICQudHJpZ2dlcih0aGlzLndyYXBwZXIsICdoaWRkZW4nLCB0aGlzKTsKICAgICAgfQogICAgfSwKICAgIF9pbml0T2ZmQ2FudmFzVmlzaWJsZTogZnVuY3Rpb24gX2luaXRPZmZDYW52YXNWaXNpYmxlKCkgewogICAgICBpZiAoIXRoaXMudmlzaWJsZSkgewogICAgICAgIHRoaXMudmlzaWJsZSA9IHRydWU7CgogICAgICAgIGlmICh0aGlzLm9mZkNhbnZhc0xlZnQpIHsKICAgICAgICAgIHRoaXMub2ZmQ2FudmFzTGVmdC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMub2ZmQ2FudmFzUmlnaHQpIHsKICAgICAgICAgIHRoaXMub2ZmQ2FudmFzUmlnaHQuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJzsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBpbml0RXZlbnQ6IGZ1bmN0aW9uIGluaXRFdmVudCgpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgaWYgKHNlbGYuYmFja2Ryb3ApIHsKICAgICAgICBzZWxmLmJhY2tkcm9wLmFkZEV2ZW50TGlzdGVuZXIoJ3RhcCcsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBzZWxmLmNsb3NlKCk7CiAgICAgICAgICBlLmRldGFpbC5nZXN0dXJlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmNsYXNzTGlzdC5jb250YWlucygnbXVpLWRyYWdnYWJsZScpKSB7CiAgICAgICAgdGhpcy53cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJC5FVkVOVF9TVEFSVCwgdGhpcyk7IC8v5Li05pe25aSE55CGCgogICAgICAgIHRoaXMud3JhcHBlci5hZGRFdmVudExpc3RlbmVyKCdkcmFnJywgdGhpcyk7CiAgICAgICAgdGhpcy53cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbmQnLCB0aGlzKTsKICAgICAgfQoKICAgICAgdGhpcy53cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJ3dlYmtpdFRyYW5zaXRpb25FbmQnLCB0aGlzKTsKICAgIH0sCiAgICBvcGVuUGVyY2VudGFnZTogZnVuY3Rpb24gb3BlblBlcmNlbnRhZ2UocGVyY2VudGFnZSkgewogICAgICB2YXIgcCA9IHBlcmNlbnRhZ2UgLyAxMDA7CgogICAgICBpZiAoIXRoaXMuc2xpZGVJbikgewogICAgICAgIGlmICh0aGlzLm9mZkNhbnZhc0xlZnQgJiYgcGVyY2VudGFnZSA+PSAwKSB7CiAgICAgICAgICB0aGlzLnVwZGF0ZVRyYW5zbGF0ZSh0aGlzLm9mZkNhbnZhc0xlZnRXaWR0aCAqIHApOwogICAgICAgICAgdGhpcy5vZmZDYW52YXNMZWZ0LmNsYXNzTGlzdFtwICE9PSAwID8gJ2FkZCcgOiAncmVtb3ZlJ10oQ0xBU1NfQUNUSVZFKTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMub2ZmQ2FudmFzUmlnaHQgJiYgcGVyY2VudGFnZSA8PSAwKSB7CiAgICAgICAgICB0aGlzLnVwZGF0ZVRyYW5zbGF0ZSh0aGlzLm9mZkNhbnZhc1JpZ2h0V2lkdGggKiBwKTsKICAgICAgICAgIHRoaXMub2ZmQ2FudmFzUmlnaHQuY2xhc3NMaXN0W3AgIT09IDAgPyAnYWRkJyA6ICdyZW1vdmUnXShDTEFTU19BQ1RJVkUpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jbGFzc0xpc3RbcCAhPT0gMCA/ICdhZGQnIDogJ3JlbW92ZSddKENMQVNTX0FDVElWRSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRoaXMub2ZmQ2FudmFzTGVmdCAmJiBwZXJjZW50YWdlID49IDApIHsKICAgICAgICAgIHAgPSBwID09PSAwID8gLTEgOiAwOwogICAgICAgICAgdGhpcy51cGRhdGVUcmFuc2xhdGUodGhpcy5vZmZDYW52YXNMZWZ0V2lkdGggKiBwKTsKICAgICAgICAgIHRoaXMub2ZmQ2FudmFzTGVmdC5jbGFzc0xpc3RbcGVyY2VudGFnZSAhPT0gMCA/ICdhZGQnIDogJ3JlbW92ZSddKENMQVNTX0FDVElWRSk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLm9mZkNhbnZhc1JpZ2h0ICYmIHBlcmNlbnRhZ2UgPD0gMCkgewogICAgICAgICAgcCA9IHAgPT09IDAgPyAxIDogMDsKICAgICAgICAgIHRoaXMudXBkYXRlVHJhbnNsYXRlKHRoaXMub2ZmQ2FudmFzUmlnaHRXaWR0aCAqIHApOwogICAgICAgICAgdGhpcy5vZmZDYW52YXNSaWdodC5jbGFzc0xpc3RbcGVyY2VudGFnZSAhPT0gMCA/ICdhZGQnIDogJ3JlbW92ZSddKENMQVNTX0FDVElWRSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmNsYXNzTGlzdFtwZXJjZW50YWdlICE9PSAwID8gJ2FkZCcgOiAncmVtb3ZlJ10oQ0xBU1NfQUNUSVZFKTsKICAgICAgfQogICAgfSwKICAgIHVwZGF0ZVRyYW5zbGF0ZTogZnVuY3Rpb24gdXBkYXRlVHJhbnNsYXRlKHgpIHsKICAgICAgaWYgKHggIT09IHRoaXMubGFzdFRyYW5zbGF0ZVgpIHsKICAgICAgICBpZiAoIXRoaXMuc2xpZGVJbikgewogICAgICAgICAgaWYgKCF0aGlzLm9mZkNhbnZhc0xlZnQgJiYgeCA+IDAgfHwgIXRoaXMub2ZmQ2FudmFzUmlnaHQgJiYgeCA8IDApIHsKICAgICAgICAgICAgdGhpcy5zZXRUcmFuc2xhdGVYKDApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMubGVmdFNob3dpbmcgJiYgeCA+IHRoaXMub2ZmQ2FudmFzTGVmdFdpZHRoKSB7CiAgICAgICAgICAgIHRoaXMuc2V0VHJhbnNsYXRlWCh0aGlzLm9mZkNhbnZhc0xlZnRXaWR0aCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5yaWdodFNob3dpbmcgJiYgeCA8IC10aGlzLm9mZkNhbnZhc1JpZ2h0V2lkdGgpIHsKICAgICAgICAgICAgdGhpcy5zZXRUcmFuc2xhdGVYKC10aGlzLm9mZkNhbnZhc1JpZ2h0V2lkdGgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5zZXRUcmFuc2xhdGVYKHgpOwoKICAgICAgICAgIGlmICh4ID49IDApIHsKICAgICAgICAgICAgdGhpcy5sZWZ0U2hvd2luZyA9IHRydWU7CiAgICAgICAgICAgIHRoaXMucmlnaHRTaG93aW5nID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoeCA+IDApIHsKICAgICAgICAgICAgICBpZiAodGhpcy5vZmZDYW52YXNMZWZ0KSB7CiAgICAgICAgICAgICAgICAkLmVhY2godGhpcy5vZmZDYW52YXNMZWZ0cywgZnVuY3Rpb24gKGluZGV4LCBvZmZDYW52YXMpIHsKICAgICAgICAgICAgICAgICAgaWYgKG9mZkNhbnZhcyA9PT0gdGhpcy5vZmZDYW52YXNMZWZ0KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vZmZDYW52YXNMZWZ0LnN0eWxlLnpJbmRleCA9IDA7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgb2ZmQ2FudmFzLnN0eWxlLnpJbmRleCA9IC0xOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHRoaXMub2ZmQ2FudmFzUmlnaHQpIHsKICAgICAgICAgICAgICAgIHRoaXMub2ZmQ2FudmFzUmlnaHQuc3R5bGUuekluZGV4ID0gLTE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnJpZ2h0U2hvd2luZyA9IHRydWU7CiAgICAgICAgICAgIHRoaXMubGVmdFNob3dpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmICh0aGlzLm9mZkNhbnZhc1JpZ2h0KSB7CiAgICAgICAgICAgICAgJC5lYWNoKHRoaXMub2ZmQ2FudmFzUmlnaHRzLCBmdW5jdGlvbiAoaW5kZXgsIG9mZkNhbnZhcykgewogICAgICAgICAgICAgICAgaWYgKG9mZkNhbnZhcyA9PT0gdGhpcy5vZmZDYW52YXNSaWdodCkgewogICAgICAgICAgICAgICAgICBvZmZDYW52YXMuc3R5bGUuekluZGV4ID0gMDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIG9mZkNhbnZhcy5zdHlsZS56SW5kZXggPSAtMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LmJpbmQodGhpcykpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5vZmZDYW52YXNMZWZ0KSB7CiAgICAgICAgICAgICAgdGhpcy5vZmZDYW52YXNMZWZ0LnN0eWxlLnpJbmRleCA9IC0xOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICh0aGlzLm9mZkNhbnZhcy5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfT0ZGX0NBTlZBU19SSUdIVCkpIHsKICAgICAgICAgICAgaWYgKHggPCAwKSB7CiAgICAgICAgICAgICAgdGhpcy5zZXRUcmFuc2xhdGVYKDApOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHggPiB0aGlzLm9mZkNhbnZhc1JpZ2h0V2lkdGgpIHsKICAgICAgICAgICAgICB0aGlzLnNldFRyYW5zbGF0ZVgodGhpcy5vZmZDYW52YXNSaWdodFdpZHRoKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh4ID4gMCkgewogICAgICAgICAgICAgIHRoaXMuc2V0VHJhbnNsYXRlWCgwKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh4IDwgLXRoaXMub2ZmQ2FudmFzTGVmdFdpZHRoKSB7CiAgICAgICAgICAgICAgdGhpcy5zZXRUcmFuc2xhdGVYKC10aGlzLm9mZkNhbnZhc0xlZnRXaWR0aCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5zZXRUcmFuc2xhdGVYKHgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5sYXN0VHJhbnNsYXRlWCA9IHg7CiAgICAgIH0KICAgIH0sCiAgICBzZXRUcmFuc2xhdGVYOiAkLmFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICh4KSB7CiAgICAgIGlmICh0aGlzLnNjcm9sbGVyKSB7CiAgICAgICAgaWYgKHRoaXMuc2NhbGFibGUgJiYgdGhpcy5vZmZDYW52YXMucGFyZW50Tm9kZSA9PT0gdGhpcy53cmFwcGVyKSB7CiAgICAgICAgICB2YXIgcGVyY2VudCA9IE1hdGguYWJzKHgpIC8gdGhpcy5vZmZDYW52YXNXaWR0aDsKICAgICAgICAgIHZhciB6b29tT3V0U2NhbGUgPSAxIC0gKDEgLSB0aGlzLm9wdGlvbnMuc2NhbGUpICogcGVyY2VudDsKICAgICAgICAgIHZhciB6b29tSW5TY2FsZSA9IHRoaXMub3B0aW9ucy5zY2FsZSArICgxIC0gdGhpcy5vcHRpb25zLnNjYWxlKSAqIHBlcmNlbnQ7CiAgICAgICAgICB2YXIgem9vbU91dE9wYWNpdHkgPSAxIC0gKDEgLSB0aGlzLm9wdGlvbnMub3BhY2l0eSkgKiBwZXJjZW50OwogICAgICAgICAgdmFyIHpvb21Jbk9wYWNpdHkgPSB0aGlzLm9wdGlvbnMub3BhY2l0eSArICgxIC0gdGhpcy5vcHRpb25zLm9wYWNpdHkpICogcGVyY2VudDsKCiAgICAgICAgICBpZiAodGhpcy5vZmZDYW52YXMuY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX09GRl9DQU5WQVNfTEVGVCkpIHsKICAgICAgICAgICAgdGhpcy5vZmZDYW52YXMuc3R5bGUud2Via2l0VHJhbnNmb3JtT3JpZ2luID0gJy0xMDAlJzsKICAgICAgICAgICAgdGhpcy5zY3JvbGxlci5zdHlsZS53ZWJraXRUcmFuc2Zvcm1PcmlnaW4gPSAnbGVmdCc7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLm9mZkNhbnZhcy5zdHlsZS53ZWJraXRUcmFuc2Zvcm1PcmlnaW4gPSAnMjAwJSc7CiAgICAgICAgICAgIHRoaXMuc2Nyb2xsZXIuc3R5bGUud2Via2l0VHJhbnNmb3JtT3JpZ2luID0gJ3JpZ2h0JzsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLm9mZkNhbnZhcy5zdHlsZS5vcGFjaXR5ID0gem9vbUluT3BhY2l0eTsKICAgICAgICAgIHRoaXMub2ZmQ2FudmFzLnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICd0cmFuc2xhdGUzZCgwLDAsMCkgc2NhbGUoJyArIHpvb21JblNjYWxlICsgJyknOwogICAgICAgICAgdGhpcy5zY3JvbGxlci5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSAndHJhbnNsYXRlM2QoJyArIHggKyAncHgsMCwwKSBzY2FsZSgnICsgem9vbU91dFNjYWxlICsgJyknOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodGhpcy5zbGlkZUluKSB7CiAgICAgICAgICAgIHRoaXMub2ZmQ2FudmFzLnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICd0cmFuc2xhdGUzZCgnICsgeCArICdweCwwLDApJzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuc2Nyb2xsZXIuc3R5bGUud2Via2l0VHJhbnNmb3JtID0gJ3RyYW5zbGF0ZTNkKCcgKyB4ICsgJ3B4LDAsMCknOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSksCiAgICBnZXRUcmFuc2xhdGVYOiBmdW5jdGlvbiBnZXRUcmFuc2xhdGVYKCkgewogICAgICBpZiAodGhpcy5vZmZDYW52YXMpIHsKICAgICAgICB2YXIgc2Nyb2xsZXIgPSB0aGlzLnNsaWRlSW4gPyB0aGlzLm9mZkNhbnZhcyA6IHRoaXMuc2Nyb2xsZXI7CiAgICAgICAgdmFyIHJlc3VsdCA9ICQucGFyc2VUcmFuc2xhdGVNYXRyaXgoJC5nZXRTdHlsZXMoc2Nyb2xsZXIsICd3ZWJraXRUcmFuc2Zvcm0nKSk7CiAgICAgICAgcmV0dXJuIHJlc3VsdCAmJiByZXN1bHQueCB8fCAwOwogICAgICB9CgogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICBpc1Nob3duOiBmdW5jdGlvbiBpc1Nob3duKGRpcmVjdGlvbikgewogICAgICB2YXIgc2hvd24gPSBmYWxzZTsKCiAgICAgIGlmICghdGhpcy5zbGlkZUluKSB7CiAgICAgICAgdmFyIHggPSB0aGlzLmdldFRyYW5zbGF0ZVgoKTsKCiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ3JpZ2h0JykgewogICAgICAgICAgc2hvd24gPSB0aGlzLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19BQ1RJVkUpICYmIHggPCAwOwogICAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSAnbGVmdCcpIHsKICAgICAgICAgIHNob3duID0gdGhpcy5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfQUNUSVZFKSAmJiB4ID4gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2hvd24gPSB0aGlzLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19BQ1RJVkUpICYmIHggIT09IDA7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChkaXJlY3Rpb24gPT09ICdsZWZ0JykgewogICAgICAgICAgc2hvd24gPSB0aGlzLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19BQ1RJVkUpICYmIHRoaXMud3JhcHBlci5xdWVyeVNlbGVjdG9yKCcuJyArIENMQVNTX09GRl9DQU5WQVNfTEVGVCArICcuJyArIENMQVNTX0FDVElWRSk7CiAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdyaWdodCcpIHsKICAgICAgICAgIHNob3duID0gdGhpcy5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfQUNUSVZFKSAmJiB0aGlzLndyYXBwZXIucXVlcnlTZWxlY3RvcignLicgKyBDTEFTU19PRkZfQ0FOVkFTX1JJR0hUICsgJy4nICsgQ0xBU1NfQUNUSVZFKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2hvd24gPSB0aGlzLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19BQ1RJVkUpICYmICh0aGlzLndyYXBwZXIucXVlcnlTZWxlY3RvcignLicgKyBDTEFTU19PRkZfQ0FOVkFTX0xFRlQgKyAnLicgKyBDTEFTU19BQ1RJVkUpIHx8IHRoaXMud3JhcHBlci5xdWVyeVNlbGVjdG9yKCcuJyArIENMQVNTX09GRl9DQU5WQVNfUklHSFQgKyAnLicgKyBDTEFTU19BQ1RJVkUpKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBzaG93bjsKICAgIH0sCiAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgIHRoaXMuX2luaXRPZmZDYW52YXNWaXNpYmxlKCk7CgogICAgICB0aGlzLm9mZkNhbnZhcyA9IHRoaXMud3JhcHBlci5xdWVyeVNlbGVjdG9yKCcuJyArIENMQVNTX09GRl9DQU5WQVNfUklHSFQgKyAnLicgKyBDTEFTU19BQ1RJVkUpIHx8IHRoaXMud3JhcHBlci5xdWVyeVNlbGVjdG9yKCcuJyArIENMQVNTX09GRl9DQU5WQVNfTEVGVCArICcuJyArIENMQVNTX0FDVElWRSk7CiAgICAgIHRoaXMub2ZmQ2FudmFzV2lkdGggPSB0aGlzLm9mZkNhbnZhcy5vZmZzZXRXaWR0aDsKCiAgICAgIGlmICh0aGlzLnNjcm9sbGVyKSB7CiAgICAgICAgdGhpcy5vZmZDYW52YXMub2Zmc2V0SGVpZ2h0OwogICAgICAgIHRoaXMub2ZmQ2FudmFzLmNsYXNzTGlzdC5hZGQoQ0xBU1NfVFJBTlNJVElPTklORyk7CiAgICAgICAgdGhpcy5zY3JvbGxlci5jbGFzc0xpc3QuYWRkKENMQVNTX1RSQU5TSVRJT05JTkcpOwogICAgICAgIHRoaXMub3BlblBlcmNlbnRhZ2UoMCk7CiAgICAgIH0KICAgIH0sCiAgICBzaG93OiBmdW5jdGlvbiBzaG93KGRpcmVjdGlvbikgewogICAgICB0aGlzLl9pbml0T2ZmQ2FudmFzVmlzaWJsZSgpOwoKICAgICAgaWYgKHRoaXMuaXNTaG93bihkaXJlY3Rpb24pKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBpZiAoIWRpcmVjdGlvbikgewogICAgICAgIGRpcmVjdGlvbiA9IHRoaXMud3JhcHBlci5xdWVyeVNlbGVjdG9yKCcuJyArIENMQVNTX09GRl9DQU5WQVNfUklHSFQpID8gJ3JpZ2h0JyA6ICdsZWZ0JzsKICAgICAgfQoKICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ3JpZ2h0JykgewogICAgICAgIHRoaXMub2ZmQ2FudmFzID0gdGhpcy5vZmZDYW52YXNSaWdodDsKICAgICAgICB0aGlzLm9mZkNhbnZhc1dpZHRoID0gdGhpcy5vZmZDYW52YXNSaWdodFdpZHRoOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMub2ZmQ2FudmFzID0gdGhpcy5vZmZDYW52YXNMZWZ0OwogICAgICAgIHRoaXMub2ZmQ2FudmFzV2lkdGggPSB0aGlzLm9mZkNhbnZhc0xlZnRXaWR0aDsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2Nyb2xsZXIpIHsKICAgICAgICB0aGlzLm9mZkNhbnZhcy5vZmZzZXRIZWlnaHQ7CiAgICAgICAgdGhpcy5vZmZDYW52YXMuY2xhc3NMaXN0LmFkZChDTEFTU19UUkFOU0lUSU9OSU5HKTsKICAgICAgICB0aGlzLnNjcm9sbGVyLmNsYXNzTGlzdC5hZGQoQ0xBU1NfVFJBTlNJVElPTklORyk7CiAgICAgICAgdGhpcy5vcGVuUGVyY2VudGFnZShkaXJlY3Rpb24gPT09ICdsZWZ0JyA/IDEwMCA6IC0xMDApOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCiAgICB0b2dnbGU6IGZ1bmN0aW9uIHRvZ2dsZShkaXJlY3Rpb25Pck9mZkNhbnZhcykgewogICAgICB2YXIgZGlyZWN0aW9uID0gZGlyZWN0aW9uT3JPZmZDYW52YXM7CgogICAgICBpZiAoZGlyZWN0aW9uT3JPZmZDYW52YXMgJiYgZGlyZWN0aW9uT3JPZmZDYW52YXMuY2xhc3NMaXN0KSB7CiAgICAgICAgZGlyZWN0aW9uID0gZGlyZWN0aW9uT3JPZmZDYW52YXMuY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX09GRl9DQU5WQVNfTEVGVCkgPyAnbGVmdCcgOiAncmlnaHQnOwogICAgICAgIHRoaXMucmVmcmVzaChkaXJlY3Rpb25Pck9mZkNhbnZhcyk7CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5zaG93KGRpcmVjdGlvbikpIHsKICAgICAgICB0aGlzLmNsb3NlKCk7CiAgICAgIH0KICAgIH0KICB9KTsgLy9oYXNoIHRvIG9mZmNhbnZhcwoKICB2YXIgZmluZE9mZkNhbnZhc0NvbnRhaW5lciA9IGZ1bmN0aW9uIGZpbmRPZmZDYW52YXNDb250YWluZXIodGFyZ2V0KSB7CiAgICBwYXJlbnROb2RlID0gdGFyZ2V0LnBhcmVudE5vZGU7CgogICAgaWYgKHBhcmVudE5vZGUpIHsKICAgICAgaWYgKHBhcmVudE5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX09GRl9DQU5WQVNfV1JBUCkpIHsKICAgICAgICByZXR1cm4gcGFyZW50Tm9kZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwYXJlbnROb2RlID0gcGFyZW50Tm9kZS5wYXJlbnROb2RlOwoKICAgICAgICBpZiAocGFyZW50Tm9kZS5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfT0ZGX0NBTlZBU19XUkFQKSkgewogICAgICAgICAgcmV0dXJuIHBhcmVudE5vZGU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgdmFyIGhhbmRsZSA9IGZ1bmN0aW9uIGhhbmRsZShldmVudCwgdGFyZ2V0KSB7CiAgICBpZiAodGFyZ2V0LnRhZ05hbWUgPT09ICdBJyAmJiB0YXJnZXQuaGFzaCkgewogICAgICB2YXIgb2ZmY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFyZ2V0Lmhhc2gucmVwbGFjZSgnIycsICcnKSk7CgogICAgICBpZiAob2ZmY2FudmFzKSB7CiAgICAgICAgdmFyIGNvbnRhaW5lciA9IGZpbmRPZmZDYW52YXNDb250YWluZXIob2ZmY2FudmFzKTsKCiAgICAgICAgaWYgKGNvbnRhaW5lcikgewogICAgICAgICAgJC50YXJnZXRzLl9jb250YWluZXIgPSBjb250YWluZXI7CiAgICAgICAgICByZXR1cm4gb2ZmY2FudmFzOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9OwoKICAkLnJlZ2lzdGVyVGFyZ2V0KHsKICAgIG5hbWU6IG5hbWUsCiAgICBpbmRleDogNjAsCiAgICBoYW5kbGU6IGhhbmRsZSwKICAgIHRhcmdldDogZmFsc2UsCiAgICBpc1Jlc2V0OiBmYWxzZSwKICAgIGlzQ29udGludWU6IHRydWUKICB9KTsKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndGFwJywgZnVuY3Rpb24gKGUpIHsKICAgIGlmICghJC50YXJnZXRzLm9mZmNhbnZhcykgewogICAgICByZXR1cm47CiAgICB9IC8vVE9ETyDmraTlpITnsbvlnovnmoTku6PnoIHlkI7nu63ogIPomZHnu5/kuIDkvJjljJYodGFyZ2V05py65Yi2Ke+8jOeOsOWcqOeahOWunueOsOi0ueWKm+S4jeiuqOWlvQoKCiAgICB2YXIgdGFyZ2V0ID0gZS50YXJnZXQ7CgogICAgZm9yICg7IHRhcmdldCAmJiB0YXJnZXQgIT09IGRvY3VtZW50OyB0YXJnZXQgPSB0YXJnZXQucGFyZW50Tm9kZSkgewogICAgICBpZiAodGFyZ2V0LnRhZ05hbWUgPT09ICdBJyAmJiB0YXJnZXQuaGFzaCAmJiB0YXJnZXQuaGFzaCA9PT0gJyMnICsgJC50YXJnZXRzLm9mZmNhbnZhcy5pZCkgewogICAgICAgIGUuZGV0YWlsICYmIGUuZGV0YWlsLmdlc3R1cmUgJiYgZS5kZXRhaWwuZ2VzdHVyZS5wcmV2ZW50RGVmYXVsdCgpOyAvL2ZpeGVkIGhhc2hjaGFuZ2UKCiAgICAgICAgJCgkLnRhcmdldHMuX2NvbnRhaW5lcikub2ZmQ2FudmFzKCkudG9nZ2xlKCQudGFyZ2V0cy5vZmZjYW52YXMpOwogICAgICAgICQudGFyZ2V0cy5vZmZjYW52YXMgPSAkLnRhcmdldHMuX2NvbnRhaW5lciA9IG51bGw7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9KTsKCiAgJC5mbi5vZmZDYW52YXMgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgdmFyIG9mZkNhbnZhc0FwaXMgPSBbXTsKICAgIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBvZmZDYW52YXNBcGkgPSBudWxsOwogICAgICB2YXIgc2VsZiA9IHRoaXM7IC8vaGFjayBvbGQgdmVyc2lvbgoKICAgICAgaWYgKCFzZWxmLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19PRkZfQ0FOVkFTX1dSQVApKSB7CiAgICAgICAgc2VsZiA9IGZpbmRPZmZDYW52YXNDb250YWluZXIoc2VsZik7CiAgICAgIH0KCiAgICAgIHZhciBpZCA9IHNlbGYuZ2V0QXR0cmlidXRlKCdkYXRhLW9mZkNhbnZhcycpOwoKICAgICAgaWYgKCFpZCkgewogICAgICAgIGlkID0gKyskLnV1aWQ7CiAgICAgICAgJC5kYXRhW2lkXSA9IG9mZkNhbnZhc0FwaSA9IG5ldyBPZmZDYW52YXMoc2VsZiwgb3B0aW9ucyk7CiAgICAgICAgc2VsZi5zZXRBdHRyaWJ1dGUoJ2RhdGEtb2ZmQ2FudmFzJywgaWQpOwogICAgICB9IGVsc2UgewogICAgICAgIG9mZkNhbnZhc0FwaSA9ICQuZGF0YVtpZF07CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zID09PSAnc2hvdycgfHwgb3B0aW9ucyA9PT0gJ2Nsb3NlJyB8fCBvcHRpb25zID09PSAndG9nZ2xlJykgewogICAgICAgIG9mZkNhbnZhc0FwaS50b2dnbGUoKTsKICAgICAgfQoKICAgICAgb2ZmQ2FudmFzQXBpcy5wdXNoKG9mZkNhbnZhc0FwaSk7CiAgICB9KTsKICAgIHJldHVybiBvZmZDYW52YXNBcGlzLmxlbmd0aCA9PT0gMSA/IG9mZkNhbnZhc0FwaXNbMF0gOiBvZmZDYW52YXNBcGlzOwogIH07CgogICQucmVhZHkoZnVuY3Rpb24gKCkgewogICAgJCgnLm11aS1vZmYtY2FudmFzLXdyYXAnKS5vZmZDYW52YXMoKTsKICB9KTsKfSkobXVpLCB3aW5kb3csIGRvY3VtZW50LCAnb2ZmY2FudmFzJyk7Ci8qKgogKiBhY3Rpb25zCiAqIEBwYXJhbSB7dHlwZX0gJAogKiBAcGFyYW0ge3R5cGV9IG5hbWUKICogQHJldHVybnMge3VuZGVmaW5lZH0KICovCgoKKGZ1bmN0aW9uICgkLCBuYW1lKSB7CiAgdmFyIENMQVNTX0FDVElPTiA9ICdtdWktYWN0aW9uJzsKCiAgdmFyIGhhbmRsZSA9IGZ1bmN0aW9uIGhhbmRsZShldmVudCwgdGFyZ2V0KSB7CiAgICB2YXIgY2xhc3NOYW1lID0gdGFyZ2V0LmNsYXNzTmFtZSB8fCAnJzsKCiAgICBpZiAodHlwZW9mIGNsYXNzTmFtZSAhPT0gJ3N0cmluZycpIHsKICAgICAgLy9zdmcgY2xhc3NOYW1lKFNWR0FuaW1hdGVkU3RyaW5nKQogICAgICBjbGFzc05hbWUgPSAnJzsKICAgIH0KCiAgICBpZiAoY2xhc3NOYW1lICYmIH5jbGFzc05hbWUuaW5kZXhPZihDTEFTU19BQ1RJT04pKSB7CiAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtdWktYWN0aW9uLWJhY2snKSkgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH07CgogICQucmVnaXN0ZXJUYXJnZXQoewogICAgbmFtZTogbmFtZSwKICAgIGluZGV4OiA1MCwKICAgIGhhbmRsZTogaGFuZGxlLAogICAgdGFyZ2V0OiBmYWxzZSwKICAgIGlzQ29udGludWU6IHRydWUKICB9KTsKfSkobXVpLCAnYWN0aW9uJyk7Ci8qKgogKiBNb2RhbHMKICogQHBhcmFtIHt0eXBlfSAkCiAqIEBwYXJhbSB7dHlwZX0gd2luZG93CiAqIEBwYXJhbSB7dHlwZX0gZG9jdW1lbnQKICogQHBhcmFtIHt0eXBlfSBuYW1lCiAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAqLwoKCihmdW5jdGlvbiAoJCwgd2luZG93LCBkb2N1bWVudCwgbmFtZSkgewogIHZhciBDTEFTU19NT0RBTCA9ICdtdWktbW9kYWwnOwoKICB2YXIgaGFuZGxlID0gZnVuY3Rpb24gaGFuZGxlKGV2ZW50LCB0YXJnZXQpIHsKICAgIGlmICh0YXJnZXQudGFnTmFtZSA9PT0gJ0EnICYmIHRhcmdldC5oYXNoKSB7CiAgICAgIHZhciBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhcmdldC5oYXNoLnJlcGxhY2UoJyMnLCAnJykpOwoKICAgICAgaWYgKG1vZGFsICYmIG1vZGFsLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19NT0RBTCkpIHsKICAgICAgICByZXR1cm4gbW9kYWw7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZmFsc2U7CiAgfTsKCiAgJC5yZWdpc3RlclRhcmdldCh7CiAgICBuYW1lOiBuYW1lLAogICAgaW5kZXg6IDUwLAogICAgaGFuZGxlOiBoYW5kbGUsCiAgICB0YXJnZXQ6IGZhbHNlLAogICAgaXNSZXNldDogZmFsc2UsCiAgICBpc0NvbnRpbnVlOiB0cnVlCiAgfSk7CiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RhcCcsIGZ1bmN0aW9uIChldmVudCkgewogICAgaWYgKCQudGFyZ2V0cy5tb2RhbCkgewogICAgICBldmVudC5kZXRhaWwuZ2VzdHVyZS5wcmV2ZW50RGVmYXVsdCgpOyAvL2ZpeGVkIGhhc2hjaGFuZ2UKCiAgICAgICQudGFyZ2V0cy5tb2RhbC5jbGFzc0xpc3QudG9nZ2xlKCdtdWktYWN0aXZlJyk7CiAgICB9CiAgfSk7Cn0pKG11aSwgd2luZG93LCBkb2N1bWVudCwgJ21vZGFsJyk7Ci8qKgogKiBQb3BvdmVycwogKiBAcGFyYW0ge3R5cGV9ICQKICogQHBhcmFtIHt0eXBlfSB3aW5kb3cKICogQHBhcmFtIHt0eXBlfSBkb2N1bWVudAogKiBAcGFyYW0ge3R5cGV9IG5hbWUKICogQHBhcmFtIHt0eXBlfSB1bmRlZmluZWQKICogQHJldHVybnMge3VuZGVmaW5lZH0KICovCgoKKGZ1bmN0aW9uICgkLCB3aW5kb3csIGRvY3VtZW50LCBuYW1lKSB7CiAgdmFyIENMQVNTX1BPUE9WRVIgPSAnbXVpLXBvcG92ZXInOwogIHZhciBDTEFTU19QT1BPVkVSX0FSUk9XID0gJ211aS1wb3BvdmVyLWFycm93JzsKICB2YXIgQ0xBU1NfQUNUSU9OX1BPUE9WRVIgPSAnbXVpLXBvcG92ZXItYWN0aW9uJzsKICB2YXIgQ0xBU1NfQkFDS0RST1AgPSAnbXVpLWJhY2tkcm9wJzsKICB2YXIgQ0xBU1NfQkFSX1BPUE9WRVIgPSAnbXVpLWJhci1wb3BvdmVyJzsKICB2YXIgQ0xBU1NfQkFSX0JBQ0tEUk9QID0gJ211aS1iYXItYmFja2Ryb3AnOwogIHZhciBDTEFTU19BQ1RJT05fQkFDS0RST1AgPSAnbXVpLWJhY2tkcm9wLWFjdGlvbic7CiAgdmFyIENMQVNTX0FDVElWRSA9ICdtdWktYWN0aXZlJzsKICB2YXIgQ0xBU1NfQk9UVE9NID0gJ211aS1ib3R0b20nOwoKICB2YXIgaGFuZGxlID0gZnVuY3Rpb24gaGFuZGxlKGV2ZW50LCB0YXJnZXQpIHsKICAgIGlmICh0YXJnZXQudGFnTmFtZSA9PT0gJ0EnICYmIHRhcmdldC5oYXNoKSB7CiAgICAgICQudGFyZ2V0cy5fcG9wb3ZlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhcmdldC5oYXNoLnJlcGxhY2UoJyMnLCAnJykpOwoKICAgICAgaWYgKCQudGFyZ2V0cy5fcG9wb3ZlciAmJiAkLnRhcmdldHMuX3BvcG92ZXIuY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX1BPUE9WRVIpKSB7CiAgICAgICAgcmV0dXJuIHRhcmdldDsKICAgICAgfSBlbHNlIHsKICAgICAgICAkLnRhcmdldHMuX3BvcG92ZXIgPSBudWxsOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH07CgogICQucmVnaXN0ZXJUYXJnZXQoewogICAgbmFtZTogbmFtZSwKICAgIGluZGV4OiA2MCwKICAgIGhhbmRsZTogaGFuZGxlLAogICAgdGFyZ2V0OiBmYWxzZSwKICAgIGlzUmVzZXQ6IGZhbHNlLAogICAgaXNDb250aW51ZTogdHJ1ZQogIH0pOwoKICB2YXIgb25Qb3BvdmVyU2hvd24gPSBmdW5jdGlvbiBvblBvcG92ZXJTaG93bihlKSB7CiAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3dlYmtpdFRyYW5zaXRpb25FbmQnLCBvblBvcG92ZXJTaG93bik7CiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoJC5FVkVOVF9NT1ZFLCAkLnByZXZlbnREZWZhdWx0KTsKICAgICQudHJpZ2dlcih0aGlzLCAnc2hvd24nLCB0aGlzKTsKICB9OwoKICB2YXIgb25Qb3BvdmVySGlkZGVuID0gZnVuY3Rpb24gb25Qb3BvdmVySGlkZGVuKGUpIHsKICAgIHNldFN0eWxlKHRoaXMsICdub25lJyk7CiAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3dlYmtpdFRyYW5zaXRpb25FbmQnLCBvblBvcG92ZXJIaWRkZW4pOwogICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKCQuRVZFTlRfTU9WRSwgJC5wcmV2ZW50RGVmYXVsdCk7CiAgICAkLnRyaWdnZXIodGhpcywgJ2hpZGRlbicsIHRoaXMpOwogIH07CgogIHZhciBiYWNrZHJvcCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoQ0xBU1NfQkFDS0RST1ApOwogICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCQuRVZFTlRfTU9WRSwgJC5wcmV2ZW50RGVmYXVsdCk7CiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RhcCcsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciBwb3BvdmVyID0gJC50YXJnZXRzLl9wb3BvdmVyOwoKICAgICAgaWYgKHBvcG92ZXIpIHsKICAgICAgICBwb3BvdmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3dlYmtpdFRyYW5zaXRpb25FbmQnLCBvblBvcG92ZXJIaWRkZW4pOwogICAgICAgIHBvcG92ZXIuY2xhc3NMaXN0LnJlbW92ZShDTEFTU19BQ1RJVkUpOwogICAgICAgIHJlbW92ZUJhY2tkcm9wKHBvcG92ZXIpOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBlbGVtZW50OwogIH0oKTsKCiAgdmFyIHJlbW92ZUJhY2tkcm9wVGltZXI7CgogIHZhciByZW1vdmVCYWNrZHJvcCA9IGZ1bmN0aW9uIHJlbW92ZUJhY2tkcm9wKHBvcG92ZXIpIHsKICAgIGJhY2tkcm9wLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnb3BhY2l0eTowJyk7CiAgICAkLnRhcmdldHMucG9wb3ZlciA9ICQudGFyZ2V0cy5fcG9wb3ZlciA9IG51bGw7IC8vcmVzZXQKCiAgICByZW1vdmVCYWNrZHJvcFRpbWVyID0gJC5sYXRlcihmdW5jdGlvbiAoKSB7CiAgICAgIGlmICghcG9wb3Zlci5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfQUNUSVZFKSAmJiBiYWNrZHJvcC5wYXJlbnROb2RlICYmIGJhY2tkcm9wLnBhcmVudE5vZGUgPT09IGRvY3VtZW50LmJvZHkpIHsKICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGJhY2tkcm9wKTsKICAgICAgfQogICAgfSwgMzUwKTsKICB9OwoKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndGFwJywgZnVuY3Rpb24gKGUpIHsKICAgIGlmICghJC50YXJnZXRzLnBvcG92ZXIpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciB0b2dnbGUgPSBmYWxzZTsKICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDsKCiAgICBmb3IgKDsgdGFyZ2V0ICYmIHRhcmdldCAhPT0gZG9jdW1lbnQ7IHRhcmdldCA9IHRhcmdldC5wYXJlbnROb2RlKSB7CiAgICAgIGlmICh0YXJnZXQgPT09ICQudGFyZ2V0cy5wb3BvdmVyKSB7CiAgICAgICAgdG9nZ2xlID0gdHJ1ZTsKICAgICAgfQogICAgfQoKICAgIGlmICh0b2dnbGUpIHsKICAgICAgZS5kZXRhaWwuZ2VzdHVyZS5wcmV2ZW50RGVmYXVsdCgpOyAvL2ZpeGVkIGhhc2hjaGFuZ2UKCiAgICAgIHRvZ2dsZVBvcG92ZXIoJC50YXJnZXRzLl9wb3BvdmVyLCAkLnRhcmdldHMucG9wb3Zlcik7CiAgICB9CiAgfSk7CgogIHZhciB0b2dnbGVQb3BvdmVyID0gZnVuY3Rpb24gdG9nZ2xlUG9wb3Zlcihwb3BvdmVyLCBhbmNob3IsIHN0YXRlKSB7CiAgICBpZiAoc3RhdGUgPT09ICdzaG93JyAmJiBwb3BvdmVyLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19BQ1RJVkUpIHx8IHN0YXRlID09PSAnaGlkZScgJiYgIXBvcG92ZXIuY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX0FDVElWRSkpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHJlbW92ZUJhY2tkcm9wVGltZXIgJiYgcmVtb3ZlQmFja2Ryb3BUaW1lci5jYW5jZWwoKTsgLy/lj5bmtohyZW1vdmXnmoR0aW1lcgogICAgLy9yZW1vdmXkuIDpgY3vvIzku6XlhY3mnaXlm57lv6vpgJ/liIfmjaLvvIzlr7zoh7R3ZWJraXRUcmFuc2l0aW9uRW5k5LiN6Kem5Y+R77yM5peg5rOVcmVtb3ZlCgogICAgcG9wb3Zlci5yZW1vdmVFdmVudExpc3RlbmVyKCd3ZWJraXRUcmFuc2l0aW9uRW5kJywgb25Qb3BvdmVyU2hvd24pOwogICAgcG9wb3Zlci5yZW1vdmVFdmVudExpc3RlbmVyKCd3ZWJraXRUcmFuc2l0aW9uRW5kJywgb25Qb3BvdmVySGlkZGVuKTsKICAgIGJhY2tkcm9wLmNsYXNzTGlzdC5yZW1vdmUoQ0xBU1NfQkFSX0JBQ0tEUk9QKTsKICAgIGJhY2tkcm9wLmNsYXNzTGlzdC5yZW1vdmUoQ0xBU1NfQUNUSU9OX0JBQ0tEUk9QKTsKCiAgICB2YXIgX3BvcG92ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXVpLXBvcG92ZXIubXVpLWFjdGl2ZScpOwoKICAgIGlmIChfcG9wb3ZlcikgewogICAgICAvLwkJCV9wb3BvdmVyLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnJyk7CiAgICAgIF9wb3BvdmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3dlYmtpdFRyYW5zaXRpb25FbmQnLCBvblBvcG92ZXJIaWRkZW4pOwoKICAgICAgX3BvcG92ZXIuY2xhc3NMaXN0LnJlbW92ZShDTEFTU19BQ1RJVkUpOyAvLwkJCV9wb3BvdmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3dlYmtpdFRyYW5zaXRpb25FbmQnLCBvblBvcG92ZXJIaWRkZW4pOwogICAgICAvL+WQjOS4gOS4quW8ueWHuuWImeebtOaOpei/lOWbnu+8jOino+WGs+WQjOS4gOS4qnBvcG92ZXLnmoR0b2dnbGUKCgogICAgICBpZiAocG9wb3ZlciA9PT0gX3BvcG92ZXIpIHsKICAgICAgICByZW1vdmVCYWNrZHJvcChfcG9wb3Zlcik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CgogICAgdmFyIGlzQWN0aW9uU2hlZXQgPSBmYWxzZTsKCiAgICBpZiAocG9wb3Zlci5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfQkFSX1BPUE9WRVIpIHx8IHBvcG92ZXIuY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX0FDVElPTl9QT1BPVkVSKSkgewogICAgICAvL25hdkJhcgogICAgICBpZiAocG9wb3Zlci5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfQUNUSU9OX1BPUE9WRVIpKSB7CiAgICAgICAgLy9hY3Rpb24gc2hlZXQgcG9wb3ZlcgogICAgICAgIGlzQWN0aW9uU2hlZXQgPSB0cnVlOwogICAgICAgIGJhY2tkcm9wLmNsYXNzTGlzdC5hZGQoQ0xBU1NfQUNUSU9OX0JBQ0tEUk9QKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvL2JhciBwb3BvdmVyCiAgICAgICAgYmFja2Ryb3AuY2xhc3NMaXN0LmFkZChDTEFTU19CQVJfQkFDS0RST1ApOyAvLwkJCQlpZiAoYW5jaG9yKSB7CiAgICAgICAgLy8JCQkJCWlmIChhbmNob3IucGFyZW50Tm9kZSkgewogICAgICAgIC8vCQkJCQkJdmFyIG9mZnNldFdpZHRoID0gYW5jaG9yLm9mZnNldFdpZHRoOwogICAgICAgIC8vCQkJCQkJdmFyIG9mZnNldExlZnQgPSBhbmNob3Iub2Zmc2V0TGVmdDsKICAgICAgICAvLwkJCQkJCXZhciBpbm5lcldpZHRoID0gd2luZG93LmlubmVyV2lkdGg7CiAgICAgICAgLy8JCQkJCQlwb3BvdmVyLnN0eWxlLmxlZnQgPSAoTWF0aC5taW4oTWF0aC5tYXgob2Zmc2V0TGVmdCwgZGVmYXVsdFBhZGRpbmcpLCBpbm5lcldpZHRoIC0gb2Zmc2V0V2lkdGggLSBkZWZhdWx0UGFkZGluZykpICsgInB4IjsKICAgICAgICAvLwkJCQkJfSBlbHNlIHsKICAgICAgICAvLwkJCQkJCS8vVE9ETyBhbmNob3IgaXMgcG9zaXRpb246e2xlZnQsdG9wLGJvdHRvbSxyaWdodH0KICAgICAgICAvLwkJCQkJfQogICAgICAgIC8vCQkJCX0KICAgICAgfQogICAgfQoKICAgIHNldFN0eWxlKHBvcG92ZXIsICdibG9jaycpOyAvL2FjdGlvbnNoZWV0IHRyYW5zZm9ybQoKICAgIHBvcG92ZXIub2Zmc2V0SGVpZ2h0OwogICAgcG9wb3Zlci5jbGFzc0xpc3QuYWRkKENMQVNTX0FDVElWRSk7CiAgICBiYWNrZHJvcC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJycpOwogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChiYWNrZHJvcCk7CiAgICBjYWxQb3NpdGlvbihwb3BvdmVyLCBhbmNob3IsIGlzQWN0aW9uU2hlZXQpOyAvL3Bvc2l0aW9uCgogICAgYmFja2Ryb3AuY2xhc3NMaXN0LmFkZChDTEFTU19BQ1RJVkUpOwogICAgcG9wb3Zlci5hZGRFdmVudExpc3RlbmVyKCd3ZWJraXRUcmFuc2l0aW9uRW5kJywgb25Qb3BvdmVyU2hvd24pOwogIH07CgogIHZhciBzZXRTdHlsZSA9IGZ1bmN0aW9uIHNldFN0eWxlKHBvcG92ZXIsIGRpc3BsYXksIHRvcCwgbGVmdCkgewogICAgdmFyIHN0eWxlID0gcG9wb3Zlci5zdHlsZTsKICAgIGlmICh0eXBlb2YgZGlzcGxheSAhPT0gJ3VuZGVmaW5lZCcpIHN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5OwogICAgaWYgKHR5cGVvZiB0b3AgIT09ICd1bmRlZmluZWQnKSBzdHlsZS50b3AgPSB0b3AgKyAncHgnOwogICAgaWYgKHR5cGVvZiBsZWZ0ICE9PSAndW5kZWZpbmVkJykgc3R5bGUubGVmdCA9IGxlZnQgKyAncHgnOwogIH07CgogIHZhciBjYWxQb3NpdGlvbiA9IGZ1bmN0aW9uIGNhbFBvc2l0aW9uKHBvcG92ZXIsIGFuY2hvciwgaXNBY3Rpb25TaGVldCkgewogICAgaWYgKCFwb3BvdmVyIHx8ICFhbmNob3IpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmIChpc0FjdGlvblNoZWV0KSB7CiAgICAgIC8vYWN0aW9uc2hlZXQKICAgICAgc2V0U3R5bGUocG9wb3ZlciwgJ2Jsb2NrJyk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgd1dpZHRoID0gd2luZG93LmlubmVyV2lkdGg7CiAgICB2YXIgd0hlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDsKICAgIHZhciBwV2lkdGggPSBwb3BvdmVyLm9mZnNldFdpZHRoOwogICAgdmFyIHBIZWlnaHQgPSBwb3BvdmVyLm9mZnNldEhlaWdodDsKICAgIHZhciBhV2lkdGggPSBhbmNob3Iub2Zmc2V0V2lkdGg7CiAgICB2YXIgYUhlaWdodCA9IGFuY2hvci5vZmZzZXRIZWlnaHQ7CiAgICB2YXIgb2Zmc2V0ID0gJC5vZmZzZXQoYW5jaG9yKTsKICAgIHZhciBhcnJvdyA9IHBvcG92ZXIucXVlcnlTZWxlY3RvcignLicgKyBDTEFTU19QT1BPVkVSX0FSUk9XKTsKCiAgICBpZiAoIWFycm93KSB7CiAgICAgIGFycm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIGFycm93LmNsYXNzTmFtZSA9IENMQVNTX1BPUE9WRVJfQVJST1c7CiAgICAgIHBvcG92ZXIuYXBwZW5kQ2hpbGQoYXJyb3cpOwogICAgfQoKICAgIHZhciBhcnJvd1NpemUgPSBhcnJvdyAmJiBhcnJvdy5vZmZzZXRXaWR0aCAvIDIgfHwgMDsKICAgIHZhciBwVG9wID0gMDsKICAgIHZhciBwTGVmdCA9IDA7CiAgICB2YXIgZGlmZiA9IDA7CiAgICB2YXIgYXJyb3dMZWZ0ID0gMDsKICAgIHZhciBkZWZhdWx0UGFkZGluZyA9IHBvcG92ZXIuY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX0FDVElPTl9QT1BPVkVSKSA/IDAgOiA1OwogICAgdmFyIHBvc2l0aW9uID0gJ3RvcCc7CgogICAgaWYgKHBIZWlnaHQgKyBhcnJvd1NpemUgPCBvZmZzZXQudG9wIC0gd2luZG93LnBhZ2VZT2Zmc2V0KSB7CiAgICAgIC8vdG9wCiAgICAgIHBUb3AgPSBvZmZzZXQudG9wIC0gcEhlaWdodCAtIGFycm93U2l6ZTsKICAgIH0gZWxzZSBpZiAocEhlaWdodCArIGFycm93U2l6ZSA8IHdIZWlnaHQgLSAob2Zmc2V0LnRvcCAtIHdpbmRvdy5wYWdlWU9mZnNldCkgLSBhSGVpZ2h0KSB7CiAgICAgIC8vYm90dG9tCiAgICAgIHBvc2l0aW9uID0gJ2JvdHRvbSc7CiAgICAgIHBUb3AgPSBvZmZzZXQudG9wICsgYUhlaWdodCArIGFycm93U2l6ZTsKICAgIH0gZWxzZSB7CiAgICAgIC8vbWlkZGxlCiAgICAgIHBvc2l0aW9uID0gJ21pZGRsZSc7CiAgICAgIHBUb3AgPSBNYXRoLm1heCgod0hlaWdodCAtIHBIZWlnaHQpIC8gMiArIHdpbmRvdy5wYWdlWU9mZnNldCwgMCk7CiAgICAgIHBMZWZ0ID0gTWF0aC5tYXgoKHdXaWR0aCAtIHBXaWR0aCkgLyAyICsgd2luZG93LnBhZ2VYT2Zmc2V0LCAwKTsKICAgIH0KCiAgICBpZiAocG9zaXRpb24gPT09ICd0b3AnIHx8IHBvc2l0aW9uID09PSAnYm90dG9tJykgewogICAgICBwTGVmdCA9IGFXaWR0aCAvIDIgKyBvZmZzZXQubGVmdCAtIHBXaWR0aCAvIDI7CiAgICAgIGRpZmYgPSBwTGVmdDsKICAgICAgaWYgKHBMZWZ0IDwgZGVmYXVsdFBhZGRpbmcpIHBMZWZ0ID0gZGVmYXVsdFBhZGRpbmc7CiAgICAgIGlmIChwTGVmdCArIHBXaWR0aCA+IHdXaWR0aCkgcExlZnQgPSB3V2lkdGggLSBwV2lkdGggLSBkZWZhdWx0UGFkZGluZzsKCiAgICAgIGlmIChhcnJvdykgewogICAgICAgIGlmIChwb3NpdGlvbiA9PT0gJ3RvcCcpIHsKICAgICAgICAgIGFycm93LmNsYXNzTGlzdC5hZGQoQ0xBU1NfQk9UVE9NKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXJyb3cuY2xhc3NMaXN0LnJlbW92ZShDTEFTU19CT1RUT00pOwogICAgICAgIH0KCiAgICAgICAgZGlmZiA9IGRpZmYgLSBwTGVmdDsKICAgICAgICBhcnJvd0xlZnQgPSBwV2lkdGggLyAyIC0gYXJyb3dTaXplIC8gMiArIGRpZmY7CiAgICAgICAgYXJyb3dMZWZ0ID0gTWF0aC5tYXgoTWF0aC5taW4oYXJyb3dMZWZ0LCBwV2lkdGggLSBhcnJvd1NpemUgKiAyIC0gNiksIDYpOwogICAgICAgIGFycm93LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnbGVmdDonICsgYXJyb3dMZWZ0ICsgJ3B4Jyk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPT09ICdtaWRkbGUnKSB7CiAgICAgIGFycm93LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnZGlzcGxheTpub25lJyk7CiAgICB9CgogICAgc2V0U3R5bGUocG9wb3ZlciwgJ2Jsb2NrJywgcFRvcCwgcExlZnQpOwogIH07CgogICQuY3JlYXRlTWFzayA9IGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChDTEFTU19CQUNLRFJPUCk7CiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJC5FVkVOVF9NT1ZFLCAkLnByZXZlbnREZWZhdWx0KTsKICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndGFwJywgZnVuY3Rpb24gKCkgewogICAgICBtYXNrLmNsb3NlKCk7CiAgICB9KTsKICAgIHZhciBtYXNrID0gW2VsZW1lbnRdOwogICAgbWFzay5fc2hvdyA9IGZhbHNlOwoKICAgIG1hc2suc2hvdyA9IGZ1bmN0aW9uICgpIHsKICAgICAgbWFzay5fc2hvdyA9IHRydWU7CiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdzdHlsZScsICdvcGFjaXR5OjEnKTsKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbGVtZW50KTsKICAgICAgcmV0dXJuIG1hc2s7CiAgICB9OwoKICAgIG1hc2suX3JlbW92ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKG1hc2suX3Nob3cpIHsKICAgICAgICBtYXNrLl9zaG93ID0gZmFsc2U7CiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJ29wYWNpdHk6MCcpOwogICAgICAgICQubGF0ZXIoZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIGJvZHkgPSBkb2N1bWVudC5ib2R5OwogICAgICAgICAgZWxlbWVudC5wYXJlbnROb2RlID09PSBib2R5ICYmIGJvZHkucmVtb3ZlQ2hpbGQoZWxlbWVudCk7CiAgICAgICAgfSwgMzUwKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG1hc2s7CiAgICB9OwoKICAgIG1hc2suY2xvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgIGlmIChjYWxsYmFjaygpICE9PSBmYWxzZSkgewogICAgICAgICAgbWFzay5fcmVtb3ZlKCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIG1hc2suX3JlbW92ZSgpOwogICAgICB9CiAgICB9OwoKICAgIHJldHVybiBtYXNrOwogIH07CgogICQuZm4ucG9wb3ZlciA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBhcmdzID0gYXJndW1lbnRzOwogICAgdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgJC50YXJnZXRzLl9wb3BvdmVyID0gdGhpczsKCiAgICAgIGlmIChhcmdzWzBdID09PSAnc2hvdycgfHwgYXJnc1swXSA9PT0gJ2hpZGUnIHx8IGFyZ3NbMF0gPT09ICd0b2dnbGUnKSB7CiAgICAgICAgdG9nZ2xlUG9wb3Zlcih0aGlzLCBhcmdzWzFdLCBhcmdzWzBdKTsKICAgICAgfQogICAgfSk7CiAgfTsKfSkobXVpLCB3aW5kb3csIGRvY3VtZW50LCAncG9wb3ZlcicpOwovKioKICogc2VnbWVudGVkLWNvbnRyb2xsZXJzCiAqIEBwYXJhbSB7dHlwZX0gJAogKiBAcGFyYW0ge3R5cGV9IHdpbmRvdwogKiBAcGFyYW0ge3R5cGV9IGRvY3VtZW50CiAqIEBwYXJhbSB7dHlwZX0gdW5kZWZpbmVkCiAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAqLwoKCihmdW5jdGlvbiAoJCwgd2luZG93LCBkb2N1bWVudCwgbmFtZSwgdW5kZWZpbmVkKSB7CiAgdmFyIENMQVNTX0NPTlRST0xfSVRFTSA9ICdtdWktY29udHJvbC1pdGVtJzsKICB2YXIgQ0xBU1NfU0VHTUVOVEVEX0NPTlRST0wgPSAnbXVpLXNlZ21lbnRlZC1jb250cm9sJzsKICB2YXIgQ0xBU1NfU0VHTUVOVEVEX0NPTlRST0xfVkVSVElDQUwgPSAnbXVpLXNlZ21lbnRlZC1jb250cm9sLXZlcnRpY2FsJzsKICB2YXIgQ0xBU1NfQ09OVFJPTF9DT05URU5UID0gJ211aS1jb250cm9sLWNvbnRlbnQnOwogIHZhciBDTEFTU19UQUJfQkFSID0gJ211aS1iYXItdGFiJzsKICB2YXIgQ0xBU1NfVEFCX0lURU0gPSAnbXVpLXRhYi1pdGVtJzsKICB2YXIgQ0xBU1NfU0xJREVSX0lURU0gPSAnbXVpLXNsaWRlci1pdGVtJzsKCiAgdmFyIGhhbmRsZSA9IGZ1bmN0aW9uIGhhbmRsZShldmVudCwgdGFyZ2V0KSB7CiAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdCAmJiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19DT05UUk9MX0lURU0pIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfVEFCX0lURU0pKSkgewogICAgICBpZiAodGFyZ2V0LnBhcmVudE5vZGUgJiYgdGFyZ2V0LnBhcmVudE5vZGUuY2xhc3NMaXN0ICYmIHRhcmdldC5wYXJlbnROb2RlLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19TRUdNRU5URURfQ09OVFJPTF9WRVJUSUNBTCkpIHsvL3ZlcnRpY2FsIOWmguaenHByZXZlbnREZWZhdWx05Lya5a+86Ie05peg5rOV5rua5YqoCiAgICAgIH0gZWxzZSB7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy8gaWYodGFyZ2V0LnRhZ05hbWUgPT0gJ0EnKSB7CiAgICAgICAgLy8gICAgIC8vIGZpeGVkIOW6lemDqOmAiemhueWNoWhyZWYg5peg5rOV6Lez6L2sICYmIHN0b3AgaGFzaCBjaGFuZ2UKICAgICAgICAvLyAgICAgdmFyIGN1cnJfaHJlZiA9IGxvY2F0aW9uLmhvc3RuYW1lICsgbG9jYXRpb24ucGF0aG5hbWUsCiAgICAgICAgLy8gICAgICAgICB0YXJnZXRfaHJlZiA9IHRhcmdldC5ob3N0bmFtZSArIHRhcmdldC5wYXRobmFtZTsKICAgICAgICAvLyAgICAgaWYgKGN1cnJfaHJlZiA9PSB0YXJnZXRfaHJlZiAmJiB0YXJnZXQuaGFzaCAhPT0gIiIpIHsKICAgICAgICAvLyAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgLy8gICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICAgIC8vICAgICB9ZWxzZXsKICAgICAgICAvLyAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAvLyAgICAgfQogICAgICAgIC8vIH0KICAgICAgfSAvLyAgICAgICAgICBpZiAodGFyZ2V0Lmhhc2gpIHsKCgogICAgICByZXR1cm4gdGFyZ2V0OyAvLyAgICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH07CgogICQucmVnaXN0ZXJUYXJnZXQoewogICAgbmFtZTogbmFtZSwKICAgIGluZGV4OiA4MCwKICAgIGhhbmRsZTogaGFuZGxlLAogICAgdGFyZ2V0OiBmYWxzZQogIH0pOwogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0YXAnLCBmdW5jdGlvbiAoZSkgewogICAgdmFyIHRhcmdldFRhYiA9ICQudGFyZ2V0cy50YWI7CgogICAgaWYgKCF0YXJnZXRUYWIpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBhY3RpdmVUYWI7CiAgICB2YXIgYWN0aXZlQm9kaWVzOwogICAgdmFyIHRhcmdldEJvZHk7CiAgICB2YXIgY2xhc3NOYW1lID0gJ211aS1hY3RpdmUnOwogICAgdmFyIGNsYXNzU2VsZWN0b3IgPSAnLicgKyBjbGFzc05hbWU7CiAgICB2YXIgc2VnbWVudGVkQ29udHJvbCA9IHRhcmdldFRhYi5wYXJlbnROb2RlOwoKICAgIGZvciAoOyBzZWdtZW50ZWRDb250cm9sICYmIHNlZ21lbnRlZENvbnRyb2wgIT09IGRvY3VtZW50OyBzZWdtZW50ZWRDb250cm9sID0gc2VnbWVudGVkQ29udHJvbC5wYXJlbnROb2RlKSB7CiAgICAgIGlmIChzZWdtZW50ZWRDb250cm9sLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19TRUdNRU5URURfQ09OVFJPTCkpIHsKICAgICAgICBhY3RpdmVUYWIgPSBzZWdtZW50ZWRDb250cm9sLnF1ZXJ5U2VsZWN0b3IoY2xhc3NTZWxlY3RvciArICcuJyArIENMQVNTX0NPTlRST0xfSVRFTSk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0gZWxzZSBpZiAoc2VnbWVudGVkQ29udHJvbC5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfVEFCX0JBUikpIHsKICAgICAgICBhY3RpdmVUYWIgPSBzZWdtZW50ZWRDb250cm9sLnF1ZXJ5U2VsZWN0b3IoY2xhc3NTZWxlY3RvciArICcuJyArIENMQVNTX1RBQl9JVEVNKTsKICAgICAgfQogICAgfQoKICAgIGlmIChhY3RpdmVUYWIpIHsKICAgICAgYWN0aXZlVGFiLmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTsKICAgIH0KCiAgICB2YXIgaXNMYXN0QWN0aXZlID0gdGFyZ2V0VGFiID09PSBhY3RpdmVUYWI7CgogICAgaWYgKHRhcmdldFRhYikgewogICAgICB0YXJnZXRUYWIuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpOwogICAgfQoKICAgIGlmICghdGFyZ2V0VGFiLmhhc2gpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHRhcmdldEJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YXJnZXRUYWIuaGFzaC5yZXBsYWNlKCcjJywgJycpKTsKCiAgICBpZiAoIXRhcmdldEJvZHkpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmICghdGFyZ2V0Qm9keS5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfQ09OVFJPTF9DT05URU5UKSkgewogICAgICAvL3RhYiBiYXIgcG9wb3ZlcgogICAgICB0YXJnZXRUYWIuY2xhc3NMaXN0W2lzTGFzdEFjdGl2ZSA/ICdyZW1vdmUnIDogJ2FkZCddKGNsYXNzTmFtZSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoaXNMYXN0QWN0aXZlKSB7CiAgICAgIC8vc2FtZQogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIHBhcmVudE5vZGUgPSB0YXJnZXRCb2R5LnBhcmVudE5vZGU7CiAgICBhY3RpdmVCb2RpZXMgPSBwYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgQ0xBU1NfQ09OVFJPTF9DT05URU5UICsgY2xhc3NTZWxlY3Rvcik7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhY3RpdmVCb2RpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIGFjdGl2ZUJvZHkgPSBhY3RpdmVCb2RpZXNbaV07CiAgICAgIGFjdGl2ZUJvZHkucGFyZW50Tm9kZSA9PT0gcGFyZW50Tm9kZSAmJiBhY3RpdmVCb2R5LmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTsKICAgIH0KCiAgICB0YXJnZXRCb2R5LmNsYXNzTGlzdC5hZGQoY2xhc3NOYW1lKTsKICAgIHZhciBjb250ZW50cyA9IFtdOwoKICAgIHZhciBfY29udGVudHMgPSBwYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgQ0xBU1NfQ09OVFJPTF9DT05URU5UKTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IF9jb250ZW50cy5sZW5ndGg7IGkrKykgewogICAgICAvL+afpeaJvuebtOWxnuWtkOiKgueCuQogICAgICBfY29udGVudHNbaV0ucGFyZW50Tm9kZSA9PT0gcGFyZW50Tm9kZSAmJiBjb250ZW50cy5wdXNoKF9jb250ZW50c1tpXSk7CiAgICB9CgogICAgJC50cmlnZ2VyKHRhcmdldEJvZHksICQuZXZlbnROYW1lKCdzaG93bicsIG5hbWUpLCB7CiAgICAgIHRhYk51bWJlcjogQXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbChjb250ZW50cywgdGFyZ2V0Qm9keSkKICAgIH0pOwogICAgZS5kZXRhaWwgJiYgZS5kZXRhaWwuZ2VzdHVyZS5wcmV2ZW50RGVmYXVsdCgpOyAvL2ZpeGVkIGhhc2hjaGFuZ2UKICB9KTsKfSkobXVpLCB3aW5kb3csIGRvY3VtZW50LCAndGFiJyk7Ci8qKgogKiBUb2dnbGVzIHN3aXRjaAogKiBAcGFyYW0ge3R5cGV9ICQKICogQHBhcmFtIHt0eXBlfSB3aW5kb3cKICogQHBhcmFtIHt0eXBlfSBuYW1lCiAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAqLwoKCihmdW5jdGlvbiAoJCwgd2luZG93LCBuYW1lKSB7CiAgdmFyIENMQVNTX1NXSVRDSCA9ICdtdWktc3dpdGNoJzsKICB2YXIgQ0xBU1NfU1dJVENIX0hBTkRMRSA9ICdtdWktc3dpdGNoLWhhbmRsZSc7CiAgdmFyIENMQVNTX0FDVElWRSA9ICdtdWktYWN0aXZlJzsKICB2YXIgQ0xBU1NfRFJBR0dJTkcgPSAnbXVpLWRyYWdnaW5nJzsKICB2YXIgQ0xBU1NfRElTQUJMRUQgPSAnbXVpLWRpc2FibGVkJzsKICB2YXIgU0VMRUNUT1JfU1dJVENIX0hBTkRMRSA9ICcuJyArIENMQVNTX1NXSVRDSF9IQU5ETEU7CgogIHZhciBoYW5kbGUgPSBmdW5jdGlvbiBoYW5kbGUoZXZlbnQsIHRhcmdldCkgewogICAgaWYgKHRhcmdldC5jbGFzc0xpc3QgJiYgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19TV0lUQ0gpKSB7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH07CgogICQucmVnaXN0ZXJUYXJnZXQoewogICAgbmFtZTogbmFtZSwKICAgIGluZGV4OiAxMDAsCiAgICBoYW5kbGU6IGhhbmRsZSwKICAgIHRhcmdldDogZmFsc2UKICB9KTsKCiAgdmFyIFRvZ2dsZSA9IGZ1bmN0aW9uIFRvZ2dsZShlbGVtZW50KSB7CiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50OwogICAgdGhpcy5jbGFzc0xpc3QgPSB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0OwogICAgdGhpcy5oYW5kbGUgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihTRUxFQ1RPUl9TV0lUQ0hfSEFORExFKTsKICAgIHRoaXMuaW5pdCgpOwogICAgdGhpcy5pbml0RXZlbnQoKTsKICB9OwoKICBUb2dnbGUucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnRvZ2dsZVdpZHRoID0gdGhpcy5lbGVtZW50Lm9mZnNldFdpZHRoOwogICAgdGhpcy5oYW5kbGVXaWR0aCA9IHRoaXMuaGFuZGxlLm9mZnNldFdpZHRoOwogICAgdGhpcy5oYW5kbGVYID0gdGhpcy50b2dnbGVXaWR0aCAtIHRoaXMuaGFuZGxlV2lkdGggLSAzOwogIH07CgogIFRvZ2dsZS5wcm90b3R5cGUuaW5pdEV2ZW50ID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJC5FVkVOVF9TVEFSVCwgdGhpcyk7CiAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJhZycsIHRoaXMpOwogICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3N3aXBlcmlnaHQnLCB0aGlzKTsKICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCQuRVZFTlRfRU5ELCB0aGlzKTsKICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCQuRVZFTlRfQ0FOQ0VMLCB0aGlzKTsKICB9OwoKICBUb2dnbGUucHJvdG90eXBlLmhhbmRsZUV2ZW50ID0gZnVuY3Rpb24gKGUpIHsKICAgIGlmICh0aGlzLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19ESVNBQkxFRCkpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHN3aXRjaCAoZS50eXBlKSB7CiAgICAgIGNhc2UgJC5FVkVOVF9TVEFSVDoKICAgICAgICB0aGlzLnN0YXJ0KGUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnZHJhZyc6CiAgICAgICAgdGhpcy5kcmFnKGUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc3dpcGVyaWdodCc6CiAgICAgICAgdGhpcy5zd2lwZXJpZ2h0KCk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICQuRVZFTlRfRU5EOgogICAgICBjYXNlICQuRVZFTlRfQ0FOQ0VMOgogICAgICAgIHRoaXMuZW5kKGUpOwogICAgICAgIGJyZWFrOwogICAgfQogIH07CgogIFRvZ2dsZS5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbiAoZSkgewogICAgdGhpcy5oYW5kbGUuc3R5bGUud2Via2l0VHJhbnNpdGlvbkR1cmF0aW9uID0gdGhpcy5lbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zaXRpb25EdXJhdGlvbiA9ICcuMnMnOwogICAgdGhpcy5jbGFzc0xpc3QuYWRkKENMQVNTX0RSQUdHSU5HKTsKCiAgICBpZiAodGhpcy50b2dnbGVXaWR0aCA9PT0gMCB8fCB0aGlzLmhhbmRsZVdpZHRoID09PSAwKSB7CiAgICAgIC8v5b2Tc3dpdGNo5aSE5LqO6ZqQ6JeP54q25oCB5pe277yMd2lkdGjkuLow77yM6ZyA6KaB6YeN5paw5Yid5aeL5YyWCiAgICAgIHRoaXMuaW5pdCgpOwogICAgfQogIH07CgogIFRvZ2dsZS5wcm90b3R5cGUuZHJhZyA9IGZ1bmN0aW9uIChlKSB7CiAgICB2YXIgZGV0YWlsID0gZS5kZXRhaWw7CgogICAgaWYgKCF0aGlzLmlzRHJhZ2dpbmcpIHsKICAgICAgaWYgKGRldGFpbC5kaXJlY3Rpb24gPT09ICdsZWZ0JyB8fCBkZXRhaWwuZGlyZWN0aW9uID09PSAncmlnaHQnKSB7CiAgICAgICAgdGhpcy5pc0RyYWdnaW5nID0gdHJ1ZTsKICAgICAgICB0aGlzLmxhc3RDaGFuZ2VkID0gdW5kZWZpbmVkOwogICAgICAgIHRoaXMuaW5pdGlhbFN0YXRlID0gdGhpcy5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfQUNUSVZFKTsKICAgICAgfQogICAgfQoKICAgIGlmICh0aGlzLmlzRHJhZ2dpbmcpIHsKICAgICAgdGhpcy5zZXRUcmFuc2xhdGVYKGRldGFpbC5kZWx0YVgpOwogICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICBkZXRhaWwuZ2VzdHVyZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgfQogIH07CgogIFRvZ2dsZS5wcm90b3R5cGUuc3dpcGVyaWdodCA9IGZ1bmN0aW9uIChlKSB7CiAgICBpZiAodGhpcy5pc0RyYWdnaW5nKSB7CiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9CiAgfTsKCiAgVG9nZ2xlLnByb3RvdHlwZS5lbmQgPSBmdW5jdGlvbiAoZSkgewogICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKENMQVNTX0RSQUdHSU5HKTsKCiAgICBpZiAodGhpcy5pc0RyYWdnaW5nKSB7CiAgICAgIHRoaXMuaXNEcmFnZ2luZyA9IGZhbHNlOwogICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAkLnRyaWdnZXIodGhpcy5lbGVtZW50LCAndG9nZ2xlJywgewogICAgICAgIGlzQWN0aXZlOiB0aGlzLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19BQ1RJVkUpCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy50b2dnbGUoKTsKICAgIH0KICB9OwoKICBUb2dnbGUucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uIChhbmltYXRlKSB7CiAgICB2YXIgY2xhc3NMaXN0ID0gdGhpcy5jbGFzc0xpc3Q7CgogICAgaWYgKGFuaW1hdGUgPT09IGZhbHNlKSB7CiAgICAgIHRoaXMuaGFuZGxlLnN0eWxlLndlYmtpdFRyYW5zaXRpb25EdXJhdGlvbiA9IHRoaXMuZWxlbWVudC5zdHlsZS53ZWJraXRUcmFuc2l0aW9uRHVyYXRpb24gPSAnMHMnOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5oYW5kbGUuc3R5bGUud2Via2l0VHJhbnNpdGlvbkR1cmF0aW9uID0gdGhpcy5lbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zaXRpb25EdXJhdGlvbiA9ICcuMnMnOwogICAgfQoKICAgIGlmIChjbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfQUNUSVZFKSkgewogICAgICBjbGFzc0xpc3QucmVtb3ZlKENMQVNTX0FDVElWRSk7CiAgICAgIHRoaXMuaGFuZGxlLnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICd0cmFuc2xhdGUoMCwwKSc7CiAgICB9IGVsc2UgewogICAgICBjbGFzc0xpc3QuYWRkKENMQVNTX0FDVElWRSk7CiAgICAgIHRoaXMuaGFuZGxlLnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICd0cmFuc2xhdGUoJyArIHRoaXMuaGFuZGxlWCArICdweCwwKSc7CiAgICB9CgogICAgJC50cmlnZ2VyKHRoaXMuZWxlbWVudCwgJ3RvZ2dsZScsIHsKICAgICAgaXNBY3RpdmU6IHRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX0FDVElWRSkKICAgIH0pOwogIH07CgogIFRvZ2dsZS5wcm90b3R5cGUuc2V0VHJhbnNsYXRlWCA9ICQuYW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKHgpIHsKICAgIGlmICghdGhpcy5pc0RyYWdnaW5nKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgaXNDaGFuZ2VkID0gZmFsc2U7CgogICAgaWYgKHRoaXMuaW5pdGlhbFN0YXRlICYmIC14ID4gdGhpcy5oYW5kbGVYIC8gMiB8fCAhdGhpcy5pbml0aWFsU3RhdGUgJiYgeCA+IHRoaXMuaGFuZGxlWCAvIDIpIHsKICAgICAgaXNDaGFuZ2VkID0gdHJ1ZTsKICAgIH0KCiAgICBpZiAodGhpcy5sYXN0Q2hhbmdlZCAhPT0gaXNDaGFuZ2VkKSB7CiAgICAgIGlmIChpc0NoYW5nZWQpIHsKICAgICAgICB0aGlzLmhhbmRsZS5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSAndHJhbnNsYXRlKCcgKyAodGhpcy5pbml0aWFsU3RhdGUgPyAwIDogdGhpcy5oYW5kbGVYKSArICdweCwwKSc7CiAgICAgICAgdGhpcy5jbGFzc0xpc3RbdGhpcy5pbml0aWFsU3RhdGUgPyAncmVtb3ZlJyA6ICdhZGQnXShDTEFTU19BQ1RJVkUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaGFuZGxlLnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICd0cmFuc2xhdGUoJyArICh0aGlzLmluaXRpYWxTdGF0ZSA/IHRoaXMuaGFuZGxlWCA6IDApICsgJ3B4LDApJzsKICAgICAgICB0aGlzLmNsYXNzTGlzdFt0aGlzLmluaXRpYWxTdGF0ZSA/ICdhZGQnIDogJ3JlbW92ZSddKENMQVNTX0FDVElWRSk7CiAgICAgIH0KCiAgICAgIHRoaXMubGFzdENoYW5nZWQgPSBpc0NoYW5nZWQ7CiAgICB9CiAgfSk7CgogICQuZm5bJ3N3aXRjaCddID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIHZhciBzd2l0Y2hBcGlzID0gW107CiAgICB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICB2YXIgc3dpdGNoQXBpID0gbnVsbDsKICAgICAgdmFyIGlkID0gdGhpcy5nZXRBdHRyaWJ1dGUoJ2RhdGEtc3dpdGNoJyk7CgogICAgICBpZiAoIWlkKSB7CiAgICAgICAgaWQgPSArKyQudXVpZDsKICAgICAgICAkLmRhdGFbaWRdID0gbmV3IFRvZ2dsZSh0aGlzKTsKICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZSgnZGF0YS1zd2l0Y2gnLCBpZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3dpdGNoQXBpID0gJC5kYXRhW2lkXTsKICAgICAgfQoKICAgICAgc3dpdGNoQXBpcy5wdXNoKHN3aXRjaEFwaSk7CiAgICB9KTsKICAgIHJldHVybiBzd2l0Y2hBcGlzLmxlbmd0aCA+IDEgPyBzd2l0Y2hBcGlzIDogc3dpdGNoQXBpc1swXTsKICB9OwoKICAkLnJlYWR5KGZ1bmN0aW9uICgpIHsKICAgICQoJy4nICsgQ0xBU1NfU1dJVENIKVsnc3dpdGNoJ10oKTsKICB9KTsKfSkobXVpLCB3aW5kb3csICd0b2dnbGUnKTsKLyoqCiAqIFRhYmxldmlld3MKICogQHBhcmFtIHt0eXBlfSAkCiAqIEBwYXJhbSB7dHlwZX0gd2luZG93CiAqIEBwYXJhbSB7dHlwZX0gZG9jdW1lbnQKICogQHJldHVybnMge3VuZGVmaW5lZH0KICovCgoKKGZ1bmN0aW9uICgkLCB3aW5kb3csIGRvY3VtZW50KSB7CiAgdmFyIENMQVNTX0FDVElWRSA9ICdtdWktYWN0aXZlJzsKICB2YXIgQ0xBU1NfU0VMRUNURUQgPSAnbXVpLXNlbGVjdGVkJzsKICB2YXIgQ0xBU1NfR1JJRF9WSUVXID0gJ211aS1ncmlkLXZpZXcnOwogIHZhciBDTEFTU19SQURJT19WSUVXID0gJ211aS10YWJsZS12aWV3LXJhZGlvJzsKICB2YXIgQ0xBU1NfVEFCTEVfVklFV19DRUxMID0gJ211aS10YWJsZS12aWV3LWNlbGwnOwogIHZhciBDTEFTU19DT0xMQVBTRV9DT05URU5UID0gJ211aS1jb2xsYXBzZS1jb250ZW50JzsKICB2YXIgQ0xBU1NfRElTQUJMRUQgPSAnbXVpLWRpc2FibGVkJzsKICB2YXIgQ0xBU1NfVE9HR0xFID0gJ211aS1zd2l0Y2gnOwogIHZhciBDTEFTU19CVE4gPSAnbXVpLWJ0bic7CiAgdmFyIENMQVNTX1NMSURFUl9IQU5ETEUgPSAnbXVpLXNsaWRlci1oYW5kbGUnOwogIHZhciBDTEFTU19TTElERVJfTEVGVCA9ICdtdWktc2xpZGVyLWxlZnQnOwogIHZhciBDTEFTU19TTElERVJfUklHSFQgPSAnbXVpLXNsaWRlci1yaWdodCc7CiAgdmFyIENMQVNTX1RSQU5TSVRJT05JTkcgPSAnbXVpLXRyYW5zaXRpb25pbmcnOwogIHZhciBTRUxFQ1RPUl9TTElERVJfSEFORExFID0gJy4nICsgQ0xBU1NfU0xJREVSX0hBTkRMRTsKICB2YXIgU0VMRUNUT1JfU0xJREVSX0xFRlQgPSAnLicgKyBDTEFTU19TTElERVJfTEVGVDsKICB2YXIgU0VMRUNUT1JfU0xJREVSX1JJR0hUID0gJy4nICsgQ0xBU1NfU0xJREVSX1JJR0hUOwogIHZhciBTRUxFQ1RPUl9TRUxFQ1RFRCA9ICcuJyArIENMQVNTX1NFTEVDVEVEOwogIHZhciBTRUxFQ1RPUl9CVVRUT04gPSAnLicgKyBDTEFTU19CVE47CiAgdmFyIG92ZXJGYWN0b3IgPSAwLjg7CiAgdmFyIGNlbGwsIGE7CiAgdmFyIGlzTW92ZWQgPSBpc09wZW5lZCA9IG9wZW5lZEFjdGlvbnMgPSBwcm9ncmVzcyA9IGZhbHNlOwogIHZhciBzbGlkZXJIYW5kbGUgPSBzbGlkZXJBY3Rpb25MZWZ0ID0gc2xpZGVyQWN0aW9uUmlnaHQgPSBidXR0b25zTGVmdCA9IGJ1dHRvbnNSaWdodCA9IHNsaWRlckRpcmVjdGlvbiA9IHNsaWRlclJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGZhbHNlOwogIHZhciB0aW1lciA9IHRyYW5zbGF0ZVggPSBsYXN0VHJhbnNsYXRlWCA9IHNsaWRlckFjdGlvbkxlZnRXaWR0aCA9IHNsaWRlckFjdGlvblJpZ2h0V2lkdGggPSAwOwoKICB2YXIgdG9nZ2xlQWN0aXZlID0gZnVuY3Rpb24gdG9nZ2xlQWN0aXZlKGlzQWN0aXZlKSB7CiAgICBpZiAoaXNBY3RpdmUpIHsKICAgICAgaWYgKGEpIHsKICAgICAgICBhLmNsYXNzTGlzdC5hZGQoQ0xBU1NfQUNUSVZFKTsKICAgICAgfSBlbHNlIGlmIChjZWxsKSB7CiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKENMQVNTX0FDVElWRSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRpbWVyICYmIHRpbWVyLmNhbmNlbCgpOwoKICAgICAgaWYgKGEpIHsKICAgICAgICBhLmNsYXNzTGlzdC5yZW1vdmUoQ0xBU1NfQUNUSVZFKTsKICAgICAgfSBlbHNlIGlmIChjZWxsKSB7CiAgICAgICAgY2VsbC5jbGFzc0xpc3QucmVtb3ZlKENMQVNTX0FDVElWRSk7CiAgICAgIH0KICAgIH0KICB9OwoKICB2YXIgdXBkYXRlVHJhbnNsYXRlID0gZnVuY3Rpb24gdXBkYXRlVHJhbnNsYXRlKCkgewogICAgaWYgKHRyYW5zbGF0ZVggIT09IGxhc3RUcmFuc2xhdGVYKSB7CiAgICAgIGlmIChidXR0b25zUmlnaHQgJiYgYnV0dG9uc1JpZ2h0Lmxlbmd0aCA+IDApIHsKICAgICAgICBwcm9ncmVzcyA9IHRyYW5zbGF0ZVggLyBzbGlkZXJBY3Rpb25SaWdodFdpZHRoOwoKICAgICAgICBpZiAodHJhbnNsYXRlWCA8IC1zbGlkZXJBY3Rpb25SaWdodFdpZHRoKSB7CiAgICAgICAgICB0cmFuc2xhdGVYID0gLXNsaWRlckFjdGlvblJpZ2h0V2lkdGggLSBNYXRoLnBvdygtdHJhbnNsYXRlWCAtIHNsaWRlckFjdGlvblJpZ2h0V2lkdGgsIG92ZXJGYWN0b3IpOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGJ1dHRvbnNSaWdodC5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgdmFyIGJ1dHRvblJpZ2h0ID0gYnV0dG9uc1JpZ2h0W2ldOwoKICAgICAgICAgIGlmICh0eXBlb2YgYnV0dG9uUmlnaHQuX2J1dHRvbk9mZnNldCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgYnV0dG9uUmlnaHQuX2J1dHRvbk9mZnNldCA9IGJ1dHRvblJpZ2h0Lm9mZnNldExlZnQ7CiAgICAgICAgICB9CgogICAgICAgICAgYnV0dG9uT2Zmc2V0ID0gYnV0dG9uUmlnaHQuX2J1dHRvbk9mZnNldDsKICAgICAgICAgIHNldFRyYW5zbGF0ZShidXR0b25SaWdodCwgdHJhbnNsYXRlWCAtIGJ1dHRvbk9mZnNldCAqICgxICsgTWF0aC5tYXgocHJvZ3Jlc3MsIC0xKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGJ1dHRvbnNMZWZ0ICYmIGJ1dHRvbnNMZWZ0Lmxlbmd0aCA+IDApIHsKICAgICAgICBwcm9ncmVzcyA9IHRyYW5zbGF0ZVggLyBzbGlkZXJBY3Rpb25MZWZ0V2lkdGg7CgogICAgICAgIGlmICh0cmFuc2xhdGVYID4gc2xpZGVyQWN0aW9uTGVmdFdpZHRoKSB7CiAgICAgICAgICB0cmFuc2xhdGVYID0gc2xpZGVyQWN0aW9uTGVmdFdpZHRoICsgTWF0aC5wb3codHJhbnNsYXRlWCAtIHNsaWRlckFjdGlvbkxlZnRXaWR0aCwgb3ZlckZhY3Rvcik7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gYnV0dG9uc0xlZnQubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIHZhciBidXR0b25MZWZ0ID0gYnV0dG9uc0xlZnRbaV07CgogICAgICAgICAgaWYgKHR5cGVvZiBidXR0b25MZWZ0Ll9idXR0b25PZmZzZXQgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGJ1dHRvbkxlZnQuX2J1dHRvbk9mZnNldCA9IHNsaWRlckFjdGlvbkxlZnRXaWR0aCAtIGJ1dHRvbkxlZnQub2Zmc2V0TGVmdCAtIGJ1dHRvbkxlZnQub2Zmc2V0V2lkdGg7CiAgICAgICAgICB9CgogICAgICAgICAgYnV0dG9uT2Zmc2V0ID0gYnV0dG9uTGVmdC5fYnV0dG9uT2Zmc2V0OwoKICAgICAgICAgIGlmIChidXR0b25zTGVmdC5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgIGJ1dHRvbkxlZnQuc3R5bGUuekluZGV4ID0gYnV0dG9uc0xlZnQubGVuZ3RoIC0gaTsKICAgICAgICAgIH0KCiAgICAgICAgICBzZXRUcmFuc2xhdGUoYnV0dG9uTGVmdCwgdHJhbnNsYXRlWCArIGJ1dHRvbk9mZnNldCAqICgxIC0gTWF0aC5taW4ocHJvZ3Jlc3MsIDEpKSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBzZXRUcmFuc2xhdGUoc2xpZGVySGFuZGxlLCB0cmFuc2xhdGVYKTsKICAgICAgbGFzdFRyYW5zbGF0ZVggPSB0cmFuc2xhdGVYOwogICAgfQoKICAgIHNsaWRlclJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgIHVwZGF0ZVRyYW5zbGF0ZSgpOwogICAgfSk7CiAgfTsKCiAgdmFyIHNldFRyYW5zbGF0ZSA9IGZ1bmN0aW9uIHNldFRyYW5zbGF0ZShlbGVtZW50LCB4KSB7CiAgICBpZiAoZWxlbWVudCkgewogICAgICBlbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICd0cmFuc2xhdGUoJyArIHggKyAncHgsMCknOwogICAgfQogIH07CgogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCQuRVZFTlRfU1RBUlQsIGZ1bmN0aW9uIChldmVudCkgewogICAgaWYgKGNlbGwpIHsKICAgICAgdG9nZ2xlQWN0aXZlKGZhbHNlKTsKICAgIH0KCiAgICBjZWxsID0gYSA9IGZhbHNlOwogICAgaXNNb3ZlZCA9IGlzT3BlbmVkID0gb3BlbmVkQWN0aW9ucyA9IGZhbHNlOwogICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDsKICAgIHZhciBpc0Rpc2FibGVkID0gZmFsc2U7CgogICAgZm9yICg7IHRhcmdldCAmJiB0YXJnZXQgIT09IGRvY3VtZW50OyB0YXJnZXQgPSB0YXJnZXQucGFyZW50Tm9kZSkgewogICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdCkgewogICAgICAgIHZhciBjbGFzc0xpc3QgPSB0YXJnZXQuY2xhc3NMaXN0OwoKICAgICAgICBpZiAodGFyZ2V0LnRhZ05hbWUgPT09ICdJTlBVVCcgJiYgdGFyZ2V0LnR5cGUgIT09ICdyYWRpbycgJiYgdGFyZ2V0LnR5cGUgIT09ICdjaGVja2JveCcgfHwgdGFyZ2V0LnRhZ05hbWUgPT09ICdCVVRUT04nIHx8IGNsYXNzTGlzdC5jb250YWlucyhDTEFTU19UT0dHTEUpIHx8IGNsYXNzTGlzdC5jb250YWlucyhDTEFTU19CVE4pIHx8IGNsYXNzTGlzdC5jb250YWlucyhDTEFTU19ESVNBQkxFRCkpIHsKICAgICAgICAgIGlzRGlzYWJsZWQgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNsYXNzTGlzdC5jb250YWlucyhDTEFTU19DT0xMQVBTRV9DT05URU5UKSkgewogICAgICAgICAgLy9jb2xsYXBzZSBjb250ZW50CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIGlmIChjbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfVEFCTEVfVklFV19DRUxMKSkgewogICAgICAgICAgY2VsbCA9IHRhcmdldDsgLy9UT0RPIHN3aXBlIHRvIGRlbGV0ZSBjbG9zZQoKICAgICAgICAgIHZhciBzZWxlY3RlZCA9IGNlbGwucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKFNFTEVDVE9SX1NFTEVDVEVEKTsKCiAgICAgICAgICBpZiAoIWNlbGwucGFyZW50Tm9kZS5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfUkFESU9fVklFVykgJiYgc2VsZWN0ZWQgJiYgc2VsZWN0ZWQgIT09IGNlbGwpIHsKICAgICAgICAgICAgJC5zd2lwZW91dENsb3NlKHNlbGVjdGVkKTsKICAgICAgICAgICAgY2VsbCA9IGlzRGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghY2VsbC5wYXJlbnROb2RlLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19HUklEX1ZJRVcpKSB7CiAgICAgICAgICAgIHZhciBsaW5rID0gY2VsbC5xdWVyeVNlbGVjdG9yKCdhJyk7CgogICAgICAgICAgICBpZiAobGluayAmJiBsaW5rLnBhcmVudE5vZGUgPT09IGNlbGwpIHsKICAgICAgICAgICAgICAvL2xpPmEKICAgICAgICAgICAgICBhID0gbGluazsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciBoYW5kbGUgPSBjZWxsLnF1ZXJ5U2VsZWN0b3IoU0VMRUNUT1JfU0xJREVSX0hBTkRMRSk7CgogICAgICAgICAgaWYgKGhhbmRsZSkgewogICAgICAgICAgICB0b2dnbGVFdmVudHMoY2VsbCk7CiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghaXNEaXNhYmxlZCkgewogICAgICAgICAgICBpZiAoaGFuZGxlKSB7CiAgICAgICAgICAgICAgaWYgKHRpbWVyKSB7CiAgICAgICAgICAgICAgICB0aW1lci5jYW5jZWwoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRpbWVyID0gJC5sYXRlcihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0b2dnbGVBY3RpdmUodHJ1ZSk7CiAgICAgICAgICAgICAgfSwgMTAwKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0b2dnbGVBY3RpdmUodHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9KTsKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigkLkVWRU5UX01PVkUsIGZ1bmN0aW9uIChldmVudCkgewogICAgdG9nZ2xlQWN0aXZlKGZhbHNlKTsKICB9KTsKICB2YXIgaGFuZGxlRXZlbnQgPSB7CiAgICBoYW5kbGVFdmVudDogZnVuY3Rpb24gaGFuZGxlRXZlbnQoZXZlbnQpIHsKICAgICAgc3dpdGNoIChldmVudC50eXBlKSB7CiAgICAgICAgY2FzZSAnZHJhZyc6CiAgICAgICAgICB0aGlzLmRyYWcoZXZlbnQpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ2RyYWdlbmQnOgogICAgICAgICAgdGhpcy5kcmFnZW5kKGV2ZW50KTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdmbGljayc6CiAgICAgICAgICB0aGlzLmZsaWNrKGV2ZW50KTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdzd2lwZXJpZ2h0JzoKICAgICAgICAgIHRoaXMuc3dpcGVyaWdodChldmVudCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnc3dpcGVsZWZ0JzoKICAgICAgICAgIHRoaXMuc3dpcGVsZWZ0KGV2ZW50KTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAogICAgZHJhZzogZnVuY3Rpb24gZHJhZyhldmVudCkgewogICAgICBpZiAoIWNlbGwpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICghaXNNb3ZlZCkgewogICAgICAgIC8vaW5pdAogICAgICAgIHNsaWRlckhhbmRsZSA9IHNsaWRlckFjdGlvbkxlZnQgPSBzbGlkZXJBY3Rpb25SaWdodCA9IGJ1dHRvbnNMZWZ0ID0gYnV0dG9uc1JpZ2h0ID0gc2xpZGVyRGlyZWN0aW9uID0gc2xpZGVyUmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gZmFsc2U7CiAgICAgICAgc2xpZGVySGFuZGxlID0gY2VsbC5xdWVyeVNlbGVjdG9yKFNFTEVDVE9SX1NMSURFUl9IQU5ETEUpOwoKICAgICAgICBpZiAoc2xpZGVySGFuZGxlKSB7CiAgICAgICAgICBzbGlkZXJBY3Rpb25MZWZ0ID0gY2VsbC5xdWVyeVNlbGVjdG9yKFNFTEVDVE9SX1NMSURFUl9MRUZUKTsKICAgICAgICAgIHNsaWRlckFjdGlvblJpZ2h0ID0gY2VsbC5xdWVyeVNlbGVjdG9yKFNFTEVDVE9SX1NMSURFUl9SSUdIVCk7CgogICAgICAgICAgaWYgKHNsaWRlckFjdGlvbkxlZnQpIHsKICAgICAgICAgICAgc2xpZGVyQWN0aW9uTGVmdFdpZHRoID0gc2xpZGVyQWN0aW9uTGVmdC5vZmZzZXRXaWR0aDsKICAgICAgICAgICAgYnV0dG9uc0xlZnQgPSBzbGlkZXJBY3Rpb25MZWZ0LnF1ZXJ5U2VsZWN0b3JBbGwoU0VMRUNUT1JfQlVUVE9OKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoc2xpZGVyQWN0aW9uUmlnaHQpIHsKICAgICAgICAgICAgc2xpZGVyQWN0aW9uUmlnaHRXaWR0aCA9IHNsaWRlckFjdGlvblJpZ2h0Lm9mZnNldFdpZHRoOwogICAgICAgICAgICBidXR0b25zUmlnaHQgPSBzbGlkZXJBY3Rpb25SaWdodC5xdWVyeVNlbGVjdG9yQWxsKFNFTEVDVE9SX0JVVFRPTik7CiAgICAgICAgICB9CgogICAgICAgICAgY2VsbC5jbGFzc0xpc3QucmVtb3ZlKENMQVNTX1RSQU5TSVRJT05JTkcpOwogICAgICAgICAgaXNPcGVuZWQgPSBjZWxsLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19TRUxFQ1RFRCk7CgogICAgICAgICAgaWYgKGlzT3BlbmVkKSB7CiAgICAgICAgICAgIG9wZW5lZEFjdGlvbnMgPSBjZWxsLnF1ZXJ5U2VsZWN0b3IoU0VMRUNUT1JfU0xJREVSX0xFRlQgKyBTRUxFQ1RPUl9TRUxFQ1RFRCkgPyAnbGVmdCcgOiAncmlnaHQnOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIGRldGFpbCA9IGV2ZW50LmRldGFpbDsKICAgICAgdmFyIGRpcmVjdGlvbiA9IGRldGFpbC5kaXJlY3Rpb247CiAgICAgIHZhciBhbmdsZSA9IGRldGFpbC5hbmdsZTsKCiAgICAgIGlmIChkaXJlY3Rpb24gPT09ICdsZWZ0JyAmJiAoYW5nbGUgPiAxNTAgfHwgYW5nbGUgPCAtMTUwKSkgewogICAgICAgIGlmIChidXR0b25zUmlnaHQgfHwgYnV0dG9uc0xlZnQgJiYgaXNPcGVuZWQpIHsKICAgICAgICAgIC8v5a2Y5Zyo5Y+z5L6n5oyJ6ZKu5oiW5a2Y5Zyo5bem5L6n5oyJ6ZKu5LiU5piv5bey5omT5byA54q25oCBCiAgICAgICAgICBpc01vdmVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSAncmlnaHQnICYmIGFuZ2xlID4gLTMwICYmIGFuZ2xlIDwgMzApIHsKICAgICAgICBpZiAoYnV0dG9uc0xlZnQgfHwgYnV0dG9uc1JpZ2h0ICYmIGlzT3BlbmVkKSB7CiAgICAgICAgICAvL+WtmOWcqOW3puS+p+aMiemSruaIluWtmOWcqOWPs+S+p+aMiemSruS4lOaYr+W3suaJk+W8gOeKtuaAgQogICAgICAgICAgaXNNb3ZlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoaXNNb3ZlZCkgewogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIGV2ZW50LmRldGFpbC5nZXN0dXJlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdmFyIHRyYW5zbGF0ZSA9IGV2ZW50LmRldGFpbC5kZWx0YVg7CgogICAgICAgIGlmIChpc09wZW5lZCkgewogICAgICAgICAgaWYgKG9wZW5lZEFjdGlvbnMgPT09ICdyaWdodCcpIHsKICAgICAgICAgICAgdHJhbnNsYXRlID0gdHJhbnNsYXRlIC0gc2xpZGVyQWN0aW9uUmlnaHRXaWR0aDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRyYW5zbGF0ZSA9IHRyYW5zbGF0ZSArIHNsaWRlckFjdGlvbkxlZnRXaWR0aDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0cmFuc2xhdGUgPiAwICYmICFidXR0b25zTGVmdCB8fCB0cmFuc2xhdGUgPCAwICYmICFidXR0b25zUmlnaHQpIHsKICAgICAgICAgIGlmICghaXNPcGVuZWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHRyYW5zbGF0ZSA9IDA7CiAgICAgICAgfQoKICAgICAgICBpZiAodHJhbnNsYXRlIDwgMCkgewogICAgICAgICAgc2xpZGVyRGlyZWN0aW9uID0gJ3RvTGVmdCc7CiAgICAgICAgfSBlbHNlIGlmICh0cmFuc2xhdGUgPiAwKSB7CiAgICAgICAgICBzbGlkZXJEaXJlY3Rpb24gPSAndG9SaWdodCc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICghc2xpZGVyRGlyZWN0aW9uKSB7CiAgICAgICAgICAgIHNsaWRlckRpcmVjdGlvbiA9ICd0b0xlZnQnOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCFzbGlkZXJSZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHsKICAgICAgICAgIHVwZGF0ZVRyYW5zbGF0ZSgpOwogICAgICAgIH0KCiAgICAgICAgdHJhbnNsYXRlWCA9IHRyYW5zbGF0ZTsKICAgICAgfQogICAgfSwKICAgIGZsaWNrOiBmdW5jdGlvbiBmbGljayhldmVudCkgewogICAgICBpZiAoaXNNb3ZlZCkgewogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICB9CiAgICB9LAogICAgc3dpcGVsZWZ0OiBmdW5jdGlvbiBzd2lwZWxlZnQoZXZlbnQpIHsKICAgICAgaWYgKGlzTW92ZWQpIHsKICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgfQogICAgfSwKICAgIHN3aXBlcmlnaHQ6IGZ1bmN0aW9uIHN3aXBlcmlnaHQoZXZlbnQpIHsKICAgICAgaWYgKGlzTW92ZWQpIHsKICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgfQogICAgfSwKICAgIGRyYWdlbmQ6IGZ1bmN0aW9uIGRyYWdlbmQoZXZlbnQpIHsKICAgICAgaWYgKCFpc01vdmVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgIGlmIChzbGlkZXJSZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHsKICAgICAgICBjYW5jZWxBbmltYXRpb25GcmFtZShzbGlkZXJSZXF1ZXN0QW5pbWF0aW9uRnJhbWUpOwogICAgICAgIHNsaWRlclJlcXVlc3RBbmltYXRpb25GcmFtZSA9IG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBkZXRhaWwgPSBldmVudC5kZXRhaWw7CiAgICAgIGlzTW92ZWQgPSBmYWxzZTsKICAgICAgdmFyIGFjdGlvbiA9ICdjbG9zZSc7CiAgICAgIHZhciBhY3Rpb25zV2lkdGggPSBzbGlkZXJEaXJlY3Rpb24gPT09ICd0b0xlZnQnID8gc2xpZGVyQWN0aW9uUmlnaHRXaWR0aCA6IHNsaWRlckFjdGlvbkxlZnRXaWR0aDsKICAgICAgdmFyIGlzVG9nZ2xlID0gZGV0YWlsLnN3aXBlIHx8IE1hdGguYWJzKHRyYW5zbGF0ZVgpID4gYWN0aW9uc1dpZHRoIC8gMjsKCiAgICAgIGlmIChpc1RvZ2dsZSkgewogICAgICAgIGlmICghaXNPcGVuZWQpIHsKICAgICAgICAgIGFjdGlvbiA9ICdvcGVuJzsKICAgICAgICB9IGVsc2UgaWYgKGRldGFpbC5kaXJlY3Rpb24gPT09ICdsZWZ0JyAmJiBvcGVuZWRBY3Rpb25zID09PSAncmlnaHQnKSB7CiAgICAgICAgICBhY3Rpb24gPSAnb3Blbic7CiAgICAgICAgfSBlbHNlIGlmIChkZXRhaWwuZGlyZWN0aW9uID09PSAncmlnaHQnICYmIG9wZW5lZEFjdGlvbnMgPT09ICdsZWZ0JykgewogICAgICAgICAgYWN0aW9uID0gJ29wZW4nOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKENMQVNTX1RSQU5TSVRJT05JTkcpOwogICAgICB2YXIgYnV0dG9uczsKCiAgICAgIGlmIChhY3Rpb24gPT09ICdvcGVuJykgewogICAgICAgIHZhciBuZXdUcmFuc2xhdGUgPSBzbGlkZXJEaXJlY3Rpb24gPT09ICd0b0xlZnQnID8gLWFjdGlvbnNXaWR0aCA6IGFjdGlvbnNXaWR0aDsKICAgICAgICBzZXRUcmFuc2xhdGUoc2xpZGVySGFuZGxlLCBuZXdUcmFuc2xhdGUpOwogICAgICAgIGJ1dHRvbnMgPSBzbGlkZXJEaXJlY3Rpb24gPT09ICd0b0xlZnQnID8gYnV0dG9uc1JpZ2h0IDogYnV0dG9uc0xlZnQ7CgogICAgICAgIGlmICh0eXBlb2YgYnV0dG9ucyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIHZhciBidXR0b24gPSBudWxsOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnV0dG9ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBidXR0b24gPSBidXR0b25zW2ldOwogICAgICAgICAgICBzZXRUcmFuc2xhdGUoYnV0dG9uLCBuZXdUcmFuc2xhdGUpOwogICAgICAgICAgfQoKICAgICAgICAgIGJ1dHRvbi5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoQ0xBU1NfU0VMRUNURUQpOwogICAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKENMQVNTX1NFTEVDVEVEKTsKCiAgICAgICAgICBpZiAoIWlzT3BlbmVkKSB7CiAgICAgICAgICAgICQudHJpZ2dlcihjZWxsLCBzbGlkZXJEaXJlY3Rpb24gPT09ICd0b0xlZnQnID8gJ3NsaWRlbGVmdCcgOiAnc2xpZGVyaWdodCcpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBzZXRUcmFuc2xhdGUoc2xpZGVySGFuZGxlLCAwKTsKICAgICAgICBzbGlkZXJBY3Rpb25MZWZ0ICYmIHNsaWRlckFjdGlvbkxlZnQuY2xhc3NMaXN0LnJlbW92ZShDTEFTU19TRUxFQ1RFRCk7CiAgICAgICAgc2xpZGVyQWN0aW9uUmlnaHQgJiYgc2xpZGVyQWN0aW9uUmlnaHQuY2xhc3NMaXN0LnJlbW92ZShDTEFTU19TRUxFQ1RFRCk7CiAgICAgICAgY2VsbC5jbGFzc0xpc3QucmVtb3ZlKENMQVNTX1NFTEVDVEVEKTsKICAgICAgfQoKICAgICAgdmFyIGJ1dHRvbk9mZnNldDsKCiAgICAgIGlmIChidXR0b25zTGVmdCAmJiBidXR0b25zTGVmdC5sZW5ndGggPiAwICYmIGJ1dHRvbnNMZWZ0ICE9PSBidXR0b25zKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGJ1dHRvbnNMZWZ0Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICB2YXIgYnV0dG9uTGVmdCA9IGJ1dHRvbnNMZWZ0W2ldOwogICAgICAgICAgYnV0dG9uT2Zmc2V0ID0gYnV0dG9uTGVmdC5fYnV0dG9uT2Zmc2V0OwoKICAgICAgICAgIGlmICh0eXBlb2YgYnV0dG9uT2Zmc2V0ID09PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICBidXR0b25MZWZ0Ll9idXR0b25PZmZzZXQgPSBzbGlkZXJBY3Rpb25MZWZ0V2lkdGggLSBidXR0b25MZWZ0Lm9mZnNldExlZnQgLSBidXR0b25MZWZ0Lm9mZnNldFdpZHRoOwogICAgICAgICAgfQoKICAgICAgICAgIHNldFRyYW5zbGF0ZShidXR0b25MZWZ0LCBidXR0b25PZmZzZXQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGJ1dHRvbnNSaWdodCAmJiBidXR0b25zUmlnaHQubGVuZ3RoID4gMCAmJiBidXR0b25zUmlnaHQgIT09IGJ1dHRvbnMpIHsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gYnV0dG9uc1JpZ2h0Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICB2YXIgYnV0dG9uUmlnaHQgPSBidXR0b25zUmlnaHRbaV07CiAgICAgICAgICBidXR0b25PZmZzZXQgPSBidXR0b25SaWdodC5fYnV0dG9uT2Zmc2V0OwoKICAgICAgICAgIGlmICh0eXBlb2YgYnV0dG9uT2Zmc2V0ID09PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICBidXR0b25SaWdodC5fYnV0dG9uT2Zmc2V0ID0gYnV0dG9uUmlnaHQub2Zmc2V0TGVmdDsKICAgICAgICAgIH0KCiAgICAgICAgICBzZXRUcmFuc2xhdGUoYnV0dG9uUmlnaHQsIC1idXR0b25PZmZzZXQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIGZ1bmN0aW9uIHRvZ2dsZUV2ZW50cyhlbGVtZW50LCBpc1JlbW92ZSkgewogICAgdmFyIG1ldGhvZCA9ICEhaXNSZW1vdmUgPyAncmVtb3ZlRXZlbnRMaXN0ZW5lcicgOiAnYWRkRXZlbnRMaXN0ZW5lcic7CiAgICBlbGVtZW50W21ldGhvZF0oJ2RyYWcnLCBoYW5kbGVFdmVudCk7CiAgICBlbGVtZW50W21ldGhvZF0oJ2RyYWdlbmQnLCBoYW5kbGVFdmVudCk7CiAgICBlbGVtZW50W21ldGhvZF0oJ3N3aXBlcmlnaHQnLCBoYW5kbGVFdmVudCk7CiAgICBlbGVtZW50W21ldGhvZF0oJ3N3aXBlbGVmdCcsIGhhbmRsZUV2ZW50KTsKICAgIGVsZW1lbnRbbWV0aG9kXSgnZmxpY2snLCBoYW5kbGVFdmVudCk7CiAgfQoKICA7CiAgLyoqCiAgICog5omT5byA5ruR5Yqo6I+c5Y2VCiAgICogQHBhcmFtIHtPYmplY3R9IGVsCiAgICogQHBhcmFtIHtPYmplY3R9IGRpcmVjdGlvbgogICAqLwoKICAkLnN3aXBlb3V0T3BlbiA9IGZ1bmN0aW9uIChlbCwgZGlyZWN0aW9uKSB7CiAgICBpZiAoIWVsKSByZXR1cm47CiAgICB2YXIgY2xhc3NMaXN0ID0gZWwuY2xhc3NMaXN0OwogICAgaWYgKGNsYXNzTGlzdC5jb250YWlucyhDTEFTU19TRUxFQ1RFRCkpIHJldHVybjsKCiAgICBpZiAoIWRpcmVjdGlvbikgewogICAgICBpZiAoZWwucXVlcnlTZWxlY3RvcihTRUxFQ1RPUl9TTElERVJfUklHSFQpKSB7CiAgICAgICAgZGlyZWN0aW9uID0gJ3JpZ2h0JzsKICAgICAgfSBlbHNlIHsKICAgICAgICBkaXJlY3Rpb24gPSAnbGVmdCc7CiAgICAgIH0KICAgIH0KCiAgICB2YXIgc3dpcGVvdXRBY3Rpb24gPSBlbC5xdWVyeVNlbGVjdG9yKCQuY2xhc3NTZWxlY3RvcigiLnNsaWRlci0iICsgZGlyZWN0aW9uKSk7CiAgICBpZiAoIXN3aXBlb3V0QWN0aW9uKSByZXR1cm47CiAgICBzd2lwZW91dEFjdGlvbi5jbGFzc0xpc3QuYWRkKENMQVNTX1NFTEVDVEVEKTsKICAgIGNsYXNzTGlzdC5hZGQoQ0xBU1NfU0VMRUNURUQpOwogICAgY2xhc3NMaXN0LnJlbW92ZShDTEFTU19UUkFOU0lUSU9OSU5HKTsKICAgIHZhciBidXR0b25zID0gc3dpcGVvdXRBY3Rpb24ucXVlcnlTZWxlY3RvckFsbChTRUxFQ1RPUl9CVVRUT04pOwogICAgdmFyIHN3aXBlb3V0V2lkdGggPSBzd2lwZW91dEFjdGlvbi5vZmZzZXRXaWR0aDsKICAgIHZhciB0cmFuc2xhdGUgPSBkaXJlY3Rpb24gPT09ICdyaWdodCcgPyAtc3dpcGVvdXRXaWR0aCA6IHN3aXBlb3V0V2lkdGg7CiAgICB2YXIgbGVuZ3RoID0gYnV0dG9ucy5sZW5ndGg7CiAgICB2YXIgYnV0dG9uOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgYnV0dG9uID0gYnV0dG9uc1tpXTsKCiAgICAgIGlmIChkaXJlY3Rpb24gPT09ICdyaWdodCcpIHsKICAgICAgICBzZXRUcmFuc2xhdGUoYnV0dG9uLCAtYnV0dG9uLm9mZnNldExlZnQpOwogICAgICB9IGVsc2UgewogICAgICAgIHNldFRyYW5zbGF0ZShidXR0b24sIHN3aXBlb3V0V2lkdGggLSBidXR0b24ub2Zmc2V0V2lkdGggLSBidXR0b24ub2Zmc2V0TGVmdCk7CiAgICAgIH0KICAgIH0KCiAgICBjbGFzc0xpc3QuYWRkKENMQVNTX1RSQU5TSVRJT05JTkcpOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgc2V0VHJhbnNsYXRlKGJ1dHRvbnNbaV0sIHRyYW5zbGF0ZSk7CiAgICB9CgogICAgc2V0VHJhbnNsYXRlKGVsLnF1ZXJ5U2VsZWN0b3IoU0VMRUNUT1JfU0xJREVSX0hBTkRMRSksIHRyYW5zbGF0ZSk7CiAgfTsKICAvKioKICAgKiDlhbPpl63mu5Hliqjoj5zljZUKICAgKiBAcGFyYW0ge09iamVjdH0gZWwKICAgKi8KCgogICQuc3dpcGVvdXRDbG9zZSA9IGZ1bmN0aW9uIChlbCkgewogICAgaWYgKCFlbCkgcmV0dXJuOwogICAgdmFyIGNsYXNzTGlzdCA9IGVsLmNsYXNzTGlzdDsKICAgIGlmICghY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX1NFTEVDVEVEKSkgcmV0dXJuOwogICAgdmFyIGRpcmVjdGlvbiA9IGVsLnF1ZXJ5U2VsZWN0b3IoU0VMRUNUT1JfU0xJREVSX1JJR0hUICsgU0VMRUNUT1JfU0VMRUNURUQpID8gJ3JpZ2h0JyA6ICdsZWZ0JzsKICAgIHZhciBzd2lwZW91dEFjdGlvbiA9IGVsLnF1ZXJ5U2VsZWN0b3IoJC5jbGFzc1NlbGVjdG9yKCIuc2xpZGVyLSIgKyBkaXJlY3Rpb24pKTsKICAgIGlmICghc3dpcGVvdXRBY3Rpb24pIHJldHVybjsKICAgIHN3aXBlb3V0QWN0aW9uLmNsYXNzTGlzdC5yZW1vdmUoQ0xBU1NfU0VMRUNURUQpOwogICAgY2xhc3NMaXN0LnJlbW92ZShDTEFTU19TRUxFQ1RFRCk7CiAgICBjbGFzc0xpc3QuYWRkKENMQVNTX1RSQU5TSVRJT05JTkcpOwogICAgdmFyIGJ1dHRvbnMgPSBzd2lwZW91dEFjdGlvbi5xdWVyeVNlbGVjdG9yQWxsKFNFTEVDVE9SX0JVVFRPTik7CiAgICB2YXIgc3dpcGVvdXRXaWR0aCA9IHN3aXBlb3V0QWN0aW9uLm9mZnNldFdpZHRoOwogICAgdmFyIGxlbmd0aCA9IGJ1dHRvbnMubGVuZ3RoOwogICAgdmFyIGJ1dHRvbjsKICAgIHNldFRyYW5zbGF0ZShlbC5xdWVyeVNlbGVjdG9yKFNFTEVDVE9SX1NMSURFUl9IQU5ETEUpLCAwKTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIGJ1dHRvbiA9IGJ1dHRvbnNbaV07CgogICAgICBpZiAoZGlyZWN0aW9uID09PSAncmlnaHQnKSB7CiAgICAgICAgc2V0VHJhbnNsYXRlKGJ1dHRvbiwgLWJ1dHRvbi5vZmZzZXRMZWZ0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZXRUcmFuc2xhdGUoYnV0dG9uLCBzd2lwZW91dFdpZHRoIC0gYnV0dG9uLm9mZnNldFdpZHRoIC0gYnV0dG9uLm9mZnNldExlZnQpOwogICAgICB9CiAgICB9CiAgfTsKCiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJC5FVkVOVF9FTkQsIGZ1bmN0aW9uIChldmVudCkgewogICAgLy/kvb/nlKh0b3VjaGVuZOadpeWPlua2iOmrmOS6ru+8jOmBv+WFjeS4gOasoeeCueWHu+aXouS4jeinpuWPkXRhcO+8jGRvdWJsZXRhcO+8jGxvbmd0YXDnmoTkuovku7YKICAgIGlmICghY2VsbCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdG9nZ2xlQWN0aXZlKGZhbHNlKTsKICAgIHNsaWRlckhhbmRsZSAmJiB0b2dnbGVFdmVudHMoY2VsbCwgdHJ1ZSk7CiAgfSk7CiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJC5FVkVOVF9DQU5DRUwsIGZ1bmN0aW9uIChldmVudCkgewogICAgLy/kvb/nlKh0b3VjaGNhbmNlbOadpeWPlua2iOmrmOS6ru+8jOmBv+WFjeS4gOasoeeCueWHu+aXouS4jeinpuWPkXRhcO+8jGRvdWJsZXRhcO+8jGxvbmd0YXDnmoTkuovku7YKICAgIGlmICghY2VsbCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdG9nZ2xlQWN0aXZlKGZhbHNlKTsKICAgIHNsaWRlckhhbmRsZSAmJiB0b2dnbGVFdmVudHMoY2VsbCwgdHJ1ZSk7CiAgfSk7CgogIHZhciByYWRpb09yQ2hlY2tib3hDbGljayA9IGZ1bmN0aW9uIHJhZGlvT3JDaGVja2JveENsaWNrKGV2ZW50KSB7CiAgICB2YXIgdHlwZSA9IGV2ZW50LnRhcmdldCAmJiBldmVudC50YXJnZXQudHlwZSB8fCAnJzsKCiAgICBpZiAodHlwZSA9PT0gJ3JhZGlvJyB8fCB0eXBlID09PSAnY2hlY2tib3gnKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgY2xhc3NMaXN0ID0gY2VsbC5jbGFzc0xpc3Q7CgogICAgaWYgKGNsYXNzTGlzdC5jb250YWlucygnbXVpLXJhZGlvJykpIHsKICAgICAgdmFyIGlucHV0ID0gY2VsbC5xdWVyeVNlbGVjdG9yKCdpbnB1dFt0eXBlPXJhZGlvXScpOwoKICAgICAgaWYgKGlucHV0KSB7CiAgICAgICAgLy8JCQkJaW5wdXQuY2xpY2soKTsKICAgICAgICBpZiAoIWlucHV0LmRpc2FibGVkICYmICFpbnB1dC5yZWFkT25seSkgewogICAgICAgICAgaW5wdXQuY2hlY2tlZCA9ICFpbnB1dC5jaGVja2VkOwogICAgICAgICAgJC50cmlnZ2VyKGlucHV0LCAnY2hhbmdlJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgaWYgKGNsYXNzTGlzdC5jb250YWlucygnbXVpLWNoZWNrYm94JykpIHsKICAgICAgdmFyIGlucHV0ID0gY2VsbC5xdWVyeVNlbGVjdG9yKCdpbnB1dFt0eXBlPWNoZWNrYm94XScpOwoKICAgICAgaWYgKGlucHV0KSB7CiAgICAgICAgLy8JCQkJaW5wdXQuY2xpY2soKTsKICAgICAgICBpZiAoIWlucHV0LmRpc2FibGVkICYmICFpbnB1dC5yZWFkT25seSkgewogICAgICAgICAgaW5wdXQuY2hlY2tlZCA9ICFpbnB1dC5jaGVja2VkOwogICAgICAgICAgJC50cmlnZ2VyKGlucHV0LCAnY2hhbmdlJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsgLy9maXhlZCBoYXNoY2hhbmdlKGFuZHJvaWQpCgoKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigkLkVWRU5UX0NMSUNLLCBmdW5jdGlvbiAoZSkgewogICAgaWYgKGNlbGwgJiYgY2VsbC5jbGFzc0xpc3QuY29udGFpbnMoJ211aS1jb2xsYXBzZScpKSB7CiAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgIH0KICB9KTsKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZG91YmxldGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBpZiAoY2VsbCkgewogICAgICByYWRpb09yQ2hlY2tib3hDbGljayhldmVudCk7CiAgICB9CiAgfSk7CiAgdmFyIHByZXZlbnREZWZhdWx0RXhjZXB0aW9uID0gL14oSU5QVVR8VEVYVEFSRUF8QlVUVE9OfFNFTEVDVCkkLzsKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBpZiAoIWNlbGwpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBpc0V4cGFuZCA9IGZhbHNlOwogICAgdmFyIGNsYXNzTGlzdCA9IGNlbGwuY2xhc3NMaXN0OwogICAgdmFyIHVsID0gY2VsbC5wYXJlbnROb2RlOwoKICAgIGlmICh1bCAmJiB1bC5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfUkFESU9fVklFVykpIHsKICAgICAgaWYgKGNsYXNzTGlzdC5jb250YWlucyhDTEFTU19TRUxFQ1RFRCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBzZWxlY3RlZCA9IHVsLnF1ZXJ5U2VsZWN0b3IoJ2xpJyArIFNFTEVDVE9SX1NFTEVDVEVEKTsKCiAgICAgIGlmIChzZWxlY3RlZCkgewogICAgICAgIHNlbGVjdGVkLmNsYXNzTGlzdC5yZW1vdmUoQ0xBU1NfU0VMRUNURUQpOwogICAgICB9CgogICAgICBjbGFzc0xpc3QuYWRkKENMQVNTX1NFTEVDVEVEKTsKICAgICAgJC50cmlnZ2VyKGNlbGwsICdzZWxlY3RlZCcsIHsKICAgICAgICBlbDogY2VsbAogICAgICB9KTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmIChjbGFzc0xpc3QuY29udGFpbnMoJ211aS1jb2xsYXBzZScpICYmICFjZWxsLnBhcmVudE5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdtdWktdW5mb2xkJykpIHsKICAgICAgaWYgKCFwcmV2ZW50RGVmYXVsdEV4Y2VwdGlvbi50ZXN0KGV2ZW50LnRhcmdldC50YWdOYW1lKSkgewogICAgICAgIGV2ZW50LmRldGFpbC5nZXN0dXJlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KCiAgICAgIGlmICghY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX0FDVElWRSkpIHsKICAgICAgICAvL+WxleW8gOaXtizpnIDopoHmlLbnvKnlhbbku5blkIznsbsKICAgICAgICB2YXIgY29sbGFwc2UgPSBjZWxsLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcignLm11aS1jb2xsYXBzZS5tdWktYWN0aXZlJyk7CgogICAgICAgIGlmIChjb2xsYXBzZSkgewogICAgICAgICAgY29sbGFwc2UuY2xhc3NMaXN0LnJlbW92ZShDTEFTU19BQ1RJVkUpOwogICAgICAgIH0KCiAgICAgICAgaXNFeHBhbmQgPSB0cnVlOwogICAgICB9CgogICAgICBjbGFzc0xpc3QudG9nZ2xlKENMQVNTX0FDVElWRSk7CgogICAgICBpZiAoaXNFeHBhbmQpIHsKICAgICAgICAvL+inpuWPkeWxleW8gOS6i+S7tgogICAgICAgICQudHJpZ2dlcihjZWxsLCAnZXhwYW5kJyk7IC8vc2Nyb2xsCiAgICAgICAgLy/mmoLkuI3mu5rliqgKICAgICAgICAvLyB2YXIgb2Zmc2V0VG9wID0gJC5vZmZzZXQoY2VsbCkudG9wOwogICAgICAgIC8vIHZhciBzY3JvbGxUb3AgPSBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcDsKICAgICAgICAvLyB2YXIgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0OwogICAgICAgIC8vIHZhciBvZmZzZXRIZWlnaHQgPSBjZWxsLm9mZnNldEhlaWdodDsKICAgICAgICAvLyB2YXIgY2VsbEhlaWdodCA9IChvZmZzZXRUb3AgLSBzY3JvbGxUb3AgKyBvZmZzZXRIZWlnaHQpOwogICAgICAgIC8vIGlmIChvZmZzZXRIZWlnaHQgPiBoZWlnaHQpIHsKICAgICAgICAvLyAJJC5zY3JvbGxUbyhvZmZzZXRUb3AsIDMwMCk7CiAgICAgICAgLy8gfSBlbHNlIGlmIChjZWxsSGVpZ2h0ID4gaGVpZ2h0KSB7CiAgICAgICAgLy8gCSQuc2Nyb2xsVG8oY2VsbEhlaWdodCAtIGhlaWdodCArIHNjcm9sbFRvcCwgMzAwKTsKICAgICAgICAvLyB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHJhZGlvT3JDaGVja2JveENsaWNrKGV2ZW50KTsKICAgIH0KICB9KTsKfSkobXVpLCB3aW5kb3csIGRvY3VtZW50KTsKCihmdW5jdGlvbiAoJCwgd2luZG93KSB7CiAgLyoqCiAgICog6K2m5ZGK5raI5oGv5qGGCiAgICovCiAgJC5hbGVydCA9IGZ1bmN0aW9uIChtZXNzYWdlLCB0aXRsZSwgYnRuVmFsdWUsIGNhbGxiYWNrKSB7CiAgICBpZiAoJC5vcy5wbHVzKSB7CiAgICAgIGlmICh0eXBlb2YgbWVzc2FnZSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHR5cGVvZiB0aXRsZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgY2FsbGJhY2sgPSB0aXRsZTsKICAgICAgICAgIHRpdGxlID0gbnVsbDsKICAgICAgICAgIGJ0blZhbHVlID0gJ+ehruWumic7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYnRuVmFsdWUgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIGNhbGxiYWNrID0gYnRuVmFsdWU7CiAgICAgICAgICBidG5WYWx1ZSA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICAkLnBsdXNSZWFkeShmdW5jdGlvbiAoKSB7CiAgICAgICAgICBwbHVzLm5hdGl2ZVVJLmFsZXJ0KG1lc3NhZ2UsIGNhbGxiYWNrLCB0aXRsZSwgYnRuVmFsdWUpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvL1RPRE8gSDXniYjmnKwKICAgICAgd2luZG93LmFsZXJ0KG1lc3NhZ2UpOwogICAgfQogIH07Cn0pKG11aSwgd2luZG93KTsKCihmdW5jdGlvbiAoJCwgd2luZG93KSB7CiAgLyoqCiAgICog56Gu6K6k5raI5oGv5qGGCiAgICovCiAgJC5jb25maXJtID0gZnVuY3Rpb24gKG1lc3NhZ2UsIHRpdGxlLCBidG5BcnJheSwgY2FsbGJhY2spIHsKICAgIGlmICgkLm9zLnBsdXMpIHsKICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlID09PSAndW5kZWZpbmVkJykgewogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAodHlwZW9mIHRpdGxlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICBjYWxsYmFjayA9IHRpdGxlOwogICAgICAgICAgdGl0bGUgPSBudWxsOwogICAgICAgICAgYnRuQXJyYXkgPSBudWxsOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGJ0bkFycmF5ID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICBjYWxsYmFjayA9IGJ0bkFycmF5OwogICAgICAgICAgYnRuQXJyYXkgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgJC5wbHVzUmVhZHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgcGx1cy5uYXRpdmVVSS5jb25maXJtKG1lc3NhZ2UsIGNhbGxiYWNrLCB0aXRsZSwgYnRuQXJyYXkpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvL0g154mI5pys77yMMOS4uuehruiupO+8jDHkuLrlj5bmtogKICAgICAgaWYgKHdpbmRvdy5jb25maXJtKG1lc3NhZ2UpKSB7CiAgICAgICAgY2FsbGJhY2soewogICAgICAgICAgaW5kZXg6IDAKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYWxsYmFjayh7CiAgICAgICAgICBpbmRleDogMQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfTsKfSkobXVpLCB3aW5kb3cpOwoKKGZ1bmN0aW9uICgkLCB3aW5kb3cpIHsKICAvKioKICAgKiDovpPlhaXlr7nor53moYYKICAgKi8KICAkLnByb21wdCA9IGZ1bmN0aW9uICh0ZXh0LCBkZWZhdWx0VGV4dCwgdGl0bGUsIGJ0bkFycmF5LCBjYWxsYmFjaykgewogICAgaWYgKCQub3MucGx1cykgewogICAgICBpZiAodHlwZW9mIG1lc3NhZ2UgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0eXBlb2YgZGVmYXVsdFRleHQgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIGNhbGxiYWNrID0gZGVmYXVsdFRleHQ7CiAgICAgICAgICBkZWZhdWx0VGV4dCA9IG51bGw7CiAgICAgICAgICB0aXRsZSA9IG51bGw7CiAgICAgICAgICBidG5BcnJheSA9IG51bGw7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGl0bGUgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIGNhbGxiYWNrID0gdGl0bGU7CiAgICAgICAgICB0aXRsZSA9IG51bGw7CiAgICAgICAgICBidG5BcnJheSA9IG51bGw7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYnRuQXJyYXkgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIGNhbGxiYWNrID0gYnRuQXJyYXk7CiAgICAgICAgICBidG5BcnJheSA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICAkLnBsdXNSZWFkeShmdW5jdGlvbiAoKSB7CiAgICAgICAgICBwbHVzLm5hdGl2ZVVJLnByb21wdCh0ZXh0LCBjYWxsYmFjaywgdGl0bGUsIGRlZmF1bHRUZXh0LCBidG5BcnJheSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vSDXniYjmnKwo56Gu6K6kaW5kZXjkuLow77yM5Y+W5raIaW5kZXjkuLoxKQogICAgICB2YXIgcmVzdWx0ID0gd2luZG93LnByb21wdCh0ZXh0KTsKCiAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICBjYWxsYmFjayh7CiAgICAgICAgICBpbmRleDogMCwKICAgICAgICAgIHZhbHVlOiByZXN1bHQKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYWxsYmFjayh7CiAgICAgICAgICBpbmRleDogMSwKICAgICAgICAgIHZhbHVlOiAnJwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfTsKfSkobXVpLCB3aW5kb3cpOwoKKGZ1bmN0aW9uICgkLCB3aW5kb3cpIHsKICB2YXIgQ0xBU1NfQUNUSVZFID0gJ211aS1hY3RpdmUnOwogIC8qKgogICAqIOiHquWKqOa2iOWkseaPkOekuuahhgogICAqLwoKICAkLnRvYXN0ID0gZnVuY3Rpb24gKG1lc3NhZ2UsIG9wdGlvbnMpIHsKICAgIHZhciBkdXJhdGlvbnMgPSB7CiAgICAgICdsb25nJzogMzUwMCwKICAgICAgJ3Nob3J0JzogMjAwMAogICAgfTsgLy/orqHnrpfmmL7npLrml7bpl7QKCiAgICBvcHRpb25zID0gJC5leHRlbmQoewogICAgICBkdXJhdGlvbjogJ3Nob3J0JwogICAgfSwgb3B0aW9ucyB8fCB7fSk7CgogICAgaWYgKCQub3MucGx1cyAmJiBvcHRpb25zLnR5cGUgIT09ICdkaXYnKSB7CiAgICAgIC8v6buY6K6k5pi+56S65Zyo5bqV6YOo77ybCiAgICAgICQucGx1c1JlYWR5KGZ1bmN0aW9uICgpIHsKICAgICAgICBwbHVzLm5hdGl2ZVVJLnRvYXN0KG1lc3NhZ2UsIHsKICAgICAgICAgIHZlcnRpY2FsQWxpZ246ICdib3R0b20nLAogICAgICAgICAgZHVyYXRpb246IG9wdGlvbnMuZHVyYXRpb24KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBpZiAodHlwZW9mIG9wdGlvbnMuZHVyYXRpb24gPT09ICdudW1iZXInKSB7CiAgICAgICAgZHVyYXRpb24gPSBvcHRpb25zLmR1cmF0aW9uID4gMCA/IG9wdGlvbnMuZHVyYXRpb24gOiBkdXJhdGlvbnNbJ3Nob3J0J107CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZHVyYXRpb24gPSBkdXJhdGlvbnNbb3B0aW9ucy5kdXJhdGlvbl07CiAgICAgIH0KCiAgICAgIGlmICghZHVyYXRpb24pIHsKICAgICAgICBkdXJhdGlvbiA9IGR1cmF0aW9uc1snc2hvcnQnXTsKICAgICAgfQoKICAgICAgdmFyIHRvYXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIHRvYXN0LmNsYXNzTGlzdC5hZGQoJ211aS10b2FzdC1jb250YWluZXInKTsKICAgICAgdG9hc3QuaW5uZXJIVE1MID0gJzxkaXYgY2xhc3M9IicgKyAnbXVpLXRvYXN0LW1lc3NhZ2UnICsgJyI+JyArIG1lc3NhZ2UgKyAnPC9kaXY+JzsKICAgICAgdG9hc3QuYWRkRXZlbnRMaXN0ZW5lcignd2Via2l0VHJhbnNpdGlvbkVuZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoIXRvYXN0LmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19BQ1RJVkUpKSB7CiAgICAgICAgICB0b2FzdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRvYXN0KTsKICAgICAgICAgIHRvYXN0ID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0pOyAvL+eCueWHu+WImeiHquWKqOa2iOWksQoKICAgICAgdG9hc3QuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdG9hc3QucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0b2FzdCk7CiAgICAgICAgdG9hc3QgPSBudWxsOwogICAgICB9KTsKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0b2FzdCk7CiAgICAgIHRvYXN0Lm9mZnNldEhlaWdodDsKICAgICAgdG9hc3QuY2xhc3NMaXN0LmFkZChDTEFTU19BQ1RJVkUpOwogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB0b2FzdCAmJiB0b2FzdC5jbGFzc0xpc3QucmVtb3ZlKENMQVNTX0FDVElWRSk7CiAgICAgIH0sIGR1cmF0aW9uKTsKICAgICAgcmV0dXJuIHsKICAgICAgICBpc1Zpc2libGU6IGZ1bmN0aW9uIGlzVmlzaWJsZSgpIHsKICAgICAgICAgIHJldHVybiAhIXRvYXN0OwogICAgICAgIH0KICAgICAgfTsKICAgIH0KICB9Owp9KShtdWksIHdpbmRvdyk7Ci8qKgogKiBQb3B1cChhbGVydCxjb25maXJtLHByb21wdCkgIAogKiBAcGFyYW0ge09iamVjdH0gJAogKiBAcGFyYW0ge09iamVjdH0gd2luZG93CiAqIEBwYXJhbSB7T2JqZWN0fSBkb2N1bWVudAogKi8KCgooZnVuY3Rpb24gKCQsIHdpbmRvdywgZG9jdW1lbnQpIHsKICB2YXIgQ0xBU1NfUE9QVVAgPSAnbXVpLXBvcHVwJzsKICB2YXIgQ0xBU1NfUE9QVVBfQkFDS0RST1AgPSAnbXVpLXBvcHVwLWJhY2tkcm9wJzsKICB2YXIgQ0xBU1NfUE9QVVBfSU4gPSAnbXVpLXBvcHVwLWluJzsKICB2YXIgQ0xBU1NfUE9QVVBfT1VUID0gJ211aS1wb3B1cC1vdXQnOwogIHZhciBDTEFTU19QT1BVUF9JTk5FUiA9ICdtdWktcG9wdXAtaW5uZXInOwogIHZhciBDTEFTU19QT1BVUF9USVRMRSA9ICdtdWktcG9wdXAtdGl0bGUnOwogIHZhciBDTEFTU19QT1BVUF9URVhUID0gJ211aS1wb3B1cC10ZXh0JzsKICB2YXIgQ0xBU1NfUE9QVVBfSU5QVVQgPSAnbXVpLXBvcHVwLWlucHV0JzsKICB2YXIgQ0xBU1NfUE9QVVBfQlVUVE9OUyA9ICdtdWktcG9wdXAtYnV0dG9ucyc7CiAgdmFyIENMQVNTX1BPUFVQX0JVVFRPTiA9ICdtdWktcG9wdXAtYnV0dG9uJzsKICB2YXIgQ0xBU1NfUE9QVVBfQlVUVE9OX0JPTEQgPSAnbXVpLXBvcHVwLWJ1dHRvbi1ib2xkJzsKICB2YXIgQ0xBU1NfUE9QVVBfQkFDS0RST1AgPSAnbXVpLXBvcHVwLWJhY2tkcm9wJzsKICB2YXIgQ0xBU1NfQUNUSVZFID0gJ211aS1hY3RpdmUnOwogIHZhciBwb3B1cFN0YWNrID0gW107CgogIHZhciBiYWNrZHJvcCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoQ0xBU1NfUE9QVVBfQkFDS0RST1ApOwogICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCQuRVZFTlRfTU9WRSwgJC5wcmV2ZW50RGVmYXVsdCk7CiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3dlYmtpdFRyYW5zaXRpb25FbmQnLCBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICghdGhpcy5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfQUNUSVZFKSkgewogICAgICAgIGVsZW1lbnQucGFyZW50Tm9kZSAmJiBlbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWxlbWVudCk7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfSgpOwoKICB2YXIgY3JlYXRlSW5wdXQgPSBmdW5jdGlvbiBjcmVhdGVJbnB1dChwbGFjZWhvbGRlcikgewogICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgQ0xBU1NfUE9QVVBfSU5QVVQgKyAnIj48aW5wdXQgdHlwZT0idGV4dCIgYXV0b2ZvY3VzIHBsYWNlaG9sZGVyPSInICsgKHBsYWNlaG9sZGVyIHx8ICcnKSArICciLz48L2Rpdj4nOwogIH07CgogIHZhciBjcmVhdGVJbm5lciA9IGZ1bmN0aW9uIGNyZWF0ZUlubmVyKG1lc3NhZ2UsIHRpdGxlLCBleHRyYSkgewogICAgcmV0dXJuICc8ZGl2IGNsYXNzPSInICsgQ0xBU1NfUE9QVVBfSU5ORVIgKyAnIj48ZGl2IGNsYXNzPSInICsgQ0xBU1NfUE9QVVBfVElUTEUgKyAnIj4nICsgdGl0bGUgKyAnPC9kaXY+PGRpdiBjbGFzcz0iJyArIENMQVNTX1BPUFVQX1RFWFQgKyAnIj4nICsgbWVzc2FnZS5yZXBsYWNlKC9cclxuL2csICI8YnIvPiIpLnJlcGxhY2UoL1xuL2csICI8YnIvPiIpICsgJzwvZGl2PicgKyAoZXh0cmEgfHwgJycpICsgJzwvZGl2Pic7CiAgfTsKCiAgdmFyIGNyZWF0ZUJ1dHRvbnMgPSBmdW5jdGlvbiBjcmVhdGVCdXR0b25zKGJ0bkFycmF5KSB7CiAgICB2YXIgbGVuZ3RoID0gYnRuQXJyYXkubGVuZ3RoOwogICAgdmFyIGJ0bnMgPSBbXTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIGJ0bnMucHVzaCgnPHNwYW4gY2xhc3M9IicgKyBDTEFTU19QT1BVUF9CVVRUT04gKyAoaSA9PT0gbGVuZ3RoIC0gMSA/ICcgJyArIENMQVNTX1BPUFVQX0JVVFRPTl9CT0xEIDogJycpICsgJyI+JyArIGJ0bkFycmF5W2ldICsgJzwvc3Bhbj4nKTsKICAgIH0KCiAgICByZXR1cm4gJzxkaXYgY2xhc3M9IicgKyBDTEFTU19QT1BVUF9CVVRUT05TICsgJyI+JyArIGJ0bnMuam9pbignJykgKyAnPC9kaXY+JzsKICB9OwoKICB2YXIgY3JlYXRlUG9wdXAgPSBmdW5jdGlvbiBjcmVhdGVQb3B1cChodG1sLCBjYWxsYmFjaykgewogICAgdmFyIHBvcHVwRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgcG9wdXBFbGVtZW50LmNsYXNzTmFtZSA9IENMQVNTX1BPUFVQOwogICAgcG9wdXBFbGVtZW50LmlubmVySFRNTCA9IGh0bWw7CgogICAgdmFyIHJlbW92ZVBvcHVwRWxlbWVudCA9IGZ1bmN0aW9uIHJlbW92ZVBvcHVwRWxlbWVudCgpIHsKICAgICAgcG9wdXBFbGVtZW50LnBhcmVudE5vZGUgJiYgcG9wdXBFbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocG9wdXBFbGVtZW50KTsKICAgICAgcG9wdXBFbGVtZW50ID0gbnVsbDsKICAgIH07CgogICAgcG9wdXBFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJC5FVkVOVF9NT1ZFLCAkLnByZXZlbnREZWZhdWx0KTsKICAgIHBvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCd3ZWJraXRUcmFuc2l0aW9uRW5kJywgZnVuY3Rpb24gKGUpIHsKICAgICAgaWYgKHBvcHVwRWxlbWVudCAmJiBlLnRhcmdldCA9PT0gcG9wdXBFbGVtZW50ICYmIHBvcHVwRWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfUE9QVVBfT1VUKSkgewogICAgICAgIHJlbW92ZVBvcHVwRWxlbWVudCgpOwogICAgICB9CiAgICB9KTsKICAgIHBvcHVwRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocG9wdXBFbGVtZW50KTsKICAgIHBvcHVwRWxlbWVudC5vZmZzZXRIZWlnaHQ7CiAgICBwb3B1cEVsZW1lbnQuY2xhc3NMaXN0LmFkZChDTEFTU19QT1BVUF9JTik7CgogICAgaWYgKCFiYWNrZHJvcC5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfQUNUSVZFKSkgewogICAgICBiYWNrZHJvcC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChiYWNrZHJvcCk7CiAgICAgIGJhY2tkcm9wLm9mZnNldEhlaWdodDsKICAgICAgYmFja2Ryb3AuY2xhc3NMaXN0LmFkZChDTEFTU19BQ1RJVkUpOwogICAgfQoKICAgIHZhciBidG5zID0gJC5xc2EoJy4nICsgQ0xBU1NfUE9QVVBfQlVUVE9OLCBwb3B1cEVsZW1lbnQpOwogICAgdmFyIGlucHV0ID0gcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nICsgQ0xBU1NfUE9QVVBfSU5QVVQgKyAnIGlucHV0Jyk7CiAgICB2YXIgcG9wdXAgPSB7CiAgICAgIGVsZW1lbnQ6IHBvcHVwRWxlbWVudCwKICAgICAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKGluZGV4LCBhbmltYXRlKSB7CiAgICAgICAgaWYgKHBvcHVwRWxlbWVudCkgewogICAgICAgICAgdmFyIHJlc3VsdCA9IGNhbGxiYWNrICYmIGNhbGxiYWNrKHsKICAgICAgICAgICAgaW5kZXg6IGluZGV4IHx8IDAsCiAgICAgICAgICAgIHZhbHVlOiBpbnB1dCAmJiBpbnB1dC52YWx1ZSB8fCAnJwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKHJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgLy/ov5Tlm55mYWxzZeWImeS4jeWFs+mXreW9k+WJjXBvcHVwCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoYW5pbWF0ZSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoQ0xBU1NfUE9QVVBfSU4pOwogICAgICAgICAgICBwb3B1cEVsZW1lbnQuY2xhc3NMaXN0LmFkZChDTEFTU19QT1BVUF9PVVQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVtb3ZlUG9wdXBFbGVtZW50KCk7CiAgICAgICAgICB9CgogICAgICAgICAgcG9wdXBTdGFjay5wb3AoKTsgLy/lpoLmnpzov5jmnInlhbbku5Zwb3B1cO+8jOWImeS4jXJlbW92ZSBiYWNrZHJvcAoKICAgICAgICAgIGlmIChwb3B1cFN0YWNrLmxlbmd0aCkgewogICAgICAgICAgICBwb3B1cFN0YWNrW3BvcHVwU3RhY2subGVuZ3RoIC0gMV1bJ3Nob3cnXShhbmltYXRlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJhY2tkcm9wLmNsYXNzTGlzdC5yZW1vdmUoQ0xBU1NfQUNUSVZFKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgdmFyIGhhbmRsZUV2ZW50ID0gZnVuY3Rpb24gaGFuZGxlRXZlbnQoZSkgewogICAgICBwb3B1cC5jbG9zZShidG5zLmluZGV4T2YoZS50YXJnZXQpKTsKICAgIH07CgogICAgJChwb3B1cEVsZW1lbnQpLm9uKCd0YXAnLCAnLicgKyBDTEFTU19QT1BVUF9CVVRUT04sIGhhbmRsZUV2ZW50KTsKCiAgICBpZiAocG9wdXBTdGFjay5sZW5ndGgpIHsKICAgICAgcG9wdXBTdGFja1twb3B1cFN0YWNrLmxlbmd0aCAtIDFdWydoaWRlJ10oKTsKICAgIH0KCiAgICBwb3B1cFN0YWNrLnB1c2goewogICAgICBjbG9zZTogcG9wdXAuY2xvc2UsCiAgICAgIHNob3c6IGZ1bmN0aW9uIHNob3coYW5pbWF0ZSkgewogICAgICAgIHBvcHVwRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICBwb3B1cEVsZW1lbnQub2Zmc2V0SGVpZ2h0OwogICAgICAgIHBvcHVwRWxlbWVudC5jbGFzc0xpc3QuYWRkKENMQVNTX1BPUFVQX0lOKTsKICAgICAgfSwKICAgICAgaGlkZTogZnVuY3Rpb24gaGlkZSgpIHsKICAgICAgICBwb3B1cEVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBwb3B1cEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShDTEFTU19QT1BVUF9JTik7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHBvcHVwOwogIH07CgogIHZhciBjcmVhdGVBbGVydCA9IGZ1bmN0aW9uIGNyZWF0ZUFsZXJ0KG1lc3NhZ2UsIHRpdGxlLCBidG5WYWx1ZSwgY2FsbGJhY2ssIHR5cGUpIHsKICAgIGlmICh0eXBlb2YgbWVzc2FnZSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgcmV0dXJuOwogICAgfSBlbHNlIHsKICAgICAgaWYgKHR5cGVvZiB0aXRsZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGNhbGxiYWNrID0gdGl0bGU7CiAgICAgICAgdHlwZSA9IGJ0blZhbHVlOwogICAgICAgIHRpdGxlID0gbnVsbDsKICAgICAgICBidG5WYWx1ZSA9IG51bGw7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGJ0blZhbHVlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgdHlwZSA9IGNhbGxiYWNrOwogICAgICAgIGNhbGxiYWNrID0gYnRuVmFsdWU7CiAgICAgICAgYnRuVmFsdWUgPSBudWxsOwogICAgICB9CiAgICB9CgogICAgaWYgKCEkLm9zLnBsdXMgfHwgdHlwZSA9PT0gJ2RpdicpIHsKICAgICAgcmV0dXJuIGNyZWF0ZVBvcHVwKGNyZWF0ZUlubmVyKG1lc3NhZ2UsIHRpdGxlIHx8ICfmj5DnpLonKSArIGNyZWF0ZUJ1dHRvbnMoW2J0blZhbHVlIHx8ICfnoa7lrponXSksIGNhbGxiYWNrKTsKICAgIH0KCiAgICByZXR1cm4gcGx1cy5uYXRpdmVVSS5hbGVydChtZXNzYWdlLCBjYWxsYmFjaywgdGl0bGUgfHwgJ+aPkOekuicsIGJ0blZhbHVlIHx8ICfnoa7lrponKTsKICB9OwoKICB2YXIgY3JlYXRlQ29uZmlybSA9IGZ1bmN0aW9uIGNyZWF0ZUNvbmZpcm0obWVzc2FnZSwgdGl0bGUsIGJ0bkFycmF5LCBjYWxsYmFjaywgdHlwZSkgewogICAgaWYgKHR5cGVvZiBtZXNzYWdlID09PSAndW5kZWZpbmVkJykgewogICAgICByZXR1cm47CiAgICB9IGVsc2UgewogICAgICBpZiAodHlwZW9mIHRpdGxlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgY2FsbGJhY2sgPSB0aXRsZTsKICAgICAgICB0eXBlID0gYnRuQXJyYXk7CiAgICAgICAgdGl0bGUgPSBudWxsOwogICAgICAgIGJ0bkFycmF5ID0gbnVsbDsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYnRuQXJyYXkgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICB0eXBlID0gY2FsbGJhY2s7CiAgICAgICAgY2FsbGJhY2sgPSBidG5BcnJheTsKICAgICAgICBidG5BcnJheSA9IG51bGw7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoISQub3MucGx1cyB8fCB0eXBlID09PSAnZGl2JykgewogICAgICByZXR1cm4gY3JlYXRlUG9wdXAoY3JlYXRlSW5uZXIobWVzc2FnZSwgdGl0bGUgfHwgJ+aPkOekuicpICsgY3JlYXRlQnV0dG9ucyhidG5BcnJheSB8fCBbJ+WPlua2iCcsICfnoa7orqQnXSksIGNhbGxiYWNrKTsKICAgIH0KCiAgICByZXR1cm4gcGx1cy5uYXRpdmVVSS5jb25maXJtKG1lc3NhZ2UsIGNhbGxiYWNrLCB0aXRsZSwgYnRuQXJyYXkgfHwgWyflj5bmtognLCAn56Gu6K6kJ10pOwogIH07CgogIHZhciBjcmVhdGVQcm9tcHQgPSBmdW5jdGlvbiBjcmVhdGVQcm9tcHQobWVzc2FnZSwgcGxhY2Vob2xkZXIsIHRpdGxlLCBidG5BcnJheSwgY2FsbGJhY2ssIHR5cGUpIHsKICAgIGlmICh0eXBlb2YgbWVzc2FnZSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgcmV0dXJuOwogICAgfSBlbHNlIHsKICAgICAgaWYgKHR5cGVvZiBwbGFjZWhvbGRlciA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGNhbGxiYWNrID0gcGxhY2Vob2xkZXI7CiAgICAgICAgdHlwZSA9IHRpdGxlOwogICAgICAgIHBsYWNlaG9sZGVyID0gbnVsbDsKICAgICAgICB0aXRsZSA9IG51bGw7CiAgICAgICAgYnRuQXJyYXkgPSBudWxsOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiB0aXRsZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGNhbGxiYWNrID0gdGl0bGU7CiAgICAgICAgdHlwZSA9IGJ0bkFycmF5OwogICAgICAgIHRpdGxlID0gbnVsbDsKICAgICAgICBidG5BcnJheSA9IG51bGw7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGJ0bkFycmF5ID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgdHlwZSA9IGNhbGxiYWNrOwogICAgICAgIGNhbGxiYWNrID0gYnRuQXJyYXk7CiAgICAgICAgYnRuQXJyYXkgPSBudWxsOwogICAgICB9CiAgICB9CgogICAgaWYgKCEkLm9zLnBsdXMgfHwgdHlwZSA9PT0gJ2RpdicpIHsKICAgICAgcmV0dXJuIGNyZWF0ZVBvcHVwKGNyZWF0ZUlubmVyKG1lc3NhZ2UsIHRpdGxlIHx8ICfmj5DnpLonLCBjcmVhdGVJbnB1dChwbGFjZWhvbGRlcikpICsgY3JlYXRlQnV0dG9ucyhidG5BcnJheSB8fCBbJ+WPlua2iCcsICfnoa7orqQnXSksIGNhbGxiYWNrKTsKICAgIH0KCiAgICByZXR1cm4gcGx1cy5uYXRpdmVVSS5wcm9tcHQobWVzc2FnZSwgY2FsbGJhY2ssIHRpdGxlIHx8ICfmj5DnpLonLCBwbGFjZWhvbGRlciwgYnRuQXJyYXkgfHwgWyflj5bmtognLCAn56Gu6K6kJ10pOwogIH07CgogIHZhciBjbG9zZVBvcHVwID0gZnVuY3Rpb24gY2xvc2VQb3B1cCgpIHsKICAgIGlmIChwb3B1cFN0YWNrLmxlbmd0aCkgewogICAgICBwb3B1cFN0YWNrW3BvcHVwU3RhY2subGVuZ3RoIC0gMV1bJ2Nsb3NlJ10oKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfTsKCiAgdmFyIGNsb3NlUG9wdXBzID0gZnVuY3Rpb24gY2xvc2VQb3B1cHMoKSB7CiAgICB3aGlsZSAocG9wdXBTdGFjay5sZW5ndGgpIHsKICAgICAgcG9wdXBTdGFja1twb3B1cFN0YWNrLmxlbmd0aCAtIDFdWydjbG9zZSddKCk7CiAgICB9CiAgfTsKCiAgJC5jbG9zZVBvcHVwID0gY2xvc2VQb3B1cDsKICAkLmNsb3NlUG9wdXBzID0gY2xvc2VQb3B1cHM7CiAgJC5hbGVydCA9IGNyZWF0ZUFsZXJ0OwogICQuY29uZmlybSA9IGNyZWF0ZUNvbmZpcm07CiAgJC5wcm9tcHQgPSBjcmVhdGVQcm9tcHQ7Cn0pKG11aSwgd2luZG93LCBkb2N1bWVudCk7CgooZnVuY3Rpb24gKCQsIGRvY3VtZW50KSB7CiAgdmFyIENMQVNTX1BST0dSRVNTQkFSID0gJ211aS1wcm9ncmVzc2Jhcic7CiAgdmFyIENMQVNTX1BST0dSRVNTQkFSX0lOID0gJ211aS1wcm9ncmVzc2Jhci1pbic7CiAgdmFyIENMQVNTX1BST0dSRVNTQkFSX09VVCA9ICdtdWktcHJvZ3Jlc3NiYXItb3V0JzsKICB2YXIgQ0xBU1NfUFJPR1JFU1NCQVJfSU5GSU5JVEUgPSAnbXVpLXByb2dyZXNzYmFyLWluZmluaXRlJzsKICB2YXIgU0VMRUNUT1JfUFJPR1JFU1NCQVIgPSAnLm11aS1wcm9ncmVzc2Jhcic7CgogIHZhciBfZmluZFByb2dyZXNzYmFyID0gZnVuY3Rpb24gX2ZpbmRQcm9ncmVzc2Jhcihjb250YWluZXIpIHsKICAgIGNvbnRhaW5lciA9ICQoY29udGFpbmVyIHx8ICdib2R5Jyk7CiAgICBpZiAoY29udGFpbmVyLmxlbmd0aCA9PT0gMCkgcmV0dXJuOwogICAgY29udGFpbmVyID0gY29udGFpbmVyWzBdOwoKICAgIGlmIChjb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX1BST0dSRVNTQkFSKSkgewogICAgICByZXR1cm4gY29udGFpbmVyOwogICAgfQoKICAgIHZhciBwcm9ncmVzc2JhcnMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbChTRUxFQ1RPUl9QUk9HUkVTU0JBUik7CgogICAgaWYgKHByb2dyZXNzYmFycykgewogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcHJvZ3Jlc3NiYXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgdmFyIHByb2dyZXNzYmFyID0gcHJvZ3Jlc3NiYXJzW2ldOwoKICAgICAgICBpZiAocHJvZ3Jlc3NiYXIucGFyZW50Tm9kZSA9PT0gY29udGFpbmVyKSB7CiAgICAgICAgICByZXR1cm4gcHJvZ3Jlc3NiYXI7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKICAvKioKICAgKiDliJvlu7rlubbmmL7npLrov5vluqbmnaEgCiAgICogQHBhcmFtIHtPYmplY3R9IGNvbnRhaW5lciAg5Y+v6YCJ77yM6buY6K6kYm9kee+8jOaUr+aMgXNlbGVjdG9yLERPTSBOb2RlLG11aSB3cmFwcGVyCiAgICogQHBhcmFtIHtPYmplY3R9IHByb2dyZXNzIOWPr+mAie+8jHVuZGVmaW5lZOihqOekuuW+queOr++8jOaVsOWtl+ihqOekuuWFt+S9k+i/m+W6pgogICAqIEBwYXJhbSB7T2JqZWN0fSBjb2xvciDlj6/pgInvvIzmjIflrprpopzoibLmoLflvI8o55uu5YmN5pqC5pyq5o+Q5L6b5a6e6ZmF5qC35byP77yM5Y+v5pqC5pe25LiN5pq06Zyy5q2k5Y+C5pWwKQogICAqLwoKCiAgdmFyIHNob3dQcm9ncmVzc2JhciA9IGZ1bmN0aW9uIHNob3dQcm9ncmVzc2Jhcihjb250YWluZXIsIHByb2dyZXNzLCBjb2xvcikgewogICAgaWYgKHR5cGVvZiBjb250YWluZXIgPT09ICdudW1iZXInKSB7CiAgICAgIGNvbG9yID0gcHJvZ3Jlc3M7CiAgICAgIHByb2dyZXNzID0gY29udGFpbmVyOwogICAgICBjb250YWluZXIgPSAnYm9keSc7CiAgICB9CgogICAgY29udGFpbmVyID0gJChjb250YWluZXIgfHwgJ2JvZHknKTsKICAgIGlmIChjb250YWluZXIubGVuZ3RoID09PSAwKSByZXR1cm47CiAgICBjb250YWluZXIgPSBjb250YWluZXJbMF07CiAgICB2YXIgcHJvZ3Jlc3NiYXI7CgogICAgaWYgKGNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfUFJPR1JFU1NCQVIpKSB7CiAgICAgIHByb2dyZXNzYmFyID0gY29udGFpbmVyOwogICAgfSBlbHNlIHsKICAgICAgdmFyIHByb2dyZXNzYmFycyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKFNFTEVDVE9SX1BST0dSRVNTQkFSICsgJzpub3QoLicgKyBDTEFTU19QUk9HUkVTU0JBUl9PVVQgKyAnKScpOwoKICAgICAgaWYgKHByb2dyZXNzYmFycykgewogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBwcm9ncmVzc2JhcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIHZhciBfcHJvZ3Jlc3NiYXIgPSBwcm9ncmVzc2JhcnNbaV07CgogICAgICAgICAgaWYgKF9wcm9ncmVzc2Jhci5wYXJlbnROb2RlID09PSBjb250YWluZXIpIHsKICAgICAgICAgICAgcHJvZ3Jlc3NiYXIgPSBfcHJvZ3Jlc3NiYXI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCFwcm9ncmVzc2JhcikgewogICAgICAgIHByb2dyZXNzYmFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICAgIHByb2dyZXNzYmFyLmNsYXNzTmFtZSA9IENMQVNTX1BST0dSRVNTQkFSICsgJyAnICsgQ0xBU1NfUFJPR1JFU1NCQVJfSU4gKyAodHlwZW9mIHByb2dyZXNzICE9PSAndW5kZWZpbmVkJyA/ICcnIDogJyAnICsgQ0xBU1NfUFJPR1JFU1NCQVJfSU5GSU5JVEUpICsgKGNvbG9yID8gJyAnICsgQ0xBU1NfUFJPR1JFU1NCQVIgKyAnLScgKyBjb2xvciA6ICcnKTsKCiAgICAgICAgaWYgKHR5cGVvZiBwcm9ncmVzcyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIHByb2dyZXNzYmFyLmlubmVySFRNTCA9ICc8c3Bhbj48L3NwYW4+JzsKICAgICAgICB9CgogICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwcm9ncmVzc2Jhcik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHJvZ3Jlc3NiYXIuY2xhc3NMaXN0LmFkZChDTEFTU19QUk9HUkVTU0JBUl9JTik7CiAgICAgIH0KICAgIH0KCiAgICBpZiAocHJvZ3Jlc3MpIHNldFByb2dyZXNzYmFyKGNvbnRhaW5lciwgcHJvZ3Jlc3MpOwogICAgcmV0dXJuIHByb2dyZXNzYmFyOwogIH07CiAgLyoqCiAgICog5YWz6Zet6L+b5bqm5p2hIAogICAqIEBwYXJhbSB7T2JqZWN0fSBjb250YWluZXIg5Y+v6YCJ77yM6buY6K6kYm9kee+8jOaUr+aMgXNlbGVjdG9yLERPTSBOb2RlLG11aSB3cmFwcGVyCiAgICovCgoKICB2YXIgaGlkZVByb2dyZXNzYmFyID0gZnVuY3Rpb24gaGlkZVByb2dyZXNzYmFyKGNvbnRhaW5lcikgewogICAgdmFyIHByb2dyZXNzYmFyID0gX2ZpbmRQcm9ncmVzc2Jhcihjb250YWluZXIpOwoKICAgIGlmICghcHJvZ3Jlc3NiYXIpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBjbGFzc0xpc3QgPSBwcm9ncmVzc2Jhci5jbGFzc0xpc3Q7CgogICAgaWYgKCFjbGFzc0xpc3QuY29udGFpbnMoQ0xBU1NfUFJPR1JFU1NCQVJfSU4pIHx8IGNsYXNzTGlzdC5jb250YWlucyhDTEFTU19QUk9HUkVTU0JBUl9PVVQpKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjbGFzc0xpc3QucmVtb3ZlKENMQVNTX1BST0dSRVNTQkFSX0lOKTsKICAgIGNsYXNzTGlzdC5hZGQoQ0xBU1NfUFJPR1JFU1NCQVJfT1VUKTsKICAgIHByb2dyZXNzYmFyLmFkZEV2ZW50TGlzdGVuZXIoJ3dlYmtpdEFuaW1hdGlvbkVuZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgcHJvZ3Jlc3NiYXIucGFyZW50Tm9kZSAmJiBwcm9ncmVzc2Jhci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHByb2dyZXNzYmFyKTsKICAgICAgcHJvZ3Jlc3NiYXIgPSBudWxsOwogICAgfSk7CiAgICByZXR1cm47CiAgfTsKICAvKioKICAgKiDorr7nva7mjIflrprov5vluqbmnaHov5vluqYgCiAgICogQHBhcmFtIHtPYmplY3R9IGNvbnRhaW5lciAg5Y+v6YCJ77yM6buY6K6kYm9kee+8jOaUr+aMgXNlbGVjdG9yLERPTSBOb2RlLG11aSB3cmFwcGVyCiAgICogQHBhcmFtIHtPYmplY3R9IHByb2dyZXNzIOWPr+mAie+8jOm7mOiupDAg5Y+W5YC86IyD5Zu0WzAtMTAwXQogICAqIEBwYXJhbSB7T2JqZWN0fSBzcGVlZCDov5vluqbmnaHliqjnlLvml7bpl7QKICAgKi8KCgogIHZhciBzZXRQcm9ncmVzc2JhciA9IGZ1bmN0aW9uIHNldFByb2dyZXNzYmFyKGNvbnRhaW5lciwgcHJvZ3Jlc3MsIHNwZWVkKSB7CiAgICBpZiAodHlwZW9mIGNvbnRhaW5lciA9PT0gJ251bWJlcicpIHsKICAgICAgc3BlZWQgPSBwcm9ncmVzczsKICAgICAgcHJvZ3Jlc3MgPSBjb250YWluZXI7CiAgICAgIGNvbnRhaW5lciA9IGZhbHNlOwogICAgfQoKICAgIHZhciBwcm9ncmVzc2JhciA9IF9maW5kUHJvZ3Jlc3NiYXIoY29udGFpbmVyKTsKCiAgICBpZiAoIXByb2dyZXNzYmFyIHx8IHByb2dyZXNzYmFyLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19QUk9HUkVTU0JBUl9JTkZJTklURSkpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmIChwcm9ncmVzcykgcHJvZ3Jlc3MgPSBNYXRoLm1pbihNYXRoLm1heChwcm9ncmVzcywgMCksIDEwMCk7CiAgICBwcm9ncmVzc2Jhci5vZmZzZXRIZWlnaHQ7CiAgICB2YXIgc3BhbiA9IHByb2dyZXNzYmFyLnF1ZXJ5U2VsZWN0b3IoJ3NwYW4nKTsKCiAgICBpZiAoc3BhbikgewogICAgICB2YXIgc3R5bGUgPSBzcGFuLnN0eWxlOwogICAgICBzdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSAndHJhbnNsYXRlM2QoJyArICgtMTAwICsgcHJvZ3Jlc3MpICsgJyUsMCwwKSc7CgogICAgICBpZiAodHlwZW9mIHNwZWVkICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIHN0eWxlLndlYmtpdFRyYW5zaXRpb25EdXJhdGlvbiA9IHNwZWVkICsgJ21zJzsKICAgICAgfSBlbHNlIHsKICAgICAgICBzdHlsZS53ZWJraXRUcmFuc2l0aW9uRHVyYXRpb24gPSAnJzsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBwcm9ncmVzc2JhcjsKICB9OwoKICAkLmZuLnByb2dyZXNzYmFyID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIHZhciBwcm9ncmVzc2JhckFwaXMgPSBbXTsKICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgcHJvZ3Jlc3NiYXJBcGkgPSBzZWxmLm11aV9wbHVnaW5fcHJvZ3Jlc3NiYXI7CgogICAgICBpZiAoIXByb2dyZXNzYmFyQXBpKSB7CiAgICAgICAgc2VsZi5tdWlfcGx1Z2luX3Byb2dyZXNzYmFyID0gcHJvZ3Jlc3NiYXJBcGkgPSB7CiAgICAgICAgICBvcHRpb25zOiBvcHRpb25zLAogICAgICAgICAgc2V0T3B0aW9uczogZnVuY3Rpb24gc2V0T3B0aW9ucyhvcHRpb25zKSB7CiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CiAgICAgICAgICB9LAogICAgICAgICAgc2hvdzogZnVuY3Rpb24gc2hvdygpIHsKICAgICAgICAgICAgcmV0dXJuIHNob3dQcm9ncmVzc2JhcihzZWxmLCB0aGlzLm9wdGlvbnMucHJvZ3Jlc3MsIHRoaXMub3B0aW9ucy5jb2xvcik7CiAgICAgICAgICB9LAogICAgICAgICAgc2V0UHJvZ3Jlc3M6IGZ1bmN0aW9uIHNldFByb2dyZXNzKHByb2dyZXNzKSB7CiAgICAgICAgICAgIHJldHVybiBzZXRQcm9ncmVzc2JhcihzZWxmLCBwcm9ncmVzcyk7CiAgICAgICAgICB9LAogICAgICAgICAgaGlkZTogZnVuY3Rpb24gaGlkZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGhpZGVQcm9ncmVzc2JhcihzZWxmKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9IGVsc2UgaWYgKG9wdGlvbnMpIHsKICAgICAgICBwcm9ncmVzc2JhckFwaS5zZXRPcHRpb25zKG9wdGlvbnMpOwogICAgICB9CgogICAgICBwcm9ncmVzc2JhckFwaXMucHVzaChwcm9ncmVzc2JhckFwaSk7CiAgICB9KTsKICAgIHJldHVybiBwcm9ncmVzc2JhckFwaXMubGVuZ3RoID09PSAxID8gcHJvZ3Jlc3NiYXJBcGlzWzBdIDogcHJvZ3Jlc3NiYXJBcGlzOwogIH07IC8vCSQuc2V0UHJvZ3Jlc3NiYXIgPSBzZXRQcm9ncmVzc2JhcjsKICAvLwkkLnNob3dQcm9ncmVzc2JhciA9IHNob3dQcm9ncmVzc2JhcjsKICAvLwkkLmhpZGVQcm9ncmVzc2JhciA9IGhpZGVQcm9ncmVzc2JhcjsKCn0pKG11aSwgZG9jdW1lbnQpOwovKioKICogSW5wdXQoVE9ETyByZXNpemUpCiAqIEBwYXJhbSB7dHlwZX0gJAogKiBAcGFyYW0ge3R5cGV9IHdpbmRvdwogKiBAcGFyYW0ge3R5cGV9IGRvY3VtZW50CiAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAqLwoKCihmdW5jdGlvbiAoJCwgd2luZG93LCBkb2N1bWVudCkgewogIHZhciBDTEFTU19JQ09OID0gJ211aS1pY29uJzsKICB2YXIgQ0xBU1NfSUNPTl9DTEVBUiA9ICdtdWktaWNvbi1jbGVhcic7CiAgdmFyIENMQVNTX0lDT05fU1BFRUNIID0gJ211aS1pY29uLXNwZWVjaCc7CiAgdmFyIENMQVNTX0lDT05fU0VBUkNIID0gJ211aS1pY29uLXNlYXJjaCc7CiAgdmFyIENMQVNTX0lDT05fUEFTU1dPUkQgPSAnbXVpLWljb24tZXllJzsKICB2YXIgQ0xBU1NfSU5QVVRfUk9XID0gJ211aS1pbnB1dC1yb3cnOwogIHZhciBDTEFTU19QTEFDRUhPTERFUiA9ICdtdWktcGxhY2Vob2xkZXInOwogIHZhciBDTEFTU19UT09MVElQID0gJ211aS10b29sdGlwJzsKICB2YXIgQ0xBU1NfSElEREVOID0gJ211aS1oaWRkZW4nOwogIHZhciBDTEFTU19GT0NVU0lOID0gJ211aS1mb2N1c2luJzsKICB2YXIgU0VMRUNUT1JfSUNPTl9DTE9TRSA9ICcuJyArIENMQVNTX0lDT05fQ0xFQVI7CiAgdmFyIFNFTEVDVE9SX0lDT05fU1BFRUNIID0gJy4nICsgQ0xBU1NfSUNPTl9TUEVFQ0g7CiAgdmFyIFNFTEVDVE9SX0lDT05fUEFTU1dPUkQgPSAnLicgKyBDTEFTU19JQ09OX1BBU1NXT1JEOwogIHZhciBTRUxFQ1RPUl9QTEFDRUhPTERFUiA9ICcuJyArIENMQVNTX1BMQUNFSE9MREVSOwogIHZhciBTRUxFQ1RPUl9UT09MVElQID0gJy4nICsgQ0xBU1NfVE9PTFRJUDsKCiAgdmFyIGZpbmRSb3cgPSBmdW5jdGlvbiBmaW5kUm93KHRhcmdldCkgewogICAgZm9yICg7IHRhcmdldCAmJiB0YXJnZXQgIT09IGRvY3VtZW50OyB0YXJnZXQgPSB0YXJnZXQucGFyZW50Tm9kZSkgewogICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdCAmJiB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKENMQVNTX0lOUFVUX1JPVykpIHsKICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIG51bGw7CiAgfTsKCiAgdmFyIElucHV0ID0gZnVuY3Rpb24gSW5wdXQoZWxlbWVudCwgb3B0aW9ucykgewogICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDsKICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgfHwgewogICAgICBhY3Rpb25zOiAnY2xlYXInCiAgICB9OwoKICAgIGlmICh+dGhpcy5vcHRpb25zLmFjdGlvbnMuaW5kZXhPZignc2xpZGVyJykpIHsKICAgICAgLy9zbGlkZXIKICAgICAgdGhpcy5zbGlkZXJBY3Rpb25DbGFzcyA9IENMQVNTX1RPT0xUSVAgKyAnICcgKyBDTEFTU19ISURERU47CiAgICAgIHRoaXMuc2xpZGVyQWN0aW9uU2VsZWN0b3IgPSBTRUxFQ1RPUl9UT09MVElQOwogICAgfSBlbHNlIHsKICAgICAgLy9jbGVhcixzcGVlY2gsc2VhcmNoCiAgICAgIGlmICh+dGhpcy5vcHRpb25zLmFjdGlvbnMuaW5kZXhPZignY2xlYXInKSkgewogICAgICAgIHRoaXMuY2xlYXJBY3Rpb25DbGFzcyA9IENMQVNTX0lDT04gKyAnICcgKyBDTEFTU19JQ09OX0NMRUFSICsgJyAnICsgQ0xBU1NfSElEREVOOwogICAgICAgIHRoaXMuY2xlYXJBY3Rpb25TZWxlY3RvciA9IFNFTEVDVE9SX0lDT05fQ0xPU0U7CiAgICAgIH0KCiAgICAgIGlmICh+dGhpcy5vcHRpb25zLmFjdGlvbnMuaW5kZXhPZignc3BlZWNoJykpIHsKICAgICAgICAvL29ubHkgZm9yIDUrCiAgICAgICAgdGhpcy5zcGVlY2hBY3Rpb25DbGFzcyA9IENMQVNTX0lDT04gKyAnICcgKyBDTEFTU19JQ09OX1NQRUVDSDsKICAgICAgICB0aGlzLnNwZWVjaEFjdGlvblNlbGVjdG9yID0gU0VMRUNUT1JfSUNPTl9TUEVFQ0g7CiAgICAgIH0KCiAgICAgIGlmICh+dGhpcy5vcHRpb25zLmFjdGlvbnMuaW5kZXhPZignc2VhcmNoJykpIHsKICAgICAgICB0aGlzLnNlYXJjaEFjdGlvbkNsYXNzID0gQ0xBU1NfUExBQ0VIT0xERVI7CiAgICAgICAgdGhpcy5zZWFyY2hBY3Rpb25TZWxlY3RvciA9IFNFTEVDVE9SX1BMQUNFSE9MREVSOwogICAgICB9CgogICAgICBpZiAofnRoaXMub3B0aW9ucy5hY3Rpb25zLmluZGV4T2YoJ3Bhc3N3b3JkJykpIHsKICAgICAgICB0aGlzLnBhc3N3b3JkQWN0aW9uQ2xhc3MgPSBDTEFTU19JQ09OICsgJyAnICsgQ0xBU1NfSUNPTl9QQVNTV09SRDsKICAgICAgICB0aGlzLnBhc3N3b3JkQWN0aW9uU2VsZWN0b3IgPSBTRUxFQ1RPUl9JQ09OX1BBU1NXT1JEOwogICAgICB9CiAgICB9CgogICAgdGhpcy5pbml0KCk7CiAgfTsKCiAgSW5wdXQucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmluaXRBY3Rpb24oKTsKICAgIHRoaXMuaW5pdEVsZW1lbnRFdmVudCgpOwogIH07CgogIElucHV0LnByb3RvdHlwZS5pbml0QWN0aW9uID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIHJvdyA9IHNlbGYuZWxlbWVudC5wYXJlbnROb2RlOwoKICAgIGlmIChyb3cpIHsKICAgICAgaWYgKHNlbGYuc2xpZGVyQWN0aW9uQ2xhc3MpIHsKICAgICAgICBzZWxmLnNsaWRlckFjdGlvbiA9IHNlbGYuY3JlYXRlQWN0aW9uKHJvdywgc2VsZi5zbGlkZXJBY3Rpb25DbGFzcywgc2VsZi5zbGlkZXJBY3Rpb25TZWxlY3Rvcik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHNlbGYuc2VhcmNoQWN0aW9uQ2xhc3MpIHsKICAgICAgICAgIHNlbGYuc2VhcmNoQWN0aW9uID0gc2VsZi5jcmVhdGVBY3Rpb24ocm93LCBzZWxmLnNlYXJjaEFjdGlvbkNsYXNzLCBzZWxmLnNlYXJjaEFjdGlvblNlbGVjdG9yKTsKICAgICAgICAgIHNlbGYuc2VhcmNoQWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoJ3RhcCcsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICQuZm9jdXMoc2VsZi5lbGVtZW50KTsKICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNlbGYuc3BlZWNoQWN0aW9uQ2xhc3MpIHsKICAgICAgICAgIHNlbGYuc3BlZWNoQWN0aW9uID0gc2VsZi5jcmVhdGVBY3Rpb24ocm93LCBzZWxmLnNwZWVjaEFjdGlvbkNsYXNzLCBzZWxmLnNwZWVjaEFjdGlvblNlbGVjdG9yKTsKICAgICAgICAgIHNlbGYuc3BlZWNoQWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgJC5zdG9wUHJvcGFnYXRpb24pOwogICAgICAgICAgc2VsZi5zcGVlY2hBY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcigndGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgIHNlbGYuc3BlZWNoQWN0aW9uQ2xpY2soZXZlbnQpOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VsZi5jbGVhckFjdGlvbkNsYXNzKSB7CiAgICAgICAgICBzZWxmLmNsZWFyQWN0aW9uID0gc2VsZi5jcmVhdGVBY3Rpb24ocm93LCBzZWxmLmNsZWFyQWN0aW9uQ2xhc3MsIHNlbGYuY2xlYXJBY3Rpb25TZWxlY3Rvcik7CiAgICAgICAgICBzZWxmLmNsZWFyQWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoJ3RhcCcsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICBzZWxmLmNsZWFyQWN0aW9uQ2xpY2soZXZlbnQpOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VsZi5wYXNzd29yZEFjdGlvbkNsYXNzKSB7CiAgICAgICAgICBzZWxmLnBhc3N3b3JkQWN0aW9uID0gc2VsZi5jcmVhdGVBY3Rpb24ocm93LCBzZWxmLnBhc3N3b3JkQWN0aW9uQ2xhc3MsIHNlbGYucGFzc3dvcmRBY3Rpb25TZWxlY3Rvcik7CiAgICAgICAgICBzZWxmLnBhc3N3b3JkQWN0aW9uLmFkZEV2ZW50TGlzdGVuZXIoJ3RhcCcsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICBzZWxmLnBhc3N3b3JkQWN0aW9uQ2xpY2soZXZlbnQpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgSW5wdXQucHJvdG90eXBlLmNyZWF0ZUFjdGlvbiA9IGZ1bmN0aW9uIChyb3csIGFjdGlvbkNsYXNzLCBhY3Rpb25TZWxlY3RvcikgewogICAgdmFyIGFjdGlvbiA9IHJvdy5xdWVyeVNlbGVjdG9yKGFjdGlvblNlbGVjdG9yKTsKCiAgICBpZiAoIWFjdGlvbikgewogICAgICB2YXIgYWN0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICBhY3Rpb24uY2xhc3NOYW1lID0gYWN0aW9uQ2xhc3M7CgogICAgICBpZiAoYWN0aW9uQ2xhc3MgPT09IHRoaXMuc2VhcmNoQWN0aW9uQ2xhc3MpIHsKICAgICAgICBhY3Rpb24uaW5uZXJIVE1MID0gJzxzcGFuIGNsYXNzPSInICsgQ0xBU1NfSUNPTiArICcgJyArIENMQVNTX0lDT05fU0VBUkNIICsgJyI+PC9zcGFuPjxzcGFuPicgKyB0aGlzLmVsZW1lbnQuZ2V0QXR0cmlidXRlKCdwbGFjZWhvbGRlcicpICsgJzwvc3Bhbj4nOwogICAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3BsYWNlaG9sZGVyJywgJycpOwoKICAgICAgICBpZiAodGhpcy5lbGVtZW50LnZhbHVlLnRyaW0oKSkgewogICAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoJ211aS1hY3RpdmUnKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJvdy5pbnNlcnRCZWZvcmUoYWN0aW9uLCB0aGlzLmVsZW1lbnQubmV4dFNpYmxpbmcpOwogICAgfQoKICAgIHJldHVybiBhY3Rpb247CiAgfTsKCiAgSW5wdXQucHJvdG90eXBlLmluaXRFbGVtZW50RXZlbnQgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDsKCiAgICBpZiAodGhpcy5zbGlkZXJBY3Rpb25DbGFzcykgewogICAgICB2YXIgdG9vbHRpcCA9IHRoaXMuc2xpZGVyQWN0aW9uOwogICAgICB2YXIgdGltZXIgPSBudWxsOwoKICAgICAgdmFyIHNob3dUaXAgPSBmdW5jdGlvbiBzaG93VGlwKCkgewogICAgICAgIC8v5q+P5qyh6YeN5paw6K6h566X5piv5Zug5Li65o6n5Lu25Y+v6IO96KKr6ZqQ6JeP77yM5Yid5aeL5YyW5pe26K6h566X5piv5LiN5q2j56Gu55qECiAgICAgICAgdG9vbHRpcC5jbGFzc0xpc3QucmVtb3ZlKENMQVNTX0hJRERFTik7CiAgICAgICAgdmFyIG9mZnNldExlZnQgPSBlbGVtZW50Lm9mZnNldExlZnQ7CiAgICAgICAgdmFyIHdpZHRoID0gZWxlbWVudC5vZmZzZXRXaWR0aCAtIDI4OwogICAgICAgIHZhciB0b29sdGlwV2lkdGggPSB0b29sdGlwLm9mZnNldFdpZHRoOwogICAgICAgIHZhciBkaXN0aW5jZSA9IE1hdGguYWJzKGVsZW1lbnQubWF4IC0gZWxlbWVudC5taW4pOwogICAgICAgIHZhciBzY2FsZVdpZHRoID0gd2lkdGggLyBkaXN0aW5jZSAqIE1hdGguYWJzKGVsZW1lbnQudmFsdWUgLSBlbGVtZW50Lm1pbik7CiAgICAgICAgdG9vbHRpcC5zdHlsZS5sZWZ0ID0gMTQgKyBvZmZzZXRMZWZ0ICsgc2NhbGVXaWR0aCAtIHRvb2x0aXBXaWR0aCAvIDIgKyAncHgnOwogICAgICAgIHRvb2x0aXAuaW5uZXJUZXh0ID0gZWxlbWVudC52YWx1ZTsKCiAgICAgICAgaWYgKHRpbWVyKSB7CiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpOwogICAgICAgIH0KCiAgICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRvb2x0aXAuY2xhc3NMaXN0LmFkZChDTEFTU19ISURERU4pOwogICAgICAgIH0sIDEwMDApOwogICAgICB9OwoKICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHNob3dUaXApOwogICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RhcCcsIHNob3dUaXApOwogICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJC5FVkVOVF9NT1ZFLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgaWYgKHRoaXMuY2xlYXJBY3Rpb25DbGFzcykgewogICAgICAgIHZhciBhY3Rpb24gPSB0aGlzLmNsZWFyQWN0aW9uOwoKICAgICAgICBpZiAoIWFjdGlvbikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgJC5lYWNoKFsna2V5dXAnLCAnY2hhbmdlJywgJ2lucHV0JywgJ2ZvY3VzJywgJ2N1dCcsICdwYXN0ZSddLCBmdW5jdGlvbiAoaW5kZXgsIHR5cGUpIHsKICAgICAgICAgIChmdW5jdGlvbiAodHlwZSkgewogICAgICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGFjdGlvbi5jbGFzc0xpc3RbZWxlbWVudC52YWx1ZS50cmltKCkgPyAncmVtb3ZlJyA6ICdhZGQnXShDTEFTU19ISURERU4pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKHR5cGUpOwogICAgICAgIH0pOwogICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGFjdGlvbi5jbGFzc0xpc3QuYWRkKENMQVNTX0hJRERFTik7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNlYXJjaEFjdGlvbkNsYXNzKSB7CiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGVsZW1lbnQucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdtdWktYWN0aXZlJyk7CiAgICAgICAgfSk7CiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKCFlbGVtZW50LnZhbHVlLnRyaW0oKSkgewogICAgICAgICAgICBlbGVtZW50LnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnbXVpLWFjdGl2ZScpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfTsKCiAgSW5wdXQucHJvdG90eXBlLnNldFBsYWNlaG9sZGVyID0gZnVuY3Rpb24gKHRleHQpIHsKICAgIGlmICh0aGlzLnNlYXJjaEFjdGlvbkNsYXNzKSB7CiAgICAgIHZhciBwbGFjZWhvbGRlciA9IHRoaXMuZWxlbWVudC5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoU0VMRUNUT1JfUExBQ0VIT0xERVIpOwogICAgICBwbGFjZWhvbGRlciAmJiAocGxhY2Vob2xkZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NwYW4nKVsxXS5pbm5lclRleHQgPSB0ZXh0KTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3BsYWNlaG9sZGVyJywgdGV4dCk7CiAgICB9CiAgfTsKCiAgSW5wdXQucHJvdG90eXBlLnBhc3N3b3JkQWN0aW9uQ2xpY2sgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIGlmICh0aGlzLmVsZW1lbnQudHlwZSA9PT0gJ3RleHQnKSB7CiAgICAgIHRoaXMuZWxlbWVudC50eXBlID0gJ3Bhc3N3b3JkJzsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZWxlbWVudC50eXBlID0gJ3RleHQnOwogICAgfQoKICAgIHRoaXMucGFzc3dvcmRBY3Rpb24uY2xhc3NMaXN0LnRvZ2dsZSgnbXVpLWFjdGl2ZScpOwogICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICB9OwoKICBJbnB1dC5wcm90b3R5cGUuY2xlYXJBY3Rpb25DbGljayA9IGZ1bmN0aW9uIChldmVudCkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgc2VsZi5lbGVtZW50LnZhbHVlID0gJyc7CiAgICAkLmZvY3VzKHNlbGYuZWxlbWVudCk7CiAgICBzZWxmLmNsZWFyQWN0aW9uLmNsYXNzTGlzdC5hZGQoQ0xBU1NfSElEREVOKTsKICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgfTsKCiAgSW5wdXQucHJvdG90eXBlLnNwZWVjaEFjdGlvbkNsaWNrID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBpZiAod2luZG93LnBsdXMpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgb2xkVmFsdWUgPSBzZWxmLmVsZW1lbnQudmFsdWU7CiAgICAgIHNlbGYuZWxlbWVudC52YWx1ZSA9ICcnOwogICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoQ0xBU1NfRk9DVVNJTik7CiAgICAgIHBsdXMuc3BlZWNoLnN0YXJ0UmVjb2duaXplKHsKICAgICAgICBlbmdpbmU6ICdpRmx5JwogICAgICB9LCBmdW5jdGlvbiAocykgewogICAgICAgIHNlbGYuZWxlbWVudC52YWx1ZSArPSBzOwogICAgICAgICQuZm9jdXMoc2VsZi5lbGVtZW50KTsKICAgICAgICBwbHVzLnNwZWVjaC5zdG9wUmVjb2duaXplKCk7CiAgICAgICAgJC50cmlnZ2VyKHNlbGYuZWxlbWVudCwgJ3JlY29nbml6ZWQnLCB7CiAgICAgICAgICB2YWx1ZTogc2VsZi5lbGVtZW50LnZhbHVlCiAgICAgICAgfSk7CgogICAgICAgIGlmIChvbGRWYWx1ZSAhPT0gc2VsZi5lbGVtZW50LnZhbHVlKSB7CiAgICAgICAgICAkLnRyaWdnZXIoc2VsZi5lbGVtZW50LCAnY2hhbmdlJyk7CiAgICAgICAgICAkLnRyaWdnZXIoc2VsZi5lbGVtZW50LCAnaW5wdXQnKTsKICAgICAgICB9IC8vIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZShDTEFTU19GT0NVU0lOKTsKCiAgICAgIH0sIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKENMQVNTX0ZPQ1VTSU4pOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGFsZXJ0KCdvbmx5IGZvciA1KycpOwogICAgfQoKICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgfTsKCiAgJC5mbi5pbnB1dCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICB2YXIgaW5wdXRBcGlzID0gW107CiAgICB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICB2YXIgaW5wdXRBcGkgPSBudWxsOwogICAgICB2YXIgYWN0aW9ucyA9IFtdOwogICAgICB2YXIgcm93ID0gZmluZFJvdyh0aGlzLnBhcmVudE5vZGUpOwoKICAgICAgaWYgKHRoaXMudHlwZSA9PT0gJ3JhbmdlJyAmJiByb3cuY2xhc3NMaXN0LmNvbnRhaW5zKCdtdWktaW5wdXQtcmFuZ2UnKSkgewogICAgICAgIGFjdGlvbnMucHVzaCgnc2xpZGVyJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGNsYXNzTGlzdCA9IHRoaXMuY2xhc3NMaXN0OwoKICAgICAgICBpZiAoY2xhc3NMaXN0LmNvbnRhaW5zKCdtdWktaW5wdXQtY2xlYXInKSkgewogICAgICAgICAgYWN0aW9ucy5wdXNoKCdjbGVhcicpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCEoJC5vcy5hbmRyb2lkICYmICQub3Muc3RyZWFtKSAmJiBjbGFzc0xpc3QuY29udGFpbnMoJ211aS1pbnB1dC1zcGVlY2gnKSkgewogICAgICAgICAgYWN0aW9ucy5wdXNoKCdzcGVlY2gnKTsKICAgICAgICB9CgogICAgICAgIGlmIChjbGFzc0xpc3QuY29udGFpbnMoJ211aS1pbnB1dC1wYXNzd29yZCcpKSB7CiAgICAgICAgICBhY3Rpb25zLnB1c2goJ3Bhc3N3b3JkJyk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy50eXBlID09PSAnc2VhcmNoJyAmJiByb3cuY2xhc3NMaXN0LmNvbnRhaW5zKCdtdWktc2VhcmNoJykpIHsKICAgICAgICAgIGFjdGlvbnMucHVzaCgnc2VhcmNoJyk7CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgaWQgPSB0aGlzLmdldEF0dHJpYnV0ZSgnZGF0YS1pbnB1dC0nICsgYWN0aW9uc1swXSk7CgogICAgICBpZiAoIWlkKSB7CiAgICAgICAgaWQgPSArKyQudXVpZDsKICAgICAgICBpbnB1dEFwaSA9ICQuZGF0YVtpZF0gPSBuZXcgSW5wdXQodGhpcywgewogICAgICAgICAgYWN0aW9uczogYWN0aW9ucy5qb2luKCcsJykKICAgICAgICB9KTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGFjdGlvbnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKCdkYXRhLWlucHV0LScgKyBhY3Rpb25zW2ldLCBpZCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlucHV0QXBpID0gJC5kYXRhW2lkXTsKICAgICAgfQoKICAgICAgaW5wdXRBcGlzLnB1c2goaW5wdXRBcGkpOwogICAgfSk7CiAgICByZXR1cm4gaW5wdXRBcGlzLmxlbmd0aCA9PT0gMSA/IGlucHV0QXBpc1swXSA6IGlucHV0QXBpczsKICB9OwoKICAkLnJlYWR5KGZ1bmN0aW9uICgpIHsKICAgICQoJy5tdWktaW5wdXQtcm93IGlucHV0JykuaW5wdXQoKTsKICB9KTsKfSkobXVpLCB3aW5kb3csIGRvY3VtZW50KTsKCihmdW5jdGlvbiAoJCwgd2luZG93KSB7CiAgdmFyIENMQVNTX0FDVElWRSA9ICdtdWktYWN0aXZlJzsKICB2YXIgcmdiYVJlZ2V4ID0gL15yZ2JhXCgoXGR7MSwzfSksXHMqKFxkezEsM30pLFxzKihcZHsxLDN9KSxccyooXGQqKD86XC5cZCspPylcKSQvOwoKICB2YXIgZ2V0Q29sb3IgPSBmdW5jdGlvbiBnZXRDb2xvcihjb2xvclN0cikgewogICAgdmFyIG1hdGNoZXMgPSBjb2xvclN0ci5tYXRjaChyZ2JhUmVnZXgpOwoKICAgIGlmIChtYXRjaGVzICYmIG1hdGNoZXMubGVuZ3RoID09PSA1KSB7CiAgICAgIHJldHVybiBbbWF0Y2hlc1sxXSwgbWF0Y2hlc1syXSwgbWF0Y2hlc1szXSwgbWF0Y2hlc1s0XV07CiAgICB9CgogICAgcmV0dXJuIFtdOwogIH07CgogIHZhciBUcmFuc3BhcmVudCA9IGZ1bmN0aW9uIFRyYW5zcGFyZW50KGVsZW1lbnQsIG9wdGlvbnMpIHsKICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7CiAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7CiAgICAgIHRvcDogMCwKICAgICAgLy/ot53nprvpobbpg6jpq5jluqYo5Yiw6L6+6K+l6auY5bqm5Y2z6Kem5Y+RKQogICAgICBvZmZzZXQ6IDE1MCwKICAgICAgLy/mu5rliqjpgI/mmI7ot53nprsKICAgICAgZHVyYXRpb246IDE2LAogICAgICAvL+i/h+a4oeaXtumXtAogICAgICBzY3JvbGxieTogd2luZG93IC8v55uR5ZCs5rua5Yqo6Led56a75a655ZmoCgogICAgfSwgb3B0aW9ucyB8fCB7fSk7CiAgICB0aGlzLnNjcm9sbEJ5RWxlbSA9IHRoaXMub3B0aW9ucy5zY3JvbGxieSB8fCB3aW5kb3c7CgogICAgaWYgKCF0aGlzLnNjcm9sbEJ5RWxlbSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIuebkeWQrOa7muWKqOeahOWFg+e0oOS4jeWtmOWcqCIpOwogICAgfQoKICAgIHRoaXMuaXNOYXRpdmVTY3JvbGwgPSBmYWxzZTsKCiAgICBpZiAodGhpcy5zY3JvbGxCeUVsZW0gPT09IHdpbmRvdykgewogICAgICB0aGlzLmlzTmF0aXZlU2Nyb2xsID0gdHJ1ZTsKICAgIH0gZWxzZSBpZiAoIX50aGlzLnNjcm9sbEJ5RWxlbS5jbGFzc05hbWUuaW5kZXhPZignbXVpLXNjcm9sbC13cmFwcGVyJykpIHsKICAgICAgdGhpcy5pc05hdGl2ZVNjcm9sbCA9IHRydWU7CiAgICB9CgogICAgdGhpcy5fc3R5bGUgPSB0aGlzLmVsZW1lbnQuc3R5bGU7CiAgICB0aGlzLl9iZ0NvbG9yID0gdGhpcy5fc3R5bGUuYmFja2dyb3VuZENvbG9yOwogICAgdmFyIGNvbG9yID0gZ2V0Q29sb3IobXVpLmdldFN0eWxlcyh0aGlzLmVsZW1lbnQsICdiYWNrZ3JvdW5kQ29sb3InKSk7CgogICAgaWYgKGNvbG9yLmxlbmd0aCkgewogICAgICB0aGlzLl9SID0gY29sb3JbMF07CiAgICAgIHRoaXMuX0cgPSBjb2xvclsxXTsKICAgICAgdGhpcy5fQiA9IGNvbG9yWzJdOwogICAgICB0aGlzLl9BID0gcGFyc2VGbG9hdChjb2xvclszXSk7CiAgICAgIHRoaXMubGFzdE9wYWNpdHkgPSB0aGlzLl9BOwogICAgICB0aGlzLl9idWZmZXJGbiA9ICQuYnVmZmVyKHRoaXMuaGFuZGxlU2Nyb2xsLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24sIHRoaXMpOwogICAgICB0aGlzLmluaXRFdmVudCgpOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCLlhYPntKDog4zmma/popzoibLlv4XpobvkuLpSR0JBIik7CiAgICB9CiAgfTsKCiAgVHJhbnNwYXJlbnQucHJvdG90eXBlLmluaXRFdmVudCA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuc2Nyb2xsQnlFbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMuX2J1ZmZlckZuKTsKCiAgICBpZiAodGhpcy5pc05hdGl2ZVNjcm9sbCkgewogICAgICAvL+WOn+eUn3Njcm9sbAogICAgICB0aGlzLnNjcm9sbEJ5RWxlbS5hZGRFdmVudExpc3RlbmVyKCQuRVZFTlRfTU9WRSwgdGhpcy5fYnVmZmVyRm4pOwogICAgfQogIH07CgogIFRyYW5zcGFyZW50LnByb3RvdHlwZS5oYW5kbGVTY3JvbGwgPSBmdW5jdGlvbiAoZSkgewogICAgdmFyIHkgPSB3aW5kb3cuc2Nyb2xsWTsKCiAgICBpZiAoIXRoaXMuaXNOYXRpdmVTY3JvbGwgJiYgZSAmJiBlLmRldGFpbCkgewogICAgICB5ID0gLWUuZGV0YWlsLnk7CiAgICB9CgogICAgdmFyIG9wYWNpdHkgPSAoeSAtIHRoaXMub3B0aW9ucy50b3ApIC8gdGhpcy5vcHRpb25zLm9mZnNldCArIHRoaXMuX0E7CiAgICBvcGFjaXR5ID0gTWF0aC5taW4oTWF0aC5tYXgodGhpcy5fQSwgb3BhY2l0eSksIDEpOwogICAgdGhpcy5fc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ3JnYmEoJyArIHRoaXMuX1IgKyAnLCcgKyB0aGlzLl9HICsgJywnICsgdGhpcy5fQiArICcsJyArIG9wYWNpdHkgKyAnKSc7CgogICAgaWYgKG9wYWNpdHkgPiB0aGlzLl9BKSB7CiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKENMQVNTX0FDVElWRSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShDTEFTU19BQ1RJVkUpOwogICAgfQoKICAgIGlmICh0aGlzLmxhc3RPcGFjaXR5ICE9PSBvcGFjaXR5KSB7CiAgICAgICQudHJpZ2dlcih0aGlzLmVsZW1lbnQsICdhbHBoYScsIHsKICAgICAgICBhbHBoYTogb3BhY2l0eQogICAgICB9KTsKICAgICAgdGhpcy5sYXN0T3BhY2l0eSA9IG9wYWNpdHk7CiAgICB9CiAgfTsKCiAgVHJhbnNwYXJlbnQucHJvdG90eXBlLmRlc3RvcnkgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnNjcm9sbEJ5RWxlbS5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLl9idWZmZXJGbik7CiAgICB0aGlzLnNjcm9sbEJ5RWxlbS5yZW1vdmVFdmVudExpc3RlbmVyKCQuRVZFTlRfTU9WRSwgdGhpcy5fYnVmZmVyRm4pOwogICAgdGhpcy5lbGVtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IHRoaXMuX2JnQ29sb3I7CiAgICB0aGlzLmVsZW1lbnQubXVpX3BsdWdpbl90cmFuc3BhcmVudCA9IG51bGw7CiAgfTsKCiAgJC5mbi50cmFuc3BhcmVudCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgIHZhciB0cmFuc3BhcmVudEFwaXMgPSBbXTsKICAgIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB0cmFuc3BhcmVudEFwaSA9IHRoaXMubXVpX3BsdWdpbl90cmFuc3BhcmVudDsKCiAgICAgIGlmICghdHJhbnNwYXJlbnRBcGkpIHsKICAgICAgICB2YXIgdG9wID0gdGhpcy5nZXRBdHRyaWJ1dGUoJ2RhdGEtdG9wJyk7CiAgICAgICAgdmFyIG9mZnNldCA9IHRoaXMuZ2V0QXR0cmlidXRlKCdkYXRhLW9mZnNldCcpOwogICAgICAgIHZhciBkdXJhdGlvbiA9IHRoaXMuZ2V0QXR0cmlidXRlKCdkYXRhLWR1cmF0aW9uJyk7CiAgICAgICAgdmFyIHNjcm9sbGJ5ID0gdGhpcy5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2Nyb2xsYnknKTsKCiAgICAgICAgaWYgKHRvcCAhPT0gbnVsbCAmJiB0eXBlb2Ygb3B0aW9ucy50b3AgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICBvcHRpb25zLnRvcCA9IHRvcDsKICAgICAgICB9CgogICAgICAgIGlmIChvZmZzZXQgIT09IG51bGwgJiYgdHlwZW9mIG9wdGlvbnMub2Zmc2V0ID09PSAndW5kZWZpbmVkJykgewogICAgICAgICAgb3B0aW9ucy5vZmZzZXQgPSBvZmZzZXQ7CiAgICAgICAgfQoKICAgICAgICBpZiAoZHVyYXRpb24gIT09IG51bGwgJiYgdHlwZW9mIG9wdGlvbnMuZHVyYXRpb24gPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICBvcHRpb25zLmR1cmF0aW9uID0gZHVyYXRpb247CiAgICAgICAgfQoKICAgICAgICBpZiAoc2Nyb2xsYnkgIT09IG51bGwgJiYgdHlwZW9mIG9wdGlvbnMuc2Nyb2xsYnkgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICBvcHRpb25zLnNjcm9sbGJ5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzY3JvbGxieSkgfHwgd2luZG93OwogICAgICAgIH0KCiAgICAgICAgdHJhbnNwYXJlbnRBcGkgPSB0aGlzLm11aV9wbHVnaW5fdHJhbnNwYXJlbnQgPSBuZXcgVHJhbnNwYXJlbnQodGhpcywgb3B0aW9ucyk7CiAgICAgIH0KCiAgICAgIHRyYW5zcGFyZW50QXBpcy5wdXNoKHRyYW5zcGFyZW50QXBpKTsKICAgIH0pOwogICAgcmV0dXJuIHRyYW5zcGFyZW50QXBpcy5sZW5ndGggPT09IDEgPyB0cmFuc3BhcmVudEFwaXNbMF0gOiB0cmFuc3BhcmVudEFwaXM7CiAgfTsKCiAgJC5yZWFkeShmdW5jdGlvbiAoKSB7CiAgICAkKCcubXVpLWJhci10cmFuc3BhcmVudCcpLnRyYW5zcGFyZW50KCk7CiAgfSk7Cn0pKG11aSwgd2luZG93KTsKLyoqCiAqIOaVsOWtl+i+k+WFpeahhgogKiB2YXJzdGlvbiAxLjAuMQogKiBieSBIb3VmZW5nCiAqIEhvdWZlbmdARENsb3VkLmlvCiAqLwoKCihmdW5jdGlvbiAoJCkgewogIHZhciB0b3VjaFN1cHBvcnQgPSAoJ29udG91Y2hzdGFydCcgaW4gZG9jdW1lbnQpOwogIHZhciB0YXBFdmVudE5hbWUgPSB0b3VjaFN1cHBvcnQgPyAndGFwJyA6ICdjbGljayc7CiAgdmFyIGNoYW5nZUV2ZW50TmFtZSA9ICdjaGFuZ2UnOwogIHZhciBob2xkZXJDbGFzc05hbWUgPSAnbXVpLW51bWJveCc7CiAgdmFyIHBsdXNDbGFzc1NlbGVjdG9yID0gJy5tdWktYnRuLW51bWJveC1wbHVzLC5tdWktbnVtYm94LWJ0bi1wbHVzJzsKICB2YXIgbWludXNDbGFzc1NlbGVjdG9yID0gJy5tdWktYnRuLW51bWJveC1taW51cywubXVpLW51bWJveC1idG4tbWludXMnOwogIHZhciBpbnB1dENsYXNzU2VsZWN0b3IgPSAnLm11aS1pbnB1dC1udW1ib3gsLm11aS1udW1ib3gtaW5wdXQnOwogIHZhciBOdW1ib3ggPSAkLk51bWJveCA9ICQuQ2xhc3MuZXh0ZW5kKHsKICAgIC8qKgogICAgICog5p6E6YCg5Ye95pWwCiAgICAgKiovCiAgICBpbml0OiBmdW5jdGlvbiBpbml0KGhvbGRlciwgb3B0aW9ucykgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICBpZiAoIWhvbGRlcikgewogICAgICAgIHRocm93ICLmnoTpgKAgbnVtYm94IOaXtue8uuWwkeWuueWZqOWFg+e0oCI7CiAgICAgIH0KCiAgICAgIHNlbGYuaG9sZGVyID0gaG9sZGVyOwogICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgb3B0aW9ucy5zdGVwID0gcGFyc2VJbnQob3B0aW9ucy5zdGVwIHx8IDEpOwogICAgICBzZWxmLm9wdGlvbnMgPSBvcHRpb25zOwogICAgICBzZWxmLmlucHV0ID0gJC5xc2EoaW5wdXRDbGFzc1NlbGVjdG9yLCBzZWxmLmhvbGRlcilbMF07CiAgICAgIHNlbGYucGx1cyA9ICQucXNhKHBsdXNDbGFzc1NlbGVjdG9yLCBzZWxmLmhvbGRlcilbMF07CiAgICAgIHNlbGYubWludXMgPSAkLnFzYShtaW51c0NsYXNzU2VsZWN0b3IsIHNlbGYuaG9sZGVyKVswXTsKICAgICAgc2VsZi5jaGVja1ZhbHVlKCk7CiAgICAgIHNlbGYuaW5pdEV2ZW50KCk7CiAgICB9LAoKICAgIC8qKgogICAgICog5Yid5aeL5YyW5LqL5Lu257uR5a6aCiAgICAgKiovCiAgICBpbml0RXZlbnQ6IGZ1bmN0aW9uIGluaXRFdmVudCgpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBzZWxmLnBsdXMuYWRkRXZlbnRMaXN0ZW5lcih0YXBFdmVudE5hbWUsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIHZhciB2YWwgPSBwYXJzZUludChzZWxmLmlucHV0LnZhbHVlKSArIHNlbGYub3B0aW9ucy5zdGVwOwogICAgICAgIHNlbGYuaW5wdXQudmFsdWUgPSB2YWwudG9TdHJpbmcoKTsKICAgICAgICAkLnRyaWdnZXIoc2VsZi5pbnB1dCwgY2hhbmdlRXZlbnROYW1lLCBudWxsKTsKICAgICAgfSk7CiAgICAgIHNlbGYubWludXMuYWRkRXZlbnRMaXN0ZW5lcih0YXBFdmVudE5hbWUsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIHZhciB2YWwgPSBwYXJzZUludChzZWxmLmlucHV0LnZhbHVlKSAtIHNlbGYub3B0aW9ucy5zdGVwOwogICAgICAgIHNlbGYuaW5wdXQudmFsdWUgPSB2YWwudG9TdHJpbmcoKTsKICAgICAgICAkLnRyaWdnZXIoc2VsZi5pbnB1dCwgY2hhbmdlRXZlbnROYW1lLCBudWxsKTsKICAgICAgfSk7CiAgICAgIHNlbGYuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihjaGFuZ2VFdmVudE5hbWUsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIHNlbGYuY2hlY2tWYWx1ZSgpOwogICAgICAgIHZhciB2YWwgPSBwYXJzZUludChzZWxmLmlucHV0LnZhbHVlKTsgLy/op6blj5HpobblsYLlrrnlmagKCiAgICAgICAgJC50cmlnZ2VyKHNlbGYuaG9sZGVyLCBjaGFuZ2VFdmVudE5hbWUsIHsKICAgICAgICAgIHZhbHVlOiB2YWwKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKgogICAgICog6I635Y+W5b2T5YmN5YC8CiAgICAgKiovCiAgICBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUoKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgcmV0dXJuIHBhcnNlSW50KHNlbGYuaW5wdXQudmFsdWUpOwogICAgfSwKCiAgICAvKioKICAgICAqIOmqjOivgeW9k+WJjeWAvOaYr+azleWQiOazlQogICAgICoqLwogICAgY2hlY2tWYWx1ZTogZnVuY3Rpb24gY2hlY2tWYWx1ZSgpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgdmFsID0gc2VsZi5pbnB1dC52YWx1ZTsKCiAgICAgIGlmICh2YWwgPT0gbnVsbCB8fCB2YWwgPT0gJycgfHwgaXNOYU4odmFsKSkgewogICAgICAgIHNlbGYuaW5wdXQudmFsdWUgPSBzZWxmLm9wdGlvbnMubWluIHx8IDA7CiAgICAgICAgc2VsZi5taW51cy5kaXNhYmxlZCA9IHNlbGYub3B0aW9ucy5taW4gIT0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgdmFsID0gcGFyc2VJbnQodmFsKTsKCiAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5tYXggIT0gbnVsbCAmJiAhaXNOYU4oc2VsZi5vcHRpb25zLm1heCkgJiYgdmFsID49IHBhcnNlSW50KHNlbGYub3B0aW9ucy5tYXgpKSB7CiAgICAgICAgICB2YWwgPSBzZWxmLm9wdGlvbnMubWF4OwogICAgICAgICAgc2VsZi5wbHVzLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2VsZi5wbHVzLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VsZi5vcHRpb25zLm1pbiAhPSBudWxsICYmICFpc05hTihzZWxmLm9wdGlvbnMubWluKSAmJiB2YWwgPD0gcGFyc2VJbnQoc2VsZi5vcHRpb25zLm1pbikpIHsKICAgICAgICAgIHZhbCA9IHNlbGYub3B0aW9ucy5taW47CiAgICAgICAgICBzZWxmLm1pbnVzLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2VsZi5taW51cy5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgc2VsZi5pbnB1dC52YWx1ZSA9IHZhbDsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIOabtOaWsOmAiemhuQogICAgICoqLwogICAgc2V0T3B0aW9uOiBmdW5jdGlvbiBzZXRPcHRpb24obmFtZSwgdmFsdWUpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBzZWxmLm9wdGlvbnNbbmFtZV0gPSB2YWx1ZTsKICAgIH0sCgogICAgLyoqCiAgICAgKiDliqjmgIHorr7nva7mlrDlgLwKICAgICAqKi8KICAgIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZSh2YWx1ZSkgewogICAgICB0aGlzLmlucHV0LnZhbHVlID0gdmFsdWU7CiAgICAgIHRoaXMuY2hlY2tWYWx1ZSgpOwogICAgfQogIH0pOwoKICAkLmZuLm51bWJveCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICB2YXIgaW5zdGFuY2VBcnJheSA9IFtdOyAvL+mBjeWOhumAieaLqeeahOWFg+e0oAoKICAgIHRoaXMuZWFjaChmdW5jdGlvbiAoaSwgZWxlbWVudCkgewogICAgICBpZiAoZWxlbWVudC5udW1ib3gpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgZWxlbWVudC5udW1ib3ggPSBuZXcgTnVtYm94KGVsZW1lbnQsIG9wdGlvbnMpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBvcHRpb25zVGV4dCA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLW51bWJveC1vcHRpb25zJyk7CiAgICAgICAgdmFyIG9wdGlvbnMgPSBvcHRpb25zVGV4dCA/IEpTT04ucGFyc2Uob3B0aW9uc1RleHQpIDoge307CiAgICAgICAgb3B0aW9ucy5zdGVwID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtbnVtYm94LXN0ZXAnKSB8fCBvcHRpb25zLnN0ZXA7CiAgICAgICAgb3B0aW9ucy5taW4gPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1udW1ib3gtbWluJykgfHwgb3B0aW9ucy5taW47CiAgICAgICAgb3B0aW9ucy5tYXggPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1udW1ib3gtbWF4JykgfHwgb3B0aW9ucy5tYXg7CiAgICAgICAgZWxlbWVudC5udW1ib3ggPSBuZXcgTnVtYm94KGVsZW1lbnQsIG9wdGlvbnMpOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiB0aGlzWzBdID8gdGhpc1swXS5udW1ib3ggOiBudWxsOwogIH07IC8v6Ieq5Yqo5aSE55CGIGNsYXNzPSdtdWktbG9ja2VyJyDnmoQgZG9tCgoKICAkLnJlYWR5KGZ1bmN0aW9uICgpIHsKICAgICQoJy4nICsgaG9sZGVyQ2xhc3NOYW1lKS5udW1ib3goKTsKICB9KTsKfSkobXVpKTsKLyoqCiAqIEJ1dHRvbgogKiBAcGFyYW0ge3R5cGV9ICQKICogQHBhcmFtIHt0eXBlfSB3aW5kb3cKICogQHBhcmFtIHt0eXBlfSBkb2N1bWVudAogKiBAcmV0dXJucyB7dW5kZWZpbmVkfQogKi8KCgooZnVuY3Rpb24gKCQsIHdpbmRvdywgZG9jdW1lbnQpIHsKICB2YXIgQ0xBU1NfSUNPTiA9ICdtdWktaWNvbic7CiAgdmFyIENMQVNTX0RJU0FCTEVEID0gJ211aS1kaXNhYmxlZCc7CiAgdmFyIFNUQVRFX1JFU0VUID0gJ3Jlc2V0JzsKICB2YXIgU1RBVEVfTE9BRElORyA9ICdsb2FkaW5nJzsKICB2YXIgZGVmYXVsdE9wdGlvbnMgPSB7CiAgICBsb2FkaW5nVGV4dDogJ0xvYWRpbmcuLi4nLAogICAgLy/mlofmoYgKICAgIGxvYWRpbmdJY29uOiAnbXVpLXNwaW5uZXInICsgJyAnICsgJ211aS1zcGlubmVyLXdoaXRlJywKICAgIC8v5Zu+5qCH77yM5Y+v5Li656m6CiAgICBsb2FkaW5nSWNvblBvc2l0aW9uOiAnbGVmdCcgLy/lm77moIfmiYDlpITkvY3nva7vvIzku4XmlK/mjIFsZWZ0fHJpZ2h0CgogIH07CgogIHZhciBCdXR0b24gPSBmdW5jdGlvbiBCdXR0b24oZWxlbWVudCwgb3B0aW9ucykgewogICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDsKICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBkZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7CgogICAgaWYgKCF0aGlzLm9wdGlvbnMubG9hZGluZ1RleHQpIHsKICAgICAgdGhpcy5vcHRpb25zLmxvYWRpbmdUZXh0ID0gZGVmYXVsdE9wdGlvbnMubG9hZGluZ1RleHQ7CiAgICB9CgogICAgaWYgKHRoaXMub3B0aW9ucy5sb2FkaW5nSWNvbiA9PT0gbnVsbCkgewogICAgICB0aGlzLm9wdGlvbnMubG9hZGluZ0ljb24gPSAnbXVpLXNwaW5uZXInOwoKICAgICAgaWYgKCQuZ2V0U3R5bGVzKHRoaXMuZWxlbWVudCwgJ2NvbG9yJykgPT09ICdyZ2IoMjU1LCAyNTUsIDI1NSknKSB7CiAgICAgICAgdGhpcy5vcHRpb25zLmxvYWRpbmdJY29uICs9ICcgJyArICdtdWktc3Bpbm5lci13aGl0ZSc7CiAgICAgIH0KICAgIH0KCiAgICB0aGlzLmlzSW5wdXQgPSB0aGlzLmVsZW1lbnQudGFnTmFtZSA9PT0gJ0lOUFVUJzsKICAgIHRoaXMucmVzZXRIVE1MID0gdGhpcy5pc0lucHV0ID8gdGhpcy5lbGVtZW50LnZhbHVlIDogdGhpcy5lbGVtZW50LmlubmVySFRNTDsKICAgIHRoaXMuc3RhdGUgPSAnJzsKICB9OwoKICBCdXR0b24ucHJvdG90eXBlLmxvYWRpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnNldFN0YXRlKFNUQVRFX0xPQURJTkcpOwogIH07CgogIEJ1dHRvbi5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnNldFN0YXRlKFNUQVRFX1JFU0VUKTsKICB9OwoKICBCdXR0b24ucHJvdG90eXBlLnNldFN0YXRlID0gZnVuY3Rpb24gKHN0YXRlKSB7CiAgICBpZiAodGhpcy5zdGF0ZSA9PT0gc3RhdGUpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTsKCiAgICBpZiAoc3RhdGUgPT09IFNUQVRFX1JFU0VUKSB7CiAgICAgIHRoaXMuZWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlOwogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShDTEFTU19ESVNBQkxFRCk7CiAgICAgIHRoaXMuc2V0SHRtbCh0aGlzLnJlc2V0SFRNTCk7CiAgICB9IGVsc2UgaWYgKHN0YXRlID09PSBTVEFURV9MT0FESU5HKSB7CiAgICAgIHRoaXMuZWxlbWVudC5kaXNhYmxlZCA9IHRydWU7CiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKENMQVNTX0RJU0FCTEVEKTsKICAgICAgdmFyIGh0bWwgPSB0aGlzLmlzSW5wdXQgPyB0aGlzLm9wdGlvbnMubG9hZGluZ1RleHQgOiAnPHNwYW4+JyArIHRoaXMub3B0aW9ucy5sb2FkaW5nVGV4dCArICc8L3NwYW4+JzsKCiAgICAgIGlmICh0aGlzLm9wdGlvbnMubG9hZGluZ0ljb24gJiYgIXRoaXMuaXNJbnB1dCkgewogICAgICAgIGlmICh0aGlzLm9wdGlvbnMubG9hZGluZ0ljb25Qb3NpdGlvbiA9PT0gJ3JpZ2h0JykgewogICAgICAgICAgaHRtbCArPSAnJm5ic3A7PHNwYW4gY2xhc3M9IicgKyB0aGlzLm9wdGlvbnMubG9hZGluZ0ljb24gKyAnIj48L3NwYW4+JzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaHRtbCA9ICc8c3BhbiBjbGFzcz0iJyArIHRoaXMub3B0aW9ucy5sb2FkaW5nSWNvbiArICciPjwvc3Bhbj4mbmJzcDsnICsgaHRtbDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuc2V0SHRtbChodG1sKTsKICAgIH0KICB9OwoKICBCdXR0b24ucHJvdG90eXBlLnNldEh0bWwgPSBmdW5jdGlvbiAoaHRtbCkgewogICAgaWYgKHRoaXMuaXNJbnB1dCkgewogICAgICB0aGlzLmVsZW1lbnQudmFsdWUgPSBodG1sOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5lbGVtZW50LmlubmVySFRNTCA9IGh0bWw7CiAgICB9CiAgfTsKCiAgJC5mbi5idXR0b24gPSBmdW5jdGlvbiAoc3RhdGUpIHsKICAgIHZhciBidXR0b25BcGlzID0gW107CiAgICB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICB2YXIgYnV0dG9uQXBpID0gdGhpcy5tdWlfcGx1Z2luX2J1dHRvbjsKCiAgICAgIGlmICghYnV0dG9uQXBpKSB7CiAgICAgICAgdmFyIGxvYWRpbmdUZXh0ID0gdGhpcy5nZXRBdHRyaWJ1dGUoJ2RhdGEtbG9hZGluZy10ZXh0Jyk7CiAgICAgICAgdmFyIGxvYWRpbmdJY29uID0gdGhpcy5nZXRBdHRyaWJ1dGUoJ2RhdGEtbG9hZGluZy1pY29uJyk7CiAgICAgICAgdmFyIGxvYWRpbmdJY29uUG9zaXRpb24gPSB0aGlzLmdldEF0dHJpYnV0ZSgnZGF0YS1sb2FkaW5nLWljb24tcG9zaXRpb24nKTsKICAgICAgICB0aGlzLm11aV9wbHVnaW5fYnV0dG9uID0gYnV0dG9uQXBpID0gbmV3IEJ1dHRvbih0aGlzLCB7CiAgICAgICAgICBsb2FkaW5nVGV4dDogbG9hZGluZ1RleHQsCiAgICAgICAgICBsb2FkaW5nSWNvbjogbG9hZGluZ0ljb24sCiAgICAgICAgICBsb2FkaW5nSWNvblBvc2l0aW9uOiBsb2FkaW5nSWNvblBvc2l0aW9uCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGlmIChzdGF0ZSA9PT0gU1RBVEVfTE9BRElORyB8fCBzdGF0ZSA9PT0gU1RBVEVfUkVTRVQpIHsKICAgICAgICBidXR0b25BcGkuc2V0U3RhdGUoc3RhdGUpOwogICAgICB9CgogICAgICBidXR0b25BcGlzLnB1c2goYnV0dG9uQXBpKTsKICAgIH0pOwogICAgcmV0dXJuIGJ1dHRvbkFwaXMubGVuZ3RoID09PSAxID8gYnV0dG9uQXBpc1swXSA6IGJ1dHRvbkFwaXM7CiAgfTsKfSkobXVpLCB3aW5kb3csIGRvY3VtZW50KTs="},{"version":3,"sources":["F:/vscode/gocode/cloudMusic/src/assets/mui/js/mui.js"],"names":["mui","document","undefined","readyRE","idSelectorRE","classSelectorRE","tagSelectorRE","translateRE","translateMatrixRE","$","selector","context","wrap","isArrayLike","slice","call","ready","trim","test","found","getElementById","RegExp","$1","qsa","e","dom","Object","setPrototypeOf","fn","uuid","data","extend","options","name","src","copy","copyIsArray","clone","target","arguments","i","length","deep","isFunction","isPlainObject","isArray","noop","filter","type","obj","String","class2type","toString","Array","object","isWindow","window","isObject","getPrototypeOf","prototype","isEmptyObject","o","p","value","getElementsByClassName","getElementsByTagName","querySelectorAll","callback","readyState","addEventListener","buffer","ms","timer","lastStart","lastEnd","run","cancel","now","apply","later","stop","each","elements","hasOwnProperty","every","el","idx","key","focus","element","os","ios","setTimeout","trigger","eventType","eventData","dispatchEvent","CustomEvent","detail","bubbles","cancelable","getStyles","property","styles","ownerDocument","defaultView","getComputedStyle","getPropertyValue","parseTranslate","translateString","position","result","match","split","x","parseFloat","y","z","parseTranslateMatrix","matrix","is3D","push","hooks","addAction","hook","index","sort","a","b","doAction","handle","when","m","d","f","r","id","clearTimeout","Date","toLowerCase","JSON","parseJSON","parse","define","amd","detect","ua","funcs","wechat","version","replace","android","isBadAndroid","navigator","appVersion","iphone","ipad","func","userAgent","plus","body","classList","add","stream","isTouchable","EVENT_START","EVENT_MOVE","EVENT_END","EVENT_CANCEL","EVENT_CLICK","_mid","delegates","eventMethods","preventDefault","stopImmediatePropagation","stopPropagation","returnTrue","returnFalse","compatible","event","currentTarget","predicate","sourceMethod","mid","delegateFns","delegateFn","callbackObjs","handlerQueue","selectorAlls","parentNode","indexOf","disabled","contains","matches","callbacks","handlers","handler","tagName","gesture","isPropagationStopped","findDelegateFn","delegateCallbacks","filterFn","preventDefaultException","on","isAddEventListener","delegateEvents","delegateCallbackObjs","delegateFnArray","delegateCallback","href","off","splice","forEach","removeEventListener","bind","targets","targetHandles","registerTarget","founds","isFound","targetHandle","isContinue","isReset","proto","params","evt","createEvent","initEvent","Event","Function","to","partial","bound","args","concat","documentElement","defineProperty","HTMLElement","get","self","update","classes","className","join","ret","remove","toggle","item","requestAnimationFrame","lastTime","webkitRequestAnimationFrame","currTime","getTime","timeToCall","Math","max","cancelAnimationFrame","webkitCancelAnimationFrame","webkitCancelRequestAnimationFrame","FastClick","querySelector","targetElement","click","clickEvent","touch","activeElement","blur","changedTouches","initMouseEvent","screenX","screenY","clientX","clientY","forwardedTouchEvent","propagationStopped","CLASS_FOCUSIN","CLASS_BAR_TAB","CLASS_BAR_FOOTER","CLASS_BAR_FOOTER_SECONDARY","CLASS_BAR_FOOTER_SECONDARY_TAB","webview","currentWebview","children","readOnly","isFooter","scrollTop","scrollHeight","scrollLeft","scrollTo","namespace","classNamePrefix","classSelectorPrefix","classSelector","eventName","module","gestures","session","addGesture","round","abs","sqrt","atan","atan2","getDistance","p1","p2","props","getScale","starts","moves","getAngle","PI","getDirection","getRotation","start","end","getVelocity","deltaTime","stoped","gestureConfig","hasParent","node","parent","uniqueArray","results","values","val","sortUniqueArray","getMultiCenter","touches","touchesLength","pageX","pageY","multiTouch","pinch","copySimpleTouchData","timestamp","center","deltaX","deltaY","calDelta","offset","offsetDelta","prevDelta","prevTouch","calTouchData","firstTouch","firstMultiTouch","offsetCenter","angle","distance","offsetDirection","scale","rotation","calIntervalTouchData","CAL_INTERVAL","last","lastInterval","velocity","velocityX","velocityY","direction","v","targetIds","convertTouches","getTouches","allTouches","targetTouches","changedTargetTouches","identifier","sessionTarget","changedTouchesLength","isFirst","isFinal","handleTouchEvent","supportsPassive","checkPassiveListener","opts","passive","capture","popover","tab","offcanvas","modal","isScrolling","scrollingTimeout","flickStartTime","flickStart","flick","flickMaxTime","flickMinDistince","flickTime","flickDistanceX","flickDistanceY","swipe","swipeMaxTime","swipeMinDistince","lockDirection","startDirection","drag","fingers","lastTarget","lastTapTime","tapMaxDistance","tapMaxTime","doubletap","tapMaxInterval","holdTimeout","holdThreshold","hold","lastScale","scaleDiff","minRotationAngle","global","tap","longtap","initGlobal","inits","init","isInit","repeat","addInit","subpages","createIframe","wrapper","createElement","top","bottom","style","iframe","url","appendChild","handleScroll","location","localStorage","getItem","onload","setInterval","_scrollTop","scrollY","setItem","osObj","classArray","defaultOptions","swipeBack","preloadPages","preloadLimit","keyEventBind","backbutton","menubutton","titleConfig","height","backgroundColor","bottomBorderColor","title","text","left","width","color","align","family","size","weight","fontSrc","back","image","base64Data","imgSrc","sprite","defaultShow","autoShow","duration","aniShow","extras","show","waitingOptions","showOptions","windowOptions","scalable","bounce","plusReady","fire","evalJS","stringify","receive","triggerPreload","preloaded","list","timeChecked","openWindow","webviewCache","nShow","nWaiting","webviews","getWebviewById","createNew","afterShowMethodName","Error","waitingConfig","waiting","nativeUI","showWaiting","createWindow","showWebview","close","openWindowWithTitle","tid","view","nativeObj","View","dock","drawRect","_b","parseInt","_title","drawText","_back","backClick","_backImage","right","bitmap","Bitmap","loadBase64Data","load","drawBitmap","setTouchEventRect","interceptTouchEvent","append","isCreate","preload","getURL","create","subpage","subpageId","subWebview","preloads","first","shift","closeAll","closeOpened","opened","len","openedWebview","open_open","createWindows","option","appendWebview","runtime","appid","statusBarBackground","setStatusBarBackground","display","supportStatusbarOffset","addBack","history","beforeback","action","_popover","offCanvas","previewImage","getPreviewImage","isShown","closePopup","__back__first","wobj","canBack","toast","quit","hide","menu","__back","__menu","pullRefreshOptions","pullRefresh","hasPulldown","down","hasPullup","up","container","$container","pullRefresh_native","__NWin_Enable__","upOptions","webviewId","downOptions","jsonType","htmlType","rscript","scriptTypeRE","xmlTypeRE","blankRE","ajaxSettings","beforeSend","success","error","complete","xhr","protocol","XMLHttpRequest","accepts","script","json","xml","html","timeout","processData","cache","ajaxBeforeSend","settings","ajaxSuccess","ajaxComplete","ajaxError","status","serialize","traditional","scope","array","hash","serializeData","contentType","headers","param","toUpperCase","appendQuery","query","mimeToDataType","mime","parseArguments","dataType","ajax","setHeader","webkit","messageHandlers","net","console","nativeSetHeader","setRequestHeader","abortTimeout","mimeType","overrideMimeType","onreadystatechange","isLocal","responseText","getResponseHeader","eval","responseXML","statusText","abort","xhrFields","async","open","username","password","send","k","encodeURIComponent","post","getJSON","parts","response","div","innerHTML","selectorDiv","childs","originAnchor","crossDomain","urlAnchor","host","box","getBoundingClientRect","pageYOffset","clientTop","pageXOffset","clientLeft","scroll","distaince","animationFrame","cb","isQueued","initializing","fnTest","xyz","Class","prop","_super","tmp","constructor","callee","CLASS_PULL_TOP_POCKET","CLASS_PULL_BOTTOM_POCKET","CLASS_PULL","CLASS_PULL_LOADING","CLASS_PULL_CAPTION","CLASS_PULL_CAPTION_DOWN","CLASS_PULL_CAPTION_REFRESH","CLASS_PULL_CAPTION_NOMORE","CLASS_ICON","CLASS_SPINNER","CLASS_ICON_PULLDOWN","CLASS_BLOCK","CLASS_HIDDEN","CLASS_VISIBILITY","CLASS_LOADING_UP","CLASS_LOADING_DOWN","CLASS_LOADING","pocketHtml","PullRefresh","scrollX","indicators","deceleration","contentinit","contentdown","contentover","contentrefresh","auto","contentnomore","_init","_initPocket","_initPulldownRefresh","pulldown","topPocket","pullPocket","pullCaption","topCaption","pullLoading","topLoading","_initPullupRefresh","bottomPocket","bottomCaption","bottomLoading","scroller","_createPocket","insertBefore","firstChild","clazz","iconClass","pocket","_resetPullDownLoading","loading","webkitTransition","webkitTransform","webkitAnimation","_setCaptionClass","isPulldown","caption","_setCaption","reset","lastTitle","CLASS_SCROLL","CLASS_SCROLLBAR","CLASS_INDICATOR","CLASS_SCROLLBAR_VERTICAL","CLASS_SCROLLBAR_HORIZONTAL","CLASS_ACTIVE","ease","quadratic","circular","outCirc","outCubic","Scroll","scrollerStyle","stopped","startX","startY","hardwareAccelerated","fixedBadAndorid","momentum","snapX","snap","bounceTime","bounceEasing","scrollTime","scrollEasing","directionLockThreshold","parallaxElement","parallaxRatio","translateZ","refresh","_initParallax","_initIndicators","_initEvent","parallaxStyle","parallaxHeight","offsetHeight","parallaxImgStyle","indicator","_createScrollBar","listenX","listenY","Indicator","_initSnap","currentPage","pages","snaps","n","leftX","rightX","offsetLeft","offsetWidth","_getSnapX","maxScrollX","min","wrapperWidth","_gotoPage","_nearestSnap","nearestX","detach","segmentedControl","_handleIndicatorScrollend","map","fade","_handleIndicatorScrollstart","_handleIndicatorRefresh","handleEvent","resetPosition","_start","_drag","_flick","_end","transitionTimer","_transitionEnd","_scrollend","_resize","moved","needReset","_transitionTime","isInTransition","pos","setTranslate","reLayout","_getDirectionByAngle","innerHeight","isPreventDefault","isReturn","absDeltaX","absDeltaY","hasHorizontalScroll","hasVerticalScroll","newX","newY","maxScrollY","_updateTranslate","_clearRequestAnimationFrame","time","easing","momentumX","_momentum","destination","momentumY","wrapperHeight","that","resizeTimeout","resizePolling","transitionTime","_transitionTimingFunction","transitionTimingFunction","_translate","lastX","lastY","scrollbar","scrollbarY","scrollbarIndicatorY","scrollbarX","scrollbarIndicatorX","_preventDefaultException","exceptions","_reLayout","scrollerWidth","scrollerHeight","items","itemLength","current","lowerMargin","wrapperSize","speed","_getTranslateStr","setStopped","disablePullupToRefresh","disablePulldownToRefresh","enablePullupToRefresh","enablePulldownToRefresh","parallaxY","updatePosition","paddingLeft","paddingRight","paddingTop","paddingBottom","clientWidth","clientHeight","_reInit","groups","scrollToBottom","gotoPage","destroy","getAttribute","setAttribute","wrapperStyle","indicatorStyle","speedRatioX","speedRatioY","sizeRatioX","sizeRatioY","maxPosX","maxPosY","opacity","indicatorWidth","minBoundaryX","maxBoundaryX","indicatorHeight","minBoundaryY","maxBoundaryY","visible","fadeTimeout","delay","scrollApis","scrollApi","_options","_scrollbottom","pullupLoading","disablePulldown","pulldownLoading","endPulldownToRefresh","endPullupToRefresh","finished","pullRefreshApi","autoY","CLASS_SLIDER","CLASS_SLIDER_GROUP","CLASS_SLIDER_LOOP","CLASS_SLIDER_INDICATOR","CLASS_ACTION_PREVIOUS","CLASS_ACTION_NEXT","CLASS_SLIDER_ITEM","SELECTOR_SLIDER_ITEM","SELECTOR_SLIDER_INDICATOR","SELECTOR_SLIDER_PROGRESS_BAR","Slider","interval","slideTime","progressBar","progressBarWidth","progressBarStyle","_initTimer","_triggerSlide","page","slideNumber","_fixedSlideNumber","loop","lastSlideNumber","lastPage","_handleSlide","temps","_slideNumber","indicatorWrap","number","innerText","controlItems","_handleTabShow","gotoItem","tabNumber","_handleIndicatorTap","slidershowTimer","slider","nextItem","_getScroll","_getPage","isFlick","_gotoItem","prevItem","getSlideNumber","sliderElement","CLASS_PLUS_PULLREFRESH","PlusPullRefresh","_initPulldownRefreshEvent","scrollInterval","isScroll","setPullToRefresh","support","range","attrWebviewId","removeAttribute","setBounce","changeoffset","beginPulldown","beginPullToRefresh","_pulldownLoading","childWebview","endPulldown","_wv","endPullToRefresh","_endPulldownToRefresh","beginPullup","isLoading","endPullup","setStyle","CLASS_OFF_CANVAS_LEFT","CLASS_OFF_CANVAS_RIGHT","CLASS_ACTION_BACKDROP","CLASS_OFF_CANVAS_WRAP","CLASS_SLIDE_IN","CLASS_TRANSITIONING","SELECTOR_INNER_WRAP","OffCanvas","dragThresholdX","slideIn","offCanvasLefts","offCanvasRights","offCanvasLeft","offCanvasRight","offCanvasRightWidth","offCanvasLeftWidth","offCanvasLeftSlideIn","offCanvasRightSlideIn","backdrop","offsetX","lastTranslateX","_dispatchEvent","isDragging","offCanvasWidth","getTranslateX","_initOffCanvasVisible","updateTranslate","ratio","openPercentage","visibility","percentage","setTranslateX","leftShowing","rightShowing","zIndex","percent","zoomOutScale","zoomInScale","zoomOutOpacity","zoomInOpacity","webkitTransformOrigin","shown","directionOrOffCanvas","findOffCanvasContainer","_container","offCanvasApis","offCanvasApi","CLASS_ACTION","CLASS_MODAL","CLASS_POPOVER","CLASS_POPOVER_ARROW","CLASS_ACTION_POPOVER","CLASS_BACKDROP","CLASS_BAR_POPOVER","CLASS_BAR_BACKDROP","CLASS_BOTTOM","onPopoverShown","onPopoverHidden","removeBackdrop","removeBackdropTimer","removeChild","togglePopover","anchor","state","isActionSheet","calPosition","wWidth","innerWidth","wHeight","pWidth","pHeight","aWidth","aHeight","arrow","arrowSize","pTop","pLeft","diff","arrowLeft","defaultPadding","createMask","mask","_show","_remove","CLASS_CONTROL_ITEM","CLASS_SEGMENTED_CONTROL","CLASS_SEGMENTED_CONTROL_VERTICAL","CLASS_CONTROL_CONTENT","CLASS_TAB_BAR","CLASS_TAB_ITEM","targetTab","activeTab","activeBodies","targetBody","isLastActive","activeBody","contents","_contents","CLASS_SWITCH","CLASS_SWITCH_HANDLE","CLASS_DRAGGING","CLASS_DISABLED","SELECTOR_SWITCH_HANDLE","Toggle","toggleWidth","handleWidth","handleX","swiperight","webkitTransitionDuration","lastChanged","initialState","isActive","animate","isChanged","switchApis","switchApi","CLASS_SELECTED","CLASS_GRID_VIEW","CLASS_RADIO_VIEW","CLASS_TABLE_VIEW_CELL","CLASS_COLLAPSE_CONTENT","CLASS_TOGGLE","CLASS_BTN","CLASS_SLIDER_HANDLE","CLASS_SLIDER_LEFT","CLASS_SLIDER_RIGHT","SELECTOR_SLIDER_HANDLE","SELECTOR_SLIDER_LEFT","SELECTOR_SLIDER_RIGHT","SELECTOR_SELECTED","SELECTOR_BUTTON","overFactor","cell","isMoved","isOpened","openedActions","progress","sliderHandle","sliderActionLeft","sliderActionRight","buttonsLeft","buttonsRight","sliderDirection","sliderRequestAnimationFrame","translateX","sliderActionLeftWidth","sliderActionRightWidth","toggleActive","pow","buttonRight","_buttonOffset","buttonOffset","buttonLeft","isDisabled","selected","swipeoutClose","link","toggleEvents","dragend","swipeleft","translate","actionsWidth","isToggle","buttons","newTranslate","button","isRemove","method","swipeoutOpen","swipeoutAction","swipeoutWidth","radioOrCheckboxClick","input","checked","isExpand","ul","collapse","alert","message","btnValue","confirm","btnArray","prompt","defaultText","durations","verticalAlign","isVisible","CLASS_POPUP","CLASS_POPUP_BACKDROP","CLASS_POPUP_IN","CLASS_POPUP_OUT","CLASS_POPUP_INNER","CLASS_POPUP_TITLE","CLASS_POPUP_TEXT","CLASS_POPUP_INPUT","CLASS_POPUP_BUTTONS","CLASS_POPUP_BUTTON","CLASS_POPUP_BUTTON_BOLD","popupStack","createInput","placeholder","createInner","extra","createButtons","btns","createPopup","popupElement","removePopupElement","popup","pop","createAlert","createConfirm","createPrompt","closePopups","CLASS_PROGRESSBAR","CLASS_PROGRESSBAR_IN","CLASS_PROGRESSBAR_OUT","CLASS_PROGRESSBAR_INFINITE","SELECTOR_PROGRESSBAR","_findProgressbar","progressbars","progressbar","showProgressbar","_progressbar","setProgressbar","hideProgressbar","span","progressbarApis","progressbarApi","mui_plugin_progressbar","setOptions","setProgress","CLASS_ICON_CLEAR","CLASS_ICON_SPEECH","CLASS_ICON_SEARCH","CLASS_ICON_PASSWORD","CLASS_INPUT_ROW","CLASS_PLACEHOLDER","CLASS_TOOLTIP","SELECTOR_ICON_CLOSE","SELECTOR_ICON_SPEECH","SELECTOR_ICON_PASSWORD","SELECTOR_PLACEHOLDER","SELECTOR_TOOLTIP","findRow","Input","actions","sliderActionClass","sliderActionSelector","clearActionClass","clearActionSelector","speechActionClass","speechActionSelector","searchActionClass","searchActionSelector","passwordActionClass","passwordActionSelector","initAction","initElementEvent","row","sliderAction","createAction","searchAction","speechAction","speechActionClick","clearAction","clearActionClick","passwordAction","passwordActionClick","actionClass","actionSelector","nextSibling","tooltip","showTip","tooltipWidth","distince","scaleWidth","setPlaceholder","oldValue","speech","startRecognize","engine","s","stopRecognize","inputApis","inputApi","rgbaRegex","getColor","colorStr","Transparent","scrollby","scrollByElem","isNativeScroll","_style","_bgColor","_R","_G","_B","_A","lastOpacity","_bufferFn","alpha","destory","mui_plugin_transparent","transparent","transparentApis","transparentApi","touchSupport","tapEventName","changeEventName","holderClassName","plusClassSelector","minusClassSelector","inputClassSelector","Numbox","holder","step","minus","checkValue","getValue","isNaN","setOption","setValue","numbox","instanceArray","optionsText","STATE_RESET","STATE_LOADING","loadingText","loadingIcon","loadingIconPosition","Button","isInput","resetHTML","setState","setHtml","buttonApis","buttonApi","mui_plugin_button"],"mappings":"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","sourcesContent":["/*!\n * =====================================================\n * Mui v3.7.3 (http://dev.dcloud.net.cn/mui)\n * =====================================================\n */\n/**\n * MUI核心JS\n * @type _L4.$|Function\n */\nvar mui = (function(document, undefined) {\n\tvar readyRE = /complete|loaded|interactive/;\n\tvar idSelectorRE = /^#([\\w-]+)$/;\n\tvar classSelectorRE = /^\\.([\\w-]+)$/;\n\tvar tagSelectorRE = /^[\\w-]+$/;\n\tvar translateRE = /translate(?:3d)?\\((.+?)\\)/;\n\tvar translateMatrixRE = /matrix(3d)?\\((.+?)\\)/;\n\n\tvar $ = function(selector, context) {\n\t\tcontext = context || document;\n\t\tif (!selector)\n\t\t\treturn wrap();\n\t\tif (typeof selector === 'object')\n\t\t\tif ($.isArrayLike(selector)) {\n\t\t\t\treturn wrap($.slice.call(selector), null);\n\t\t\t} else {\n\t\t\t\treturn wrap([selector], null);\n\t\t\t}\n\t\tif (typeof selector === 'function')\n\t\t\treturn $.ready(selector);\n\t\tif (typeof selector === 'string') {\n\t\t\ttry {\n\t\t\t\tselector = selector.trim();\n\t\t\t\tif (idSelectorRE.test(selector)) {\n\t\t\t\t\tvar found = document.getElementById(RegExp.$1);\n\t\t\t\t\treturn wrap(found ? [found] : []);\n\t\t\t\t}\n\t\t\t\treturn wrap($.qsa(selector, context), selector);\n\t\t\t} catch (e) {}\n\t\t}\n\t\treturn wrap();\n\t};\n\n\tvar wrap = function(dom, selector) {\n\t\tdom = dom || [];\n\t\tObject.setPrototypeOf(dom, $.fn);\n\t\tdom.selector = selector || '';\n\t\treturn dom;\n\t};\n\n\t$.uuid = 0;\n\n\t$.data = {};\n\t/**\n\t * extend(simple)\n\t * @param {type} target\n\t * @param {type} source\n\t * @param {type} deep\n\t * @returns {unresolved}\n\t */\n\t$.extend = function() { //from jquery2\n\t\tvar options, name, src, copy, copyIsArray, clone,\n\t\t\ttarget = arguments[0] || {},\n\t\t\ti = 1,\n\t\t\tlength = arguments.length,\n\t\t\tdeep = false;\n\n\t\tif (typeof target === \"boolean\") {\n\t\t\tdeep = target;\n\n\t\t\ttarget = arguments[i] || {};\n\t\t\ti++;\n\t\t}\n\n\t\tif (typeof target !== \"object\" && !$.isFunction(target)) {\n\t\t\ttarget = {};\n\t\t}\n\n\t\tif (i === length) {\n\t\t\ttarget = this;\n\t\t\ti--;\n\t\t}\n\n\t\tfor (; i < length; i++) {\n\t\t\tif ((options = arguments[i]) != null) {\n\t\t\t\tfor (name in options) {\n\t\t\t\t\tsrc = target[name];\n\t\t\t\t\tcopy = options[name];\n\n\t\t\t\t\tif (target === copy) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (deep && copy && ($.isPlainObject(copy) || (copyIsArray = $.isArray(copy)))) {\n\t\t\t\t\t\tif (copyIsArray) {\n\t\t\t\t\t\t\tcopyIsArray = false;\n\t\t\t\t\t\t\tclone = src && $.isArray(src) ? src : [];\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclone = src && $.isPlainObject(src) ? src : {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttarget[name] = $.extend(deep, clone, copy);\n\n\t\t\t\t\t} else if (copy !== undefined) {\n\t\t\t\t\t\ttarget[name] = copy;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn target;\n\t};\n\t/**\n\t * mui noop(function)\n\t */\n\t$.noop = function() {};\n\t/**\n\t * mui slice(array)\n\t */\n\t$.slice = [].slice;\n\t/**\n\t * mui filter(array)\n\t */\n\t$.filter = [].filter;\n\n\t$.type = function(obj) {\n\t\treturn obj == null ? String(obj) : class2type[{}.toString.call(obj)] || \"object\";\n\t};\n\t/**\n\t * mui isArray\n\t */\n\t$.isArray = Array.isArray ||\n\t\tfunction(object) {\n\t\t\treturn object instanceof Array;\n\t\t};\n\t/**\n\t * mui isArrayLike \n\t * @param {Object} obj\n\t */\n\t$.isArrayLike = function(obj) {\n\t\tvar length = !!obj && \"length\" in obj && obj.length;\n\t\tvar type = $.type(obj);\n\t\tif (type === \"function\" || $.isWindow(obj)) {\n\t\t\treturn false;\n\t\t}\n\t\treturn type === \"array\" || length === 0 ||\n\t\t\ttypeof length === \"number\" && length > 0 && (length - 1) in obj;\n\t};\n\t/**\n\t * mui isWindow(需考虑obj为undefined的情况)\n\t */\n\t$.isWindow = function(obj) {\n\t\treturn obj != null && obj === obj.window;\n\t};\n\t/**\n\t * mui isObject\n\t */\n\t$.isObject = function(obj) {\n\t\treturn $.type(obj) === \"object\";\n\t};\n\t/**\n\t * mui isPlainObject\n\t */\n\t$.isPlainObject = function(obj) {\n\t\treturn $.isObject(obj) && !$.isWindow(obj) && Object.getPrototypeOf(obj) === Object.prototype;\n\t};\n\t/**\n\t * mui isEmptyObject\n\t * @param {Object} o\n\t */\n\t$.isEmptyObject = function(o) {\n\t\tfor (var p in o) {\n\t\t\tif (p !== undefined) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t};\n\t/**\n\t * mui isFunction\n\t */\n\t$.isFunction = function(value) {\n\t\treturn $.type(value) === \"function\";\n\t};\n\t/**\n\t * mui querySelectorAll\n\t * @param {type} selector\n\t * @param {type} context\n\t * @returns {Array}\n\t */\n\t$.qsa = function(selector, context) {\n\t\tcontext = context || document;\n\t\treturn $.slice.call(classSelectorRE.test(selector) ? context.getElementsByClassName(RegExp.$1) : tagSelectorRE.test(selector) ? context.getElementsByTagName(selector) : context.querySelectorAll(selector));\n\t};\n\t/**\n\t * ready(DOMContentLoaded)\n\t * @param {type} callback\n\t * @returns {_L6.$}\n\t */\n\t$.ready = function(callback) {\n\t\tif (readyRE.test(document.readyState)) {\n\t\t\tcallback($);\n\t\t} else {\n\t\t\tdocument.addEventListener('DOMContentLoaded', function() {\n\t\t\t\tcallback($);\n\t\t\t}, false);\n\t\t}\n\t\treturn this;\n\t};\n\t/**\n\t * 将 fn 缓存一段时间后, 再被调用执行\n\t * 此方法为了避免在 ms 段时间内, 执行 fn 多次. 常用于 resize , scroll , mousemove 等连续性事件中;\n\t * 当 ms 设置为 -1, 表示立即执行 fn, 即和直接调用 fn 一样;\n\t * 调用返回函数的 stop 停止最后一次的 buffer 效果\n\t * @param {Object} fn\n\t * @param {Object} ms\n\t * @param {Object} context\n\t */\n\t$.buffer = function(fn, ms, context) {\n\t\tvar timer;\n\t\tvar lastStart = 0;\n\t\tvar lastEnd = 0;\n\t\tvar ms = ms || 150;\n\n\t\tfunction run() {\n\t\t\tif (timer) {\n\t\t\t\ttimer.cancel();\n\t\t\t\ttimer = 0;\n\t\t\t}\n\t\t\tlastStart = $.now();\n\t\t\tfn.apply(context || this, arguments);\n\t\t\tlastEnd = $.now();\n\t\t}\n\n\t\treturn $.extend(function() {\n\t\t\tif (\n\t\t\t\t(!lastStart) || // 从未运行过\n\t\t\t\t(lastEnd >= lastStart && $.now() - lastEnd > ms) || // 上次运行成功后已经超过ms毫秒\n\t\t\t\t(lastEnd < lastStart && $.now() - lastStart > ms * 8) // 上次运行或未完成，后8*ms毫秒\n\t\t\t) {\n\t\t\t\trun.apply(this, arguments);\n\t\t\t} else {\n\t\t\t\tif (timer) {\n\t\t\t\t\ttimer.cancel();\n\t\t\t\t}\n\t\t\t\ttimer = $.later(run, ms, null, $.slice.call(arguments));\n\t\t\t}\n\t\t}, {\n\t\t\tstop: function() {\n\t\t\t\tif (timer) {\n\t\t\t\t\ttimer.cancel();\n\t\t\t\t\ttimer = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\t/**\n\t * each\n\t * @param {type} elements\n\t * @param {type} callback\n\t * @returns {_L8.$}\n\t */\n\t$.each = function(elements, callback, hasOwnProperty) {\n\t\tif (!elements) {\n\t\t\treturn this;\n\t\t}\n\t\tif (typeof elements.length === 'number') {\n\t\t\t[].every.call(elements, function(el, idx) {\n\t\t\t\treturn callback.call(el, idx, el) !== false;\n\t\t\t});\n\t\t} else {\n\t\t\tfor (var key in elements) {\n\t\t\t\tif (hasOwnProperty) {\n\t\t\t\t\tif (elements.hasOwnProperty(key)) {\n\t\t\t\t\t\tif (callback.call(elements[key], key, elements[key]) === false) return elements;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (callback.call(elements[key], key, elements[key]) === false) return elements;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t};\n\t$.focus = function(element) {\n\t\tif ($.os.ios) {\n\t\t\tsetTimeout(function() {\n\t\t\t\telement.focus();\n\t\t\t}, 10);\n\t\t} else {\n\t\t\telement.focus();\n\t\t}\n\t};\n\t/**\n\t * trigger event\n\t * @param {type} element\n\t * @param {type} eventType\n\t * @param {type} eventData\n\t * @returns {_L8.$}\n\t */\n\t$.trigger = function(element, eventType, eventData) {\n\t\telement.dispatchEvent(new CustomEvent(eventType, {\n\t\t\tdetail: eventData,\n\t\t\tbubbles: true,\n\t\t\tcancelable: true\n\t\t}));\n\t\treturn this;\n\t};\n\t/**\n\t * getStyles\n\t * @param {type} element\n\t * @param {type} property\n\t * @returns {styles}\n\t */\n\t$.getStyles = function(element, property) {\n\t\tvar styles = element.ownerDocument.defaultView.getComputedStyle(element, null);\n\t\tif (property) {\n\t\t\treturn styles.getPropertyValue(property) || styles[property];\n\t\t}\n\t\treturn styles;\n\t};\n\t/**\n\t * parseTranslate\n\t * @param {type} translateString\n\t * @param {type} position\n\t * @returns {Object}\n\t */\n\t$.parseTranslate = function(translateString, position) {\n\t\tvar result = translateString.match(translateRE || '');\n\t\tif (!result || !result[1]) {\n\t\t\tresult = ['', '0,0,0'];\n\t\t}\n\t\tresult = result[1].split(\",\");\n\t\tresult = {\n\t\t\tx: parseFloat(result[0]),\n\t\t\ty: parseFloat(result[1]),\n\t\t\tz: parseFloat(result[2])\n\t\t};\n\t\tif (position && result.hasOwnProperty(position)) {\n\t\t\treturn result[position];\n\t\t}\n\t\treturn result;\n\t};\n\t/**\n\t * parseTranslateMatrix\n\t * @param {type} translateString\n\t * @param {type} position\n\t * @returns {Object}\n\t */\n\t$.parseTranslateMatrix = function(translateString, position) {\n\t\tvar matrix = translateString.match(translateMatrixRE);\n\t\tvar is3D = matrix && matrix[1];\n\t\tif (matrix) {\n\t\t\tmatrix = matrix[2].split(\",\");\n\t\t\tif (is3D === \"3d\")\n\t\t\t\tmatrix = matrix.slice(12, 15);\n\t\t\telse {\n\t\t\t\tmatrix.push(0);\n\t\t\t\tmatrix = matrix.slice(4, 7);\n\t\t\t}\n\t\t} else {\n\t\t\tmatrix = [0, 0, 0];\n\t\t}\n\t\tvar result = {\n\t\t\tx: parseFloat(matrix[0]),\n\t\t\ty: parseFloat(matrix[1]),\n\t\t\tz: parseFloat(matrix[2])\n\t\t};\n\t\tif (position && result.hasOwnProperty(position)) {\n\t\t\treturn result[position];\n\t\t}\n\t\treturn result;\n\t};\n\t$.hooks = {};\n\t$.addAction = function(type, hook) {\n\t\tvar hooks = $.hooks[type];\n\t\tif (!hooks) {\n\t\t\thooks = [];\n\t\t}\n\t\thook.index = hook.index || 1000;\n\t\thooks.push(hook);\n\t\thooks.sort(function(a, b) {\n\t\t\treturn a.index - b.index;\n\t\t});\n\t\t$.hooks[type] = hooks;\n\t\treturn $.hooks[type];\n\t};\n\t$.doAction = function(type, callback) {\n\t\tif ($.isFunction(callback)) { //指定了callback\n\t\t\t$.each($.hooks[type], callback);\n\t\t} else { //未指定callback，直接执行\n\t\t\t$.each($.hooks[type], function(index, hook) {\n\t\t\t\treturn !hook.handle();\n\t\t\t});\n\t\t}\n\t};\n\t/**\n\t * setTimeout封装\n\t * @param {Object} fn\n\t * @param {Object} when\n\t * @param {Object} context\n\t * @param {Object} data\n\t */\n\t$.later = function(fn, when, context, data) {\n\t\twhen = when || 0;\n\t\tvar m = fn;\n\t\tvar d = data;\n\t\tvar f;\n\t\tvar r;\n\n\t\tif (typeof fn === 'string') {\n\t\t\tm = context[fn];\n\t\t}\n\n\t\tf = function() {\n\t\t\tm.apply(context, $.isArray(d) ? d : [d]);\n\t\t};\n\n\t\tr = setTimeout(f, when);\n\n\t\treturn {\n\t\t\tid: r,\n\t\t\tcancel: function() {\n\t\t\t\tclearTimeout(r);\n\t\t\t}\n\t\t};\n\t};\n\t$.now = Date.now || function() {\n\t\treturn +new Date();\n\t};\n\tvar class2type = {};\n\t$.each(['Boolean', 'Number', 'String', 'Function', 'Array', 'Date', 'RegExp', 'Object', 'Error'], function(i, name) {\n\t\tclass2type[\"[object \" + name + \"]\"] = name.toLowerCase();\n\t});\n\tif (window.JSON) {\n\t\t$.parseJSON = JSON.parse;\n\t}\n\t/**\n\t * $.fn\n\t */\n\t$.fn = {\n\t\teach: function(callback) {\n\t\t\t[].every.call(this, function(el, idx) {\n\t\t\t\treturn callback.call(el, idx, el) !== false;\n\t\t\t});\n\t\t\treturn this;\n\t\t}\n\t};\n\n\t/**\n\t * 兼容 AMD 模块\n\t **/\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine('mui', [], function() {\n\t\t\treturn $;\n\t\t});\n\t}\n\n\treturn $;\n})(document);\n//window.mui = mui;\n//'$' in window || (window.$ = mui);\n/**\n * $.os\n * @param {type} $\n * @returns {undefined}\n */\n(function($, window) {\n\tfunction detect(ua) {\n\t\tthis.os = {};\n\t\tvar funcs = [\n\n\t\t\tfunction() { //wechat\n\t\t\t\tvar wechat = ua.match(/(MicroMessenger)\\/([\\d\\.]+)/i);\n\t\t\t\tif (wechat) { //wechat\n\t\t\t\t\tthis.os.wechat = {\n\t\t\t\t\t\tversion: wechat[2].replace(/_/g, '.')\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tfunction() { //android\n\t\t\t\tvar android = ua.match(/(Android);?[\\s\\/]+([\\d.]+)?/);\n\t\t\t\tif (android) {\n\t\t\t\t\tthis.os.android = true;\n\t\t\t\t\tthis.os.version = android[2];\n\n\t\t\t\t\tthis.os.isBadAndroid = !(/Chrome\\/\\d/.test(window.navigator.appVersion));\n\t\t\t\t}\n\t\t\t\treturn this.os.android === true;\n\t\t\t},\n\t\t\tfunction() { //ios\n\t\t\t\tvar iphone = ua.match(/(iPhone\\sOS)\\s([\\d_]+)/);\n\t\t\t\tif (iphone) { //iphone\n\t\t\t\t\tthis.os.ios = this.os.iphone = true;\n\t\t\t\t\tthis.os.version = iphone[2].replace(/_/g, '.');\n\t\t\t\t} else {\n\t\t\t\t\tvar ipad = ua.match(/(iPad).*OS\\s([\\d_]+)/);\n\t\t\t\t\tif (ipad) { //ipad\n\t\t\t\t\t\tthis.os.ios = this.os.ipad = true;\n\t\t\t\t\t\tthis.os.version = ipad[2].replace(/_/g, '.');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn this.os.ios === true;\n\t\t\t}\n\t\t];\n\t\t[].every.call(funcs, function(func) {\n\t\t\treturn !func.call($);\n\t\t});\n\t}\n\tdetect.call($, navigator.userAgent);\n})(mui, window);\n/**\n * $.os.plus\n * @param {type} $\n * @returns {undefined}\n */\n(function($, document) {\n\tfunction detect(ua) {\n\t\tthis.os = this.os || {};\n\t\tvar plus = ua.match(/Html5Plus/i); //TODO 5\\+Browser?\n\t\tif (plus) {\n\t\t\tthis.os.plus = true;\n\t\t\t$(function() {\n\t\t\t\tdocument.body.classList.add('mui-plus');\n\t\t\t});\n\t\t\tif (ua.match(/StreamApp/i)) { //TODO 最好有流应用自己的标识\n\t\t\t\tthis.os.stream = true;\n\t\t\t\t$(function() {\n\t\t\t\t\tdocument.body.classList.add('mui-plus-stream');\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\tdetect.call($, navigator.userAgent);\n})(mui, document);\n/**\n * 仅提供简单的on，off(仅支持事件委托，不支持当前元素绑定，当前元素绑定请直接使用addEventListener,removeEventListener)\n * @param {Object} $\n */\n(function($) {\n\tif ('ontouchstart' in window) {\n\t\t$.isTouchable = true;\n\t\t$.EVENT_START = 'touchstart';\n\t\t$.EVENT_MOVE = 'touchmove';\n\t\t$.EVENT_END = 'touchend';\n\t} else {\n\t\t$.isTouchable = false;\n\t\t$.EVENT_START = 'mousedown';\n\t\t$.EVENT_MOVE = 'mousemove';\n\t\t$.EVENT_END = 'mouseup';\n\t}\n\t$.EVENT_CANCEL = 'touchcancel';\n\t$.EVENT_CLICK = 'click';\n\n\tvar _mid = 1;\n\tvar delegates = {};\n\t//需要wrap的函数\n\tvar eventMethods = {\n\t\tpreventDefault: 'isDefaultPrevented',\n\t\tstopImmediatePropagation: 'isImmediatePropagationStopped',\n\t\tstopPropagation: 'isPropagationStopped'\n\t};\n\t//默认true返回函数\n\tvar returnTrue = function() {\n\t\treturn true\n\t};\n\t//默认false返回函数\n\tvar returnFalse = function() {\n\t\treturn false\n\t};\n\t//wrap浏览器事件\n\tvar compatible = function(event, target) {\n\t\tif (!event.detail) {\n\t\t\tevent.detail = {\n\t\t\t\tcurrentTarget: target\n\t\t\t};\n\t\t} else {\n\t\t\tevent.detail.currentTarget = target;\n\t\t}\n\t\t$.each(eventMethods, function(name, predicate) {\n\t\t\tvar sourceMethod = event[name];\n\t\t\tevent[name] = function() {\n\t\t\t\tthis[predicate] = returnTrue;\n\t\t\t\treturn sourceMethod && sourceMethod.apply(event, arguments)\n\t\t\t}\n\t\t\tevent[predicate] = returnFalse;\n\t\t}, true);\n\t\treturn event;\n\t};\n\t//简单的wrap对象_mid\n\tvar mid = function(obj) {\n\t\treturn obj && (obj._mid || (obj._mid = _mid++));\n\t};\n\t//事件委托对象绑定的事件回调列表\n\tvar delegateFns = {};\n\t//返回事件委托的wrap事件回调\n\tvar delegateFn = function(element, event, selector, callback) {\n\t\treturn function(e) {\n\t\t\t//same event\n\t\t\tvar callbackObjs = delegates[element._mid][event];\n\t\t\tvar handlerQueue = [];\n\t\t\tvar target = e.target;\n\t\t\tvar selectorAlls = {};\n\t\t\tfor (; target && target !== document; target = target.parentNode) {\n\t\t\t\tif (target === element) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (~['click', 'tap', 'doubletap', 'longtap', 'hold'].indexOf(event) && (target.disabled || target.classList.contains('mui-disabled'))) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tvar matches = {};\n\t\t\t\t$.each(callbackObjs, function(selector, callbacks) { //same selector\n\t\t\t\t\tselectorAlls[selector] || (selectorAlls[selector] = $.qsa(selector, element));\n\t\t\t\t\tif (selectorAlls[selector] && ~(selectorAlls[selector]).indexOf(target)) {\n\t\t\t\t\t\tif (!matches[selector]) {\n\t\t\t\t\t\t\tmatches[selector] = callbacks;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, true);\n\t\t\t\tif (!$.isEmptyObject(matches)) {\n\t\t\t\t\thandlerQueue.push({\n\t\t\t\t\t\telement: target,\n\t\t\t\t\t\thandlers: matches\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tselectorAlls = null;\n\t\t\te = compatible(e); //compatible event\n\t\t\t$.each(handlerQueue, function(index, handler) {\n\t\t\t\ttarget = handler.element;\n\t\t\t\tvar tagName = target.tagName;\n\t\t\t\tif (event === 'tap' && (tagName !== 'INPUT' && tagName !== 'TEXTAREA' && tagName !== 'SELECT')) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.detail && e.detail.gesture && e.detail.gesture.preventDefault();\n\t\t\t\t}\n\t\t\t\t$.each(handler.handlers, function(index, handler) {\n\t\t\t\t\t$.each(handler, function(index, callback) {\n\t\t\t\t\t\tif (callback.call(target, e) === false) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t}\n\t\t\t\t\t}, true);\n\t\t\t\t}, true)\n\t\t\t\tif (e.isPropagationStopped()) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}, true);\n\t\t};\n\t};\n\tvar findDelegateFn = function(element, event) {\n\t\tvar delegateCallbacks = delegateFns[mid(element)];\n\t\tvar result = [];\n\t\tif (delegateCallbacks) {\n\t\t\tresult = [];\n\t\t\tif (event) {\n\t\t\t\tvar filterFn = function(fn) {\n\t\t\t\t\treturn fn.type === event;\n\t\t\t\t}\n\t\t\t\treturn delegateCallbacks.filter(filterFn);\n\t\t\t} else {\n\t\t\t\tresult = delegateCallbacks;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\tvar preventDefaultException = /^(INPUT|TEXTAREA|BUTTON|SELECT)$/;\n\t/**\n\t * mui delegate events\n\t * @param {type} event\n\t * @param {type} selector\n\t * @param {type} callback\n\t * @returns {undefined}\n\t */\n\t$.fn.on = function(event, selector, callback) { //仅支持简单的事件委托,主要是tap事件使用，类似mouse,focus之类暂不封装支持\n\t\treturn this.each(function() {\n\t\t\tvar element = this;\n\t\t\tmid(element);\n\t\t\tmid(callback);\n\t\t\tvar isAddEventListener = false;\n\t\t\tvar delegateEvents = delegates[element._mid] || (delegates[element._mid] = {});\n\t\t\tvar delegateCallbackObjs = delegateEvents[event] || ((delegateEvents[event] = {}));\n\t\t\tif ($.isEmptyObject(delegateCallbackObjs)) {\n\t\t\t\tisAddEventListener = true;\n\t\t\t}\n\t\t\tvar delegateCallbacks = delegateCallbackObjs[selector] || (delegateCallbackObjs[selector] = []);\n\t\t\tdelegateCallbacks.push(callback);\n\t\t\tif (isAddEventListener) {\n\t\t\t\tvar delegateFnArray = delegateFns[mid(element)];\n\t\t\t\tif (!delegateFnArray) {\n\t\t\t\t\tdelegateFnArray = [];\n\t\t\t\t}\n\t\t\t\tvar delegateCallback = delegateFn(element, event, selector, callback);\n\t\t\t\tdelegateFnArray.push(delegateCallback);\n\t\t\t\tdelegateCallback.i = delegateFnArray.length - 1;\n\t\t\t\tdelegateCallback.type = event;\n\t\t\t\tdelegateFns[mid(element)] = delegateFnArray;\n\t\t\t\telement.addEventListener(event, delegateCallback);\n\t\t\t\tif (event === 'tap') { //TODO 需要找个更好的解决方案\n\t\t\t\t\telement.addEventListener('click', function(e) {\n\t\t\t\t\t\tif (e.target) {\n\t\t\t\t\t\t\tvar tagName = e.target.tagName;\n\t\t\t\t\t\t\tif (!preventDefaultException.test(tagName)) {\n\t\t\t\t\t\t\t\tif (tagName === 'A') {\n\t\t\t\t\t\t\t\t\tvar href = e.target.href;\n\t\t\t\t\t\t\t\t\tif (!(href && ~href.indexOf('tel:'))) {\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\t$.fn.off = function(event, selector, callback) {\n\t\treturn this.each(function() {\n\t\t\tvar _mid = mid(this);\n\t\t\tif (!event) { //mui(selector).off();\n\t\t\t\tdelegates[_mid] && delete delegates[_mid];\n\t\t\t} else if (!selector) { //mui(selector).off(event);\n\t\t\t\tdelegates[_mid] && delete delegates[_mid][event];\n\t\t\t} else if (!callback) { //mui(selector).off(event,selector);\n\t\t\t\tdelegates[_mid] && delegates[_mid][event] && delete delegates[_mid][event][selector];\n\t\t\t} else { //mui(selector).off(event,selector,callback);\n\t\t\t\tvar delegateCallbacks = delegates[_mid] && delegates[_mid][event] && delegates[_mid][event][selector];\n\t\t\t\t$.each(delegateCallbacks, function(index, delegateCallback) {\n\t\t\t\t\tif (mid(delegateCallback) === mid(callback)) {\n\t\t\t\t\t\tdelegateCallbacks.splice(index, 1);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}, true);\n\t\t\t}\n\t\t\tif (delegates[_mid]) {\n\t\t\t\t//如果off掉了所有当前element的指定的event事件，则remove掉当前element的delegate回调\n\t\t\t\tif ((!delegates[_mid][event] || $.isEmptyObject(delegates[_mid][event]))) {\n\t\t\t\t\tfindDelegateFn(this, event).forEach(function(fn) {\n\t\t\t\t\t\tthis.removeEventListener(fn.type, fn);\n\t\t\t\t\t\tdelete delegateFns[_mid][fn.i];\n\t\t\t\t\t}.bind(this));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t//如果delegates[_mid]已不存在，删除所有\n\t\t\t\tfindDelegateFn(this).forEach(function(fn) {\n\t\t\t\t\tthis.removeEventListener(fn.type, fn);\n\t\t\t\t\tdelete delegateFns[_mid][fn.i];\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t});\n\n\t};\n})(mui);\n/**\n * mui target(action>popover>modal>tab>toggle)\n */\n(function($, window, document) {\n\t/**\n\t * targets\n\t */\n\t$.targets = {};\n\t/**\n\t * target handles\n\t */\n\t$.targetHandles = [];\n\t/**\n\t * register target\n\t * @param {type} target\n\t * @returns {$.targets}\n\t */\n\t$.registerTarget = function(target) {\n\n\t\ttarget.index = target.index || 1000;\n\n\t\t$.targetHandles.push(target);\n\n\t\t$.targetHandles.sort(function(a, b) {\n\t\t\treturn a.index - b.index;\n\t\t});\n\n\t\treturn $.targetHandles;\n\t};\n\twindow.addEventListener($.EVENT_START, function(event) {\n\t\tvar target = event.target;\n\t\tvar founds = {};\n\t\tfor (; target && target !== document; target = target.parentNode) {\n\t\t\tvar isFound = false;\n\t\t\t$.each($.targetHandles, function(index, targetHandle) {\n\t\t\t\tvar name = targetHandle.name;\n\t\t\t\tif (!isFound && !founds[name] && targetHandle.hasOwnProperty('handle')) {\n\t\t\t\t\t$.targets[name] = targetHandle.handle(event, target);\n\t\t\t\t\tif ($.targets[name]) {\n\t\t\t\t\t\tfounds[name] = true;\n\t\t\t\t\t\tif (targetHandle.isContinue !== true) {\n\t\t\t\t\t\t\tisFound = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (!founds[name]) {\n\t\t\t\t\t\tif (targetHandle.isReset !== false)\n\t\t\t\t\t\t\t$.targets[name] = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (isFound) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t});\n\twindow.addEventListener('click', function(event) { //解决touch与click的target不一致的问题(比如链接边缘点击时，touch的target为html，而click的target为A)\n\t\tvar target = event.target;\n\t\tvar isFound = false;\n\t\tfor (; target && target !== document; target = target.parentNode) {\n\t\t\tif (target.tagName === 'A') {\n\t\t\t\t$.each($.targetHandles, function(index, targetHandle) {\n\t\t\t\t\tvar name = targetHandle.name;\n\t\t\t\t\tif (targetHandle.hasOwnProperty('handle')) {\n\t\t\t\t\t\tif (targetHandle.handle(event, target)) {\n\t\t\t\t\t\t\tisFound = true;\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (isFound) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n})(mui, window, document);\n/**\n * fixed trim\n * @param {type} undefined\n * @returns {undefined}\n */\n(function(undefined) {\n\tif (String.prototype.trim === undefined) { // fix for iOS 3.2\n\t\tString.prototype.trim = function() {\n\t\t\treturn this.replace(/^\\s+|\\s+$/g, '');\n\t\t};\n\t}\n\tObject.setPrototypeOf = Object.setPrototypeOf || function(obj, proto) {\n\t\tobj['__proto__'] = proto;\n\t\treturn obj;\n\t};\n\n})();\n/**\n * fixed CustomEvent\n */\n(function() {\n\tif (typeof window.CustomEvent === 'undefined') {\n\t\tfunction CustomEvent(event, params) {\n\t\t\tparams = params || {\n\t\t\t\tbubbles: false,\n\t\t\t\tcancelable: false,\n\t\t\t\tdetail: undefined\n\t\t\t};\n\t\t\tvar evt = document.createEvent('Events');\n\t\t\tvar bubbles = true;\n\t\t\tfor (var name in params) {\n\t\t\t\t(name === 'bubbles') ? (bubbles = !!params[name]) : (evt[name] = params[name]);\n\t\t\t}\n\t\t\tevt.initEvent(event, bubbles, true);\n\t\t\treturn evt;\n\t\t};\n\t\tCustomEvent.prototype = window.Event.prototype;\n\t\twindow.CustomEvent = CustomEvent;\n\t}\n})();\n/*\n\tA shim for non ES5 supporting browsers.\n\tAdds function bind to Function prototype, so that you can do partial application.\n\tWorks even with the nasty thing, where the first word is the opposite of extranet, the second one is the profession of Columbus, and the version number is 9, flipped 180 degrees.\n*/\n\nFunction.prototype.bind = Function.prototype.bind || function(to) {\n\t// Make an array of our arguments, starting from second argument\n\tvar partial = Array.prototype.splice.call(arguments, 1),\n\t\t// We'll need the original function.\n\t\tfn = this;\n\tvar bound = function() {\n\t\t\t// Join the already applied arguments to the now called ones (after converting to an array again).\n\t\t\tvar args = partial.concat(Array.prototype.splice.call(arguments, 0));\n\t\t\t// If not being called as a constructor\n\t\t\tif (!(this instanceof bound)) {\n\t\t\t\t// return the result of the function called bound to target and partially applied.\n\t\t\t\treturn fn.apply(to, args);\n\t\t\t}\n\t\t\t// If being called as a constructor, apply the function bound to self.\n\t\t\tfn.apply(this, args);\n\t\t}\n\t\t// Attach the prototype of the function to our newly created function.\n\tbound.prototype = fn.prototype;\n\treturn bound;\n};\n/**\n * mui fixed classList\n * @param {type} document\n * @returns {undefined}\n */\n(function(document) {\n    if (!(\"classList\" in document.documentElement) && Object.defineProperty && typeof HTMLElement !== 'undefined') {\n\n        Object.defineProperty(HTMLElement.prototype, 'classList', {\n            get: function() {\n                var self = this;\n                function update(fn) {\n                    return function(value) {\n                        var classes = self.className.split(/\\s+/),\n                                index = classes.indexOf(value);\n\n                        fn(classes, index, value);\n                        self.className = classes.join(\" \");\n                    };\n                }\n\n                var ret = {\n                    add: update(function(classes, index, value) {\n                        ~index || classes.push(value);\n                    }),\n                    remove: update(function(classes, index) {\n                        ~index && classes.splice(index, 1);\n                    }),\n                    toggle: update(function(classes, index, value) {\n                        ~index ? classes.splice(index, 1) : classes.push(value);\n                    }),\n                    contains: function(value) {\n                        return !!~self.className.split(/\\s+/).indexOf(value);\n                    },\n                    item: function(i) {\n                        return self.className.split(/\\s+/)[i] || null;\n                    }\n                };\n\n                Object.defineProperty(ret, 'length', {\n                    get: function() {\n                        return self.className.split(/\\s+/).length;\n                    }\n                });\n\n                return ret;\n            }\n        });\n    }\n})(document);\n\n/**\n * mui fixed requestAnimationFrame\n * @param {type} window\n * @returns {undefined}\n */\n(function(window) {\n\tif (!window.requestAnimationFrame) {\n\t\tvar lastTime = 0;\n\t\twindow.requestAnimationFrame = window.webkitRequestAnimationFrame || function(callback, element) {\n\t\t\tvar currTime = new Date().getTime();\n\t\t\tvar timeToCall = Math.max(0, 16.7 - (currTime - lastTime));\n\t\t\tvar id = window.setTimeout(function() {\n\t\t\t\tcallback(currTime + timeToCall);\n\t\t\t}, timeToCall);\n\t\t\tlastTime = currTime + timeToCall;\n\t\t\treturn id;\n\t\t};\n\t\twindow.cancelAnimationFrame = window.webkitCancelAnimationFrame || window.webkitCancelRequestAnimationFrame || function(id) {\n\t\t\tclearTimeout(id);\n\t\t};\n\t};\n}(window));\n/**\n * fastclick(only for radio,checkbox)\n */\n(function($, window, name) {\n\tif (!$.os.android && !$.os.ios) { //目前仅识别android和ios\n\t\treturn;\n\t}\n\tif (window.FastClick) {\n\t\treturn;\n\t}\n\n\tvar handle = function(event, target) {\n\t\tif (target.tagName === 'LABEL') {\n\t\t\tif (target.parentNode) {\n\t\t\t\ttarget = target.parentNode.querySelector('input');\n\t\t\t}\n\t\t}\n\t\tif (target && (target.type === 'radio' || target.type === 'checkbox')) {\n\t\t\tif (!target.disabled) { //disabled\n\t\t\t\treturn target;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t};\n\n\t$.registerTarget({\n\t\tname: name,\n\t\tindex: 40,\n\t\thandle: handle,\n\t\ttarget: false\n\t});\n\tvar dispatchEvent = function(event) {\n\t\tvar targetElement = $.targets.click;\n\t\tif (targetElement) {\n\t\t\tvar clickEvent, touch;\n\t\t\t// On some Android devices activeElement needs to be blurred otherwise the synthetic click will have no effect\n\t\t\tif (document.activeElement && document.activeElement !== targetElement) {\n\t\t\t\tdocument.activeElement.blur();\n\t\t\t}\n\t\t\ttouch = event.detail.gesture.changedTouches[0];\n\t\t\t// Synthesise a click event, with an extra attribute so it can be tracked\n\t\t\tclickEvent = document.createEvent('MouseEvents');\n\t\t\tclickEvent.initMouseEvent('click', true, true, window, 1, touch.screenX, touch.screenY, touch.clientX, touch.clientY, false, false, false, false, 0, null);\n\t\t\tclickEvent.forwardedTouchEvent = true;\n\t\t\ttargetElement.dispatchEvent(clickEvent);\n\t\t\tevent.detail && event.detail.gesture.preventDefault();\n\t\t}\n\t};\n\twindow.addEventListener('tap', dispatchEvent);\n\twindow.addEventListener('doubletap', dispatchEvent);\n\t//捕获\n\twindow.addEventListener('click', function(event) {\n\t\tif ($.targets.click) {\n\t\t\tif (!event.forwardedTouchEvent) { //stop click\n\t\t\t\tif (event.stopImmediatePropagation) {\n\t\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\t} else {\n\t\t\t\t\t// Part of the hack for browsers that don't support Event#stopImmediatePropagation\n\t\t\t\t\tevent.propagationStopped = true;\n\t\t\t\t}\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}, true);\n\n})(mui, window, 'click');\n(function($, document) {\n\t$(function() {\n\t\tif (!$.os.ios) {\n\t\t\treturn;\n\t\t}\n\t\tvar CLASS_FOCUSIN = 'mui-focusin';\n\t\tvar CLASS_BAR_TAB = 'mui-bar-tab';\n\t\tvar CLASS_BAR_FOOTER = 'mui-bar-footer';\n\t\tvar CLASS_BAR_FOOTER_SECONDARY = 'mui-bar-footer-secondary';\n\t\tvar CLASS_BAR_FOOTER_SECONDARY_TAB = 'mui-bar-footer-secondary-tab';\n\t\t// var content = document.querySelector('.' + CLASS_CONTENT);\n\t\t// if (content) {\n\t\t// \tdocument.body.insertBefore(content, document.body.firstElementChild);\n\t\t// }\n\t\tdocument.addEventListener('focusin', function(e) {\n\t\t\tif ($.os.plus) { //在父webview里边不fix\n\t\t\t\tif (window.plus) {\n\t\t\t\t\tif (plus.webview.currentWebview().children().length > 0) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar target = e.target;\n\t\t\t//TODO 需考虑所有键盘弹起的情况\n\t\t\tif (target.tagName && (target.tagName === 'TEXTAREA' || (target.tagName === 'INPUT' && (target.type === 'text' || target.type === 'search' || target.type === 'number')))) {\n\t\t\t\tif (target.disabled || target.readOnly) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tdocument.body.classList.add(CLASS_FOCUSIN);\n\t\t\t\tvar isFooter = false;\n\t\t\t\tfor (; target && target !== document; target = target.parentNode) {\n\t\t\t\t\tvar classList = target.classList;\n\t\t\t\t\tif (classList && classList.contains(CLASS_BAR_TAB) || classList.contains(CLASS_BAR_FOOTER) || classList.contains(CLASS_BAR_FOOTER_SECONDARY) || classList.contains(CLASS_BAR_FOOTER_SECONDARY_TAB)) {\n\t\t\t\t\t\tisFooter = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (isFooter) {\n\t\t\t\t\tvar scrollTop = document.body.scrollHeight;\n\t\t\t\t\tvar scrollLeft = document.body.scrollLeft;\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\twindow.scrollTo(scrollLeft, scrollTop);\n\t\t\t\t\t}, 20);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tdocument.addEventListener('focusout', function(e) {\n\t\t\tvar classList = document.body.classList;\n\t\t\tif (classList.contains(CLASS_FOCUSIN)) {\n\t\t\t\tclassList.remove(CLASS_FOCUSIN);\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\twindow.scrollTo(document.body.scrollLeft, document.body.scrollTop);\n\t\t\t\t}, 20);\n\t\t\t}\n\t\t});\n\t});\n})(mui, document);\n/**\n * mui namespace(optimization)\n * @param {type} $\n * @returns {undefined}\n */\n(function($) {\n\t$.namespace = 'mui';\n\t$.classNamePrefix = $.namespace + '-';\n\t$.classSelectorPrefix = '.' + $.classNamePrefix;\n\t/**\n\t * 返回正确的className\n\t * @param {type} className\n\t * @returns {String}\n\t */\n\t$.className = function(className) {\n\t\treturn $.classNamePrefix + className;\n\t};\n\t/**\n\t * 返回正确的classSelector\n\t * @param {type} classSelector\n\t * @returns {String}\n\t */\n\t$.classSelector = function(classSelector) {\n\t\treturn classSelector.replace(/\\./g, $.classSelectorPrefix);\n\t};\n\t/**\n         * 返回正确的eventName\n         * @param {type} event\n         * @param {type} module\n         * @returns {String}\n         */\n\t$.eventName = function(event, module) {\n\t\treturn event + ($.namespace ? ('.' + $.namespace) : '') + ( module ? ('.' + module) : '');\n\t};\n})(mui);\n\n/**\n * mui gestures\n * @param {type} $\n * @param {type} window\n * @returns {undefined}\n */\n(function($, window) {\n\t$.gestures = {\n\t\tsession: {}\n\t};\n\t/**\n\t * Gesture preventDefault\n\t * @param {type} e\n\t * @returns {undefined}\n\t */\n\t$.preventDefault = function(e) {\n\t\te.preventDefault();\n\t};\n\t/**\n\t * Gesture stopPropagation\n\t * @param {type} e\n\t * @returns {undefined}\n\t */\n\t$.stopPropagation = function(e) {\n\t\te.stopPropagation();\n\t};\n\n\t/**\n\t * register gesture\n\t * @param {type} gesture\n\t * @returns {$.gestures}\n\t */\n\t$.addGesture = function(gesture) {\n\t\treturn $.addAction('gestures', gesture);\n\n\t};\n\n\tvar round = Math.round;\n\tvar abs = Math.abs;\n\tvar sqrt = Math.sqrt;\n\tvar atan = Math.atan;\n\tvar atan2 = Math.atan2;\n\t/**\n\t * distance\n\t * @param {type} p1\n\t * @param {type} p2\n\t * @returns {Number}\n\t */\n\tvar getDistance = function(p1, p2, props) {\n\t\tif(!props) {\n\t\t\tprops = ['x', 'y'];\n\t\t}\n\t\tvar x = p2[props[0]] - p1[props[0]];\n\t\tvar y = p2[props[1]] - p1[props[1]];\n\t\treturn sqrt((x * x) + (y * y));\n\t};\n\t/**\n\t * scale\n\t * @param {Object} starts\n\t * @param {Object} moves\n\t */\n\tvar getScale = function(starts, moves) {\n\t\tif(starts.length >= 2 && moves.length >= 2) {\n\t\t\tvar props = ['pageX', 'pageY'];\n\t\t\treturn getDistance(moves[1], moves[0], props) / getDistance(starts[1], starts[0], props);\n\t\t}\n\t\treturn 1;\n\t};\n\t/**\n\t * angle\n\t * @param {type} p1\n\t * @param {type} p2\n\t * @returns {Number}\n\t */\n\tvar getAngle = function(p1, p2, props) {\n\t\tif(!props) {\n\t\t\tprops = ['x', 'y'];\n\t\t}\n\t\tvar x = p2[props[0]] - p1[props[0]];\n\t\tvar y = p2[props[1]] - p1[props[1]];\n\t\treturn atan2(y, x) * 180 / Math.PI;\n\t};\n\t/**\n\t * direction\n\t * @param {Object} x\n\t * @param {Object} y\n\t */\n\tvar getDirection = function(x, y) {\n\t\tif(x === y) {\n\t\t\treturn '';\n\t\t}\n\t\tif(abs(x) >= abs(y)) {\n\t\t\treturn x > 0 ? 'left' : 'right';\n\t\t}\n\t\treturn y > 0 ? 'up' : 'down';\n\t};\n\t/**\n\t * rotation\n\t * @param {Object} start\n\t * @param {Object} end\n\t */\n\tvar getRotation = function(start, end) {\n\t\tvar props = ['pageX', 'pageY'];\n\t\treturn getAngle(end[1], end[0], props) - getAngle(start[1], start[0], props);\n\t};\n\t/**\n\t * px per ms\n\t * @param {Object} deltaTime\n\t * @param {Object} x\n\t * @param {Object} y\n\t */\n\tvar getVelocity = function(deltaTime, x, y) {\n\t\treturn {\n\t\t\tx: x / deltaTime || 0,\n\t\t\ty: y / deltaTime || 0\n\t\t};\n\t};\n\t/**\n\t * detect gestures\n\t * @param {type} event\n\t * @param {type} touch\n\t * @returns {undefined}\n\t */\n\tvar detect = function(event, touch) {\n\t\tif($.gestures.stoped) {\n\t\t\treturn;\n\t\t}\n\t\t$.doAction('gestures', function(index, gesture) {\n\t\t\tif(!$.gestures.stoped) {\n\t\t\t\tif($.options.gestureConfig[gesture.name] !== false) {\n\t\t\t\t\tgesture.handle(event, touch);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\t/**\n\t * 暂时无用\n\t * @param {Object} node\n\t * @param {Object} parent\n\t */\n\tvar hasParent = function(node, parent) {\n\t\twhile(node) {\n\t\t\tif(node == parent) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tnode = node.parentNode;\n\t\t}\n\t\treturn false;\n\t};\n\n\tvar uniqueArray = function(src, key, sort) {\n\t\tvar results = [];\n\t\tvar values = [];\n\t\tvar i = 0;\n\n\t\twhile(i < src.length) {\n\t\t\tvar val = key ? src[i][key] : src[i];\n\t\t\tif(values.indexOf(val) < 0) {\n\t\t\t\tresults.push(src[i]);\n\t\t\t}\n\t\t\tvalues[i] = val;\n\t\t\ti++;\n\t\t}\n\n\t\tif(sort) {\n\t\t\tif(!key) {\n\t\t\t\tresults = results.sort();\n\t\t\t} else {\n\t\t\t\tresults = results.sort(function sortUniqueArray(a, b) {\n\t\t\t\t\treturn a[key] > b[key];\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn results;\n\t};\n\tvar getMultiCenter = function(touches) {\n\t\tvar touchesLength = touches.length;\n\t\tif(touchesLength === 1) {\n\t\t\treturn {\n\t\t\t\tx: round(touches[0].pageX),\n\t\t\t\ty: round(touches[0].pageY)\n\t\t\t};\n\t\t}\n\n\t\tvar x = 0;\n\t\tvar y = 0;\n\t\tvar i = 0;\n\t\twhile(i < touchesLength) {\n\t\t\tx += touches[i].pageX;\n\t\t\ty += touches[i].pageY;\n\t\t\ti++;\n\t\t}\n\n\t\treturn {\n\t\t\tx: round(x / touchesLength),\n\t\t\ty: round(y / touchesLength)\n\t\t};\n\t};\n\tvar multiTouch = function() {\n\t\treturn $.options.gestureConfig.pinch;\n\t};\n\tvar copySimpleTouchData = function(touch) {\n\t\tvar touches = [];\n\t\tvar i = 0;\n\t\twhile(i < touch.touches.length) {\n\t\t\ttouches[i] = {\n\t\t\t\tpageX: round(touch.touches[i].pageX),\n\t\t\t\tpageY: round(touch.touches[i].pageY)\n\t\t\t};\n\t\t\ti++;\n\t\t}\n\t\treturn {\n\t\t\ttimestamp: $.now(),\n\t\t\tgesture: touch.gesture,\n\t\t\ttouches: touches,\n\t\t\tcenter: getMultiCenter(touch.touches),\n\t\t\tdeltaX: touch.deltaX,\n\t\t\tdeltaY: touch.deltaY\n\t\t};\n\t};\n\n\tvar calDelta = function(touch) {\n\t\tvar session = $.gestures.session;\n\t\tvar center = touch.center;\n\t\tvar offset = session.offsetDelta || {};\n\t\tvar prevDelta = session.prevDelta || {};\n\t\tvar prevTouch = session.prevTouch || {};\n\n\t\tif(touch.gesture.type === $.EVENT_START || touch.gesture.type === $.EVENT_END) {\n\t\t\tprevDelta = session.prevDelta = {\n\t\t\t\tx: prevTouch.deltaX || 0,\n\t\t\t\ty: prevTouch.deltaY || 0\n\t\t\t};\n\n\t\t\toffset = session.offsetDelta = {\n\t\t\t\tx: center.x,\n\t\t\t\ty: center.y\n\t\t\t};\n\t\t}\n\t\ttouch.deltaX = prevDelta.x + (center.x - offset.x);\n\t\ttouch.deltaY = prevDelta.y + (center.y - offset.y);\n\t};\n\tvar calTouchData = function(touch) {\n\t\tvar session = $.gestures.session;\n\t\tvar touches = touch.touches;\n\t\tvar touchesLength = touches.length;\n\n\t\tif(!session.firstTouch) {\n\t\t\tsession.firstTouch = copySimpleTouchData(touch);\n\t\t}\n\n\t\tif(multiTouch() && touchesLength > 1 && !session.firstMultiTouch) {\n\t\t\tsession.firstMultiTouch = copySimpleTouchData(touch);\n\t\t} else if(touchesLength === 1) {\n\t\t\tsession.firstMultiTouch = false;\n\t\t}\n\n\t\tvar firstTouch = session.firstTouch;\n\t\tvar firstMultiTouch = session.firstMultiTouch;\n\t\tvar offsetCenter = firstMultiTouch ? firstMultiTouch.center : firstTouch.center;\n\n\t\tvar center = touch.center = getMultiCenter(touches);\n\t\ttouch.timestamp = $.now();\n\t\ttouch.deltaTime = touch.timestamp - firstTouch.timestamp;\n\n\t\ttouch.angle = getAngle(offsetCenter, center);\n\t\ttouch.distance = getDistance(offsetCenter, center);\n\n\t\tcalDelta(touch);\n\n\t\ttouch.offsetDirection = getDirection(touch.deltaX, touch.deltaY);\n\n\t\ttouch.scale = firstMultiTouch ? getScale(firstMultiTouch.touches, touches) : 1;\n\t\ttouch.rotation = firstMultiTouch ? getRotation(firstMultiTouch.touches, touches) : 0;\n\n\t\tcalIntervalTouchData(touch);\n\n\t};\n\tvar CAL_INTERVAL = 25;\n\tvar calIntervalTouchData = function(touch) {\n\t\tvar session = $.gestures.session;\n\t\tvar last = session.lastInterval || touch;\n\t\tvar deltaTime = touch.timestamp - last.timestamp;\n\t\tvar velocity;\n\t\tvar velocityX;\n\t\tvar velocityY;\n\t\tvar direction;\n\n\t\tif(touch.gesture.type != $.EVENT_CANCEL && (deltaTime > CAL_INTERVAL || last.velocity === undefined)) {\n\t\t\tvar deltaX = last.deltaX - touch.deltaX;\n\t\t\tvar deltaY = last.deltaY - touch.deltaY;\n\n\t\t\tvar v = getVelocity(deltaTime, deltaX, deltaY);\n\t\t\tvelocityX = v.x;\n\t\t\tvelocityY = v.y;\n\t\t\tvelocity = (abs(v.x) > abs(v.y)) ? v.x : v.y;\n\t\t\tdirection = getDirection(deltaX, deltaY) || last.direction;\n\n\t\t\tsession.lastInterval = touch;\n\t\t} else {\n\t\t\tvelocity = last.velocity;\n\t\t\tvelocityX = last.velocityX;\n\t\t\tvelocityY = last.velocityY;\n\t\t\tdirection = last.direction;\n\t\t}\n\n\t\ttouch.velocity = velocity;\n\t\ttouch.velocityX = velocityX;\n\t\ttouch.velocityY = velocityY;\n\t\ttouch.direction = direction;\n\t};\n\tvar targetIds = {};\n\tvar convertTouches = function(touches) {\n\t\tfor(var i = 0; i < touches.length; i++) {\n\t\t\t!touches['identifier'] && (touches['identifier'] = 0);\n\t\t}\n\t\treturn touches;\n\t};\n\tvar getTouches = function(event, touch) {\n\t\tvar allTouches = convertTouches($.slice.call(event.touches || [event]));\n\n\t\tvar type = event.type;\n\n\t\tvar targetTouches = [];\n\t\tvar changedTargetTouches = [];\n\n\t\t//当touchstart或touchmove且touches长度为1，直接获得all和changed\n\t\tif((type === $.EVENT_START || type === $.EVENT_MOVE) && allTouches.length === 1) {\n\t\t\ttargetIds[allTouches[0].identifier] = true;\n\t\t\ttargetTouches = allTouches;\n\t\t\tchangedTargetTouches = allTouches;\n\t\t\ttouch.target = event.target;\n\t\t} else {\n\t\t\tvar i = 0;\n\t\t\tvar targetTouches = [];\n\t\t\tvar changedTargetTouches = [];\n\t\t\tvar changedTouches = convertTouches($.slice.call(event.changedTouches || [event]));\n\n\t\t\ttouch.target = event.target;\n\t\t\tvar sessionTarget = $.gestures.session.target || event.target;\n\t\t\ttargetTouches = allTouches.filter(function(touch) {\n\t\t\t\treturn hasParent(touch.target, sessionTarget);\n\t\t\t});\n\n\t\t\tif(type === $.EVENT_START) {\n\t\t\t\ti = 0;\n\t\t\t\twhile(i < targetTouches.length) {\n\t\t\t\t\ttargetIds[targetTouches[i].identifier] = true;\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ti = 0;\n\t\t\twhile(i < changedTouches.length) {\n\t\t\t\tif(targetIds[changedTouches[i].identifier]) {\n\t\t\t\t\tchangedTargetTouches.push(changedTouches[i]);\n\t\t\t\t}\n\t\t\t\tif(type === $.EVENT_END || type === $.EVENT_CANCEL) {\n\t\t\t\t\tdelete targetIds[changedTouches[i].identifier];\n\t\t\t\t}\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\tif(!changedTargetTouches.length) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\ttargetTouches = uniqueArray(targetTouches.concat(changedTargetTouches), 'identifier', true);\n\t\tvar touchesLength = targetTouches.length;\n\t\tvar changedTouchesLength = changedTargetTouches.length;\n\t\tif(type === $.EVENT_START && touchesLength - changedTouchesLength === 0) { //first\n\t\t\ttouch.isFirst = true;\n\t\t\t$.gestures.touch = $.gestures.session = {\n\t\t\t\ttarget: event.target\n\t\t\t};\n\t\t}\n\t\ttouch.isFinal = ((type === $.EVENT_END || type === $.EVENT_CANCEL) && (touchesLength - changedTouchesLength === 0));\n\n\t\ttouch.touches = targetTouches;\n\t\ttouch.changedTouches = changedTargetTouches;\n\t\treturn true;\n\n\t};\n\tvar handleTouchEvent = function(event) {\n\t\tvar touch = {\n\t\t\tgesture: event\n\t\t};\n\t\tvar touches = getTouches(event, touch);\n\t\tif(!touches) {\n\t\t\treturn;\n\t\t}\n\t\tcalTouchData(touch);\n\t\tdetect(event, touch);\n\t\t$.gestures.session.prevTouch = touch;\n\t\tif(event.type === $.EVENT_END && !$.isTouchable) {\n\t\t\t$.gestures.touch = $.gestures.session = {};\n\t\t}\n\t};\n\tvar supportsPassive = (function checkPassiveListener() {\n\t\tvar supportsPassive = false;\n\t\ttry {\n\t\t\tvar opts = Object.defineProperty({}, 'passive', {\n\t\t\t\tget: function get() {\n\t\t\t\t\tsupportsPassive = true;\n\t\t\t\t},\n\t\t\t});\n\t\t\twindow.addEventListener('testPassiveListener', null, opts);\n\t\t} catch(e) {\n\t\t\t// No support\n\t\t}\n\t\treturn supportsPassive;\n\t}())\n\twindow.addEventListener($.EVENT_START, handleTouchEvent);\n\twindow.addEventListener($.EVENT_MOVE, handleTouchEvent, supportsPassive ? {\n\t\tpassive: false,\n\t\tcapture: false\n\t} : false);\n\twindow.addEventListener($.EVENT_END, handleTouchEvent);\n\twindow.addEventListener($.EVENT_CANCEL, handleTouchEvent);\n\t//fixed hashchange(android)\n\twindow.addEventListener($.EVENT_CLICK, function(e) {\n\t\t//TODO 应该判断当前target是不是在targets.popover内部，而不是非要相等\n\t\tif(($.os.android || $.os.ios) && (($.targets.popover && e.target === $.targets.popover) || ($.targets.tab) || $.targets.offcanvas || $.targets.modal)) {\n\t\t\te.preventDefault();\n\t\t}\n\t}, true);\n\n\t//增加原生滚动识别\n\t$.isScrolling = false;\n\tvar scrollingTimeout = null;\n\twindow.addEventListener('scroll', function() {\n\t\t$.isScrolling = true;\n\t\tscrollingTimeout && clearTimeout(scrollingTimeout);\n\t\tscrollingTimeout = setTimeout(function() {\n\t\t\t$.isScrolling = false;\n\t\t}, 250);\n\t});\n})(mui, window);\n/**\n * mui gesture flick[left|right|up|down]\n * @param {type} $\n * @param {type} name\n * @returns {undefined}\n */\n(function($, name) {\n\tvar flickStartTime = 0;\n\tvar handle = function(event, touch) {\n\t\tvar session = $.gestures.session;\n\t\tvar options = this.options;\n\t\tvar now = $.now();\n\t\tswitch (event.type) {\n\t\t\tcase $.EVENT_MOVE:\n\t\t\t\tif (now - flickStartTime > 300) {\n\t\t\t\t\tflickStartTime = now;\n\t\t\t\t\tsession.flickStart = touch.center;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase $.EVENT_END:\n\t\t\tcase $.EVENT_CANCEL:\n\t\t\t\ttouch.flick = false;\n\t\t\t\tif (session.flickStart && options.flickMaxTime > (now - flickStartTime) && touch.distance > options.flickMinDistince) {\n\t\t\t\t\ttouch.flick = true;\n\t\t\t\t\ttouch.flickTime = now - flickStartTime;\n\t\t\t\t\ttouch.flickDistanceX = touch.center.x - session.flickStart.x;\n\t\t\t\t\ttouch.flickDistanceY = touch.center.y - session.flickStart.y;\n\t\t\t\t\t$.trigger(session.target, name, touch);\n\t\t\t\t\t$.trigger(session.target, name + touch.direction, touch);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t};\n\t/**\n\t * mui gesture flick\n\t */\n\t$.addGesture({\n\t\tname: name,\n\t\tindex: 5,\n\t\thandle: handle,\n\t\toptions: {\n\t\t\tflickMaxTime: 200,\n\t\t\tflickMinDistince: 10\n\t\t}\n\t});\n})(mui, 'flick');\n/**\n * mui gesture swipe[left|right|up|down]\n * @param {type} $\n * @param {type} name\n * @returns {undefined}\n */\n(function($, name) {\n\tvar handle = function(event, touch) {\n\t\tvar session = $.gestures.session;\n\t\tif (event.type === $.EVENT_END || event.type === $.EVENT_CANCEL) {\n\t\t\tvar options = this.options;\n\t\t\ttouch.swipe = false;\n\t\t\t//TODO 后续根据velocity计算\n\t\t\tif (touch.direction && options.swipeMaxTime > touch.deltaTime && touch.distance > options.swipeMinDistince) {\n\t\t\t\ttouch.swipe = true;\n\t\t\t\t$.trigger(session.target, name, touch);\n\t\t\t\t$.trigger(session.target, name + touch.direction, touch);\n\t\t\t}\n\t\t}\n\t};\n\t/**\n\t * mui gesture swipe\n\t */\n\t$.addGesture({\n\t\tname: name,\n\t\tindex: 10,\n\t\thandle: handle,\n\t\toptions: {\n\t\t\tswipeMaxTime: 300,\n\t\t\tswipeMinDistince: 18\n\t\t}\n\t});\n})(mui, 'swipe');\n/**\n * mui gesture drag[start|left|right|up|down|end]\n * @param {type} $\n * @param {type} name\n * @returns {undefined}\n */\n(function($, name) {\n\tvar handle = function(event, touch) {\n\t\tvar session = $.gestures.session;\n\t\tswitch (event.type) {\n\t\t\tcase $.EVENT_START:\n\t\t\t\tbreak;\n\t\t\tcase $.EVENT_MOVE:\n\t\t\t\tif (!touch.direction || !session.target) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t//修正direction,可在session期间自行锁定拖拽方向，方便开发scroll类不同方向拖拽插件嵌套\n\t\t\t\tif (session.lockDirection && session.startDirection) {\n\t\t\t\t\tif (session.startDirection && session.startDirection !== touch.direction) {\n\t\t\t\t\t\tif (session.startDirection === 'up' || session.startDirection === 'down') {\n\t\t\t\t\t\t\ttouch.direction = touch.deltaY < 0 ? 'up' : 'down';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttouch.direction = touch.deltaX < 0 ? 'left' : 'right';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!session.drag) {\n\t\t\t\t\tsession.drag = true;\n\t\t\t\t\t$.trigger(session.target, name + 'start', touch);\n\t\t\t\t}\n\t\t\t\t$.trigger(session.target, name, touch);\n\t\t\t\t$.trigger(session.target, name + touch.direction, touch);\n\t\t\t\tbreak;\n\t\t\tcase $.EVENT_END:\n\t\t\tcase $.EVENT_CANCEL:\n\t\t\t\tif (session.drag && touch.isFinal) {\n\t\t\t\t\t$.trigger(session.target, name + 'end', touch);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t};\n\t/**\n\t * mui gesture drag\n\t */\n\t$.addGesture({\n\t\tname: name,\n\t\tindex: 20,\n\t\thandle: handle,\n\t\toptions: {\n\t\t\tfingers: 1\n\t\t}\n\t});\n})(mui, 'drag');\n/**\n * mui gesture tap and doubleTap\n * @param {type} $\n * @param {type} name\n * @returns {undefined}\n */\n(function($, name) {\n\tvar lastTarget;\n\tvar lastTapTime;\n\tvar handle = function(event, touch) {\n\t\tvar session = $.gestures.session;\n\t\tvar options = this.options;\n\t\tswitch (event.type) {\n\t\t\tcase $.EVENT_END:\n\t\t\t\tif (!touch.isFinal) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar target = session.target;\n\t\t\t\tif (!target || (target.disabled || (target.classList && target.classList.contains('mui-disabled')))) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (touch.distance < options.tapMaxDistance && touch.deltaTime < options.tapMaxTime) {\n\t\t\t\t\tif ($.options.gestureConfig.doubletap && lastTarget && (lastTarget === target)) { //same target\n\t\t\t\t\t\tif (lastTapTime && (touch.timestamp - lastTapTime) < options.tapMaxInterval) {\n\t\t\t\t\t\t\t$.trigger(target, 'doubletap', touch);\n\t\t\t\t\t\t\tlastTapTime = $.now();\n\t\t\t\t\t\t\tlastTarget = target;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t$.trigger(target, name, touch);\n\t\t\t\t\tlastTapTime = $.now();\n\t\t\t\t\tlastTarget = target;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t};\n\t/**\n\t * mui gesture tap\n\t */\n\t$.addGesture({\n\t\tname: name,\n\t\tindex: 30,\n\t\thandle: handle,\n\t\toptions: {\n\t\t\tfingers: 1,\n\t\t\ttapMaxInterval: 300,\n\t\t\ttapMaxDistance: 5,\n\t\t\ttapMaxTime: 250\n\t\t}\n\t});\n})(mui, 'tap');\n/**\n * mui gesture longtap\n * @param {type} $\n * @param {type} name\n * @returns {undefined}\n */\n(function($, name) {\n\tvar timer;\n\tvar handle = function(event, touch) {\n\t\tvar session = $.gestures.session;\n\t\tvar options = this.options;\n\t\tswitch (event.type) {\n\t\t\tcase $.EVENT_START:\n\t\t\t\tclearTimeout(timer);\n\t\t\t\ttimer = setTimeout(function() {\n\t\t\t\t\t$.trigger(session.target, name, touch);\n\t\t\t\t}, options.holdTimeout);\n\t\t\t\tbreak;\n\t\t\tcase $.EVENT_MOVE:\n\t\t\t\tif (touch.distance > options.holdThreshold) {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase $.EVENT_END:\n\t\t\tcase $.EVENT_CANCEL:\n\t\t\t\tclearTimeout(timer);\n\t\t\t\tbreak;\n\t\t}\n\t};\n\t/**\n\t * mui gesture longtap\n\t */\n\t$.addGesture({\n\t\tname: name,\n\t\tindex: 10,\n\t\thandle: handle,\n\t\toptions: {\n\t\t\tfingers: 1,\n\t\t\tholdTimeout: 500,\n\t\t\tholdThreshold: 2\n\t\t}\n\t});\n})(mui, 'longtap');\n/**\n * mui gesture hold\n * @param {type} $\n * @param {type} name\n * @returns {undefined}\n */\n(function($, name) {\n\tvar timer;\n\tvar handle = function(event, touch) {\n\t\tvar session = $.gestures.session;\n\t\tvar options = this.options;\n\t\tswitch (event.type) {\n\t\t\tcase $.EVENT_START:\n\t\t\t\tif ($.options.gestureConfig.hold) {\n\t\t\t\t\ttimer && clearTimeout(timer);\n\t\t\t\t\ttimer = setTimeout(function() {\n\t\t\t\t\t\ttouch.hold = true;\n\t\t\t\t\t\t$.trigger(session.target, name, touch);\n\t\t\t\t\t}, options.holdTimeout);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase $.EVENT_MOVE:\n\t\t\t\tbreak;\n\t\t\tcase $.EVENT_END:\n\t\t\tcase $.EVENT_CANCEL:\n\t\t\t\tif (timer) {\n\t\t\t\t\tclearTimeout(timer) && (timer = null);\n\t\t\t\t\t$.trigger(session.target, 'release', touch);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t};\n\t/**\n\t * mui gesture hold\n\t */\n\t$.addGesture({\n\t\tname: name,\n\t\tindex: 10,\n\t\thandle: handle,\n\t\toptions: {\n\t\t\tfingers: 1,\n\t\t\tholdTimeout: 0\n\t\t}\n\t});\n})(mui, 'hold');\n/**\n * mui gesture pinch\n * @param {type} $\n * @param {type} name\n * @returns {undefined}\n */\n(function($, name) {\n\tvar handle = function(event, touch) {\n\t\tvar options = this.options;\n\t\tvar session = $.gestures.session;\n\t\tswitch (event.type) {\n\t\t\tcase $.EVENT_START:\n\t\t\t\tbreak;\n\t\t\tcase $.EVENT_MOVE:\n\t\t\t\tif ($.options.gestureConfig.pinch) {\n\t\t\t\t\tif (touch.touches.length < 2) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (!session.pinch) { //start\n\t\t\t\t\t\tsession.pinch = true;\n\t\t\t\t\t\t$.trigger(session.target, name + 'start', touch);\n\t\t\t\t\t}\n\t\t\t\t\t$.trigger(session.target, name, touch);\n\t\t\t\t\tvar scale = touch.scale;\n\t\t\t\t\tvar rotation = touch.rotation;\n\t\t\t\t\tvar lastScale = typeof touch.lastScale === 'undefined' ? 1 : touch.lastScale;\n\t\t\t\t\tvar scaleDiff = 0.000000000001; //防止scale与lastScale相等，不触发事件的情况。\n\t\t\t\t\tif (scale > lastScale) { //out\n\t\t\t\t\t\tlastScale = scale - scaleDiff;\n\t\t\t\t\t\t$.trigger(session.target, name + 'out', touch);\n\t\t\t\t\t} //in\n\t\t\t\t\telse if (scale < lastScale) {\n\t\t\t\t\t\tlastScale = scale + scaleDiff;\n\t\t\t\t\t\t$.trigger(session.target, name + 'in', touch);\n\t\t\t\t\t}\n\t\t\t\t\tif (Math.abs(rotation) > options.minRotationAngle) {\n\t\t\t\t\t\t$.trigger(session.target, 'rotate', touch);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase $.EVENT_END:\n\t\t\tcase $.EVENT_CANCEL:\n\t\t\t\tif ($.options.gestureConfig.pinch && session.pinch && touch.touches.length === 2) {\n\t\t\t\t\tsession.pinch = false;\n\t\t\t\t\t$.trigger(session.target, name + 'end', touch);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t};\n\t/**\n\t * mui gesture pinch\n\t */\n\t$.addGesture({\n\t\tname: name,\n\t\tindex: 10,\n\t\thandle: handle,\n\t\toptions: {\n\t\t\tminRotationAngle: 0\n\t\t}\n\t});\n})(mui, 'pinch');\n/**\n * mui.init\n * @param {type} $\n * @returns {undefined}\n */\n(function($) {\n\t$.global = $.options = {\n\t\tgestureConfig: {\n\t\t\ttap: true,\n\t\t\tdoubletap: false,\n\t\t\tlongtap: false,\n\t\t\thold: false,\n\t\t\tflick: true,\n\t\t\tswipe: true,\n\t\t\tdrag: true,\n\t\t\tpinch: false\n\t\t}\n\t};\n\t/**\n\t *\n\t * @param {type} options\n\t * @returns {undefined}\n\t */\n\t$.initGlobal = function(options) {\n\t\t$.options = $.extend(true, $.global, options);\n\t\treturn this;\n\t};\n\tvar inits = {};\n\n\t/**\n\t * 单页配置 初始化\n\t * @param {object} options\n\t */\n\t$.init = function(options) {\n\t\t$.options = $.extend(true, $.global, options || {});\n\t\t$.ready(function() {\n\t\t\t$.doAction('inits', function(index, init) {\n\t\t\t\tvar isInit = !!(!inits[init.name] || init.repeat);\n\t\t\t\tif (isInit) {\n\t\t\t\t\tinit.handle.call($);\n\t\t\t\t\tinits[init.name] = true;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\treturn this;\n\t};\n\n\t/**\n\t * 增加初始化执行流程\n\t * @param {function} init\n\t */\n\t$.addInit = function(init) {\n\t\treturn $.addAction('inits', init);\n\t};\n\t/**\n\t * 处理html5版本subpages \n\t */\n\t$.addInit({\n\t\tname: 'iframe',\n\t\tindex: 100,\n\t\thandle: function() {\n\t\t\tvar options = $.options;\n\t\t\tvar subpages = options.subpages || [];\n\t\t\tif (!$.os.plus && subpages.length) {\n\t\t\t\t//暂时只处理单个subpage。后续可以考虑支持多个subpage\n\t\t\t\tcreateIframe(subpages[0]);\n\t\t\t}\n\t\t}\n\t});\n\tvar createIframe = function(options) {\n\t\tvar wrapper = document.createElement('div');\n\t\twrapper.className = 'mui-iframe-wrapper';\n\t\tvar styles = options.styles || {};\n\t\tif (typeof styles.top !== 'string') {\n\t\t\tstyles.top = '0px';\n\t\t}\n\t\tif (typeof styles.bottom !== 'string') {\n\t\t\tstyles.bottom = '0px';\n\t\t}\n\t\twrapper.style.top = styles.top;\n\t\twrapper.style.bottom = styles.bottom;\n\t\tvar iframe = document.createElement('iframe');\n\t\tiframe.src = options.url;\n\t\tiframe.id = options.id || options.url;\n\t\tiframe.name = iframe.id;\n\t\twrapper.appendChild(iframe);\n\t\tdocument.body.appendChild(wrapper);\n\t\t//目前仅处理微信\n\t\t$.os.wechat && handleScroll(wrapper, iframe);\n\t};\n\n\tfunction handleScroll(wrapper, iframe) {\n\t\tvar key = 'MUI_SCROLL_POSITION_' + document.location.href + '_' + iframe.src;\n\t\tvar scrollTop = (parseFloat(localStorage.getItem(key)) || 0);\n\t\tif (scrollTop) {\n\t\t\t(function(y) {\n\t\t\t\tiframe.onload = function() {\n\t\t\t\t\twindow.scrollTo(0, y);\n\t\t\t\t};\n\t\t\t})(scrollTop);\n\t\t}\n\t\tsetInterval(function() {\n\t\t\tvar _scrollTop = window.scrollY;\n\t\t\tif (scrollTop !== _scrollTop) {\n\t\t\t\tlocalStorage.setItem(key, _scrollTop + '');\n\t\t\t\tscrollTop = _scrollTop;\n\t\t\t}\n\t\t}, 100);\n\t};\n\t$(function() {\n\t\tvar classList = document.body.classList;\n\t\tvar os = [];\n\t\tif ($.os.ios) {\n\t\t\tos.push({\n\t\t\t\tos: 'ios',\n\t\t\t\tversion: $.os.version\n\t\t\t});\n\t\t\tclassList.add('mui-ios');\n\t\t} else if ($.os.android) {\n\t\t\tos.push({\n\t\t\t\tos: 'android',\n\t\t\t\tversion: $.os.version\n\t\t\t});\n\t\t\tclassList.add('mui-android');\n\t\t}\n\t\tif ($.os.wechat) {\n\t\t\tos.push({\n\t\t\t\tos: 'wechat',\n\t\t\t\tversion: $.os.wechat.version\n\t\t\t});\n\t\t\tclassList.add('mui-wechat');\n\t\t}\n\t\tif (os.length) {\n\t\t\t$.each(os, function(index, osObj) {\n\t\t\t\tvar version = '';\n\t\t\t\tvar classArray = [];\n\t\t\t\tif (osObj.version) {\n\t\t\t\t\t$.each(osObj.version.split('.'), function(i, v) {\n\t\t\t\t\t\tversion = version + (version ? '-' : '') + v;\n\t\t\t\t\t\tclassList.add($.className(osObj.os + '-' + version));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n})(mui);\n/**\n * mui.init 5+\n * @param {type} $\n * @returns {undefined}\n */\n(function($) {\n\tvar defaultOptions = {\n\t\tswipeBack: false,\n\t\tpreloadPages: [], //5+ lazyLoad webview\n\t\tpreloadLimit: 10, //预加载窗口的数量限制(一旦超出，先进先出)\n\t\tkeyEventBind: {\n\t\t\tbackbutton: true,\n\t\t\tmenubutton: true\n\t\t},\n\t\ttitleConfig: {\n\t\t\theight: \"44px\",\n\t\t\tbackgroundColor: \"#f7f7f7\", //导航栏背景色\n\t\t\tbottomBorderColor: \"#cccccc\", //底部边线颜色\n\t\t\ttitle: { //标题配置\n\t\t\t\ttext: \"\", //标题文字\n\t\t\t\tposition: {\n\t\t\t\t\ttop: 0,\n\t\t\t\t\tleft: 0,\n\t\t\t\t\twidth: \"100%\",\n\t\t\t\t\theight: \"100%\"\n\t\t\t\t},\n\t\t\t\tstyles: {\n\t\t\t\t\tcolor: \"#000000\",\n\t\t\t\t\talign: \"center\",\n\t\t\t\t\tfamily: \"'Helvetica Neue',Helvetica,sans-serif\",\n\t\t\t\t\tsize: \"17px\",\n\t\t\t\t\tstyle: \"normal\",\n\t\t\t\t\tweight: \"normal\",\n\t\t\t\t\tfontSrc: \"\"\n\t\t\t\t}\n\t\t\t},\n\t\t\tback: {\n\t\t\t\timage: {\n\t\t\t\t\tbase64Data: '',\n\t\t\t\t\timgSrc: '',\n\t\t\t\t\tsprite: {\n\t\t\t\t\t\ttop: '0px',\n\t\t\t\t\t\tleft: '0px',\n\t\t\t\t\t\twidth: '100%',\n\t\t\t\t\t\theight: '100%'\n\t\t\t\t\t},\n\t\t\t\t\tposition: {\n\t\t\t\t\t\ttop: \"10px\",\n\t\t\t\t\t\tleft: \"10px\",\n\t\t\t\t\t\twidth: \"24px\",\n\t\t\t\t\t\theight: \"24px\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t//默认页面动画\n\tvar defaultShow = {\n\t\tevent:\"titleUpdate\",\n\t\tautoShow: true,\n\t\tduration: 300,\n\t\taniShow: 'slide-in-right',\n\t\textras:{}\n\t};\n\t//若执行了显示动画初始化操作，则要覆盖默认配置\n\tif($.options.show) {\n\t\tdefaultShow = $.extend(true, defaultShow, $.options.show);\n\t}\n\n\t$.currentWebview = null;\n\n\t$.extend(true, $.global, defaultOptions);\n\t$.extend(true, $.options, defaultOptions);\n\t/**\n\t * 等待动画配置\n\t * @param {type} options\n\t * @returns {Object}\n\t */\n\t$.waitingOptions = function(options) {\n\t\treturn $.extend(true, {}, {\n\t\t\tautoShow: true,\n\t\t\ttitle: '',\n\t\t\tmodal: false\n\t\t}, options);\n\t};\n\t/**\n\t * 窗口显示配置\n\t * @param {type} options\n\t * @returns {Object}\n\t */\n\t$.showOptions = function(options) {\n\t\treturn $.extend(true, {}, defaultShow, options);\n\t};\n\t/**\n\t * 窗口默认配置\n\t * @param {type} options\n\t * @returns {Object}\n\t */\n\t$.windowOptions = function(options) {\n\t\treturn $.extend({\n\t\t\tscalable: false,\n\t\t\tbounce: \"\" //vertical\n\t\t}, options);\n\t};\n\t/**\n\t * plusReady\n\t * @param {type} callback\n\t * @returns {_L6.$}\n\t */\n\t$.plusReady = function(callback) {\n\t\tif(window.plus) {\n\t\t\tsetTimeout(function() { //解决callback与plusready事件的执行时机问题(典型案例:showWaiting,closeWaiting)\n\t\t\t\tcallback();\n\t\t\t}, 0);\n\t\t} else {\n\t\t\tdocument.addEventListener(\"plusready\", function() {\n\t\t\t\tcallback();\n\t\t\t}, false);\n\t\t}\n\t\treturn this;\n\t};\n\t/**\n\t * 5+ event(5+没提供之前我自己实现)\n\t * @param {type} webview\n\t * @param {type} eventType\n\t * @param {type} data\n\t * @returns {undefined}\n\t */\n\t$.fire = function(webview, eventType, data) {\n\t\tif(webview) {\n\t\t\tif(typeof data === 'undefined') {\n\t\t\t\tdata = '';\n\t\t\t} else if(typeof data === 'boolean' || typeof data === 'number') {\n\t\t\t\twebview.evalJS(\"typeof mui!=='undefined'&&mui.receive('\" + eventType + \"',\" + data + \")\");\n\t\t\t\treturn;\n\t\t\t} else if($.isPlainObject(data) || $.isArray(data)) {\n\t\t\t\tdata = JSON.stringify(data || {}).replace(/\\'/g, \"\\\\u0027\").replace(/\\\\/g, \"\\\\u005c\");\n\t\t\t}\n\t\t\twebview.evalJS(\"typeof mui!=='undefined'&&mui.receive('\" + eventType + \"','\" + data + \"')\");\n\t\t}\n\t};\n\t/**\n\t * 5+ event(5+没提供之前我自己实现)\n\t * @param {type} eventType\n\t * @param {type} data\n\t * @returns {undefined}\n\t */\n\t$.receive = function(eventType, data) {\n\t\tif(eventType) {\n\t\t\ttry {\n\t\t\t\tif(data && typeof data === 'string') {\n\t\t\t\t\tdata = JSON.parse(data);\n\t\t\t\t}\n\t\t\t} catch(e) {}\n\t\t\t$.trigger(document, eventType, data);\n\t\t}\n\t};\n\tvar triggerPreload = function(webview) {\n\t\tif(!webview.preloaded) { //保证仅触发一次\n\t\t\t$.fire(webview, 'preload');\n\t\t\tvar list = webview.children();\n\t\t\tfor(var i = 0; i < list.length; i++) {\n\t\t\t\t$.fire(list[i], 'preload');\n\t\t\t}\n\t\t\twebview.preloaded = true;\n\t\t}\n\t};\n\tvar trigger = function(webview, eventType, timeChecked) {\n\t\tif(timeChecked) {\n\t\t\tif(!webview[eventType + 'ed']) {\n\t\t\t\t$.fire(webview, eventType);\n\t\t\t\tvar list = webview.children();\n\t\t\t\tfor(var i = 0; i < list.length; i++) {\n\t\t\t\t\t$.fire(list[i], eventType);\n\t\t\t\t}\n\t\t\t\twebview[eventType + 'ed'] = true;\n\t\t\t}\n\t\t} else {\n\t\t\t$.fire(webview, eventType);\n\t\t\tvar list = webview.children();\n\t\t\tfor(var i = 0; i < list.length; i++) {\n\t\t\t\t$.fire(list[i], eventType);\n\t\t\t}\n\t\t}\n\n\t};\n\t/**\n\t * 打开新窗口\n\t * @param {string} url 要打开的页面地址\n\t * @param {string} id 指定页面ID\n\t * @param {object} options 可选:参数,等待,窗口,显示配置{params:{},waiting:{},styles:{},show:{}}\n\t */\n\t$.openWindow = function(url, id, options) {\n\t\tif(typeof url === 'object') {\n\t\t\toptions = url;\n\t\t\turl = options.url;\n\t\t\tid = options.id || url;\n\t\t} else {\n\t\t\tif(typeof id === 'object') {\n\t\t\t\toptions = id;\n\t\t\t\tid = options.id || url;\n\t\t\t} else {\n\t\t\t\tid = id || url;\n\t\t\t}\n\t\t}\n\t\tif(!$.os.plus) {\n\t\t\t//TODO 先临时这么处理：手机上顶层跳，PC上parent跳\n\t\t\tif($.os.ios || $.os.android) {\n\t\t\t\twindow.top.location.href = url;\n\t\t\t} else {\n\t\t\t\twindow.parent.location.href = url;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif(!window.plus) {\n\t\t\treturn;\n\t\t}\n\n\t\toptions = options || {};\n\t\tvar params = options.params || {};\n\t\tvar webview = null,\n\t\t\twebviewCache = null,\n\t\t\tnShow, nWaiting;\n\n\t\tif($.webviews[id]) {\n\t\t\twebviewCache = $.webviews[id];\n\t\t\t//webview真实存在，才能获取\n\t\t\tif(plus.webview.getWebviewById(id)) {\n\t\t\t\twebview = webviewCache.webview;\n\t\t\t}\n\t\t} else if(options.createNew !== true) {\n\t\t\twebview = plus.webview.getWebviewById(id);\n\t\t}\n\n\t\tif(webview) { //已缓存\n\t\t\t//每次show都需要传递动画参数；\n\t\t\t//预加载的动画参数优先级：openWindow配置>preloadPages配置>mui默认配置；\n\t\t\tnShow = webviewCache ? webviewCache.show : defaultShow;\n\t\t\tnShow = options.show ? $.extend(nShow, options.show) : nShow;\n\t\t\tnShow.autoShow && webview.show(nShow.aniShow, nShow.duration, function() {\n\t\t\t\ttriggerPreload(webview);\n\t\t\t\ttrigger(webview, 'pagebeforeshow', false);\n\t\t\t});\n\t\t\tif(webviewCache) {\n\t\t\t\twebviewCache.afterShowMethodName && webview.evalJS(webviewCache.afterShowMethodName + '(\\'' + JSON.stringify(params) + '\\')');\n\t\t\t}\n\t\t\treturn webview;\n\t\t} else { //新窗口\n\t\t\tif(!url) {\n\t\t\t\tthrow new Error('webview[' + id + '] does not exist');\n\t\t\t}\n\n\t\t\t//显示waiting\n\t\t\tvar waitingConfig = $.waitingOptions(options.waiting);\n\t\t\tif(waitingConfig.autoShow) {\n\t\t\t\tnWaiting = plus.nativeUI.showWaiting(waitingConfig.title, waitingConfig.options);\n\t\t\t}\n\n\t\t\t//创建页面\n\t\t\toptions = $.extend(options, {\n\t\t\t\tid: id,\n\t\t\t\turl: url\n\t\t\t});\n\n\t\t\twebview = $.createWindow(options);\n\n\t\t\t//显示\n\t\t\tnShow = $.showOptions(options.show);\n\t\t\tif(nShow.autoShow) {\n\t\t\t\tvar showWebview = function() {\n\t\t\t\t\t//关闭等待框\n\t\t\t\t\tif(nWaiting) {\n\t\t\t\t\t\tnWaiting.close();\n\t\t\t\t\t}\n\t\t\t\t\t//显示页面\n\t\t\t\t\twebview.show(nShow.aniShow, nShow.duration, function() {},nShow.extras);\n\t\t\t\t\toptions.afterShowMethodName && webview.evalJS(options.afterShowMethodName + '(\\'' + JSON.stringify(params) + '\\')');\n\t\t\t\t};\n\t\t\t\t//titleUpdate触发时机早于loaded，更换为titleUpdate后，可以更早的显示webview\n\t\t\t\twebview.addEventListener(nShow.event, showWebview, false);\n\t\t\t\t//loaded事件发生后，触发预加载和pagebeforeshow事件\n\t\t\t\twebview.addEventListener(\"loaded\", function() {\n\t\t\t\t\ttriggerPreload(webview);\n\t\t\t\t\ttrigger(webview, 'pagebeforeshow', false);\n\t\t\t\t}, false);\n\t\t\t}\n\t\t}\n\t\treturn webview;\n\t};\n\n\t$.openWindowWithTitle = function(options, titleConfig) {\n\t\toptions = options || {};\n\t\tvar url = options.url;\n\t\tvar id = options.id || url;\n\n\t\tif(!$.os.plus) {\n\t\t\t//TODO 先临时这么处理：手机上顶层跳，PC上parent跳\n\t\t\tif($.os.ios || $.os.android) {\n\t\t\t\twindow.top.location.href = url;\n\t\t\t} else {\n\t\t\t\twindow.parent.location.href = url;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif(!window.plus) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar params = options.params || {};\n\t\tvar webview = null,\n\t\t\twebviewCache = null,\n\t\t\tnShow, nWaiting;\n\n\t\tif($.webviews[id]) {\n\t\t\twebviewCache = $.webviews[id];\n\t\t\t//webview真实存在，才能获取\n\t\t\tif(plus.webview.getWebviewById(id)) {\n\t\t\t\twebview = webviewCache.webview;\n\t\t\t}\n\t\t} else if(options.createNew !== true) {\n\t\t\twebview = plus.webview.getWebviewById(id);\n\t\t}\n\n\t\tif(webview) { //已缓存\n\t\t\t//每次show都需要传递动画参数；\n\t\t\t//预加载的动画参数优先级：openWindow配置>preloadPages配置>mui默认配置；\n\t\t\tnShow = webviewCache ? webviewCache.show : defaultShow;\n\t\t\tnShow = options.show ? $.extend(nShow, options.show) : nShow;\n\t\t\tnShow.autoShow && webview.show(nShow.aniShow, nShow.duration, function() {\n\t\t\t\ttriggerPreload(webview);\n\t\t\t\ttrigger(webview, 'pagebeforeshow', false);\n\t\t\t});\n\t\t\tif(webviewCache) {\n\t\t\t\twebviewCache.afterShowMethodName && webview.evalJS(webviewCache.afterShowMethodName + '(\\'' + JSON.stringify(params) + '\\')');\n\t\t\t}\n\t\t\treturn webview;\n\t\t} else { //新窗口\n\t\t\tif(!url) {\n\t\t\t\tthrow new Error('webview[' + id + '] does not exist');\n\t\t\t}\n\n\t\t\t//显示waiting\n\t\t\tvar waitingConfig = $.waitingOptions(options.waiting);\n\t\t\tif(waitingConfig.autoShow) {\n\t\t\t\tnWaiting = plus.nativeUI.showWaiting(waitingConfig.title, waitingConfig.options);\n\t\t\t}\n\n\t\t\t//创建页面\n\t\t\toptions = $.extend(options, {\n\t\t\t\tid: id,\n\t\t\t\turl: url\n\t\t\t});\n\n\t\t\twebview = $.createWindow(options);\n\n\t\t\tif(titleConfig) { //处理原生头\n\t\t\t\t$.extend(true, $.options.titleConfig, titleConfig);\n\t\t\t\tvar tid = $.options.titleConfig.id ? $.options.titleConfig.id : id + \"_title\";\n\t\t\t\tvar view = new plus.nativeObj.View(tid, {\n\t\t\t\t\ttop: 0,\n\t\t\t\t\theight: $.options.titleConfig.height,\n\t\t\t\t\twidth: \"100%\",\n\t\t\t\t\tdock: \"top\",\n\t\t\t\t\tposition: \"dock\"\n\t\t\t\t});\n\t\t\t\tview.drawRect($.options.titleConfig.backgroundColor); //绘制背景色\n\t\t\t\tvar _b = parseInt($.options.titleConfig.height) - 1;\n\t\t\t\tview.drawRect($.options.titleConfig.bottomBorderColor, {\n\t\t\t\t\ttop: _b + \"px\",\n\t\t\t\t\tleft: \"0px\"\n\t\t\t\t}); //绘制底部边线\n\n\t\t\t\t//绘制文字\n\t\t\t\tif($.options.titleConfig.title.text){\n\t\t\t\t\tvar _title = $.options.titleConfig.title;\n\t\t\t\t\tview.drawText(_title.text,_title.position , _title.styles);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//返回图标绘制\n\t\t\t\tvar _back = $.options.titleConfig.back;\n\t\t\t\tvar backClick = null;\n\t\t\t\t//优先字体\n\n\t\t\t\t//其次是图片\n\t\t\t\tvar _backImage = _back.image;\n\t\t\t\tif(_backImage.base64Data || _backImage.imgSrc) {\n\t\t\t\t\t//TODO 此处需要处理百分比的情况\n\t\t\t\t\tbackClick = {\n\t\t\t\t\t\tleft:parseInt(_backImage.position.left),\n\t\t\t\t\t\tright:parseInt(_backImage.position.left) + parseInt(_backImage.position.width)\n\t\t\t\t\t};\n\t\t\t\t\tvar bitmap = new plus.nativeObj.Bitmap(id + \"_back\");\n\t\t\t\t\tif(_backImage.base64Data) { //优先base64编码字符串\n\t\t\t\t\t\tbitmap.loadBase64Data(_backImage.base64Data);\n\t\t\t\t\t} else { //其次加载图片文件\n\t\t\t\t\t\tbitmap.load(_backImage.imgSrc);\n\t\t\t\t\t}\n\t\t\t\t\tview.drawBitmap(bitmap,_backImage.sprite , _backImage.position);\n\t\t\t\t}\n\n\t\t\t\t//处理点击事件\n\t\t\t\tview.setTouchEventRect({\n\t\t\t\t\ttop: \"0px\",\n\t\t\t\t\tleft: \"0px\",\n\t\t\t\t\twidth: \"100%\",\n\t\t\t\t\theight: \"100%\"\n\t\t\t\t});\n\t\t\t\tview.interceptTouchEvent(true);\n\t\t\t\tview.addEventListener(\"click\", function(e) {\n\t\t\t\t\tvar x = e.clientX;\n\t\t\t\t\t\n\t\t\t\t\t//返回按钮点击\n\t\t\t\t\tif(backClick&& x > backClick.left && x < backClick.right){\n\t\t\t\t\t\tif( _back.click && $.isFunction(_back.click)){\n\t\t\t\t\t\t\t_back.click();\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\twebview.evalJS(\"window.mui&&mui.back();\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, false);\n\t\t\t\twebview.append(view);\n\n\t\t\t}\n\n\t\t\t//显示\n\t\t\tnShow = $.showOptions(options.show);\n\t\t\tif(nShow.autoShow) {\n\t\t\t\t//titleUpdate触发时机早于loaded，更换为titleUpdate后，可以更早的显示webview\n\t\t\t\twebview.addEventListener(nShow.event, function () {\n\t\t\t\t\t//关闭等待框\n\t\t\t\t\tif(nWaiting) {\n\t\t\t\t\t\tnWaiting.close();\n\t\t\t\t\t}\n\t\t\t\t\t//显示页面\n\t\t\t\t\twebview.show(nShow.aniShow, nShow.duration, function() {},nShow.extras);\n\t\t\t\t}, false);\n\t\t\t}\n\t\t}\n\t\treturn webview;\n\t};\n\n\t/**\n\t * 根据配置信息创建一个webview\n\t * @param {type} options\n\t * @param {type} isCreate\n\t * @returns {webview}\n\t */\n\t$.createWindow = function(options, isCreate) {\n\t\tif(!window.plus) {\n\t\t\treturn;\n\t\t}\n\t\tvar id = options.id || options.url;\n\t\tvar webview;\n\t\tif(options.preload) {\n\t\t\tif($.webviews[id] && $.webviews[id].webview.getURL()) { //已经cache\n\t\t\t\twebview = $.webviews[id].webview;\n\t\t\t} else { //新增预加载窗口\n\t\t\t\t//判断是否携带createNew参数，默认为false\n\t\t\t\tif(options.createNew !== true) {\n\t\t\t\t\twebview = plus.webview.getWebviewById(id);\n\t\t\t\t}\n\n\t\t\t\t//之前没有，那就新创建\t\n\t\t\t\tif(!webview) {\n\t\t\t\t\twebview = plus.webview.create(options.url, id, $.windowOptions(options.styles), $.extend({\n\t\t\t\t\t\tpreload: true\n\t\t\t\t\t}, options.extras));\n\t\t\t\t\tif(options.subpages) {\n\t\t\t\t\t\t$.each(options.subpages, function(index, subpage) {\n\t\t\t\t\t\t\tvar subpageId = subpage.id || subpage.url;\n\t\t\t\t\t\t\tif(subpageId) { //过滤空对象\n\t\t\t\t\t\t\t\tvar subWebview = plus.webview.getWebviewById(subpageId);\n\t\t\t\t\t\t\t\tif(!subWebview) { //如果该webview不存在，则创建\n\t\t\t\t\t\t\t\t\tsubWebview = plus.webview.create(subpage.url, subpageId, $.windowOptions(subpage.styles), $.extend({\n\t\t\t\t\t\t\t\t\t\tpreload: true\n\t\t\t\t\t\t\t\t\t}, subpage.extras));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\twebview.append(subWebview);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//TODO 理论上，子webview也应该计算到预加载队列中，但这样就麻烦了，要退必须退整体，否则可能出现问题；\n\t\t\t$.webviews[id] = {\n\t\t\t\twebview: webview, //目前仅preload的缓存webview\n\t\t\t\tpreload: true,\n\t\t\t\tshow: $.showOptions(options.show),\n\t\t\t\tafterShowMethodName: options.afterShowMethodName //就不应该用evalJS。应该是通过事件消息通讯\n\t\t\t};\n\t\t\t//索引该预加载窗口\n\t\t\tvar preloads = $.data.preloads;\n\t\t\tvar index = preloads.indexOf(id);\n\t\t\tif(~index) { //删除已存在的(变相调整插入位置)\n\t\t\t\tpreloads.splice(index, 1);\n\t\t\t}\n\t\t\tpreloads.push(id);\n\t\t\tif(preloads.length > $.options.preloadLimit) {\n\t\t\t\t//先进先出\n\t\t\t\tvar first = $.data.preloads.shift();\n\t\t\t\tvar webviewCache = $.webviews[first];\n\t\t\t\tif(webviewCache && webviewCache.webview) {\n\t\t\t\t\t//需要将自己打开的所有页面，全部close；\n\t\t\t\t\t//关闭该预加载webview\t\n\t\t\t\t\t$.closeAll(webviewCache.webview);\n\t\t\t\t}\n\t\t\t\t//删除缓存\n\t\t\t\tdelete $.webviews[first];\n\t\t\t}\n\t\t} else {\n\t\t\tif(isCreate !== false) { //直接创建非预加载窗口\n\t\t\t\twebview = plus.webview.create(options.url, id, $.windowOptions(options.styles), options.extras);\n\t\t\t\tif(options.subpages) {\n\t\t\t\t\t$.each(options.subpages, function(index, subpage) {\n\t\t\t\t\t\tvar subpageId = subpage.id || subpage.url;\n\t\t\t\t\t\tvar subWebview = plus.webview.getWebviewById(subpageId);\n\t\t\t\t\t\tif(!subWebview) {\n\t\t\t\t\t\t\tsubWebview = plus.webview.create(subpage.url, subpageId, $.windowOptions(subpage.styles), subpage.extras);\n\t\t\t\t\t\t}\n\t\t\t\t\t\twebview.append(subWebview);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn webview;\n\t};\n\n\t/**\n\t * 预加载\n\t */\n\t$.preload = function(options) {\n\t\t//调用预加载函数，不管是否传递preload参数，强制变为true\n\t\tif(!options.preload) {\n\t\t\toptions.preload = true;\n\t\t}\n\t\treturn $.createWindow(options);\n\t};\n\n\t/**\n\t *关闭当前webview打开的所有webview；\n\t */\n\t$.closeOpened = function(webview) {\n\t\tvar opened = webview.opened();\n\t\tif(opened) {\n\t\t\tfor(var i = 0, len = opened.length; i < len; i++) {\n\t\t\t\tvar openedWebview = opened[i];\n\t\t\t\tvar open_open = openedWebview.opened();\n\t\t\t\tif(open_open && open_open.length > 0) {\n\t\t\t\t\t//关闭打开的webview\n\t\t\t\t\t$.closeOpened(openedWebview);\n\t\t\t\t\t//关闭自己\n\t\t\t\t\topenedWebview.close(\"none\");\n\t\t\t\t} else {\n\t\t\t\t\t//如果直接孩子节点，就不用关闭了，因为父关闭的时候，会自动关闭子；\n\t\t\t\t\tif(openedWebview.parent() !== webview) {\n\t\t\t\t\t\topenedWebview.close('none');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\t$.closeAll = function(webview, aniShow) {\n\t\t$.closeOpened(webview);\n\t\tif(aniShow) {\n\t\t\twebview.close(aniShow);\n\t\t} else {\n\t\t\twebview.close();\n\t\t}\n\t};\n\n\t/**\n\t * 批量创建webview\n\t * @param {type} options\n\t * @returns {undefined}\n\t */\n\t$.createWindows = function(options) {\n\t\t$.each(options, function(index, option) {\n\t\t\t//初始化预加载窗口(创建)和非预加载窗口(仅配置，不创建)\n\t\t\t$.createWindow(option, false);\n\t\t});\n\t};\n\t/**\n\t * 创建当前页面的子webview\n\t * @param {type} options\n\t * @returns {webview}\n\t */\n\t$.appendWebview = function(options) {\n\t\tif(!window.plus) {\n\t\t\treturn;\n\t\t}\n\t\tvar id = options.id || options.url;\n\t\tvar webview;\n\t\tif(!$.webviews[id]) { //保证执行一遍\n\t\t\t//TODO 这里也有隐患，比如某个webview不是作为subpage创建的，而是作为target webview的话；\n\t\t\tif(!plus.webview.getWebviewById(id)) {\n\t\t\t\twebview = plus.webview.create(options.url, id, options.styles, options.extras);\n\t\t\t}\n\t\t\t//之前的实现方案：子窗口loaded之后再append到父窗口中；\n\t\t\t//问题：部分子窗口loaded事件发生较晚，此时执行父窗口的children方法会返回空，导致父子通讯失败；\n\t\t\t//     比如父页面执行完preload事件后，需触发子页面的preload事件，此时未append的话，就无法触发；\n\t\t\t//修改方式：不再监控loaded事件，直接append\n\t\t\t//by chb@20150521\n\t\t\t// webview.addEventListener('loaded', function() {\n\t\t\tplus.webview.currentWebview().append(webview);\n\t\t\t// });\n\t\t\t$.webviews[id] = options;\n\n\t\t}\n\t\treturn webview;\n\t};\n\n\t//全局webviews\n\t$.webviews = {};\n\t//预加载窗口索引\n\t$.data.preloads = [];\n\t//$.currentWebview\n\t$.plusReady(function() {\n\t\t$.currentWebview = plus.webview.currentWebview();\n\t});\n\t$.addInit({\n\t\tname: '5+',\n\t\tindex: 100,\n\t\thandle: function() {\n\t\t\tvar options = $.options;\n\t\t\tvar subpages = options.subpages || [];\n\t\t\tif($.os.plus) {\n\t\t\t\t$.plusReady(function() {\n\t\t\t\t\t//TODO  这里需要判断一下，最好等子窗口加载完毕后，再调用主窗口的show方法；\n\t\t\t\t\t//或者：在openwindow方法中，监听实现；\n\t\t\t\t\t$.each(subpages, function(index, subpage) {\n\t\t\t\t\t\t$.appendWebview(subpage);\n\t\t\t\t\t});\n\t\t\t\t\t//判断是否首页\n\t\t\t\t\tif(plus.webview.currentWebview() === plus.webview.getWebviewById(plus.runtime.appid)) {\n\t\t\t\t\t\t//首页需要自己激活预加载；\n\t\t\t\t\t\t//timeout因为子页面loaded之后才append的，防止子页面尚未append、从而导致其preload未触发的问题；\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\ttriggerPreload(plus.webview.currentWebview());\n\t\t\t\t\t\t}, 300);\n\t\t\t\t\t}\n\t\t\t\t\t//设置ios顶部状态栏颜色；\n\t\t\t\t\tif($.os.ios && $.options.statusBarBackground) {\n\t\t\t\t\t\tplus.navigator.setStatusBarBackground($.options.statusBarBackground);\n\t\t\t\t\t}\n\t\t\t\t\tif($.os.android && parseFloat($.os.version) < 4.4) {\n\t\t\t\t\t\t//解决Android平台4.4版本以下，resume后，父窗体标题延迟渲染的问题；\n\t\t\t\t\t\tif(plus.webview.currentWebview().parent() == null) {\n\t\t\t\t\t\t\tdocument.addEventListener(\"resume\", function() {\n\t\t\t\t\t\t\t\tvar body = document.body;\n\t\t\t\t\t\t\t\tbody.style.display = 'none';\n\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\tbody.style.display = '';\n\t\t\t\t\t\t\t\t}, 10);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t//已支持iframe嵌入\n\t\t\t\t//\t\t\t\tif (subpages.length > 0) {\n\t\t\t\t//\t\t\t\t\tvar err = document.createElement('div');\n\t\t\t\t//\t\t\t\t\terr.className = 'mui-error';\n\t\t\t\t//\t\t\t\t\t//文字描述\n\t\t\t\t//\t\t\t\t\tvar span = document.createElement('span');\n\t\t\t\t//\t\t\t\t\tspan.innerHTML = '在该浏览器下，不支持创建子页面，具体参考';\n\t\t\t\t//\t\t\t\t\terr.appendChild(span);\n\t\t\t\t//\t\t\t\t\tvar a = document.createElement('a');\n\t\t\t\t//\t\t\t\t\ta.innerHTML = '\"mui框架适用场景\"';\n\t\t\t\t//\t\t\t\t\ta.href = 'http://ask.dcloud.net.cn/article/113';\n\t\t\t\t//\t\t\t\t\terr.appendChild(a);\n\t\t\t\t//\t\t\t\t\tdocument.body.appendChild(err);\n\t\t\t\t//\t\t\t\t\tconsole.log('在该浏览器下，不支持创建子页面');\n\t\t\t\t//\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\t});\n\twindow.addEventListener('preload', function() {\n\t\t//处理预加载部分\n\t\tvar webviews = $.options.preloadPages || [];\n\t\t$.plusReady(function() {\n\t\t\t$.each(webviews, function(index, webview) {\n\t\t\t\t$.createWindow($.extend(webview, {\n\t\t\t\t\tpreload: true\n\t\t\t\t}));\n\t\t\t});\n\n\t\t});\n\t});\n\t$.supportStatusbarOffset = function() {\n\t\treturn $.os.plus && $.os.ios && parseFloat($.os.version) >= 7;\n\t};\n\t$.ready(function() {\n\t\t//标识当前环境支持statusbar\n\t\tif($.supportStatusbarOffset()) {\n\t\t\tdocument.body.classList.add('mui-statusbar');\n\t\t}\n\t});\n})(mui);\n\n/**\n * mui back\n * @param {type} $\n * @param {type} window\n * @returns {undefined}\n */\n(function($, window) {\n\t/**\n\t * register back\n\t * @param {type} back\n\t * @returns {$.gestures}\n\t */\n\t$.addBack = function(back) {\n\t\treturn $.addAction('backs', back);\n\t};\n\t/**\n\t * default\n\t */\n\t$.addBack({\n\t\tname: 'browser',\n\t\tindex: 100,\n\t\thandle: function() {\n\t\t\tif (window.history.length > 1) {\n\t\t\t\twindow.history.back();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t});\n\t/**\n\t * 后退\n\t */\n\t$.back = function() {\n\t\tif (typeof $.options.beforeback === 'function') {\n\t\t\tif ($.options.beforeback() === false) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t$.doAction('backs');\n\t};\n\twindow.addEventListener('tap', function(e) {\n\t\tvar action = $.targets.action;\n\t\tif (action && action.classList.contains('mui-action-back')) {\n\t\t\t$.back();\n\t\t\t$.targets.action = false;\n\t\t}\n\t});\n\twindow.addEventListener('swiperight', function(e) {\n\t\tvar detail = e.detail;\n\t\tif ($.options.swipeBack === true && Math.abs(detail.angle) < 3) {\n\t\t\t$.back();\n\t\t}\n\t});\n\n})(mui, window);\n/**\n * mui back 5+\n * @param {type} $\n * @param {type} window\n * @returns {undefined}\n */\n(function($, window) {\n\tif ($.os.plus && $.os.android) {\n\t\t$.addBack({\n\t\t\tname: 'mui',\n\t\t\tindex: 5,\n\t\t\thandle: function() {\n\t\t\t\t//后续重新设计此处，将back放到各个空间内部实现\n\t\t\t\t//popover\n\t\t\t\tif ($.targets._popover && $.targets._popover.classList.contains('mui-active')) {\n\t\t\t\t\t$($.targets._popover).popover('hide');\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\t//offcanvas\n\t\t\t\tvar offCanvas = document.querySelector('.mui-off-canvas-wrap.mui-active');\n\t\t\t\tif (offCanvas) {\n\t\t\t\t\t$(offCanvas).offCanvas('close');\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tvar previewImage = $.isFunction($.getPreviewImage) && $.getPreviewImage();\n\t\t\t\tif (previewImage && previewImage.isShown()) {\n\t\t\t\t\tpreviewImage.close();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\t//popup\n\t\t\t\treturn $.closePopup();\n\t\t\t}\n\t\t});\n\t}\n\t//首次按下back按键的时间\n\t$.__back__first = null;\n\t/**\n\t * 5+ back\n\t */\n\t$.addBack({\n\t\tname: '5+',\n\t\tindex: 10,\n\t\thandle: function() {\n\t\t\tif (!window.plus) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar wobj = plus.webview.currentWebview();\n\t\t\tvar parent = wobj.parent();\n\t\t\tif (parent) {\n\t\t\t\tparent.evalJS('mui&&mui.back();');\n\t\t\t} else {\n\t\t\t\twobj.canBack(function(e) {\n\t\t\t\t\t//by chb 暂时注释，在碰到类似popover之类的锚点的时候，需多次点击才能返回；\n\t\t\t\t\tif (e.canBack) { //webview history back\n\t\t\t\t\t\twindow.history.back();\n\t\t\t\t\t} else { //webview close or hide\n\t\t\t\t\t\t//fixed by fxy 此处不应该用opener判断，因为用户有可能自己close掉当前窗口的opener。这样的话。opener就为空了，导致不能执行close\n\t\t\t\t\t\tif (wobj.id === plus.runtime.appid) { //首页\n\t\t\t\t\t\t\t//首页不存在opener的情况下，后退实际上应该是退出应用；\n\t\t\t\t\t\t\t//首次按键，提示‘再按一次退出应用’\n\t\t\t\t\t\t\tif (!$.__back__first) {\n\t\t\t\t\t\t\t\t$.__back__first = new Date().getTime();\n\t\t\t\t\t\t\t\tmui.toast('再按一次退出应用');\n\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t$.__back__first = null;\n\t\t\t\t\t\t\t\t}, 2000);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (new Date().getTime() - $.__back__first < 2000) {\n\t\t\t\t\t\t\t\t\tplus.runtime.quit();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else { //其他页面，\n\t\t\t\t\t\t\tif (wobj.preload) {\n\t\t\t\t\t\t\t\twobj.hide(\"auto\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t//关闭页面时，需要将其打开的所有子页面全部关闭；\n\t\t\t\t\t\t\t\t$.closeAll(wobj);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t});\n\n\n\t$.menu = function() {\n\t\tvar menu = document.querySelector('.mui-action-menu');\n\t\tif (menu) {\n\t\t\t$.trigger(menu, $.EVENT_START); //临时处理menu无touchstart的话，找不到当前targets的问题\n\t\t\t$.trigger(menu, 'tap');\n\t\t} else { //执行父窗口的menu\n\t\t\tif (window.plus) {\n\t\t\t\tvar wobj = $.currentWebview;\n\t\t\t\tvar parent = wobj.parent();\n\t\t\t\tif (parent) { //又得evalJS\n\t\t\t\t\tparent.evalJS('mui&&mui.menu();');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\tvar __back = function() {\n\t\t$.back();\n\t};\n\tvar __menu = function() {\n\t\t$.menu();\n\t};\n\t//默认监听\n\t$.plusReady(function() {\n\t\tif ($.options.keyEventBind.backbutton) {\n\t\t\tplus.key.addEventListener('backbutton', __back, false);\n\t\t}\n\t\tif ($.options.keyEventBind.menubutton) {\n\t\t\tplus.key.addEventListener('menubutton', __menu, false);\n\t\t}\n\t});\n\t//处理按键监听事件\n\t$.addInit({\n\t\tname: 'keyEventBind',\n\t\tindex: 1000,\n\t\thandle: function() {\n\t\t\t$.plusReady(function() {\n\t\t\t\t//如果不为true，则移除默认监听\n\t\t\t\tif (!$.options.keyEventBind.backbutton) {\n\t\t\t\t\tplus.key.removeEventListener('backbutton', __back);\n\t\t\t\t}\n\t\t\t\tif (!$.options.keyEventBind.menubutton) {\n\t\t\t\t\tplus.key.removeEventListener('menubutton', __menu);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n})(mui, window);\n/**\n * mui.init pulldownRefresh\n * @param {type} $\n * @returns {undefined}\n */\n(function($) {\n\t$.addInit({\n\t\tname: 'pullrefresh',\n\t\tindex: 1000,\n\t\thandle: function() {\n\t\t\tvar options = $.options;\n\t\t\tvar pullRefreshOptions = options.pullRefresh || {};\n\t\t\tvar hasPulldown = pullRefreshOptions.down && pullRefreshOptions.down.hasOwnProperty('callback');\n\t\t\tvar hasPullup = pullRefreshOptions.up && pullRefreshOptions.up.hasOwnProperty('callback');\n\t\t\tif(hasPulldown || hasPullup) {\n\t\t\t\tvar container = pullRefreshOptions.container;\n\t\t\t\tif(container) {\n\t\t\t\t\tvar $container = $(container);\n\t\t\t\t\tif($container.length === 1) {\n\t\t\t\t\t\tif($.os.plus) { //5+环境\n\t\t\t\t\t\t\tif(hasPulldown && pullRefreshOptions.down.style == \"circle\") { //原生转圈\n\t\t\t\t\t\t\t\t$.plusReady(function() {\n\t\t\t\t\t\t\t\t\t//这里改写$.fn.pullRefresh\n\t\t\t\t\t\t\t\t\t$.fn.pullRefresh = $.fn.pullRefresh_native;\n\t\t\t\t\t\t\t\t\t$container.pullRefresh(pullRefreshOptions);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t} else if($.os.android) { //非原生转圈，但是Android环境\n\t\t\t\t\t\t\t\t$.plusReady(function() {\n\t\t\t\t\t\t\t\t\t//这里改写$.fn.pullRefresh\n\t\t\t\t\t\t\t\t\t$.fn.pullRefresh = $.fn.pullRefresh_native\n\t\t\t\t\t\t\t\t\tvar webview = plus.webview.currentWebview();\n\t\t\t\t\t\t\t\t\tif(window.__NWin_Enable__ === false) { //不支持多webview\n\t\t\t\t\t\t\t\t\t\t$container.pullRefresh(pullRefreshOptions);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tif(hasPullup) {\n\t\t\t\t\t\t\t\t\t\t\t//当前页面初始化pullup\n\t\t\t\t\t\t\t\t\t\t\tvar upOptions = {};\n\t\t\t\t\t\t\t\t\t\t\tupOptions.up = pullRefreshOptions.up;\n\t\t\t\t\t\t\t\t\t\t\tupOptions.webviewId = webview.id || webview.getURL();\n\t\t\t\t\t\t\t\t\t\t\t$container.pullRefresh(upOptions);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif(hasPulldown) {\n\t\t\t\t\t\t\t\t\t\t\tvar parent = webview.parent();\n\t\t\t\t\t\t\t\t\t\t\tvar id = webview.id || webview.getURL();\n\t\t\t\t\t\t\t\t\t\t\tif(parent) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(!hasPullup) { //如果没有上拉加载，需要手动初始化一个默认的pullRefresh，以便当前页面容器可以调用endPulldownToRefresh等方法\n\t\t\t\t\t\t\t\t\t\t\t\t\t$container.pullRefresh({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twebviewId: id\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tvar downOptions = {\n\t\t\t\t\t\t\t\t\t\t\t\t\twebviewId: id//子页面id\n\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\tdownOptions.down = $.extend({}, pullRefreshOptions.down);\n\t\t\t\t\t\t\t\t\t\t\t\tdownOptions.down.callback = '_CALLBACK';\n\t\t\t\t\t\t\t\t\t\t\t\t//改写父页面的$.fn.pullRefresh\n\t\t\t\t\t\t\t\t\t\t\t\tparent.evalJS(\"mui.fn.pullRefresh=mui.fn.pullRefresh_native\");\n\t\t\t\t\t\t\t\t\t\t\t\t//父页面初始化pulldown\n\t\t\t\t\t\t\t\t\t\t\t\tparent.evalJS(\"mui&&mui(document.querySelector('.mui-content')).pullRefresh('\" + JSON.stringify(downOptions) + \"')\");\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else { //非原生转圈，iOS环境\n\t\t\t\t\t\t\t\t$container.pullRefresh(pullRefreshOptions);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$container.pullRefresh(pullRefreshOptions);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n})(mui);\n/**\n * mui ajax\n * @param {type} $\n * @returns {undefined}\n */\n(function($, window, undefined) {\n\n\tvar jsonType = 'application/json';\n\tvar htmlType = 'text/html';\n\tvar rscript = /<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi;\n\tvar scriptTypeRE = /^(?:text|application)\\/javascript/i;\n\tvar xmlTypeRE = /^(?:text|application)\\/xml/i;\n\tvar blankRE = /^\\s*$/;\n\n\t$.ajaxSettings = {\n\t\ttype: 'GET',\n\t\tbeforeSend: $.noop,\n\t\tsuccess: $.noop,\n\t\terror: $.noop,\n\t\tcomplete: $.noop,\n\t\tcontext: null,\n\t\txhr: function(protocol) {\n\t\t\treturn new window.XMLHttpRequest();\n\t\t},\n\t\taccepts: {\n\t\t\tscript: 'text/javascript, application/javascript, application/x-javascript',\n\t\t\tjson: jsonType,\n\t\t\txml: 'application/xml, text/xml',\n\t\t\thtml: htmlType,\n\t\t\ttext: 'text/plain'\n\t\t},\n\t\ttimeout: 0,\n\t\tprocessData: true,\n\t\tcache: true\n\t};\n\tvar ajaxBeforeSend = function(xhr, settings) {\n\t\tvar context = settings.context\n\t\tif(settings.beforeSend.call(context, xhr, settings) === false) {\n\t\t\treturn false;\n\t\t}\n\t};\n\tvar ajaxSuccess = function(data, xhr, settings) {\n\t\tsettings.success.call(settings.context, data, 'success', xhr);\n\t\tajaxComplete('success', xhr, settings);\n\t};\n\t// type: \"timeout\", \"error\", \"abort\", \"parsererror\"\n\tvar ajaxError = function(error, type, xhr, settings) {\n\t\tsettings.error.call(settings.context, xhr, type, error);\n\t\tajaxComplete(type, xhr, settings);\n\t};\n\t// status: \"success\", \"notmodified\", \"error\", \"timeout\", \"abort\", \"parsererror\"\n\tvar ajaxComplete = function(status, xhr, settings) {\n\t\tsettings.complete.call(settings.context, xhr, status);\n\t};\n\n\tvar serialize = function(params, obj, traditional, scope) {\n\t\tvar type, array = $.isArray(obj),\n\t\t\thash = $.isPlainObject(obj);\n\t\t$.each(obj, function(key, value) {\n\t\t\ttype = $.type(value);\n\t\t\tif(scope) {\n\t\t\t\tkey = traditional ? scope :\n\t\t\t\t\tscope + '[' + (hash || type === 'object' || type === 'array' ? key : '') + ']';\n\t\t\t}\n\t\t\t// handle data in serializeArray() format\n\t\t\tif(!scope && array) {\n\t\t\t\tparams.add(value.name, value.value);\n\t\t\t}\n\t\t\t// recurse into nested objects\n\t\t\telse if(type === \"array\" || (!traditional && type === \"object\")) {\n\t\t\t\tserialize(params, value, traditional, key);\n\t\t\t} else {\n\t\t\t\tparams.add(key, value);\n\t\t\t}\n\t\t});\n\t};\n\tvar serializeData = function(options) {\n\t\tif(options.processData && options.data && typeof options.data !== \"string\") {\n\t\t\tvar contentType = options.contentType;\n\t\t\tif(!contentType && options.headers) {\n\t\t\t\tcontentType = options.headers['Content-Type'];\n\t\t\t}\n\t\t\tif(contentType && ~contentType.indexOf(jsonType)) { //application/json\n\t\t\t\toptions.data = JSON.stringify(options.data);\n\t\t\t} else {\n\t\t\t\toptions.data = $.param(options.data, options.traditional);\n\t\t\t}\n\t\t}\n\t\tif(options.data && (!options.type || options.type.toUpperCase() === 'GET')) {\n\t\t\toptions.url = appendQuery(options.url, options.data);\n\t\t\toptions.data = undefined;\n\t\t}\n\t};\n\tvar appendQuery = function(url, query) {\n\t\tif(query === '') {\n\t\t\treturn url;\n\t\t}\n\t\treturn(url + '&' + query).replace(/[&?]{1,2}/, '?');\n\t};\n\tvar mimeToDataType = function(mime) {\n\t\tif(mime) {\n\t\t\tmime = mime.split(';', 2)[0];\n\t\t}\n\t\treturn mime && (mime === htmlType ? 'html' :\n\t\t\tmime === jsonType ? 'json' :\n\t\t\tscriptTypeRE.test(mime) ? 'script' :\n\t\t\txmlTypeRE.test(mime) && 'xml') || 'text';\n\t};\n\tvar parseArguments = function(url, data, success, dataType) {\n\t\tif($.isFunction(data)) {\n\t\t\tdataType = success, success = data, data = undefined;\n\t\t}\n\t\tif(!$.isFunction(success)) {\n\t\t\tdataType = success, success = undefined;\n\t\t}\n\t\treturn {\n\t\t\turl: url,\n\t\t\tdata: data,\n\t\t\tsuccess: success,\n\t\t\tdataType: dataType\n\t\t};\n\t};\n\t$.ajax = function(url, options) {\n\t\tif(typeof url === \"object\") {\n\t\t\toptions = url;\n\t\t\turl = undefined;\n\t\t}\n\t\tvar settings = options || {};\n\t\tsettings.url = url || settings.url;\n\t\tfor(var key in $.ajaxSettings) {\n\t\t\tif(settings[key] === undefined) {\n\t\t\t\tsettings[key] = $.ajaxSettings[key];\n\t\t\t}\n\t\t}\n\t\tserializeData(settings);\n\t\tvar dataType = settings.dataType;\n\n\t\tif(settings.cache === false || ((!options || options.cache !== true) && ('script' === dataType))) {\n\t\t\tsettings.url = appendQuery(settings.url, '_=' + $.now());\n\t\t}\n\t\tvar mime = settings.accepts[dataType && dataType.toLowerCase()];\n\t\tvar headers = {};\n\t\tvar setHeader = function(name, value) {\n\t\t\theaders[name.toLowerCase()] = [name, value];\n\t\t};\n\t\tvar protocol = /^([\\w-]+:)\\/\\//.test(settings.url) ? RegExp.$1 : window.location.protocol;        \n\t\tvar xhr = settings.xhr(settings);\n        \n        if(location.protocol === 'file:' && $.os.ios && window.webkit && window.webkit.messageHandlers && !(xhr instanceof plus.net.XMLHttpRequest)){\n            console.error(\"当前运行环境为WKWebview，需在plusReady事件触发后再调用mui.ajax，否则可能会执行失败或报Script error的错误\")\n        }\n\t\tvar nativeSetHeader = xhr.setRequestHeader;\n\t\tvar abortTimeout;\n\n\t\tsetHeader('X-Requested-With', 'XMLHttpRequest');\n\t\tsetHeader('Accept', mime || '*/*');\n\t\tif(!!(mime = settings.mimeType || mime)) {\n\t\t\tif(mime.indexOf(',') > -1) {\n\t\t\t\tmime = mime.split(',', 2)[0];\n\t\t\t}\n\t\t\txhr.overrideMimeType && xhr.overrideMimeType(mime);\n\t\t}\n\t\tif(settings.contentType || (settings.contentType !== false && settings.data && settings.type.toUpperCase() !== 'GET')) {\n\t\t\tsetHeader('Content-Type', settings.contentType || 'application/x-www-form-urlencoded');\n\t\t}\n\t\tif(settings.headers) {\n\t\t\tfor(var name in settings.headers)\n\t\t\t\tsetHeader(name, settings.headers[name]);\n\t\t}\n\t\txhr.setRequestHeader = setHeader;\n\n\t\txhr.onreadystatechange = function() {\n\t\t\tif(xhr.readyState === 4) {\n\t\t\t\txhr.onreadystatechange = $.noop;\n\t\t\t\tclearTimeout(abortTimeout);\n\t\t\t\tvar result, error = false;\n\t\t\t\tvar isLocal = protocol === 'file:';\n\t\t\t\tif((xhr.status >= 200 && xhr.status < 300) || xhr.status === 304 || (xhr.status === 0 && isLocal && xhr.responseText)) {\n\t\t\t\t\tdataType = dataType || mimeToDataType(settings.mimeType || xhr.getResponseHeader('content-type'));\n\t\t\t\t\tresult = xhr.responseText;\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// http://perfectionkills.com/global-eval-what-are-the-options/\n\t\t\t\t\t\tif(dataType === 'script') {\n\t\t\t\t\t\t\t(1, eval)(result);\n\t\t\t\t\t\t} else if(dataType === 'xml') {\n\t\t\t\t\t\t\tresult = xhr.responseXML;\n\t\t\t\t\t\t} else if(dataType === 'json') {\n\t\t\t\t\t\t\tresult = blankRE.test(result) ? null : $.parseJSON(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\terror = e;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(error) {\n\t\t\t\t\t\tajaxError(error, 'parsererror', xhr, settings);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tajaxSuccess(result, xhr, settings);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tvar status = xhr.status ? 'error' : 'abort';\n\t\t\t\t\tvar statusText = xhr.statusText || null;\n\t\t\t\t\tif(isLocal) {\n\t\t\t\t\t\tstatus = 'error';\n\t\t\t\t\t\tstatusText = '404';\n\t\t\t\t\t}\n\t\t\t\t\tajaxError(statusText, status, xhr, settings);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tif(ajaxBeforeSend(xhr, settings) === false) {\n\t\t\txhr.abort();\n\t\t\tajaxError(null, 'abort', xhr, settings);\n\t\t\treturn xhr;\n\t\t}\n\n\t\tif(settings.xhrFields) {\n\t\t\tfor(var name in settings.xhrFields) {\n\t\t\t\txhr[name] = settings.xhrFields[name];\n\t\t\t}\n\t\t}\n\n\t\tvar async = 'async' in settings ? settings.async : true;\n\n\t\txhr.open(settings.type.toUpperCase(), settings.url, async, settings.username, settings.password);\n\n\t\tfor(var name in headers) {\n\t\t\tif(headers.hasOwnProperty(name)) {\n\t\t\t\tnativeSetHeader.apply(xhr, headers[name]);\n\t\t\t}\n\t\t}\n\t\tif(settings.timeout > 0) {\n\t\t\tabortTimeout = setTimeout(function() {\n\t\t\t\txhr.onreadystatechange = $.noop;\n\t\t\t\txhr.abort();\n\t\t\t\tajaxError(null, 'timeout', xhr, settings);\n\t\t\t}, settings.timeout);\n\t\t}\n\t\txhr.send(settings.data ? settings.data : null);\n\t\treturn xhr;\n\t};\n\n\t$.param = function(obj, traditional) {\n\t\tvar params = [];\n\t\tparams.add = function(k, v) {\n\t\t\tthis.push(encodeURIComponent(k) + '=' + encodeURIComponent(v));\n\t\t};\n\t\tserialize(params, obj, traditional);\n\t\treturn params.join('&').replace(/%20/g, '+');\n\t};\n\t$.get = function( /* url, data, success, dataType */ ) {\n\t\treturn $.ajax(parseArguments.apply(null, arguments));\n\t};\n\n\t$.post = function( /* url, data, success, dataType */ ) {\n\t\tvar options = parseArguments.apply(null, arguments);\n\t\toptions.type = 'POST';\n\t\treturn $.ajax(options);\n\t};\n\n\t$.getJSON = function( /* url, data, success */ ) {\n\t\tvar options = parseArguments.apply(null, arguments);\n\t\toptions.dataType = 'json';\n\t\treturn $.ajax(options);\n\t};\n\n\t$.fn.load = function(url, data, success) {\n\t\tif(!this.length)\n\t\t\treturn this;\n\t\tvar self = this,\n\t\t\tparts = url.split(/\\s/),\n\t\t\tselector,\n\t\t\toptions = parseArguments(url, data, success),\n\t\t\tcallback = options.success;\n\t\tif(parts.length > 1)\n\t\t\toptions.url = parts[0], selector = parts[1];\n\t\toptions.success = function(response) {\n\t\t\tif(selector) {\n\t\t\t\tvar div = document.createElement('div');\n\t\t\t\tdiv.innerHTML = response.replace(rscript, \"\");\n\t\t\t\tvar selectorDiv = document.createElement('div');\n\t\t\t\tvar childs = div.querySelectorAll(selector);\n\t\t\t\tif(childs && childs.length > 0) {\n\t\t\t\t\tfor(var i = 0, len = childs.length; i < len; i++) {\n\t\t\t\t\t\tselectorDiv.appendChild(childs[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tself[0].innerHTML = selectorDiv.innerHTML;\n\t\t\t} else {\n\t\t\t\tself[0].innerHTML = response;\n\t\t\t}\n\t\t\tcallback && callback.apply(self, arguments);\n\t\t};\n\t\t$.ajax(options);\n\t\treturn this;\n\t};\n\n})(mui, window);\n/**\n * 5+ ajax\n */\n(function($) {\n\tvar originAnchor = document.createElement('a');\n\toriginAnchor.href = window.location.href;\n\t$.plusReady(function() {\n\t\t$.ajaxSettings = $.extend($.ajaxSettings, {\n\t\t\txhr: function(settings) {\n\t\t\t\tif (settings.crossDomain) { //强制使用plus跨域\n\t\t\t\t\treturn new plus.net.XMLHttpRequest();\n\t\t\t\t}\n\t\t\t\t//仅在webview的url为远程文件，且ajax请求的资源不同源下使用plus.net.XMLHttpRequest\n\t\t\t\tif (originAnchor.protocol !== 'file:') {\n\t\t\t\t\tvar urlAnchor = document.createElement('a');\n\t\t\t\t\turlAnchor.href = settings.url;\n\t\t\t\t\turlAnchor.href = urlAnchor.href;\n\t\t\t\t\tsettings.crossDomain = (originAnchor.protocol + '//' + originAnchor.host) !== (urlAnchor.protocol + '//' + urlAnchor.host);\n\t\t\t\t\tif (settings.crossDomain) {\n\t\t\t\t\t\treturn new plus.net.XMLHttpRequest();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ($.os.ios && window.webkit && window.webkit.messageHandlers) { //wkwebview下同样使用5+ xhr\n                    return new plus.net.XMLHttpRequest();\n                }\n\t\t\t\treturn new window.XMLHttpRequest();\n\t\t\t}\n\t\t});\n\t});\n})(mui);\n/**\n * mui layout(offset[,position,width,height...])\n * @param {type} $\n * @param {type} window\n * @param {type} undefined\n * @returns {undefined}\n */\n(function($, window, undefined) {\n\t$.offset = function(element) {\n\t\tvar box = {\n\t\t\ttop : 0,\n\t\t\tleft : 0\n\t\t};\n\t\tif ( typeof element.getBoundingClientRect !== undefined) {\n\t\t\tbox = element.getBoundingClientRect();\n\t\t}\n\t\treturn {\n\t\t\ttop : box.top + window.pageYOffset - element.clientTop,\n\t\t\tleft : box.left + window.pageXOffset - element.clientLeft\n\t\t};\n\t};\n})(mui, window); \n/**\n * mui animation\n */\n(function($, window) {\n\t/**\n\t * scrollTo\n\t */\n\t$.scrollTo = function(scrollTop, duration, callback) {\n\t\tduration = duration || 1000;\n\t\tvar scroll = function(duration) {\n\t\t\tif (duration <= 0) {\n\t\t\t\twindow.scrollTo(0, scrollTop);\n\t\t\t\tcallback && callback();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar distaince = scrollTop - window.scrollY;\n\t\t\tsetTimeout(function() {\n\t\t\t\twindow.scrollTo(0, window.scrollY + distaince / duration * 10);\n\t\t\t\tscroll(duration - 10);\n\t\t\t}, 16.7);\n\t\t};\n\t\tscroll(duration);\n\t};\n\t$.animationFrame = function(cb) {\n\t\tvar args, isQueued, context;\n\t\treturn function() {\n\t\t\targs = arguments;\n\t\t\tcontext = this;\n\t\t\tif (!isQueued) {\n\t\t\t\tisQueued = true;\n\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\tcb.apply(context, args);\n\t\t\t\t\tisQueued = false;\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t};\n\n})(mui, window);\n(function($) {\n\tvar initializing = false,\n\t\tfnTest = /xyz/.test(function() {\n\t\t\txyz;\n\t\t}) ? /\\b_super\\b/ : /.*/;\n\n\tvar Class = function() {};\n\tClass.extend = function(prop) {\n\t\tvar _super = this.prototype;\n\t\tinitializing = true;\n\t\tvar prototype = new this();\n\t\tinitializing = false;\n\t\tfor (var name in prop) {\n\t\t\tprototype[name] = typeof prop[name] == \"function\" &&\n\t\t\t\ttypeof _super[name] == \"function\" && fnTest.test(prop[name]) ?\n\t\t\t\t(function(name, fn) {\n\t\t\t\t\treturn function() {\n\t\t\t\t\t\tvar tmp = this._super;\n\n\t\t\t\t\t\tthis._super = _super[name];\n\n\t\t\t\t\t\tvar ret = fn.apply(this, arguments);\n\t\t\t\t\t\tthis._super = tmp;\n\n\t\t\t\t\t\treturn ret;\n\t\t\t\t\t};\n\t\t\t\t})(name, prop[name]) :\n\t\t\t\tprop[name];\n\t\t}\n\t\tfunction Class() {\n\t\t\tif (!initializing && this.init)\n\t\t\t\tthis.init.apply(this, arguments);\n\t\t}\n\t\tClass.prototype = prototype;\n\t\tClass.prototype.constructor = Class;\n\t\tClass.extend = arguments.callee;\n\t\treturn Class;\n\t};\n\t$.Class = Class;\n})(mui);\n(function($, document, undefined) {\n    var CLASS_PULL_TOP_POCKET = 'mui-pull-top-pocket';\n    var CLASS_PULL_BOTTOM_POCKET = 'mui-pull-bottom-pocket';\n    var CLASS_PULL = 'mui-pull';\n    var CLASS_PULL_LOADING = 'mui-pull-loading';\n    var CLASS_PULL_CAPTION = 'mui-pull-caption';\n    var CLASS_PULL_CAPTION_DOWN = 'mui-pull-caption-down';\n    var CLASS_PULL_CAPTION_REFRESH = 'mui-pull-caption-refresh';\n    var CLASS_PULL_CAPTION_NOMORE = 'mui-pull-caption-nomore';\n\n    var CLASS_ICON = 'mui-icon';\n    var CLASS_SPINNER = 'mui-spinner';\n    var CLASS_ICON_PULLDOWN = 'mui-icon-pulldown';\n\n    var CLASS_BLOCK = 'mui-block';\n    var CLASS_HIDDEN = 'mui-hidden';\n    var CLASS_VISIBILITY = 'mui-visibility';\n\n    var CLASS_LOADING_UP = CLASS_PULL_LOADING + ' ' + CLASS_ICON + ' ' + CLASS_ICON_PULLDOWN;\n    var CLASS_LOADING_DOWN = CLASS_PULL_LOADING + ' ' + CLASS_ICON + ' ' + CLASS_ICON_PULLDOWN;\n    var CLASS_LOADING = CLASS_PULL_LOADING + ' ' + CLASS_ICON + ' ' + CLASS_SPINNER;\n\n    var pocketHtml = ['<div class=\"' + CLASS_PULL + '\">', '<div class=\"{icon}\"></div>', '<div class=\"' + CLASS_PULL_CAPTION + '\">{contentrefresh}</div>', '</div>'].join('');\n\n    var PullRefresh = {\n        init: function(element, options) {\n            this._super(element, $.extend(true, {\n                scrollY: true,\n                scrollX: false,\n                indicators: true,\n                deceleration: 0.003,\n                down: {\n                    height: 50,\n                    contentinit: '下拉可以刷新',\n                    contentdown: '下拉可以刷新',\n                    contentover: '释放立即刷新',\n                    contentrefresh: '正在刷新...'\n                },\n                up: {\n                    height: 50,\n                    auto: false,\n                    contentinit: '上拉显示更多',\n                    contentdown: '上拉显示更多',\n                    contentrefresh: '正在加载...',\n                    contentnomore: '没有更多数据了',\n                    duration: 300\n                }\n            }, options));\n        },\n        _init: function() {\n            this._super();\n            this._initPocket();\n        },\n        _initPulldownRefresh: function() {\n            this.pulldown = true;\n            if (this.topPocket) {\n                this.pullPocket = this.topPocket;\n                this.pullPocket.classList.add(CLASS_BLOCK);\n                this.pullPocket.classList.add(CLASS_VISIBILITY);\n                this.pullCaption = this.topCaption;\n                this.pullLoading = this.topLoading;\n            }\n        },\n        _initPullupRefresh: function() {\n            this.pulldown = false;\n            if (this.bottomPocket) {\n                this.pullPocket = this.bottomPocket;\n                this.pullPocket.classList.add(CLASS_BLOCK);\n                this.pullPocket.classList.add(CLASS_VISIBILITY);\n                this.pullCaption = this.bottomCaption;\n                this.pullLoading = this.bottomLoading;\n            }\n        },\n        _initPocket: function() {\n            var options = this.options;\n            if (options.down && options.down.hasOwnProperty('callback')) {\n                this.topPocket = this.scroller.querySelector('.' + CLASS_PULL_TOP_POCKET);\n                if (!this.topPocket) {\n                    this.topPocket = this._createPocket(CLASS_PULL_TOP_POCKET, options.down, CLASS_LOADING_DOWN);\n                    this.wrapper.insertBefore(this.topPocket, this.wrapper.firstChild);\n                }\n                this.topLoading = this.topPocket.querySelector('.' + CLASS_PULL_LOADING);\n                this.topCaption = this.topPocket.querySelector('.' + CLASS_PULL_CAPTION);\n            }\n            if (options.up && options.up.hasOwnProperty('callback')) {\n                this.bottomPocket = this.scroller.querySelector('.' + CLASS_PULL_BOTTOM_POCKET);\n                if (!this.bottomPocket) {\n                    this.bottomPocket = this._createPocket(CLASS_PULL_BOTTOM_POCKET, options.up, CLASS_LOADING);\n                    this.scroller.appendChild(this.bottomPocket);\n                }\n                this.bottomLoading = this.bottomPocket.querySelector('.' + CLASS_PULL_LOADING);\n                this.bottomCaption = this.bottomPocket.querySelector('.' + CLASS_PULL_CAPTION);\n                //TODO only for h5\n                this.wrapper.addEventListener('scrollbottom', this);\n            }\n        },\n        _createPocket: function(clazz, options, iconClass) {\n            var pocket = document.createElement('div');\n            pocket.className = clazz;\n            pocket.innerHTML = pocketHtml.replace('{contentrefresh}', options.contentinit).replace('{icon}', iconClass);\n            return pocket;\n        },\n        _resetPullDownLoading: function() {\n            var loading = this.pullLoading;\n            if (loading) {\n                this.pullCaption.innerHTML = this.options.down.contentdown;\n                loading.style.webkitTransition = \"\";\n                loading.style.webkitTransform = \"\";\n                loading.style.webkitAnimation = \"\";\n                loading.className = CLASS_LOADING_DOWN;\n            }\n        },\n        _setCaptionClass: function(isPulldown, caption, title) {\n            if (!isPulldown) {\n                switch (title) {\n                    case this.options.up.contentdown:\n                        caption.className = CLASS_PULL_CAPTION + ' ' + CLASS_PULL_CAPTION_DOWN;\n                        break;\n                    case this.options.up.contentrefresh:\n                        caption.className = CLASS_PULL_CAPTION + ' ' + CLASS_PULL_CAPTION_REFRESH\n                        break;\n                    case this.options.up.contentnomore:\n                        caption.className = CLASS_PULL_CAPTION + ' ' + CLASS_PULL_CAPTION_NOMORE;\n                        break;\n                }\n            }\n        },\n        _setCaption: function(title, reset) {\n            if (this.loading) {\n                return;\n            }\n            var options = this.options;\n            var pocket = this.pullPocket;\n            var caption = this.pullCaption;\n            var loading = this.pullLoading;\n            var isPulldown = this.pulldown;\n            var self = this;\n            if (pocket) {\n                if (reset) {\n                    setTimeout(function() {\n                        caption.innerHTML = self.lastTitle = title;\n                        if (isPulldown) {\n                            loading.className = CLASS_LOADING_DOWN;\n                        } else {\n                            self._setCaptionClass(false, caption, title);\n                            loading.className = CLASS_LOADING;\n                        }\n                        loading.style.webkitAnimation = \"\";\n                        loading.style.webkitTransition = \"\";\n                        loading.style.webkitTransform = \"\";\n                    }, 100);\n                } else {\n                    if (title !== this.lastTitle) {\n                        caption.innerHTML = title;\n                        if (isPulldown) {\n                            if (title === options.down.contentrefresh) {\n                                loading.className = CLASS_LOADING;\n                                loading.style.webkitAnimation = \"spinner-spin 1s step-end infinite\";\n                            } else if (title === options.down.contentover) {\n                                loading.className = CLASS_LOADING_UP;\n                                loading.style.webkitTransition = \"-webkit-transform 0.3s ease-in\";\n                                loading.style.webkitTransform = \"rotate(180deg)\";\n                            } else if (title === options.down.contentdown) {\n                                loading.className = CLASS_LOADING_DOWN;\n                                loading.style.webkitTransition = \"-webkit-transform 0.3s ease-in\";\n                                loading.style.webkitTransform = \"rotate(0deg)\";\n                            }\n                        } else {\n                            if (title === options.up.contentrefresh) {\n                                loading.className = CLASS_LOADING + ' ' + CLASS_VISIBILITY;\n                            } else {\n                                loading.className = CLASS_LOADING + ' ' + CLASS_HIDDEN;\n                            }\n                            self._setCaptionClass(false, caption, title);\n                        }\n                        this.lastTitle = title;\n                    }\n                }\n\n            }\n        }\n    };\n    $.PullRefresh = PullRefresh;\n})(mui, document);\n(function($, window, document, undefined) {\n\tvar CLASS_SCROLL = 'mui-scroll';\n\tvar CLASS_SCROLLBAR = 'mui-scrollbar';\n\tvar CLASS_INDICATOR = 'mui-scrollbar-indicator';\n\tvar CLASS_SCROLLBAR_VERTICAL = CLASS_SCROLLBAR + '-vertical';\n\tvar CLASS_SCROLLBAR_HORIZONTAL = CLASS_SCROLLBAR + '-horizontal';\n\n\tvar CLASS_ACTIVE = 'mui-active';\n\n\tvar ease = {\n\t\tquadratic: {\n\t\t\tstyle: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)',\n\t\t\tfn: function(k) {\n\t\t\t\treturn k * (2 - k);\n\t\t\t}\n\t\t},\n\t\tcircular: {\n\t\t\tstyle: 'cubic-bezier(0.1, 0.57, 0.1, 1)',\n\t\t\tfn: function(k) {\n\t\t\t\treturn Math.sqrt(1 - (--k * k));\n\t\t\t}\n\t\t},\n\t\toutCirc: {\n\t\t\tstyle: 'cubic-bezier(0.075, 0.82, 0.165, 1)'\n\t\t},\n\t\toutCubic: {\n\t\t\tstyle: 'cubic-bezier(0.165, 0.84, 0.44, 1)'\n\t\t}\n\t}\n\tvar Scroll = $.Class.extend({\n\t\tinit: function(element, options) {\n\t\t\tthis.wrapper = this.element = element;\n\t\t\tthis.scroller = this.wrapper.children[0];\n\t\t\tthis.scrollerStyle = this.scroller && this.scroller.style;\n\t\t\tthis.stopped = false;\n\n\t\t\tthis.options = $.extend(true, {\n\t\t\t\tscrollY: true, //是否竖向滚动\n\t\t\t\tscrollX: false, //是否横向滚动\n\t\t\t\tstartX: 0, //初始化时滚动至x\n\t\t\t\tstartY: 0, //初始化时滚动至y\n\n\t\t\t\tindicators: true, //是否显示滚动条\n\t\t\t\tstopPropagation: false,\n\t\t\t\thardwareAccelerated: true,\n\t\t\t\tfixedBadAndorid: false,\n\t\t\t\tpreventDefaultException: {\n\t\t\t\t\ttagName: /^(INPUT|TEXTAREA|BUTTON|SELECT|VIDEO)$/\n\t\t\t\t},\n\t\t\t\tmomentum: true,\n\n\t\t\t\tsnapX: 0.5, //横向切换距离(以当前容器宽度为基准)\n\t\t\t\tsnap: false, //图片轮播，拖拽式选项卡\n\n\t\t\t\tbounce: true, //是否启用回弹\n\t\t\t\tbounceTime: 500, //回弹动画时间\n\t\t\t\tbounceEasing: ease.outCirc, //回弹动画曲线\n\n\t\t\t\tscrollTime: 500,\n\t\t\t\tscrollEasing: ease.outCubic, //轮播动画曲线\n\n\t\t\t\tdirectionLockThreshold: 5,\n\n\t\t\t\tparallaxElement: false, //视差元素\n\t\t\t\tparallaxRatio: 0.5\n\t\t\t}, options);\n\n\t\t\tthis.x = 0;\n\t\t\tthis.y = 0;\n\t\t\tthis.translateZ = this.options.hardwareAccelerated ? ' translateZ(0)' : '';\n\n\t\t\tthis._init();\n\t\t\tif (this.scroller) {\n\t\t\t\tthis.refresh();\n\t\t\t\t//\t\t\t\tif (this.options.startX !== 0 || this.options.startY !== 0) { //需要判断吗？后续根据实际情况再看看\n\t\t\t\tthis.scrollTo(this.options.startX, this.options.startY);\n\t\t\t\t//\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t_init: function() {\n\t\t\tthis._initParallax();\n\t\t\tthis._initIndicators();\n\t\t\tthis._initEvent();\n\t\t},\n\t\t_initParallax: function() {\n\t\t\tif (this.options.parallaxElement) {\n\t\t\t\tthis.parallaxElement = document.querySelector(this.options.parallaxElement);\n\t\t\t\tthis.parallaxStyle = this.parallaxElement.style;\n\t\t\t\tthis.parallaxHeight = this.parallaxElement.offsetHeight;\n\t\t\t\tthis.parallaxImgStyle = this.parallaxElement.querySelector('img').style;\n\t\t\t}\n\t\t},\n\t\t_initIndicators: function() {\n\t\t\tvar self = this;\n\t\t\tself.indicators = [];\n\t\t\tif (!this.options.indicators) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar indicators = [],\n\t\t\t\tindicator;\n\n\t\t\t// Vertical scrollbar\n\t\t\tif (self.options.scrollY) {\n\t\t\t\tindicator = {\n\t\t\t\t\tel: this._createScrollBar(CLASS_SCROLLBAR_VERTICAL),\n\t\t\t\t\tlistenX: false\n\t\t\t\t};\n\n\t\t\t\tthis.wrapper.appendChild(indicator.el);\n\t\t\t\tindicators.push(indicator);\n\t\t\t}\n\n\t\t\t// Horizontal scrollbar\n\t\t\tif (this.options.scrollX) {\n\t\t\t\tindicator = {\n\t\t\t\t\tel: this._createScrollBar(CLASS_SCROLLBAR_HORIZONTAL),\n\t\t\t\t\tlistenY: false\n\t\t\t\t};\n\n\t\t\t\tthis.wrapper.appendChild(indicator.el);\n\t\t\t\tindicators.push(indicator);\n\t\t\t}\n\n\t\t\tfor (var i = indicators.length; i--;) {\n\t\t\t\tthis.indicators.push(new Indicator(this, indicators[i]));\n\t\t\t}\n\n\t\t},\n\t\t_initSnap: function() {\n\t\t\tthis.currentPage = {};\n\t\t\tthis.pages = [];\n\t\t\tvar snaps = this.snaps;\n\t\t\tvar length = snaps.length;\n\t\t\tvar m = 0;\n\t\t\tvar n = -1;\n\t\t\tvar x = 0;\n\t\t\tvar leftX = 0;\n\t\t\tvar rightX = 0;\n\t\t\tvar snapX = 0;\n\t\t\tfor (var i = 0; i < length; i++) {\n\t\t\t\tvar snap = snaps[i];\n\t\t\t\tvar offsetLeft = snap.offsetLeft;\n\t\t\t\tvar offsetWidth = snap.offsetWidth;\n\t\t\t\tif (i === 0 || offsetLeft <= snaps[i - 1].offsetLeft) {\n\t\t\t\t\tm = 0;\n\t\t\t\t\tn++;\n\t\t\t\t}\n\t\t\t\tif (!this.pages[m]) {\n\t\t\t\t\tthis.pages[m] = [];\n\t\t\t\t}\n\t\t\t\tx = this._getSnapX(offsetLeft);\n\t\t\t\tsnapX = Math.round((offsetWidth) * this.options.snapX);\n\t\t\t\tleftX = x - snapX;\n\t\t\t\trightX = x - offsetWidth + snapX;\n\t\t\t\tthis.pages[m][n] = {\n\t\t\t\t\tx: x,\n\t\t\t\t\tleftX: leftX,\n\t\t\t\t\trightX: rightX,\n\t\t\t\t\tpageX: m,\n\t\t\t\t\telement: snap\n\t\t\t\t}\n\t\t\t\tif (snap.classList.contains(CLASS_ACTIVE)) {\n\t\t\t\t\tthis.currentPage = this.pages[m][0];\n\t\t\t\t}\n\t\t\t\tif (x >= this.maxScrollX) {\n\t\t\t\t\tm++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.options.startX = this.currentPage.x || 0;\n\t\t},\n\t\t_getSnapX: function(offsetLeft) {\n\t\t\treturn Math.max(Math.min(0, -offsetLeft + (this.wrapperWidth / 2)), this.maxScrollX);\n\t\t},\n\t\t_gotoPage: function(index) {\n\t\t\tthis.currentPage = this.pages[Math.min(index, this.pages.length - 1)][0];\n\t\t\tfor (var i = 0, len = this.snaps.length; i < len; i++) {\n\t\t\t\tif (i === index) {\n\t\t\t\t\tthis.snaps[i].classList.add(CLASS_ACTIVE);\n\t\t\t\t} else {\n\t\t\t\t\tthis.snaps[i].classList.remove(CLASS_ACTIVE);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.scrollTo(this.currentPage.x, 0, this.options.scrollTime);\n\t\t},\n\t\t_nearestSnap: function(x) {\n\t\t\tif (!this.pages.length) {\n\t\t\t\treturn {\n\t\t\t\t\tx: 0,\n\t\t\t\t\tpageX: 0\n\t\t\t\t};\n\t\t\t}\n\t\t\tvar i = 0;\n\t\t\tvar length = this.pages.length;\n\t\t\tif (x > 0) {\n\t\t\t\tx = 0;\n\t\t\t} else if (x < this.maxScrollX) {\n\t\t\t\tx = this.maxScrollX;\n\t\t\t}\n\t\t\tfor (; i < length; i++) {\n\t\t\t\tvar nearestX = this.direction === 'left' ? this.pages[i][0].leftX : this.pages[i][0].rightX;\n\t\t\t\tif (x >= nearestX) {\n\t\t\t\t\treturn this.pages[i][0];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tx: 0,\n\t\t\t\tpageX: 0\n\t\t\t};\n\t\t},\n\t\t_initEvent: function(detach) {\n\t\t\tvar action = detach ? 'removeEventListener' : 'addEventListener';\n\t\t\twindow[action]('orientationchange', this);\n\t\t\twindow[action]('resize', this);\n\n\t\t\tthis.scroller[action]('webkitTransitionEnd', this);\n\n\t\t\tthis.wrapper[action]($.EVENT_START, this);\n\t\t\tthis.wrapper[action]($.EVENT_CANCEL, this);\n\t\t\tthis.wrapper[action]($.EVENT_END, this);\n\t\t\tthis.wrapper[action]('drag', this);\n\t\t\tthis.wrapper[action]('dragend', this);\n\t\t\tthis.wrapper[action]('flick', this);\n\t\t\tthis.wrapper[action]('scrollend', this);\n\t\t\tif (this.options.scrollX) {\n\t\t\t\tthis.wrapper[action]('swiperight', this);\n\t\t\t}\n\t\t\tvar segmentedControl = this.wrapper.querySelector('.mui-segmented-control');\n\t\t\tif (segmentedControl) { //靠，这个bug排查了一下午，阻止hash跳转，一旦hash跳转会导致可拖拽选项卡的tab不见\n\t\t\t\tmui(segmentedControl)[detach ? 'off' : 'on']('click', 'a', $.preventDefault);\n\t\t\t}\n\n\t\t\tthis.wrapper[action]('scrollstart', this);\n\t\t\tthis.wrapper[action]('refresh', this);\n\t\t},\n\t\t_handleIndicatorScrollend: function() {\n\t\t\tthis.indicators.map(function(indicator) {\n\t\t\t\tindicator.fade();\n\t\t\t});\n\t\t},\n\t\t_handleIndicatorScrollstart: function() {\n\t\t\tthis.indicators.map(function(indicator) {\n\t\t\t\tindicator.fade(1);\n\t\t\t});\n\t\t},\n\t\t_handleIndicatorRefresh: function() {\n\t\t\tthis.indicators.map(function(indicator) {\n\t\t\t\tindicator.refresh();\n\t\t\t});\n\t\t},\n\t\thandleEvent: function(e) {\n\t\t\tif (this.stopped) {\n\t\t\t\tthis.resetPosition();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (e.type) {\n\t\t\t\tcase $.EVENT_START:\n\t\t\t\t\tthis._start(e);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'drag':\n\t\t\t\t\tthis.options.stopPropagation && e.stopPropagation();\n\t\t\t\t\tthis._drag(e);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'dragend':\n\t\t\t\tcase 'flick':\n\t\t\t\t\tthis.options.stopPropagation && e.stopPropagation();\n\t\t\t\t\tthis._flick(e);\n\t\t\t\t\tbreak;\n\t\t\t\tcase $.EVENT_CANCEL:\n\t\t\t\tcase $.EVENT_END:\n\t\t\t\t\tthis._end(e);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'webkitTransitionEnd':\n\t\t\t\t\tthis.transitionTimer && this.transitionTimer.cancel();\n\t\t\t\t\tthis._transitionEnd(e);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'scrollstart':\n\t\t\t\t\tthis._handleIndicatorScrollstart(e);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'scrollend':\n\t\t\t\t\tthis._handleIndicatorScrollend(e);\n\t\t\t\t\tthis._scrollend(e);\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'orientationchange':\n\t\t\t\tcase 'resize':\n\t\t\t\t\tthis._resize();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'swiperight':\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'refresh':\n\t\t\t\t\tthis._handleIndicatorRefresh(e);\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\t\t},\n\t\t_start: function(e) {\n\t\t\tthis.moved = this.needReset = false;\n\t\t\tthis._transitionTime();\n\t\t\tif (this.isInTransition) {\n\t\t\t\tthis.needReset = true;\n\t\t\t\tthis.isInTransition = false;\n\t\t\t\tvar pos = $.parseTranslateMatrix($.getStyles(this.scroller, 'webkitTransform'));\n\t\t\t\tthis.setTranslate(Math.round(pos.x), Math.round(pos.y));\n\t\t\t\t//\t\t\t\tthis.resetPosition(); //reset\n\t\t\t\t$.trigger(this.scroller, 'scrollend', this);\n\t\t\t\t//\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t\tthis.reLayout();\n\t\t\t$.trigger(this.scroller, 'beforescrollstart', this);\n\t\t},\n\t\t_getDirectionByAngle: function(angle) {\n\t\t\tif (angle < -80 && angle > -100) {\n\t\t\t\treturn 'up';\n\t\t\t} else if (angle >= 80 && angle < 100) {\n\t\t\t\treturn 'down';\n\t\t\t} else if (angle >= 170 || angle <= -170) {\n\t\t\t\treturn 'left';\n\t\t\t} else if (angle >= -35 && angle <= 10) {\n\t\t\t\treturn 'right';\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\t\t_drag: function(e) {\n\t\t\t//\t\t\tif (this.needReset) {\n\t\t\t//\t\t\t\te.stopPropagation(); //disable parent drag(nested scroller)\n\t\t\t//\t\t\t\treturn;\n\t\t\t//\t\t\t}\n\t\t\tvar detail = e.detail;\n\t\t\tif (this.options.scrollY || detail.direction === 'up' || detail.direction === 'down') { //如果是竖向滚动或手势方向是上或下\n\t\t\t\t//ios8 hack\n\t\t\t\tif ($.os.ios && parseFloat($.os.version) >= 8) { //多webview时，离开当前webview会导致后续touch事件不触发\n\t\t\t\t\tvar clientY = detail.gesture.touches[0].clientY;\n\t\t\t\t\t//下拉刷新 or 上拉加载\n\t\t\t\t\tif ((clientY + 10) > window.innerHeight || clientY < 10) {\n\t\t\t\t\t\tthis.resetPosition(this.options.bounceTime);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar isPreventDefault = isReturn = false;\n\t\t\tvar direction = this._getDirectionByAngle(detail.angle);\n\t\t\tif (detail.direction === 'left' || detail.direction === 'right') {\n\t\t\t\tif (this.options.scrollX) {\n\t\t\t\t\tisPreventDefault = true;\n\t\t\t\t\tif (!this.moved) { //识别角度(该角度导致轮播不灵敏)\n\t\t\t\t\t\t//\t\t\t\t\t\tif (direction !== 'left' && direction !== 'right') {\n\t\t\t\t\t\t//\t\t\t\t\t\t\tisReturn = true;\n\t\t\t\t\t\t//\t\t\t\t\t\t} else {\n\t\t\t\t\t\t$.gestures.session.lockDirection = true; //锁定方向\n\t\t\t\t\t\t$.gestures.session.startDirection = detail.direction;\n\t\t\t\t\t\t//\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (this.options.scrollY && !this.moved) {\n\t\t\t\t\tisReturn = true;\n\t\t\t\t}\n\t\t\t} else if (detail.direction === 'up' || detail.direction === 'down') {\n\t\t\t\tif (this.options.scrollY) {\n\t\t\t\t\tisPreventDefault = true;\n\t\t\t\t\t//\t\t\t\t\tif (!this.moved) { //识别角度,竖向滚动似乎没必要进行小角度验证\n\t\t\t\t\t//\t\t\t\t\t\tif (direction !== 'up' && direction !== 'down') {\n\t\t\t\t\t//\t\t\t\t\t\t\tisReturn = true;\n\t\t\t\t\t//\t\t\t\t\t\t}\n\t\t\t\t\t//\t\t\t\t\t}\n\t\t\t\t\tif (!this.moved) {\n\t\t\t\t\t\t$.gestures.session.lockDirection = true; //锁定方向\n\t\t\t\t\t\t$.gestures.session.startDirection = detail.direction;\n\t\t\t\t\t}\n\t\t\t\t} else if (this.options.scrollX && !this.moved) {\n\t\t\t\t\tisReturn = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tisReturn = true;\n\t\t\t}\n\t\t\tif (this.moved || isPreventDefault) {\n\t\t\t\te.stopPropagation(); //阻止冒泡(scroll类嵌套)\n\t\t\t\tdetail.gesture && detail.gesture.preventDefault();\n\t\t\t}\n\t\t\tif (isReturn) { //禁止非法方向滚动\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!this.moved) {\n\t\t\t\t$.trigger(this.scroller, 'scrollstart', this);\n\t\t\t} else {\n\t\t\t\te.stopPropagation(); //move期间阻止冒泡(scroll嵌套)\n\t\t\t}\n\t\t\tvar deltaX = 0;\n\t\t\tvar deltaY = 0;\n\t\t\tif (!this.moved) { //start\n\t\t\t\tdeltaX = detail.deltaX;\n\t\t\t\tdeltaY = detail.deltaY;\n\t\t\t} else { //move\n\t\t\t\tdeltaX = detail.deltaX - $.gestures.session.prevTouch.deltaX;\n\t\t\t\tdeltaY = detail.deltaY - $.gestures.session.prevTouch.deltaY;\n\t\t\t}\n\t\t\tvar absDeltaX = Math.abs(detail.deltaX);\n\t\t\tvar absDeltaY = Math.abs(detail.deltaY);\n\t\t\tif (absDeltaX > absDeltaY + this.options.directionLockThreshold) {\n\t\t\t\tdeltaY = 0;\n\t\t\t} else if (absDeltaY >= absDeltaX + this.options.directionLockThreshold) {\n\t\t\t\tdeltaX = 0;\n\t\t\t}\n\n\t\t\tdeltaX = this.hasHorizontalScroll ? deltaX : 0;\n\t\t\tdeltaY = this.hasVerticalScroll ? deltaY : 0;\n\t\t\tvar newX = this.x + deltaX;\n\t\t\tvar newY = this.y + deltaY;\n\t\t\t// Slow down if outside of the boundaries\n\t\t\tif (newX > 0 || newX < this.maxScrollX) {\n\t\t\t\tnewX = this.options.bounce ? this.x + deltaX / 3 : newX > 0 ? 0 : this.maxScrollX;\n\t\t\t}\n\t\t\tif (newY > 0 || newY < this.maxScrollY) {\n\t\t\t\tnewY = this.options.bounce ? this.y + deltaY / 3 : newY > 0 ? 0 : this.maxScrollY;\n\t\t\t}\n\n\t\t\tif (!this.requestAnimationFrame) {\n\t\t\t\tthis._updateTranslate();\n\t\t\t}\n\t\t\tthis.direction = detail.deltaX > 0 ? 'right' : 'left';\n\t\t\tthis.moved = true;\n\t\t\tthis.x = newX;\n\t\t\tthis.y = newY;\n\t\t\t$.trigger(this.scroller, 'scroll', this);\n\t\t},\n\t\t_flick: function(e) {\n\t\t\t//\t\t\tif (!this.moved || this.needReset) {\n\t\t\t//\t\t\t\treturn;\n\t\t\t//\t\t\t}\n\t\t\tif (!this.moved) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.stopPropagation();\n\t\t\tvar detail = e.detail;\n\t\t\tthis._clearRequestAnimationFrame();\n\t\t\tif (e.type === 'dragend' && detail.flick) { //dragend\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar newX = Math.round(this.x);\n\t\t\tvar newY = Math.round(this.y);\n\n\t\t\tthis.isInTransition = false;\n\t\t\t// reset if we are outside of the boundaries\n\t\t\tif (this.resetPosition(this.options.bounceTime)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.scrollTo(newX, newY); // ensures that the last position is rounded\n\n\t\t\tif (e.type === 'dragend') { //dragend\n\t\t\t\t$.trigger(this.scroller, 'scrollend', this);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar time = 0;\n\t\t\tvar easing = '';\n\t\t\t// start momentum animation if needed\n\t\t\tif (this.options.momentum && detail.flickTime < 300) {\n\t\t\t\tmomentumX = this.hasHorizontalScroll ? this._momentum(this.x, detail.flickDistanceX, detail.flickTime, this.maxScrollX, this.options.bounce ? this.wrapperWidth : 0, this.options.deceleration) : {\n\t\t\t\t\tdestination: newX,\n\t\t\t\t\tduration: 0\n\t\t\t\t};\n\t\t\t\tmomentumY = this.hasVerticalScroll ? this._momentum(this.y, detail.flickDistanceY, detail.flickTime, this.maxScrollY, this.options.bounce ? this.wrapperHeight : 0, this.options.deceleration) : {\n\t\t\t\t\tdestination: newY,\n\t\t\t\t\tduration: 0\n\t\t\t\t};\n\t\t\t\tnewX = momentumX.destination;\n\t\t\t\tnewY = momentumY.destination;\n\t\t\t\ttime = Math.max(momentumX.duration, momentumY.duration);\n\t\t\t\tthis.isInTransition = true;\n\t\t\t}\n\n\t\t\tif (newX != this.x || newY != this.y) {\n\t\t\t\tif (newX > 0 || newX < this.maxScrollX || newY > 0 || newY < this.maxScrollY) {\n\t\t\t\t\teasing = ease.quadratic;\n\t\t\t\t}\n\t\t\t\tthis.scrollTo(newX, newY, time, easing);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$.trigger(this.scroller, 'scrollend', this);\n\t\t\t//\t\t\te.stopPropagation();\n\t\t},\n\t\t_end: function(e) {\n\t\t\tthis.needReset = false;\n\t\t\tif ((!this.moved && this.needReset) || e.type === $.EVENT_CANCEL) {\n\t\t\t\tthis.resetPosition();\n\t\t\t}\n\t\t},\n\t\t_transitionEnd: function(e) {\n\t\t\tif (e.target != this.scroller || !this.isInTransition) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._transitionTime();\n\t\t\tif (!this.resetPosition(this.options.bounceTime)) {\n\t\t\t\tthis.isInTransition = false;\n\t\t\t\t$.trigger(this.scroller, 'scrollend', this);\n\t\t\t}\n\t\t},\n\t\t_scrollend: function(e) {\n\t\t\tif ((this.y === 0 && this.maxScrollY === 0) || (Math.abs(this.y) > 0 && this.y <= this.maxScrollY)) {\n\t\t\t\t$.trigger(this.scroller, 'scrollbottom', this);\n\t\t\t}\n\t\t},\n\t\t_resize: function() {\n\t\t\tvar that = this;\n\t\t\tclearTimeout(that.resizeTimeout);\n\t\t\tthat.resizeTimeout = setTimeout(function() {\n\t\t\t\tthat.refresh();\n\t\t\t}, that.options.resizePolling);\n\t\t},\n\t\t_transitionTime: function(time) {\n\t\t\ttime = time || 0;\n\t\t\tthis.scrollerStyle['webkitTransitionDuration'] = time + 'ms';\n\t\t\tif (this.parallaxElement && this.options.scrollY) { //目前仅支持竖向视差效果\n\t\t\t\tthis.parallaxStyle['webkitTransitionDuration'] = time + 'ms';\n\t\t\t}\n\t\t\tif (this.options.fixedBadAndorid && !time && $.os.isBadAndroid) {\n\t\t\t\tthis.scrollerStyle['webkitTransitionDuration'] = '0.001s';\n\t\t\t\tif (this.parallaxElement && this.options.scrollY) { //目前仅支持竖向视差效果\n\t\t\t\t\tthis.parallaxStyle['webkitTransitionDuration'] = '0.001s';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.indicators) {\n\t\t\t\tfor (var i = this.indicators.length; i--;) {\n\t\t\t\t\tthis.indicators[i].transitionTime(time);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (time) { //自定义timer，保证webkitTransitionEnd始终触发\n\t\t\t\tthis.transitionTimer && this.transitionTimer.cancel();\n\t\t\t\tthis.transitionTimer = $.later(function() {\n\t\t\t\t\t$.trigger(this.scroller, 'webkitTransitionEnd');\n\t\t\t\t}, time + 100, this);\n\t\t\t}\n\t\t},\n\t\t_transitionTimingFunction: function(easing) {\n\t\t\tthis.scrollerStyle['webkitTransitionTimingFunction'] = easing;\n\t\t\tif (this.parallaxElement && this.options.scrollY) { //目前仅支持竖向视差效果\n\t\t\t\tthis.parallaxStyle['webkitTransitionDuration'] = easing;\n\t\t\t}\n\t\t\tif (this.indicators) {\n\t\t\t\tfor (var i = this.indicators.length; i--;) {\n\t\t\t\t\tthis.indicators[i].transitionTimingFunction(easing);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t_translate: function(x, y) {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t},\n\t\t_clearRequestAnimationFrame: function() {\n\t\t\tif (this.requestAnimationFrame) {\n\t\t\t\tcancelAnimationFrame(this.requestAnimationFrame);\n\t\t\t\tthis.requestAnimationFrame = null;\n\t\t\t}\n\t\t},\n\t\t_updateTranslate: function() {\n\t\t\tvar self = this;\n\t\t\tif (self.x !== self.lastX || self.y !== self.lastY) {\n\t\t\t\tself.setTranslate(self.x, self.y);\n\t\t\t}\n\t\t\tself.requestAnimationFrame = requestAnimationFrame(function() {\n\t\t\t\tself._updateTranslate();\n\t\t\t});\n\t\t},\n\t\t_createScrollBar: function(clazz) {\n\t\t\tvar scrollbar = document.createElement('div');\n\t\t\tvar indicator = document.createElement('div');\n\t\t\tscrollbar.className = CLASS_SCROLLBAR + ' ' + clazz;\n\t\t\tindicator.className = CLASS_INDICATOR;\n\t\t\tscrollbar.appendChild(indicator);\n\t\t\tif (clazz === CLASS_SCROLLBAR_VERTICAL) {\n\t\t\t\tthis.scrollbarY = scrollbar;\n\t\t\t\tthis.scrollbarIndicatorY = indicator;\n\t\t\t} else if (clazz === CLASS_SCROLLBAR_HORIZONTAL) {\n\t\t\t\tthis.scrollbarX = scrollbar;\n\t\t\t\tthis.scrollbarIndicatorX = indicator;\n\t\t\t}\n\t\t\tthis.wrapper.appendChild(scrollbar);\n\t\t\treturn scrollbar;\n\t\t},\n\t\t_preventDefaultException: function(el, exceptions) {\n\t\t\tfor (var i in exceptions) {\n\t\t\t\tif (exceptions[i].test(el[i])) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\t_reLayout: function() {\n\t\t\tif (!this.hasHorizontalScroll) {\n\t\t\t\tthis.maxScrollX = 0;\n\t\t\t\tthis.scrollerWidth = this.wrapperWidth;\n\t\t\t}\n\n\t\t\tif (!this.hasVerticalScroll) {\n\t\t\t\tthis.maxScrollY = 0;\n\t\t\t\tthis.scrollerHeight = this.wrapperHeight;\n\t\t\t}\n\n\t\t\tthis.indicators.map(function(indicator) {\n\t\t\t\tindicator.refresh();\n\t\t\t});\n\n\t\t\t//以防slider类嵌套使用\n\t\t\tif (this.options.snap && typeof this.options.snap === 'string') {\n\t\t\t\tvar items = this.scroller.querySelectorAll(this.options.snap);\n\t\t\t\tthis.itemLength = 0;\n\t\t\t\tthis.snaps = [];\n\t\t\t\tfor (var i = 0, len = items.length; i < len; i++) {\n\t\t\t\t\tvar item = items[i];\n\t\t\t\t\tif (item.parentNode === this.scroller) {\n\t\t\t\t\t\tthis.itemLength++;\n\t\t\t\t\t\tthis.snaps.push(item);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._initSnap(); //需要每次都_initSnap么。其实init的时候执行一次，后续resize的时候执行一次就行了吧.先这么做吧，如果影响性能，再调整\n\t\t\t}\n\t\t},\n\t\t_momentum: function(current, distance, time, lowerMargin, wrapperSize, deceleration) {\n\t\t\tvar speed = parseFloat(Math.abs(distance) / time),\n\t\t\t\tdestination,\n\t\t\t\tduration;\n\n\t\t\tdeceleration = deceleration === undefined ? 0.0006 : deceleration;\n\t\t\tdestination = current + (speed * speed) / (2 * deceleration) * (distance < 0 ? -1 : 1);\n\t\t\tduration = speed / deceleration;\n\t\t\tif (destination < lowerMargin) {\n\t\t\t\tdestination = wrapperSize ? lowerMargin - (wrapperSize / 2.5 * (speed / 8)) : lowerMargin;\n\t\t\t\tdistance = Math.abs(destination - current);\n\t\t\t\tduration = distance / speed;\n\t\t\t} else if (destination > 0) {\n\t\t\t\tdestination = wrapperSize ? wrapperSize / 2.5 * (speed / 8) : 0;\n\t\t\t\tdistance = Math.abs(current) + destination;\n\t\t\t\tduration = distance / speed;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tdestination: Math.round(destination),\n\t\t\t\tduration: duration\n\t\t\t};\n\t\t},\n\t\t_getTranslateStr: function(x, y) {\n\t\t\tif (this.options.hardwareAccelerated) {\n\t\t\t\treturn 'translate3d(' + x + 'px,' + y + 'px,0px) ' + this.translateZ;\n\t\t\t}\n\t\t\treturn 'translate(' + x + 'px,' + y + 'px) ';\n\t\t},\n\t\t//API\n\t\tsetStopped: function(stopped) {\n\t\t\t// this.stopped = !!stopped;\n\n\t\t\t// fixed ios双webview模式下拉刷新\n\t\t\tif(stopped) {\n\t\t\t\tthis.disablePullupToRefresh();\n\t\t\t\tthis.disablePulldownToRefresh();\n\t\t\t} else {\n\t\t\t\tthis.enablePullupToRefresh();\n\t\t\t\tthis.enablePulldownToRefresh();\n\t\t\t}\n\t\t},\n\t\tsetTranslate: function(x, y) {\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t\tthis.scrollerStyle['webkitTransform'] = this._getTranslateStr(x, y);\n\t\t\tif (this.parallaxElement && this.options.scrollY) { //目前仅支持竖向视差效果\n\t\t\t\tvar parallaxY = y * this.options.parallaxRatio;\n\t\t\t\tvar scale = 1 + parallaxY / ((this.parallaxHeight - parallaxY) / 2);\n\t\t\t\tif (scale > 1) {\n\t\t\t\t\tthis.parallaxImgStyle['opacity'] = 1 - parallaxY / 100 * this.options.parallaxRatio;\n\t\t\t\t\tthis.parallaxStyle['webkitTransform'] = this._getTranslateStr(0, -parallaxY) + ' scale(' + scale + ',' + scale + ')';\n\t\t\t\t} else {\n\t\t\t\t\tthis.parallaxImgStyle['opacity'] = 1;\n\t\t\t\t\tthis.parallaxStyle['webkitTransform'] = this._getTranslateStr(0, -1) + ' scale(1,1)';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.indicators) {\n\t\t\t\tfor (var i = this.indicators.length; i--;) {\n\t\t\t\t\tthis.indicators[i].updatePosition();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.lastX = this.x;\n\t\t\tthis.lastY = this.y;\n\t\t\t$.trigger(this.scroller, 'scroll', this);\n\t\t},\n\t\treLayout: function() {\n\t\t\tthis.wrapper.offsetHeight;\n\n\t\t\tvar paddingLeft = parseFloat($.getStyles(this.wrapper, 'padding-left')) || 0;\n\t\t\tvar paddingRight = parseFloat($.getStyles(this.wrapper, 'padding-right')) || 0;\n\t\t\tvar paddingTop = parseFloat($.getStyles(this.wrapper, 'padding-top')) || 0;\n\t\t\tvar paddingBottom = parseFloat($.getStyles(this.wrapper, 'padding-bottom')) || 0;\n\n\t\t\tvar clientWidth = this.wrapper.clientWidth;\n\t\t\tvar clientHeight = this.wrapper.clientHeight;\n\n\t\t\tthis.scrollerWidth = this.scroller.offsetWidth;\n\t\t\tthis.scrollerHeight = this.scroller.offsetHeight;\n\n\t\t\tthis.wrapperWidth = clientWidth - paddingLeft - paddingRight;\n\t\t\tthis.wrapperHeight = clientHeight - paddingTop - paddingBottom;\n\n\t\t\tthis.maxScrollX = Math.min(this.wrapperWidth - this.scrollerWidth, 0);\n\t\t\tthis.maxScrollY = Math.min(this.wrapperHeight - this.scrollerHeight, 0);\n\t\t\tthis.hasHorizontalScroll = this.options.scrollX && this.maxScrollX < 0;\n\t\t\tthis.hasVerticalScroll = this.options.scrollY && this.maxScrollY < 0;\n\t\t\tthis._reLayout();\n\t\t},\n\t\tresetPosition: function(time) {\n\t\t\tvar x = this.x,\n\t\t\t\ty = this.y;\n\n\t\t\ttime = time || 0;\n\t\t\tif (!this.hasHorizontalScroll || this.x > 0) {\n\t\t\t\tx = 0;\n\t\t\t} else if (this.x < this.maxScrollX) {\n\t\t\t\tx = this.maxScrollX;\n\t\t\t}\n\n\t\t\tif (!this.hasVerticalScroll || this.y > 0) {\n\t\t\t\ty = 0;\n\t\t\t} else if (this.y < this.maxScrollY) {\n\t\t\t\ty = this.maxScrollY;\n\t\t\t}\n\n\t\t\tif (x == this.x && y == this.y) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.scrollTo(x, y, time, this.options.scrollEasing);\n\n\t\t\treturn true;\n\t\t},\n\t\t_reInit: function() {\n\t\t\tvar groups = this.wrapper.querySelectorAll('.' + CLASS_SCROLL);\n\t\t\tfor (var i = 0, len = groups.length; i < len; i++) {\n\t\t\t\tif (groups[i].parentNode === this.wrapper) {\n\t\t\t\t\tthis.scroller = groups[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.scrollerStyle = this.scroller && this.scroller.style;\n\t\t},\n\t\trefresh: function() {\n\t\t\tthis._reInit();\n\t\t\tthis.reLayout();\n\t\t\t$.trigger(this.scroller, 'refresh', this);\n\t\t\tthis.resetPosition();\n\t\t},\n\t\tscrollTo: function(x, y, time, easing) {\n\t\t\tvar easing = easing || ease.circular;\n\t\t\t//\t\t\tthis.isInTransition = time > 0 && (this.lastX != x || this.lastY != y);\n\t\t\t//暂不严格判断x,y，否则会导致部分版本上不正常触发轮播\n\t\t\tthis.isInTransition = time > 0;\n\t\t\tif (this.isInTransition) {\n\t\t\t\tthis._clearRequestAnimationFrame();\n\t\t\t\tthis._transitionTimingFunction(easing.style);\n\t\t\t\tthis._transitionTime(time);\n\t\t\t\tthis.setTranslate(x, y);\n\t\t\t} else {\n\t\t\t\tthis.setTranslate(x, y);\n\t\t\t}\n\n\t\t},\n\t\tscrollToBottom: function(time, easing) {\n\t\t\ttime = time || this.options.scrollTime;\n\t\t\tthis.scrollTo(0, this.maxScrollY, time, easing);\n\t\t},\n\t\tgotoPage: function(index) {\n\t\t\tthis._gotoPage(index);\n\t\t},\n\t\tdestroy: function() {\n\t\t\tthis._initEvent(true); //detach\n\t\t\tdelete $.data[this.wrapper.getAttribute('data-scroll')];\n\t\t\tthis.wrapper.setAttribute('data-scroll', '');\n\t\t}\n\t});\n\t//Indicator\n\tvar Indicator = function(scroller, options) {\n\t\tthis.wrapper = typeof options.el == 'string' ? document.querySelector(options.el) : options.el;\n\t\tthis.wrapperStyle = this.wrapper.style;\n\t\tthis.indicator = this.wrapper.children[0];\n\t\tthis.indicatorStyle = this.indicator.style;\n\t\tthis.scroller = scroller;\n\n\t\tthis.options = $.extend({\n\t\t\tlistenX: true,\n\t\t\tlistenY: true,\n\t\t\tfade: false,\n\t\t\tspeedRatioX: 0,\n\t\t\tspeedRatioY: 0\n\t\t}, options);\n\n\t\tthis.sizeRatioX = 1;\n\t\tthis.sizeRatioY = 1;\n\t\tthis.maxPosX = 0;\n\t\tthis.maxPosY = 0;\n\n\t\tif (this.options.fade) {\n\t\t\tthis.wrapperStyle['webkitTransform'] = this.scroller.translateZ;\n\t\t\tthis.wrapperStyle['webkitTransitionDuration'] = this.options.fixedBadAndorid && $.os.isBadAndroid ? '0.001s' : '0ms';\n\t\t\tthis.wrapperStyle.opacity = '0';\n\t\t}\n\t}\n\tIndicator.prototype = {\n\t\thandleEvent: function(e) {\n\n\t\t},\n\t\ttransitionTime: function(time) {\n\t\t\ttime = time || 0;\n\t\t\tthis.indicatorStyle['webkitTransitionDuration'] = time + 'ms';\n\t\t\tif (this.scroller.options.fixedBadAndorid && !time && $.os.isBadAndroid) {\n\t\t\t\tthis.indicatorStyle['webkitTransitionDuration'] = '0.001s';\n\t\t\t}\n\t\t},\n\t\ttransitionTimingFunction: function(easing) {\n\t\t\tthis.indicatorStyle['webkitTransitionTimingFunction'] = easing;\n\t\t},\n\t\trefresh: function() {\n\t\t\tthis.transitionTime();\n\n\t\t\tif (this.options.listenX && !this.options.listenY) {\n\t\t\t\tthis.indicatorStyle.display = this.scroller.hasHorizontalScroll ? 'block' : 'none';\n\t\t\t} else if (this.options.listenY && !this.options.listenX) {\n\t\t\t\tthis.indicatorStyle.display = this.scroller.hasVerticalScroll ? 'block' : 'none';\n\t\t\t} else {\n\t\t\t\tthis.indicatorStyle.display = this.scroller.hasHorizontalScroll || this.scroller.hasVerticalScroll ? 'block' : 'none';\n\t\t\t}\n\n\t\t\tthis.wrapper.offsetHeight; // force refresh\n\n\t\t\tif (this.options.listenX) {\n\t\t\t\tthis.wrapperWidth = this.wrapper.clientWidth;\n\t\t\t\tthis.indicatorWidth = Math.max(Math.round(this.wrapperWidth * this.wrapperWidth / (this.scroller.scrollerWidth || this.wrapperWidth || 1)), 8);\n\t\t\t\tthis.indicatorStyle.width = this.indicatorWidth + 'px';\n\n\t\t\t\tthis.maxPosX = this.wrapperWidth - this.indicatorWidth;\n\n\t\t\t\tthis.minBoundaryX = 0;\n\t\t\t\tthis.maxBoundaryX = this.maxPosX;\n\n\t\t\t\tthis.sizeRatioX = this.options.speedRatioX || (this.scroller.maxScrollX && (this.maxPosX / this.scroller.maxScrollX));\n\t\t\t}\n\n\t\t\tif (this.options.listenY) {\n\t\t\t\tthis.wrapperHeight = this.wrapper.clientHeight;\n\t\t\t\tthis.indicatorHeight = Math.max(Math.round(this.wrapperHeight * this.wrapperHeight / (this.scroller.scrollerHeight || this.wrapperHeight || 1)), 8);\n\t\t\t\tthis.indicatorStyle.height = this.indicatorHeight + 'px';\n\n\t\t\t\tthis.maxPosY = this.wrapperHeight - this.indicatorHeight;\n\n\t\t\t\tthis.minBoundaryY = 0;\n\t\t\t\tthis.maxBoundaryY = this.maxPosY;\n\n\t\t\t\tthis.sizeRatioY = this.options.speedRatioY || (this.scroller.maxScrollY && (this.maxPosY / this.scroller.maxScrollY));\n\t\t\t}\n\n\t\t\tthis.updatePosition();\n\t\t},\n\n\t\tupdatePosition: function() {\n\t\t\tvar x = this.options.listenX && Math.round(this.sizeRatioX * this.scroller.x) || 0,\n\t\t\t\ty = this.options.listenY && Math.round(this.sizeRatioY * this.scroller.y) || 0;\n\n\t\t\tif (x < this.minBoundaryX) {\n\t\t\t\tthis.width = Math.max(this.indicatorWidth + x, 8);\n\t\t\t\tthis.indicatorStyle.width = this.width + 'px';\n\t\t\t\tx = this.minBoundaryX;\n\t\t\t} else if (x > this.maxBoundaryX) {\n\t\t\t\tthis.width = Math.max(this.indicatorWidth - (x - this.maxPosX), 8);\n\t\t\t\tthis.indicatorStyle.width = this.width + 'px';\n\t\t\t\tx = this.maxPosX + this.indicatorWidth - this.width;\n\t\t\t} else if (this.width != this.indicatorWidth) {\n\t\t\t\tthis.width = this.indicatorWidth;\n\t\t\t\tthis.indicatorStyle.width = this.width + 'px';\n\t\t\t}\n\n\t\t\tif (y < this.minBoundaryY) {\n\t\t\t\tthis.height = Math.max(this.indicatorHeight + y * 3, 8);\n\t\t\t\tthis.indicatorStyle.height = this.height + 'px';\n\t\t\t\ty = this.minBoundaryY;\n\t\t\t} else if (y > this.maxBoundaryY) {\n\t\t\t\tthis.height = Math.max(this.indicatorHeight - (y - this.maxPosY) * 3, 8);\n\t\t\t\tthis.indicatorStyle.height = this.height + 'px';\n\t\t\t\ty = this.maxPosY + this.indicatorHeight - this.height;\n\t\t\t} else if (this.height != this.indicatorHeight) {\n\t\t\t\tthis.height = this.indicatorHeight;\n\t\t\t\tthis.indicatorStyle.height = this.height + 'px';\n\t\t\t}\n\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\n\t\t\tthis.indicatorStyle['webkitTransform'] = this.scroller._getTranslateStr(x, y);\n\n\t\t},\n\t\tfade: function(val, hold) {\n\t\t\tif (hold && !this.visible) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tclearTimeout(this.fadeTimeout);\n\t\t\tthis.fadeTimeout = null;\n\n\t\t\tvar time = val ? 250 : 500,\n\t\t\t\tdelay = val ? 0 : 300;\n\n\t\t\tval = val ? '1' : '0';\n\n\t\t\tthis.wrapperStyle['webkitTransitionDuration'] = time + 'ms';\n\n\t\t\tthis.fadeTimeout = setTimeout((function(val) {\n\t\t\t\tthis.wrapperStyle.opacity = val;\n\t\t\t\tthis.visible = +val;\n\t\t\t}).bind(this, val), delay);\n\t\t}\n\t};\n\n\t$.Scroll = Scroll;\n\n\t$.fn.scroll = function(options) {\n\t\tvar scrollApis = [];\n\t\tthis.each(function() {\n\t\t\tvar scrollApi = null;\n\t\t\tvar self = this;\n\t\t\tvar id = self.getAttribute('data-scroll');\n\t\t\tif (!id) {\n\t\t\t\tid = ++$.uuid;\n\t\t\t\tvar _options = $.extend({}, options);\n\t\t\t\tif (self.classList.contains('mui-segmented-control')) {\n\t\t\t\t\t_options = $.extend(_options, {\n\t\t\t\t\t\tscrollY: false,\n\t\t\t\t\t\tscrollX: true,\n\t\t\t\t\t\tindicators: false,\n\t\t\t\t\t\tsnap: '.mui-control-item'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t$.data[id] = scrollApi = new Scroll(self, _options);\n\t\t\t\tself.setAttribute('data-scroll', id);\n\t\t\t} else {\n\t\t\t\tscrollApi = $.data[id];\n\t\t\t}\n\t\t\tscrollApis.push(scrollApi);\n\t\t});\n\t\treturn scrollApis.length === 1 ? scrollApis[0] : scrollApis;\n\t};\n})(mui, window, document);\n(function($, window, document, undefined) {\n\n    var CLASS_VISIBILITY = 'mui-visibility';\n    var CLASS_HIDDEN = 'mui-hidden';\n\n    var PullRefresh = $.Scroll.extend($.extend({\n        handleEvent: function(e) {\n            this._super(e);\n            if (e.type === 'scrollbottom') {\n                if (e.target === this.scroller) {\n                    this._scrollbottom();\n                }\n            }\n        },\n        _scrollbottom: function() {\n            if (!this.pulldown && !this.loading) {\n                this.pulldown = false;\n                this._initPullupRefresh();\n                this.pullupLoading();\n            }\n        },\n        _start: function(e) {\n            //仅下拉刷新在start阻止默认事件\n            if (e.touches && e.touches.length && e.touches[0].clientX > 30) {\n                e.target && !this._preventDefaultException(e.target, this.options.preventDefaultException) && e.preventDefault();\n            }\n            if (!this.loading) {\n                this.pulldown = this.pullPocket = this.pullCaption = this.pullLoading = false\n            }\n            this._super(e);\n        },\n        _drag: function(e) {\n            if (this.y >= 0 && this.disablePulldown && e.detail.direction === 'down') { //禁用下拉刷新\n                return;\n            }\n            this._super(e);\n            if (!this.pulldown && !this.loading && this.topPocket && e.detail.direction === 'down' && this.y >= 0) {\n                this._initPulldownRefresh();\n            }\n            if (this.pulldown) {\n                this._setCaption(this.y > this.options.down.height ? this.options.down.contentover : this.options.down.contentdown);\n            }\n        },\n\n        _reLayout: function() {\n            this.hasVerticalScroll = true;\n            this._super();\n        },\n        //API\n        resetPosition: function(time) {\n            if (this.pulldown && !this.disablePulldown) {\n                if (this.y >= this.options.down.height) {\n                    this.pulldownLoading(undefined, time || 0);\n                    return true;\n                } else {\n                    !this.loading && this.topPocket.classList.remove(CLASS_VISIBILITY);\n                }\n            }\n            return this._super(time);\n        },\n        pulldownLoading: function(y, time) {\n            typeof y === 'undefined' && (y = this.options.down.height); //默认高度\n            this.scrollTo(0, y, time, this.options.bounceEasing);\n            if (this.loading) {\n                return;\n            }\n            //\t\t\tif (!this.pulldown) {\n            this._initPulldownRefresh();\n            //\t\t\t}\n            this._setCaption(this.options.down.contentrefresh);\n            this.loading = true;\n            this.indicators.map(function(indicator) {\n                indicator.fade(0);\n            });\n            var callback = this.options.down.callback;\n            callback && callback.call(this);\n        },\n        endPulldownToRefresh: function() {\n            var self = this;\n            if (self.topPocket && self.loading && this.pulldown) {\n                self.scrollTo(0, 0, self.options.bounceTime, self.options.bounceEasing);\n                self.loading = false;\n                self._setCaption(self.options.down.contentdown, true);\n                setTimeout(function() {\n                    self.loading || self.topPocket.classList.remove(CLASS_VISIBILITY);\n                }, 350);\n            }\n        },\n        pullupLoading: function(callback, x, time) {\n            x = x || 0;\n            this.scrollTo(x, this.maxScrollY, time, this.options.bounceEasing);\n            if (this.loading) {\n                return;\n            }\n            this._initPullupRefresh();\n            this._setCaption(this.options.up.contentrefresh);\n            this.indicators.map(function(indicator) {\n                indicator.fade(0);\n            });\n            this.loading = true;\n            callback = callback || this.options.up.callback;\n            callback && callback.call(this);\n        },\n        endPullupToRefresh: function(finished) {\n            var self = this;\n            if (self.bottomPocket) { // && self.loading && !this.pulldown\n                self.loading = false;\n                if (finished) {\n                    this.finished = true;\n                    self._setCaption(self.options.up.contentnomore);\n                    //\t\t\t\t\tself.bottomPocket.classList.remove(CLASS_VISIBILITY);\n                    //\t\t\t\t\tself.bottomPocket.classList.add(CLASS_HIDDEN);\n                    self.wrapper.removeEventListener('scrollbottom', self);\n                } else {\n                    self._setCaption(self.options.up.contentdown);\n                    //\t\t\t\t\tsetTimeout(function() {\n                    self.loading || self.bottomPocket.classList.remove(CLASS_VISIBILITY);\n                    //\t\t\t\t\t}, 300);\n                }\n            }\n        },\n        disablePullupToRefresh: function() {\n            this._initPullupRefresh();\n            this.bottomPocket.className = 'mui-pull-bottom-pocket' + ' ' + CLASS_HIDDEN;\n            this.wrapper.removeEventListener('scrollbottom', this);\n        },\n        disablePulldownToRefresh: function() {\n            this._initPulldownRefresh();\n            this.topPocket.className = 'mui-pull-top-pocket' + ' ' + CLASS_HIDDEN;\n            this.disablePulldown = true;\n        },\n        enablePulldownToRefresh: function() {\n            this._initPulldownRefresh();\n            this.topPocket.classList.remove(CLASS_HIDDEN);\n            this._setCaption(this.options.down.contentdown);\n            this.disablePulldown = false;\n        },\n        enablePullupToRefresh: function() {\n            this._initPullupRefresh();\n            this.bottomPocket.classList.remove(CLASS_HIDDEN);\n            this._setCaption(this.options.up.contentdown);\n            this.wrapper.addEventListener('scrollbottom', this);\n        },\n        refresh: function(isReset) {\n            if (isReset && this.finished) {\n                this.enablePullupToRefresh();\n                this.finished = false;\n            }\n            this._super();\n        },\n    }, $.PullRefresh));\n    $.fn.pullRefresh = function(options) {\n        if (this.length === 1) {\n            var self = this[0];\n            var pullRefreshApi = null;\n            var id = self.getAttribute('data-pullrefresh');\n            if (!id && typeof options === 'undefined') {\n                return false;\n            }\n            options = options || {};\n            if (!id) {\n                id = ++$.uuid;\n                $.data[id] = pullRefreshApi = new PullRefresh(self, options);\n                self.setAttribute('data-pullrefresh', id);\n            } else {\n                pullRefreshApi = $.data[id];\n            }\n            if (options.down && options.down.auto) { //如果设置了auto，则自动下拉一次\n                pullRefreshApi.pulldownLoading(options.down.autoY);\n            } else if (options.up && options.up.auto) { //如果设置了auto，则自动上拉一次\n                pullRefreshApi.pullupLoading();\n            }\n            //暂不提供这种调用方式吧\t\t\t\n            //\t\t\tif (typeof options === 'string') {\n            //\t\t\t\tvar methodValue = pullRefreshApi[options].apply(pullRefreshApi, $.slice.call(arguments, 1));\n            //\t\t\t\tif (methodValue !== undefined) {\n            //\t\t\t\t\treturn methodValue;\n            //\t\t\t\t}\n            //\t\t\t}\n            return pullRefreshApi;\n        }\n    };\n})(mui, window, document);\n/**\n * snap 重构\n * @param {Object} $\n * @param {Object} window\n */\n(function($, window) {\n\tvar CLASS_SLIDER = 'mui-slider';\n\tvar CLASS_SLIDER_GROUP = 'mui-slider-group';\n\tvar CLASS_SLIDER_LOOP = 'mui-slider-loop';\n\tvar CLASS_SLIDER_INDICATOR = 'mui-slider-indicator';\n\tvar CLASS_ACTION_PREVIOUS = 'mui-action-previous';\n\tvar CLASS_ACTION_NEXT = 'mui-action-next';\n\tvar CLASS_SLIDER_ITEM = 'mui-slider-item';\n\n\tvar CLASS_ACTIVE = 'mui-active';\n\n\tvar SELECTOR_SLIDER_ITEM = '.' + CLASS_SLIDER_ITEM;\n\tvar SELECTOR_SLIDER_INDICATOR = '.' + CLASS_SLIDER_INDICATOR;\n\tvar SELECTOR_SLIDER_PROGRESS_BAR = '.mui-slider-progress-bar';\n\n\tvar Slider = $.Slider = $.Scroll.extend({\n\t\tinit: function(element, options) {\n\t\t\tthis._super(element, $.extend(true, {\n\t\t\t\tfingers: 1,\n\t\t\t\tinterval: 0, //设置为0，则不定时轮播\n\t\t\t\tscrollY: false,\n\t\t\t\tscrollX: true,\n\t\t\t\tindicators: false,\n\t\t\t\tscrollTime: 1000,\n\t\t\t\tstartX: false,\n\t\t\t\tslideTime: 0, //滑动动画时间\n\t\t\t\tsnap: SELECTOR_SLIDER_ITEM\n\t\t\t}, options));\n\t\t\tif (this.options.startX) {\n\t\t\t\t//\t\t\t\t$.trigger(this.wrapper, 'scrollend', this);\n\t\t\t}\n\t\t},\n\t\t_init: function() {\n\t\t\tthis._reInit();\n\t\t\tif (this.scroller) {\n\t\t\t\tthis.scrollerStyle = this.scroller.style;\n\t\t\t\tthis.progressBar = this.wrapper.querySelector(SELECTOR_SLIDER_PROGRESS_BAR);\n\t\t\t\tif (this.progressBar) {\n\t\t\t\t\tthis.progressBarWidth = this.progressBar.offsetWidth;\n\t\t\t\t\tthis.progressBarStyle = this.progressBar.style;\n\t\t\t\t}\n\t\t\t\t//忘记这个代码是干什么的了？\n\t\t\t\t//\t\t\t\tthis.x = this._getScroll();\n\t\t\t\t//\t\t\t\tif (this.options.startX === false) {\n\t\t\t\t//\t\t\t\t\tthis.options.startX = this.x;\n\t\t\t\t//\t\t\t\t}\n\t\t\t\t//根据active修正startX\n\n\t\t\t\tthis._super();\n\t\t\t\tthis._initTimer();\n\t\t\t}\n\t\t},\n\t\t_triggerSlide: function() {\n\t\t\tvar self = this;\n\t\t\tself.isInTransition = false;\n\t\t\tvar page = self.currentPage;\n\t\t\tself.slideNumber = self._fixedSlideNumber();\n\t\t\tif (self.loop) {\n\t\t\t\tif (self.slideNumber === 0) {\n\t\t\t\t\tself.setTranslate(self.pages[1][0].x, 0);\n\t\t\t\t} else if (self.slideNumber === self.itemLength - 3) {\n\t\t\t\t\tself.setTranslate(self.pages[self.itemLength - 2][0].x, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (self.lastSlideNumber != self.slideNumber) {\n\t\t\t\tself.lastSlideNumber = self.slideNumber;\n\t\t\t\tself.lastPage = self.currentPage;\n\t\t\t\t$.trigger(self.wrapper, 'slide', {\n\t\t\t\t\tslideNumber: self.slideNumber\n\t\t\t\t});\n\t\t\t}\n\t\t\tself._initTimer();\n\t\t},\n\t\t_handleSlide: function(e) {\n\t\t\tvar self = this;\n\t\t\tif (e.target !== self.wrapper) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar detail = e.detail;\n\t\t\tdetail.slideNumber = detail.slideNumber || 0;\n\t\t\tvar temps = self.scroller.querySelectorAll(SELECTOR_SLIDER_ITEM);\n\t\t\tvar items = [];\n\t\t\tfor (var i = 0, len = temps.length; i < len; i++) {\n\t\t\t\tvar item = temps[i];\n\t\t\t\tif (item.parentNode === self.scroller) {\n\t\t\t\t\titems.push(item);\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar _slideNumber = detail.slideNumber;\n\t\t\tif (self.loop) {\n\t\t\t\t_slideNumber += 1;\n\t\t\t}\n\t\t\tif (!self.wrapper.classList.contains('mui-segmented-control')) {\n\t\t\t\tfor (var i = 0, len = items.length; i < len; i++) {\n\t\t\t\t\tvar item = items[i];\n\t\t\t\t\tif (item.parentNode === self.scroller) {\n\t\t\t\t\t\tif (i === _slideNumber) {\n\t\t\t\t\t\t\titem.classList.add(CLASS_ACTIVE);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\titem.classList.remove(CLASS_ACTIVE);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar indicatorWrap = self.wrapper.querySelector('.mui-slider-indicator');\n\t\t\tif (indicatorWrap) {\n\t\t\t\tif (indicatorWrap.getAttribute('data-scroll')) { //scroll\n\t\t\t\t\t$(indicatorWrap).scroll().gotoPage(detail.slideNumber);\n\t\t\t\t}\n\t\t\t\tvar indicators = indicatorWrap.querySelectorAll('.mui-indicator');\n\t\t\t\tif (indicators.length > 0) { //图片轮播\n\t\t\t\t\tfor (var i = 0, len = indicators.length; i < len; i++) {\n\t\t\t\t\t\tindicators[i].classList[i === detail.slideNumber ? 'add' : 'remove'](CLASS_ACTIVE);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tvar number = indicatorWrap.querySelector('.mui-number span');\n\t\t\t\t\tif (number) { //图文表格\n\t\t\t\t\t\tnumber.innerText = (detail.slideNumber + 1);\n\t\t\t\t\t} else { //segmented controls\n\t\t\t\t\t\tvar controlItems = indicatorWrap.querySelectorAll('.mui-control-item');\n\t\t\t\t\t\tfor (var i = 0, len = controlItems.length; i < len; i++) {\n\t\t\t\t\t\t\tcontrolItems[i].classList[i === detail.slideNumber ? 'add' : 'remove'](CLASS_ACTIVE);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\te.stopPropagation();\n\t\t},\n\t\t_handleTabShow: function(e) {\n\t\t\tvar self = this;\n\t\t\tself.gotoItem((e.detail.tabNumber || 0), self.options.slideTime);\n\t\t},\n\t\t_handleIndicatorTap: function(event) {\n\t\t\tvar self = this;\n\t\t\tvar target = event.target;\n\t\t\tif (target.classList.contains(CLASS_ACTION_PREVIOUS) || target.classList.contains(CLASS_ACTION_NEXT)) {\n\t\t\t\tself[target.classList.contains(CLASS_ACTION_PREVIOUS) ? 'prevItem' : 'nextItem']();\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t},\n\t\t_initEvent: function(detach) {\n\t\t\tvar self = this;\n\t\t\tself._super(detach);\n\t\t\tvar action = detach ? 'removeEventListener' : 'addEventListener';\n\t\t\tself.wrapper[action]('slide', this);\n\t\t\tself.wrapper[action]($.eventName('shown', 'tab'), this);\n\t\t},\n\t\thandleEvent: function(e) {\n\t\t\tthis._super(e);\n\t\t\tswitch (e.type) {\n\t\t\t\tcase 'slide':\n\t\t\t\t\tthis._handleSlide(e);\n\t\t\t\t\tbreak;\n\t\t\t\tcase $.eventName('shown', 'tab'):\n\t\t\t\t\tif (~this.snaps.indexOf(e.target)) { //避免嵌套监听错误的tab show\n\t\t\t\t\t\tthis._handleTabShow(e);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\t_scrollend: function(e) {\n\t\t\tthis._super(e);\n\t\t\tthis._triggerSlide(e);\n\t\t},\n\t\t_drag: function(e) {\n\t\t\tthis._super(e);\n\t\t\tvar direction = e.detail.direction;\n\t\t\tif (direction === 'left' || direction === 'right') {\n\t\t\t\t//拖拽期间取消定时\n\t\t\t\tvar slidershowTimer = this.wrapper.getAttribute('data-slidershowTimer');\n\t\t\t\tslidershowTimer && window.clearTimeout(slidershowTimer);\n\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t},\n\t\t_initTimer: function() {\n\t\t\tvar self = this;\n\t\t\tvar slider = self.wrapper;\n\t\t\tvar interval = self.options.interval;\n\t\t\tvar slidershowTimer = slider.getAttribute('data-slidershowTimer');\n\t\t\tslidershowTimer && window.clearTimeout(slidershowTimer);\n\t\t\tif (interval) {\n\t\t\t\tslidershowTimer = window.setTimeout(function() {\n\t\t\t\t\tif (!slider) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t//仅slider显示状态进行自动轮播\n\t\t\t\t\tif (!!(slider.offsetWidth || slider.offsetHeight)) {\n\t\t\t\t\t\tself.nextItem(true);\n\t\t\t\t\t\t//下一个\n\t\t\t\t\t}\n\t\t\t\t\tself._initTimer();\n\t\t\t\t}, interval);\n\t\t\t\tslider.setAttribute('data-slidershowTimer', slidershowTimer);\n\t\t\t}\n\t\t},\n\n\t\t_fixedSlideNumber: function(page) {\n\t\t\tpage = page || this.currentPage;\n\t\t\tvar slideNumber = page.pageX;\n\t\t\tif (this.loop) {\n\t\t\t\tif (page.pageX === 0) {\n\t\t\t\t\tslideNumber = this.itemLength - 3;\n\t\t\t\t} else if (page.pageX === (this.itemLength - 1)) {\n\t\t\t\t\tslideNumber = 0;\n\t\t\t\t} else {\n\t\t\t\t\tslideNumber = page.pageX - 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn slideNumber;\n\t\t},\n\t\t_reLayout: function() {\n\t\t\tthis.hasHorizontalScroll = true;\n\t\t\tthis.loop = this.scroller.classList.contains(CLASS_SLIDER_LOOP);\n\t\t\tthis._super();\n\t\t},\n\t\t_getScroll: function() {\n\t\t\tvar result = $.parseTranslateMatrix($.getStyles(this.scroller, 'webkitTransform'));\n\t\t\treturn result ? result.x : 0;\n\t\t},\n\t\t_transitionEnd: function(e) {\n\t\t\tif (e.target !== this.scroller || !this.isInTransition) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._transitionTime();\n\t\t\tthis.isInTransition = false;\n\t\t\t$.trigger(this.wrapper, 'scrollend', this);\n\t\t},\n\t\t_flick: function(e) {\n\t\t\tif (!this.moved) { //无moved\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar detail = e.detail;\n\t\t\tvar direction = detail.direction;\n\t\t\tthis._clearRequestAnimationFrame();\n\t\t\tthis.isInTransition = true;\n\t\t\t//\t\t\tif (direction === 'up' || direction === 'down') {\n\t\t\t//\t\t\t\tthis.resetPosition(this.options.bounceTime);\n\t\t\t//\t\t\t\treturn;\n\t\t\t//\t\t\t}\n\t\t\tif (e.type === 'flick') {\n\t\t\t\tif (detail.deltaTime < 200) { //flick，太容易触发，额外校验一下deltaTime\n\t\t\t\t\tthis.x = this._getPage((this.slideNumber + (direction === 'right' ? -1 : 1)), true).x;\n\t\t\t\t}\n\t\t\t\tthis.resetPosition(this.options.bounceTime);\n\t\t\t} else if (e.type === 'dragend' && !detail.flick) {\n\t\t\t\tthis.resetPosition(this.options.bounceTime);\n\t\t\t}\n\t\t\te.stopPropagation();\n\t\t},\n\t\t_initSnap: function() {\n\t\t\tthis.scrollerWidth = this.itemLength * this.scrollerWidth;\n\t\t\tthis.maxScrollX = Math.min(this.wrapperWidth - this.scrollerWidth, 0);\n\t\t\tthis._super();\n\t\t\tif (!this.currentPage.x) {\n\t\t\t\t//当slider处于隐藏状态时，导致snap计算是错误的，临时先这么判断一下，后续要考虑解决所有scroll在隐藏状态下初始化属性不正确的问题\n\t\t\t\tvar currentPage = this.pages[this.loop ? 1 : 0];\n\t\t\t\tcurrentPage = currentPage || this.pages[0];\n\t\t\t\tif (!currentPage) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.currentPage = currentPage[0];\n\t\t\t\tthis.slideNumber = 0;\n\t\t\t\tthis.lastSlideNumber = typeof this.lastSlideNumber === 'undefined' ? 0 : this.lastSlideNumber;\n\t\t\t} else {\n\t\t\t\tthis.slideNumber = this._fixedSlideNumber();\n\t\t\t\tthis.lastSlideNumber = typeof this.lastSlideNumber === 'undefined' ? this.slideNumber : this.lastSlideNumber;\n\t\t\t}\n\t\t\tthis.options.startX = this.currentPage.x || 0;\n\t\t},\n\t\t_getSnapX: function(offsetLeft) {\n\t\t\treturn Math.max(-offsetLeft, this.maxScrollX);\n\t\t},\n\t\t_getPage: function(slideNumber, isFlick) {\n\t\t\tif (this.loop) {\n\t\t\t\tif (slideNumber > (this.itemLength - (isFlick ? 2 : 3))) {\n\t\t\t\t\tslideNumber = 1;\n\t\t\t\t\ttime = 0;\n\t\t\t\t} else if (slideNumber < (isFlick ? -1 : 0)) {\n\t\t\t\t\tslideNumber = this.itemLength - 2;\n\t\t\t\t\ttime = 0;\n\t\t\t\t} else {\n\t\t\t\t\tslideNumber += 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!isFlick) {\n\t\t\t\t\tif (slideNumber > (this.itemLength - 1)) {\n\t\t\t\t\t\tslideNumber = 0;\n\t\t\t\t\t\ttime = 0;\n\t\t\t\t\t} else if (slideNumber < 0) {\n\t\t\t\t\t\tslideNumber = this.itemLength - 1;\n\t\t\t\t\t\ttime = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tslideNumber = Math.min(Math.max(0, slideNumber), this.itemLength - 1);\n\t\t\t}\n\t\t\treturn this.pages[slideNumber][0];\n\t\t},\n\t\t_gotoItem: function(slideNumber, time) {\n\t\t\tthis.currentPage = this._getPage(slideNumber, true); //此处传true。可保证程序切换时，动画与人手操作一致(第一张，最后一张的切换动画)\n\t\t\tthis.scrollTo(this.currentPage.x, 0, time, this.options.scrollEasing);\n\t\t\tif (time === 0) {\n\t\t\t\t$.trigger(this.wrapper, 'scrollend', this);\n\t\t\t}\n\t\t},\n\t\t//API\n\t\tsetTranslate: function(x, y) {\n\t\t\tthis._super(x, y);\n\t\t\tvar progressBar = this.progressBar;\n\t\t\tif (progressBar) {\n\t\t\t\tthis.progressBarStyle.webkitTransform = this._getTranslateStr((-x * (this.progressBarWidth / this.wrapperWidth)), 0);\n\t\t\t}\n\t\t},\n\t\tresetPosition: function(time) {\n\t\t\ttime = time || 0;\n\t\t\tif (this.x > 0) {\n\t\t\t\tthis.x = 0;\n\t\t\t} else if (this.x < this.maxScrollX) {\n\t\t\t\tthis.x = this.maxScrollX;\n\t\t\t}\n\t\t\tthis.currentPage = this._nearestSnap(this.x);\n\t\t\tthis.scrollTo(this.currentPage.x, 0, time, this.options.scrollEasing);\n\t\t\treturn true;\n\t\t},\n\t\tgotoItem: function(slideNumber, time) {\n\t\t\tthis._gotoItem(slideNumber, typeof time === 'undefined' ? this.options.scrollTime : time);\n\t\t},\n\t\tnextItem: function() {\n\t\t\tthis._gotoItem(this.slideNumber + 1, this.options.scrollTime);\n\t\t},\n\t\tprevItem: function() {\n\t\t\tthis._gotoItem(this.slideNumber - 1, this.options.scrollTime);\n\t\t},\n\t\tgetSlideNumber: function() {\n\t\t\treturn this.slideNumber || 0;\n\t\t},\n\t\t_reInit: function() {\n\t\t\tvar groups = this.wrapper.querySelectorAll('.' + CLASS_SLIDER_GROUP);\n\t\t\tfor (var i = 0, len = groups.length; i < len; i++) {\n\t\t\t\tif (groups[i].parentNode === this.wrapper) {\n\t\t\t\t\tthis.scroller = groups[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.scrollerStyle = this.scroller && this.scroller.style;\n\t\t\tif (this.progressBar) {\n\t\t\t\tthis.progressBarWidth = this.progressBar.offsetWidth;\n\t\t\t\tthis.progressBarStyle = this.progressBar.style;\n\t\t\t}\n\t\t},\n\t\trefresh: function(options) {\n\t\t\tif (options) {\n\t\t\t\t$.extend(this.options, options);\n\t\t\t\tthis._super();\n\t\t\t\tthis._initTimer();\n\t\t\t} else {\n\t\t\t\tthis._super();\n\t\t\t}\n\t\t},\n\t\tdestroy: function() {\n\t\t\tthis._initEvent(true); //detach\n\t\t\tdelete $.data[this.wrapper.getAttribute('data-slider')];\n\t\t\tthis.wrapper.setAttribute('data-slider', '');\n\t\t}\n\t});\n\t$.fn.slider = function(options) {\n\t\tvar slider = null;\n\t\tthis.each(function() {\n\t\t\tvar sliderElement = this;\n\t\t\tif (!this.classList.contains(CLASS_SLIDER)) {\n\t\t\t\tsliderElement = this.querySelector('.' + CLASS_SLIDER);\n\t\t\t}\n\t\t\tif (sliderElement && sliderElement.querySelector(SELECTOR_SLIDER_ITEM)) {\n\t\t\t\tvar id = sliderElement.getAttribute('data-slider');\n\t\t\t\tif (!id) {\n\t\t\t\t\tid = ++$.uuid;\n\t\t\t\t\t$.data[id] = slider = new Slider(sliderElement, options);\n\t\t\t\t\tsliderElement.setAttribute('data-slider', id);\n\t\t\t\t} else {\n\t\t\t\t\tslider = $.data[id];\n\t\t\t\t\tif (slider && options) {\n\t\t\t\t\t\tslider.refresh(options);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn slider;\n\t};\n\t$.ready(function() {\n\t\t//\t\tsetTimeout(function() {\n\t\t$('.mui-slider').slider();\n\t\t$('.mui-scroll-wrapper.mui-slider-indicator.mui-segmented-control').scroll({\n\t\t\tscrollY: false,\n\t\t\tscrollX: true,\n\t\t\tindicators: false,\n\t\t\tsnap: '.mui-control-item'\n\t\t});\n\t\t//\t\t}, 500); //临时处理slider宽度计算不正确的问题(初步确认是scrollbar导致的)\n\n\t});\n})(mui, window);\n/**\n * pullRefresh 5+\n * @param {type} $\n * @returns {undefined}\n */\n(function($, document) {\n    if (!($.os.plus)) { //仅在5+android支持多webview的使用\n        return;\n    }\n    $.plusReady(function() {\n        if (window.__NWin_Enable__ === false) { //不支持多webview，则不用5+下拉刷新\n            return;\n        }\n        var CLASS_PLUS_PULLREFRESH = 'mui-plus-pullrefresh';\n        var CLASS_VISIBILITY = 'mui-visibility';\n        var CLASS_HIDDEN = 'mui-hidden';\n        var CLASS_BLOCK = 'mui-block';\n\n        var CLASS_PULL_CAPTION = 'mui-pull-caption';\n        var CLASS_PULL_CAPTION_DOWN = 'mui-pull-caption-down';\n        var CLASS_PULL_CAPTION_REFRESH = 'mui-pull-caption-refresh';\n        var CLASS_PULL_CAPTION_NOMORE = 'mui-pull-caption-nomore';\n\n        var PlusPullRefresh = $.Class.extend({\n            init: function(element, options) {\n                this.element = element;\n                this.options = options;\n                this.wrapper = this.scroller = element;\n                this._init();\n                this._initPulldownRefreshEvent();\n            },\n            _init: function() {\n                var self = this;\n                //document.addEventListener('plusscrollbottom', this);\n                window.addEventListener('dragup', self);\n                document.addEventListener(\"plusscrollbottom\", self);\n                self.scrollInterval = window.setInterval(function() {\n                    if (self.isScroll && !self.loading) {\n                        if (window.pageYOffset + window.innerHeight + 10 >= document.documentElement.scrollHeight) {\n                            self.isScroll = false; //放在这里是因为快速滚动的话，有可能检测时，还没到底，所以只要有滚动，没到底之前一直检测高度变化\n                            if (self.bottomPocket) {\n                                self.pullupLoading();\n                            }\n                        }\n                    }\n                }, 100);\n            },\n            _initPulldownRefreshEvent: function() {\n                var self = this;\n                $.plusReady(function() {\n                    if (self.options.down.style == \"circle\") {\n                        //单webview、原生转圈\n                        self.options.webview = plus.webview.currentWebview();\n                        self.options.webview.setPullToRefresh({\n                            support: true,\n                            color: self.options.down.color || '#2BD009',\n                            height: self.options.down.height || '50px',\n                            range: self.options.down.range || '100px',\n                            style: 'circle',\n                            offset: self.options.down.offset || '0px'\n                        }, function() {\n                            self.options.down.callback();\n                        });\n                    } else if (self.topPocket && self.options.webviewId) {\n                        var webview = plus.webview.getWebviewById(self.options.webviewId); //子窗口\n                        if (!webview) {\n                            return;\n                        }\n                        self.options.webview = webview;\n                        var downOptions = self.options.down;\n                        var height = downOptions.height;\n                        webview.addEventListener('close', function() {\n                            var attrWebviewId = self.options.webviewId && self.options.webviewId.replace(/\\//g, \"_\"); //替换所有\"/\" \n                            self.element.removeAttribute('data-pullrefresh-plus-' + attrWebviewId);\n                        });\n                        webview.addEventListener(\"dragBounce\", function(e) {\n                            if (!self.pulldown) {\n                                self._initPulldownRefresh();\n                            } else {\n                                self.pullPocket.classList.add(CLASS_BLOCK);\n                            }\n                            switch (e.status) {\n                                case \"beforeChangeOffset\": //下拉可刷新状态\n                                    self._setCaption(downOptions.contentdown);\n                                    break;\n                                case \"afterChangeOffset\": //松开可刷新状态\n                                    self._setCaption(downOptions.contentover);\n                                    break;\n                                case \"dragEndAfterChangeOffset\": //正在刷新状态\n                                    //执行下拉刷新所在webview的回调函数\n                                    webview.evalJS(\"window.mui&&mui.options.pullRefresh.down.callback()\");\n                                    self._setCaption(downOptions.contentrefresh);\n                                    break;\n                                default:\n                                    break;\n                            }\n                        }, false);\n\n                        webview.setBounce({\n                            position: {\n                                top: height * 2 + 'px'\n                            },\n                            changeoffset: {\n                                top: height + 'px'\n                            }\n                        });\n\n                    }\n                });\n            },\n            handleEvent: function(e) {\n                var self = this;\n                if (self.stopped) {\n                    return;\n                }\n                self.isScroll = false;\n                if (e.type === 'dragup' || e.type === 'plusscrollbottom') {\n                    self.isScroll = true;\n                    setTimeout(function() {\n                        self.isScroll = false;\n                    }, 1000);\n                }\n            }\n        }).extend($.extend({\n            setStopped: function(stopped) { //该方法是子页面调用的\n                this.stopped = !!stopped;\n                // TODO 此处需要设置当前webview的bounce为none,目前5+有BUG\n                if (this.stopped) {\n                    this.disablePullupToRefresh();\n                    this.disablePulldownToRefresh();\n                } else {\n                    this.enablePullupToRefresh();\n                    this.enablePulldownToRefresh();\n                }\n            },\n            beginPulldown: function() {\n                var self = this;\n                $.plusReady(function() {\n                    //这里延时的目的是为了保证下拉刷新组件初始化完成，后续应该做成有状态的\n                    setTimeout(function() {\n                        if (self.options.down.style == \"circle\") { //单webview下拉刷新\n                            plus.webview.currentWebview().beginPullToRefresh();\n                        } else { //双webview模式\n                            var webview = self.options.webview;\n                            if (webview) {\n                                webview.setBounce({\n                                    offset: {\n                                        top: self.options.down.height + \"px\"\n                                    }\n                                });\n                            }\n                        }\n                    }, 15);\n                }.bind(this));\n            },\n            pulldownLoading: function() { //该方法是子页面调用的，兼容老的历史API\n                this.beginPulldown();\n            },\n            _pulldownLoading: function() { //该方法是父页面调用的\n                var self = this;\n                $.plusReady(function() {\n                    var childWebview = plus.webview.getWebviewById(self.options.webviewId);\n                    childWebview && childWebview.setBounce({\n                        offset: {\n                            top: self.options.down.height + \"px\"\n                        }\n                    });\n                });\n            },\n            endPulldown: function() {\n                var _wv = plus.webview.currentWebview();\n                //双webview的下拉刷新，需要修改父窗口提示信息\n                if (_wv.parent() && this.options.down.style !== \"circle\") {\n                    _wv.parent().evalJS(\"mui&&mui(document.querySelector('.mui-content')).pullRefresh('\" + JSON.stringify({\n                        webviewId: _wv.id\n                    }) + \"')._endPulldownToRefresh()\");\n                } else {\n                    _wv.endPullToRefresh();\n                }\n            },\n            endPulldownToRefresh: function() { //该方法是子页面调用的，兼容老的历史API\n                this.endPulldown();\n            },\n            _endPulldownToRefresh: function() { //该方法是父页面调用的\n                var self = this;\n                if (self.topPocket && self.options.webview) {\n                    self.options.webview.endPullToRefresh(); //下拉刷新所在webview回弹\n                    self.loading = false;\n                    self._setCaption(self.options.down.contentdown, true);\n                    setTimeout(function() {\n                        self.loading || self.topPocket.classList.remove(CLASS_BLOCK);\n                    }, 350);\n                }\n            },\n            beginPullup: function(callback) { //开始上拉加载\n                var self = this;\n                if (self.isLoading) return;\n                self.isLoading = true;\n                if (self.pulldown !== false) {\n                    self._initPullupRefresh();\n                } else {\n                    this.pullPocket.classList.add(CLASS_BLOCK);\n                }\n                setTimeout(function() {\n                    self.pullLoading.classList.add(CLASS_VISIBILITY);\n                    self.pullLoading.classList.remove(CLASS_HIDDEN);\n                    self.pullCaption.innerHTML = ''; //修正5+里边第一次加载时，文字显示的bug(还会显示出来个“多”,猜测应该是渲染问题导致的)\n                    self.pullCaption.className = CLASS_PULL_CAPTION + ' ' + CLASS_PULL_CAPTION_REFRESH;\n                    self.pullCaption.innerHTML = self.options.up.contentrefresh;\n                    callback = callback || self.options.up.callback;\n                    callback && callback.call(self);\n                }, 300);\n            },\n            pullupLoading: function(callback) { //兼容老的API\n                this.beginPullup(callback);\n            },\n            endPullup: function(finished) { //上拉加载结束\n                var self = this;\n                if (self.pullLoading) {\n                    self.pullLoading.classList.remove(CLASS_VISIBILITY);\n                    self.pullLoading.classList.add(CLASS_HIDDEN);\n                    self.isLoading = false;\n                    if (finished) {\n                        self.finished = true;\n                        self.pullCaption.className = CLASS_PULL_CAPTION + ' ' + CLASS_PULL_CAPTION_NOMORE;\n                        self.pullCaption.innerHTML = self.options.up.contentnomore;\n                        //取消5+的plusscrollbottom事件\n                        document.removeEventListener('plusscrollbottom', self);\n                        window.removeEventListener('dragup', self);\n                    } else { //初始化时隐藏，后续不再隐藏\n                        self.pullCaption.className = CLASS_PULL_CAPTION + ' ' + CLASS_PULL_CAPTION_DOWN;\n                        self.pullCaption.innerHTML = self.options.up.contentdown;\n                    }\n                }\n            },\n            endPullupToRefresh: function(finished) { //上拉加载结束，兼容老的API\n                this.endPullup(finished);\n            },\n            disablePulldownToRefresh: function() {\n                var webview = plus.webview.currentWebview();\n                if (this.options.down.style && this.options.down.style == 'circle') { // 单webview模式禁止原生下拉刷新\n                    this.options.webview.setPullToRefresh({\n                        support: false,\n                        style: 'circle'\n                    });\n                } else { // 双webview模式禁止下拉刷新\n                    webview.setStyle({\n                        bounce: 'none'\n                    });\n                    webview.setBounce({\n                        position: {\n                            top: 'none'\n                        }\n                    });\n                }\n            },\n            enablePulldownToRefresh: function() {\n                var self = this,\n                    webview = plus.webview.currentWebview(),\n                    height = this.options.down.height;\n                // 单webview模式禁止原生下拉刷新\n                if (this.options.down.style && this.options.down.style == 'circle') {\n                    webview.setPullToRefresh({\n                        support: true,\n                        height: height || '50px',\n                        range: self.options.down.range || '100px',\n                        style: 'circle',\n                        offset: self.options.down.offset || '0px'\n                    });\n                } else { // 重新初始化双webview模式下拉刷新\n                    webview.setStyle({\n                        bounce: 'vertical'\n                    });\n                    webview.setBounce({\n                        position: {\n                            top: height * 2 + 'px'\n                        },\n                        changeoffset: {\n                            top: height + 'px'\n                        }\n                    });\n                }\n            },\n            disablePullupToRefresh: function() {\n                this._initPullupRefresh();\n                this.bottomPocket.className = 'mui-pull-bottom-pocket' + ' ' + CLASS_HIDDEN;\n                window.removeEventListener('dragup', this);\n            },\n            enablePullupToRefresh: function() {\n                this._initPullupRefresh();\n                this.bottomPocket.classList.remove(CLASS_HIDDEN);\n                this.pullCaption.className = CLASS_PULL_CAPTION + ' ' + CLASS_PULL_CAPTION_DOWN;\n                this.pullCaption.innerHTML = this.options.up.contentdown;\n                document.addEventListener(\"plusscrollbottom\", this);\n                window.addEventListener('dragup', this);\n            },\n            scrollTo: function(x, y, time) {\n                $.scrollTo(y, time);\n            },\n            scrollToBottom: function(time) {\n                $.scrollTo(document.documentElement.scrollHeight, time);\n            },\n            refresh: function(isReset) {\n                if (isReset && this.finished) {\n                    this.enablePullupToRefresh();\n                    this.finished = false;\n                }\n            }\n        }, $.PullRefresh));\n\n        //override h5 pullRefresh\n        $.fn.pullRefresh_native = function(options) {\n            var self;\n            if (this.length === 0) {\n                self = document.createElement('div');\n                self.className = 'mui-content';\n                document.body.appendChild(self);\n            } else {\n                self = this[0];\n            }\n            var args = options;\n            //一个父需要支持多个子下拉刷新\n            options = options || {}\n            if (typeof options === 'string') {\n                options = $.parseJSON(options);\n            };\n            !options.webviewId && (options.webviewId = (plus.webview.currentWebview().id || plus.webview.currentWebview().getURL()));\n            var pullRefreshApi = null;\n            var attrWebviewId = options.webviewId && options.webviewId.replace(/\\//g, \"_\"); //替换所有\"/\"\n            var id = self.getAttribute('data-pullrefresh-plus-' + attrWebviewId);\n            if (!id && typeof args === 'undefined') {\n                return false;\n            }\n            if (!id) { //避免重复初始化5+ pullrefresh\n                id = ++$.uuid;\n                self.setAttribute('data-pullrefresh-plus-' + attrWebviewId, id);\n                document.body.classList.add(CLASS_PLUS_PULLREFRESH);\n                $.data[id] = pullRefreshApi = new PlusPullRefresh(self, options);\n            } else {\n                pullRefreshApi = $.data[id];\n            }\n            if (options.down && options.down.auto) { //如果设置了auto，则自动下拉一次\n                //pullRefreshApi._pulldownLoading(); //parent webview\n                pullRefreshApi.beginPulldown();\n            } else if (options.up && options.up.auto) { //如果设置了auto，则自动上拉一次\n                pullRefreshApi.beginPullup();\n            }\n            return pullRefreshApi;\n        };\n    });\n\n})(mui, document);\n/**\n * off-canvas\n * @param {type} $\n * @param {type} window\n * @param {type} document\n * @param {type} action\n * @returns {undefined}\n */\n(function($, window, document, name) {\n\tvar CLASS_OFF_CANVAS_LEFT = 'mui-off-canvas-left';\n\tvar CLASS_OFF_CANVAS_RIGHT = 'mui-off-canvas-right';\n\tvar CLASS_ACTION_BACKDROP = 'mui-off-canvas-backdrop';\n\tvar CLASS_OFF_CANVAS_WRAP = 'mui-off-canvas-wrap';\n\n\tvar CLASS_SLIDE_IN = 'mui-slide-in';\n\tvar CLASS_ACTIVE = 'mui-active';\n\n\n\tvar CLASS_TRANSITIONING = 'mui-transitioning';\n\n\tvar SELECTOR_INNER_WRAP = '.mui-inner-wrap';\n\n\n\tvar OffCanvas = $.Class.extend({\n\t\tinit: function(element, options) {\n\t\t\tthis.wrapper = this.element = element;\n\t\t\tthis.scroller = this.wrapper.querySelector(SELECTOR_INNER_WRAP);\n\t\t\tthis.classList = this.wrapper.classList;\n\t\t\tif (this.scroller) {\n\t\t\t\tthis.options = $.extend(true, {\n\t\t\t\t\tdragThresholdX: 10,\n\t\t\t\t\tscale: 0.8,\n\t\t\t\t\topacity: 0.1,\n\t\t\t\t\tpreventDefaultException: {\n\t\t\t\t\t\ttagName: /^(INPUT|TEXTAREA|BUTTON|SELECT|VIDEO)$/\n\t\t\t\t\t},\n\t\t\t\t}, options);\n\t\t\t\tdocument.body.classList.add('mui-fullscreen'); //fullscreen\n\t\t\t\tthis.refresh();\n\t\t\t\tthis.initEvent();\n\t\t\t}\n\t\t},\n\t\t_preventDefaultException: function(el, exceptions) {\n\t\t\tfor (var i in exceptions) {\n\t\t\t\tif (exceptions[i].test(el[i])) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\trefresh: function(offCanvas) {\n\t\t\t//\t\t\toffCanvas && !offCanvas.classList.contains(CLASS_ACTIVE) && this.classList.remove(CLASS_ACTIVE);\n\t\t\tthis.slideIn = this.classList.contains(CLASS_SLIDE_IN);\n\t\t\tthis.scalable = this.classList.contains('mui-scalable') && !this.slideIn;\n\t\t\tthis.scroller = this.wrapper.querySelector(SELECTOR_INNER_WRAP);\n\t\t\t//\t\t\t!offCanvas && this.scroller.classList.remove(CLASS_TRANSITIONING);\n\t\t\t//\t\t\t!offCanvas && this.scroller.setAttribute('style', '');\n\t\t\tthis.offCanvasLefts = this.wrapper.querySelectorAll('.' + CLASS_OFF_CANVAS_LEFT);\n\t\t\tthis.offCanvasRights = this.wrapper.querySelectorAll('.' + CLASS_OFF_CANVAS_RIGHT);\n\t\t\tif (offCanvas) {\n\t\t\t\tif (offCanvas.classList.contains(CLASS_OFF_CANVAS_LEFT)) {\n\t\t\t\t\tthis.offCanvasLeft = offCanvas;\n\t\t\t\t} else if (offCanvas.classList.contains(CLASS_OFF_CANVAS_RIGHT)) {\n\t\t\t\t\tthis.offCanvasRight = offCanvas;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.offCanvasRight = this.wrapper.querySelector('.' + CLASS_OFF_CANVAS_RIGHT);\n\t\t\t\tthis.offCanvasLeft = this.wrapper.querySelector('.' + CLASS_OFF_CANVAS_LEFT);\n\t\t\t}\n\t\t\tthis.offCanvasRightWidth = this.offCanvasLeftWidth = 0;\n\t\t\tthis.offCanvasLeftSlideIn = this.offCanvasRightSlideIn = false;\n\t\t\tif (this.offCanvasRight) {\n\t\t\t\tthis.offCanvasRightWidth = this.offCanvasRight.offsetWidth;\n\t\t\t\tthis.offCanvasRightSlideIn = this.slideIn && (this.offCanvasRight.parentNode === this.wrapper);\n\t\t\t\t//\t\t\t\tthis.offCanvasRight.classList.remove(CLASS_TRANSITIONING);\n\t\t\t\t//\t\t\t\tthis.offCanvasRight.classList.remove(CLASS_ACTIVE);\n\t\t\t\t//\t\t\t\tthis.offCanvasRight.setAttribute('style', '');\n\t\t\t}\n\t\t\tif (this.offCanvasLeft) {\n\t\t\t\tthis.offCanvasLeftWidth = this.offCanvasLeft.offsetWidth;\n\t\t\t\tthis.offCanvasLeftSlideIn = this.slideIn && (this.offCanvasLeft.parentNode === this.wrapper);\n\t\t\t\t//\t\t\t\tthis.offCanvasLeft.classList.remove(CLASS_TRANSITIONING);\n\t\t\t\t//\t\t\t\tthis.offCanvasLeft.classList.remove(CLASS_ACTIVE);\n\t\t\t\t//\t\t\t\tthis.offCanvasLeft.setAttribute('style', '');\n\t\t\t}\n\t\t\tthis.backdrop = this.scroller.querySelector('.' + CLASS_ACTION_BACKDROP);\n\n\t\t\tthis.options.dragThresholdX = this.options.dragThresholdX || 10;\n\n\t\t\tthis.visible = false;\n\t\t\tthis.startX = null;\n\t\t\tthis.lastX = null;\n\t\t\tthis.offsetX = null;\n\t\t\tthis.lastTranslateX = null;\n\t\t},\n\t\thandleEvent: function(e) {\n\t\t\tswitch (e.type) {\n\t\t\t\tcase $.EVENT_START:\n\t\t\t\t\te.target && !this._preventDefaultException(e.target, this.options.preventDefaultException) && e.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'webkitTransitionEnd': //有个bug需要处理，需要考虑假设没有触发webkitTransitionEnd的情况\n\t\t\t\t\tif (e.target === this.scroller) {\n\t\t\t\t\t\tthis._dispatchEvent();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'drag':\n\t\t\t\t\tvar detail = e.detail;\n\t\t\t\t\tif (!this.startX) {\n\t\t\t\t\t\tthis.startX = detail.center.x;\n\t\t\t\t\t\tthis.lastX = this.startX;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.lastX = detail.center.x;\n\t\t\t\t\t}\n\t\t\t\t\tif (!this.isDragging && Math.abs(this.lastX - this.startX) > this.options.dragThresholdX && (detail.direction === 'left' || (detail.direction === 'right'))) {\n\t\t\t\t\t\tif (this.slideIn) {\n\t\t\t\t\t\t\tthis.scroller = this.wrapper.querySelector(SELECTOR_INNER_WRAP);\n\t\t\t\t\t\t\tif (this.classList.contains(CLASS_ACTIVE)) {\n\t\t\t\t\t\t\t\tif (this.offCanvasRight && this.offCanvasRight.classList.contains(CLASS_ACTIVE)) {\n\t\t\t\t\t\t\t\t\tthis.offCanvas = this.offCanvasRight;\n\t\t\t\t\t\t\t\t\tthis.offCanvasWidth = this.offCanvasRightWidth;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis.offCanvas = this.offCanvasLeft;\n\t\t\t\t\t\t\t\t\tthis.offCanvasWidth = this.offCanvasLeftWidth;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (detail.direction === 'left' && this.offCanvasRight) {\n\t\t\t\t\t\t\t\t\tthis.offCanvas = this.offCanvasRight;\n\t\t\t\t\t\t\t\t\tthis.offCanvasWidth = this.offCanvasRightWidth;\n\t\t\t\t\t\t\t\t} else if (detail.direction === 'right' && this.offCanvasLeft) {\n\t\t\t\t\t\t\t\t\tthis.offCanvas = this.offCanvasLeft;\n\t\t\t\t\t\t\t\t\tthis.offCanvasWidth = this.offCanvasLeftWidth;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis.scroller = null;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (this.classList.contains(CLASS_ACTIVE)) {\n\t\t\t\t\t\t\t\tif (detail.direction === 'left') {\n\t\t\t\t\t\t\t\t\tthis.offCanvas = this.offCanvasLeft;\n\t\t\t\t\t\t\t\t\tthis.offCanvasWidth = this.offCanvasLeftWidth;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis.offCanvas = this.offCanvasRight;\n\t\t\t\t\t\t\t\t\tthis.offCanvasWidth = this.offCanvasRightWidth;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (detail.direction === 'right') {\n\t\t\t\t\t\t\t\t\tthis.offCanvas = this.offCanvasLeft;\n\t\t\t\t\t\t\t\t\tthis.offCanvasWidth = this.offCanvasLeftWidth;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis.offCanvas = this.offCanvasRight;\n\t\t\t\t\t\t\t\t\tthis.offCanvasWidth = this.offCanvasRightWidth;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (this.offCanvas && this.scroller) {\n\t\t\t\t\t\t\tthis.startX = this.lastX;\n\t\t\t\t\t\t\tthis.isDragging = true;\n\n\t\t\t\t\t\t\t$.gestures.session.lockDirection = true; //锁定方向\n\t\t\t\t\t\t\t$.gestures.session.startDirection = detail.direction;\n\n\t\t\t\t\t\t\tthis.offCanvas.classList.remove(CLASS_TRANSITIONING);\n\t\t\t\t\t\t\tthis.scroller.classList.remove(CLASS_TRANSITIONING);\n\t\t\t\t\t\t\tthis.offsetX = this.getTranslateX();\n\t\t\t\t\t\t\tthis._initOffCanvasVisible();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (this.isDragging) {\n\t\t\t\t\t\tthis.updateTranslate(this.offsetX + (this.lastX - this.startX));\n\t\t\t\t\t\tdetail.gesture.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'dragend':\n\t\t\t\t\tif (this.isDragging) {\n\t\t\t\t\t\tvar detail = e.detail;\n\t\t\t\t\t\tvar direction = detail.direction;\n\t\t\t\t\t\tthis.isDragging = false;\n\t\t\t\t\t\tthis.offCanvas.classList.add(CLASS_TRANSITIONING);\n\t\t\t\t\t\tthis.scroller.classList.add(CLASS_TRANSITIONING);\n\t\t\t\t\t\tvar ratio = 0;\n\t\t\t\t\t\tvar x = this.getTranslateX();\n\t\t\t\t\t\tif (!this.slideIn) {\n\t\t\t\t\t\t\tif (x >= 0) {\n\t\t\t\t\t\t\t\tratio = (this.offCanvasLeftWidth && (x / this.offCanvasLeftWidth)) || 0;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tratio = (this.offCanvasRightWidth && (x / this.offCanvasRightWidth)) || 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (ratio === 0) {\n\t\t\t\t\t\t\t\tthis.openPercentage(0);\n\t\t\t\t\t\t\t\tthis._dispatchEvent(); //此处不触发webkitTransitionEnd,所以手动dispatch\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (direction === 'right' && ratio >= 0 && (ratio >= 0.5 || detail.swipe)) { //右滑打开\n\t\t\t\t\t\t\t\tthis.openPercentage(100);\n\t\t\t\t\t\t\t} else if (direction === 'right' && ratio < 0 && (ratio > -0.5 || detail.swipe)) { //右滑关闭\n\t\t\t\t\t\t\t\tthis.openPercentage(0);\n\t\t\t\t\t\t\t} else if (direction === 'right' && ratio > 0 && ratio < 0.5) { //右滑还原关闭\n\t\t\t\t\t\t\t\tthis.openPercentage(0);\n\t\t\t\t\t\t\t} else if (direction === 'right' && ratio < 0.5) { //右滑还原打开\n\t\t\t\t\t\t\t\tthis.openPercentage(-100);\n\t\t\t\t\t\t\t} else if (direction === 'left' && ratio <= 0 && (ratio <= -0.5 || detail.swipe)) { //左滑打开\n\t\t\t\t\t\t\t\tthis.openPercentage(-100);\n\t\t\t\t\t\t\t} else if (direction === 'left' && ratio > 0 && (ratio <= 0.5 || detail.swipe)) { //左滑关闭\n\t\t\t\t\t\t\t\tthis.openPercentage(0);\n\t\t\t\t\t\t\t} else if (direction === 'left' && ratio < 0 && ratio >= -0.5) { //左滑还原关闭\n\t\t\t\t\t\t\t\tthis.openPercentage(0);\n\t\t\t\t\t\t\t} else if (direction === 'left' && ratio > 0.5) { //左滑还原打开\n\t\t\t\t\t\t\t\tthis.openPercentage(100);\n\t\t\t\t\t\t\t} else { //默认关闭\n\t\t\t\t\t\t\t\tthis.openPercentage(0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (ratio === 1 || ratio === -1) { //此处不触发webkitTransitionEnd,所以手动dispatch\n\t\t\t\t\t\t\t\tthis._dispatchEvent();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (x >= 0) {\n\t\t\t\t\t\t\t\tratio = (this.offCanvasRightWidth && (x / this.offCanvasRightWidth)) || 0;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tratio = (this.offCanvasLeftWidth && (x / this.offCanvasLeftWidth)) || 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (direction === 'right' && ratio <= 0 && (ratio >= -0.5 || detail.swipe)) { //右滑打开\n\t\t\t\t\t\t\t\tthis.openPercentage(100);\n\t\t\t\t\t\t\t} else if (direction === 'right' && ratio > 0 && (ratio >= 0.5 || detail.swipe)) { //右滑关闭\n\t\t\t\t\t\t\t\tthis.openPercentage(0);\n\t\t\t\t\t\t\t} else if (direction === 'right' && ratio <= -0.5) { //右滑还原关闭\n\t\t\t\t\t\t\t\tthis.openPercentage(0);\n\t\t\t\t\t\t\t} else if (direction === 'right' && ratio > 0 && ratio <= 0.5) { //右滑还原打开\n\t\t\t\t\t\t\t\tthis.openPercentage(-100);\n\t\t\t\t\t\t\t} else if (direction === 'left' && ratio >= 0 && (ratio <= 0.5 || detail.swipe)) { //左滑打开\n\t\t\t\t\t\t\t\tthis.openPercentage(-100);\n\t\t\t\t\t\t\t} else if (direction === 'left' && ratio < 0 && (ratio <= -0.5 || detail.swipe)) { //左滑关闭\n\t\t\t\t\t\t\t\tthis.openPercentage(0);\n\t\t\t\t\t\t\t} else if (direction === 'left' && ratio >= 0.5) { //左滑还原关闭\n\t\t\t\t\t\t\t\tthis.openPercentage(0);\n\t\t\t\t\t\t\t} else if (direction === 'left' && ratio >= -0.5 && ratio < 0) { //左滑还原打开\n\t\t\t\t\t\t\t\tthis.openPercentage(100);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.openPercentage(0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (ratio === 1 || ratio === -1 || ratio === 0) {\n\t\t\t\t\t\t\t\tthis._dispatchEvent();\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\t_dispatchEvent: function() {\n\t\t\tif (this.classList.contains(CLASS_ACTIVE)) {\n\t\t\t\t$.trigger(this.wrapper, 'shown', this);\n\t\t\t} else {\n\t\t\t\t$.trigger(this.wrapper, 'hidden', this);\n\t\t\t}\n\t\t},\n\t\t_initOffCanvasVisible: function() {\n\t\t\tif (!this.visible) {\n\t\t\t\tthis.visible = true;\n\t\t\t\tif (this.offCanvasLeft) {\n\t\t\t\t\tthis.offCanvasLeft.style.visibility = 'visible';\n\t\t\t\t}\n\t\t\t\tif (this.offCanvasRight) {\n\t\t\t\t\tthis.offCanvasRight.style.visibility = 'visible';\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tinitEvent: function() {\n\t\t\tvar self = this;\n\t\t\tif (self.backdrop) {\n\t\t\t\tself.backdrop.addEventListener('tap', function(e) {\n\t\t\t\t\tself.close();\n\t\t\t\t\te.detail.gesture.preventDefault();\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (this.classList.contains('mui-draggable')) {\n\t\t\t\tthis.wrapper.addEventListener($.EVENT_START, this); //临时处理\n\t\t\t\tthis.wrapper.addEventListener('drag', this);\n\t\t\t\tthis.wrapper.addEventListener('dragend', this);\n\t\t\t}\n\t\t\tthis.wrapper.addEventListener('webkitTransitionEnd', this);\n\t\t},\n\t\topenPercentage: function(percentage) {\n\t\t\tvar p = percentage / 100;\n\t\t\tif (!this.slideIn) {\n\t\t\t\tif (this.offCanvasLeft && percentage >= 0) {\n\t\t\t\t\tthis.updateTranslate(this.offCanvasLeftWidth * p);\n\t\t\t\t\tthis.offCanvasLeft.classList[p !== 0 ? 'add' : 'remove'](CLASS_ACTIVE);\n\t\t\t\t} else if (this.offCanvasRight && percentage <= 0) {\n\t\t\t\t\tthis.updateTranslate(this.offCanvasRightWidth * p);\n\t\t\t\t\tthis.offCanvasRight.classList[p !== 0 ? 'add' : 'remove'](CLASS_ACTIVE);\n\t\t\t\t}\n\t\t\t\tthis.classList[p !== 0 ? 'add' : 'remove'](CLASS_ACTIVE);\n\t\t\t} else {\n\t\t\t\tif (this.offCanvasLeft && percentage >= 0) {\n\t\t\t\t\tp = p === 0 ? -1 : 0;\n\t\t\t\t\tthis.updateTranslate(this.offCanvasLeftWidth * p);\n\t\t\t\t\tthis.offCanvasLeft.classList[percentage !== 0 ? 'add' : 'remove'](CLASS_ACTIVE);\n\t\t\t\t} else if (this.offCanvasRight && percentage <= 0) {\n\t\t\t\t\tp = p === 0 ? 1 : 0;\n\t\t\t\t\tthis.updateTranslate(this.offCanvasRightWidth * p);\n\t\t\t\t\tthis.offCanvasRight.classList[percentage !== 0 ? 'add' : 'remove'](CLASS_ACTIVE);\n\t\t\t\t}\n\t\t\t\tthis.classList[percentage !== 0 ? 'add' : 'remove'](CLASS_ACTIVE);\n\t\t\t}\n\t\t},\n\t\tupdateTranslate: function(x) {\n\t\t\tif (x !== this.lastTranslateX) {\n\t\t\t\tif (!this.slideIn) {\n\t\t\t\t\tif ((!this.offCanvasLeft && x > 0) || (!this.offCanvasRight && x < 0)) {\n\t\t\t\t\t\tthis.setTranslateX(0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (this.leftShowing && x > this.offCanvasLeftWidth) {\n\t\t\t\t\t\tthis.setTranslateX(this.offCanvasLeftWidth);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (this.rightShowing && x < -this.offCanvasRightWidth) {\n\t\t\t\t\t\tthis.setTranslateX(-this.offCanvasRightWidth);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.setTranslateX(x);\n\t\t\t\t\tif (x >= 0) {\n\t\t\t\t\t\tthis.leftShowing = true;\n\t\t\t\t\t\tthis.rightShowing = false;\n\t\t\t\t\t\tif (x > 0) {\n\t\t\t\t\t\t\tif (this.offCanvasLeft) {\n\t\t\t\t\t\t\t\t$.each(this.offCanvasLefts, function(index, offCanvas) {\n\t\t\t\t\t\t\t\t\tif (offCanvas === this.offCanvasLeft) {\n\t\t\t\t\t\t\t\t\t\tthis.offCanvasLeft.style.zIndex = 0;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\toffCanvas.style.zIndex = -1;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}.bind(this));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (this.offCanvasRight) {\n\t\t\t\t\t\t\t\tthis.offCanvasRight.style.zIndex = -1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.rightShowing = true;\n\t\t\t\t\t\tthis.leftShowing = false;\n\t\t\t\t\t\tif (this.offCanvasRight) {\n\t\t\t\t\t\t\t$.each(this.offCanvasRights, function(index, offCanvas) {\n\t\t\t\t\t\t\t\tif (offCanvas === this.offCanvasRight) {\n\t\t\t\t\t\t\t\t\toffCanvas.style.zIndex = 0;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\toffCanvas.style.zIndex = -1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}.bind(this));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (this.offCanvasLeft) {\n\t\t\t\t\t\t\tthis.offCanvasLeft.style.zIndex = -1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (this.offCanvas.classList.contains(CLASS_OFF_CANVAS_RIGHT)) {\n\t\t\t\t\t\tif (x < 0) {\n\t\t\t\t\t\t\tthis.setTranslateX(0);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (x > this.offCanvasRightWidth) {\n\t\t\t\t\t\t\tthis.setTranslateX(this.offCanvasRightWidth);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (x > 0) {\n\t\t\t\t\t\t\tthis.setTranslateX(0);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (x < -this.offCanvasLeftWidth) {\n\t\t\t\t\t\t\tthis.setTranslateX(-this.offCanvasLeftWidth);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.setTranslateX(x);\n\t\t\t\t}\n\t\t\t\tthis.lastTranslateX = x;\n\t\t\t}\n\t\t},\n\t\tsetTranslateX: $.animationFrame(function(x) {\n\t\t\tif (this.scroller) {\n\t\t\t\tif (this.scalable && this.offCanvas.parentNode === this.wrapper) {\n\t\t\t\t\tvar percent = Math.abs(x) / this.offCanvasWidth;\n\t\t\t\t\tvar zoomOutScale = 1 - (1 - this.options.scale) * percent;\n\t\t\t\t\tvar zoomInScale = this.options.scale + (1 - this.options.scale) * percent;\n\t\t\t\t\tvar zoomOutOpacity = 1 - (1 - this.options.opacity) * percent;\n\t\t\t\t\tvar zoomInOpacity = this.options.opacity + (1 - this.options.opacity) * percent;\n\t\t\t\t\tif (this.offCanvas.classList.contains(CLASS_OFF_CANVAS_LEFT)) {\n\t\t\t\t\t\tthis.offCanvas.style.webkitTransformOrigin = '-100%';\n\t\t\t\t\t\tthis.scroller.style.webkitTransformOrigin = 'left';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.offCanvas.style.webkitTransformOrigin = '200%';\n\t\t\t\t\t\tthis.scroller.style.webkitTransformOrigin = 'right';\n\t\t\t\t\t}\n\t\t\t\t\tthis.offCanvas.style.opacity = zoomInOpacity;\n\t\t\t\t\tthis.offCanvas.style.webkitTransform = 'translate3d(0,0,0) scale(' + zoomInScale + ')';\n\t\t\t\t\tthis.scroller.style.webkitTransform = 'translate3d(' + x + 'px,0,0) scale(' + zoomOutScale + ')';\n\t\t\t\t} else {\n\t\t\t\t\tif (this.slideIn) {\n\t\t\t\t\t\tthis.offCanvas.style.webkitTransform = 'translate3d(' + x + 'px,0,0)';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.scroller.style.webkitTransform = 'translate3d(' + x + 'px,0,0)';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}),\n\t\tgetTranslateX: function() {\n\t\t\tif (this.offCanvas) {\n\t\t\t\tvar scroller = this.slideIn ? this.offCanvas : this.scroller;\n\t\t\t\tvar result = $.parseTranslateMatrix($.getStyles(scroller, 'webkitTransform'));\n\t\t\t\treturn (result && result.x) || 0;\n\t\t\t}\n\t\t\treturn 0;\n\t\t},\n\t\tisShown: function(direction) {\n\t\t\tvar shown = false;\n\t\t\tif (!this.slideIn) {\n\t\t\t\tvar x = this.getTranslateX();\n\t\t\t\tif (direction === 'right') {\n\t\t\t\t\tshown = this.classList.contains(CLASS_ACTIVE) && x < 0;\n\t\t\t\t} else if (direction === 'left') {\n\t\t\t\t\tshown = this.classList.contains(CLASS_ACTIVE) && x > 0;\n\t\t\t\t} else {\n\t\t\t\t\tshown = this.classList.contains(CLASS_ACTIVE) && x !== 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (direction === 'left') {\n\t\t\t\t\tshown = this.classList.contains(CLASS_ACTIVE) && this.wrapper.querySelector('.' + CLASS_OFF_CANVAS_LEFT + '.' + CLASS_ACTIVE);\n\t\t\t\t} else if (direction === 'right') {\n\t\t\t\t\tshown = this.classList.contains(CLASS_ACTIVE) && this.wrapper.querySelector('.' + CLASS_OFF_CANVAS_RIGHT + '.' + CLASS_ACTIVE);\n\t\t\t\t} else {\n\t\t\t\t\tshown = this.classList.contains(CLASS_ACTIVE) && (this.wrapper.querySelector('.' + CLASS_OFF_CANVAS_LEFT + '.' + CLASS_ACTIVE) || this.wrapper.querySelector('.' + CLASS_OFF_CANVAS_RIGHT + '.' + CLASS_ACTIVE));\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn shown;\n\t\t},\n\t\tclose: function() {\n\t\t\tthis._initOffCanvasVisible();\n\t\t\tthis.offCanvas = this.wrapper.querySelector('.' + CLASS_OFF_CANVAS_RIGHT + '.' + CLASS_ACTIVE) || this.wrapper.querySelector('.' + CLASS_OFF_CANVAS_LEFT + '.' + CLASS_ACTIVE);\n\t\t\tthis.offCanvasWidth = this.offCanvas.offsetWidth;\n\t\t\tif (this.scroller) {\n\t\t\t\tthis.offCanvas.offsetHeight;\n\t\t\t\tthis.offCanvas.classList.add(CLASS_TRANSITIONING);\n\t\t\t\tthis.scroller.classList.add(CLASS_TRANSITIONING);\n\t\t\t\tthis.openPercentage(0);\n\t\t\t}\n\t\t},\n\t\tshow: function(direction) {\n\t\t\tthis._initOffCanvasVisible();\n\t\t\tif (this.isShown(direction)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (!direction) {\n\t\t\t\tdirection = this.wrapper.querySelector('.' + CLASS_OFF_CANVAS_RIGHT) ? 'right' : 'left';\n\t\t\t}\n\t\t\tif (direction === 'right') {\n\t\t\t\tthis.offCanvas = this.offCanvasRight;\n\t\t\t\tthis.offCanvasWidth = this.offCanvasRightWidth;\n\t\t\t} else {\n\t\t\t\tthis.offCanvas = this.offCanvasLeft;\n\t\t\t\tthis.offCanvasWidth = this.offCanvasLeftWidth;\n\t\t\t}\n\t\t\tif (this.scroller) {\n\t\t\t\tthis.offCanvas.offsetHeight;\n\t\t\t\tthis.offCanvas.classList.add(CLASS_TRANSITIONING);\n\t\t\t\tthis.scroller.classList.add(CLASS_TRANSITIONING);\n\t\t\t\tthis.openPercentage(direction === 'left' ? 100 : -100);\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\ttoggle: function(directionOrOffCanvas) {\n\t\t\tvar direction = directionOrOffCanvas;\n\t\t\tif (directionOrOffCanvas && directionOrOffCanvas.classList) {\n\t\t\t\tdirection = directionOrOffCanvas.classList.contains(CLASS_OFF_CANVAS_LEFT) ? 'left' : 'right';\n\t\t\t\tthis.refresh(directionOrOffCanvas);\n\t\t\t}\n\t\t\tif (!this.show(direction)) {\n\t\t\t\tthis.close();\n\t\t\t}\n\t\t}\n\t});\n\n\t//hash to offcanvas\n\tvar findOffCanvasContainer = function(target) {\n\t\tparentNode = target.parentNode;\n\t\tif (parentNode) {\n\t\t\tif (parentNode.classList.contains(CLASS_OFF_CANVAS_WRAP)) {\n\t\t\t\treturn parentNode;\n\t\t\t} else {\n\t\t\t\tparentNode = parentNode.parentNode;\n\t\t\t\tif (parentNode.classList.contains(CLASS_OFF_CANVAS_WRAP)) {\n\t\t\t\t\treturn parentNode;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\tvar handle = function(event, target) {\n\t\tif (target.tagName === 'A' && target.hash) {\n\t\t\tvar offcanvas = document.getElementById(target.hash.replace('#', ''));\n\t\t\tif (offcanvas) {\n\t\t\t\tvar container = findOffCanvasContainer(offcanvas);\n\t\t\t\tif (container) {\n\t\t\t\t\t$.targets._container = container;\n\t\t\t\t\treturn offcanvas;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t};\n\n\t$.registerTarget({\n\t\tname: name,\n\t\tindex: 60,\n\t\thandle: handle,\n\t\ttarget: false,\n\t\tisReset: false,\n\t\tisContinue: true\n\t});\n\n\twindow.addEventListener('tap', function(e) {\n\t\tif (!$.targets.offcanvas) {\n\t\t\treturn;\n\t\t}\n\t\t//TODO 此处类型的代码后续考虑统一优化(target机制)，现在的实现费力不讨好\n\t\tvar target = e.target;\n\t\tfor (; target && target !== document; target = target.parentNode) {\n\t\t\tif (target.tagName === 'A' && target.hash && target.hash === ('#' + $.targets.offcanvas.id)) {\n\t\t\t\te.detail && e.detail.gesture && e.detail.gesture.preventDefault(); //fixed hashchange\n\t\t\t\t$($.targets._container).offCanvas().toggle($.targets.offcanvas);\n\t\t\t\t$.targets.offcanvas = $.targets._container = null;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t});\n\n\t$.fn.offCanvas = function(options) {\n\t\tvar offCanvasApis = [];\n\t\tthis.each(function() {\n\t\t\tvar offCanvasApi = null;\n\t\t\tvar self = this;\n\t\t\t//hack old version\n\t\t\tif (!self.classList.contains(CLASS_OFF_CANVAS_WRAP)) {\n\t\t\t\tself = findOffCanvasContainer(self);\n\t\t\t}\n\t\t\tvar id = self.getAttribute('data-offCanvas');\n\t\t\tif (!id) {\n\t\t\t\tid = ++$.uuid;\n\t\t\t\t$.data[id] = offCanvasApi = new OffCanvas(self, options);\n\t\t\t\tself.setAttribute('data-offCanvas', id);\n\t\t\t} else {\n\t\t\t\toffCanvasApi = $.data[id];\n\t\t\t}\n\t\t\tif (options === 'show' || options === 'close' || options === 'toggle') {\n\t\t\t\toffCanvasApi.toggle();\n\t\t\t}\n\t\t\toffCanvasApis.push(offCanvasApi);\n\t\t});\n\t\treturn offCanvasApis.length === 1 ? offCanvasApis[0] : offCanvasApis;\n\t};\n\t$.ready(function() {\n\t\t$('.mui-off-canvas-wrap').offCanvas();\n\t});\n})(mui, window, document, 'offcanvas');\n/**\n * actions\n * @param {type} $\n * @param {type} name\n * @returns {undefined}\n */\n(function($, name) {\n\tvar CLASS_ACTION = 'mui-action';\n\n\tvar handle = function(event, target) {\n\t\tvar className = target.className || '';\n\t\tif (typeof className !== 'string') { //svg className(SVGAnimatedString)\n\t\t\tclassName = '';\n\t\t}\n\t\tif (className && ~className.indexOf(CLASS_ACTION)) {\n\t\t\tif (target.classList.contains('mui-action-back')) {\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t\treturn target;\n\t\t}\n\t\treturn false;\n\t};\n\n\t$.registerTarget({\n\t\tname: name,\n\t\tindex: 50,\n\t\thandle: handle,\n\t\ttarget: false,\n\t\tisContinue: true\n\t});\n\n})(mui, 'action');\n/**\n * Modals\n * @param {type} $\n * @param {type} window\n * @param {type} document\n * @param {type} name\n * @returns {undefined}\n */\n(function($, window, document, name) {\n\tvar CLASS_MODAL = 'mui-modal';\n\n\tvar handle = function(event, target) {\n\t\tif (target.tagName === 'A' && target.hash) {\n\t\t\tvar modal = document.getElementById(target.hash.replace('#', ''));\n\t\t\tif (modal && modal.classList.contains(CLASS_MODAL)) {\n\t\t\t\treturn modal;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t};\n\n\t$.registerTarget({\n\t\tname: name,\n\t\tindex: 50,\n\t\thandle: handle,\n\t\ttarget: false,\n\t\tisReset: false,\n\t\tisContinue: true\n\t});\n\n\twindow.addEventListener('tap', function(event) {\n\t\tif ($.targets.modal) {\n\t\t\tevent.detail.gesture.preventDefault(); //fixed hashchange\n\t\t\t$.targets.modal.classList.toggle('mui-active');\n\t\t}\n\t});\n})(mui, window, document, 'modal');\n/**\n * Popovers\n * @param {type} $\n * @param {type} window\n * @param {type} document\n * @param {type} name\n * @param {type} undefined\n * @returns {undefined}\n */\n(function($, window, document, name) {\n\n\tvar CLASS_POPOVER = 'mui-popover';\n\tvar CLASS_POPOVER_ARROW = 'mui-popover-arrow';\n\tvar CLASS_ACTION_POPOVER = 'mui-popover-action';\n\tvar CLASS_BACKDROP = 'mui-backdrop';\n\tvar CLASS_BAR_POPOVER = 'mui-bar-popover';\n\tvar CLASS_BAR_BACKDROP = 'mui-bar-backdrop';\n\tvar CLASS_ACTION_BACKDROP = 'mui-backdrop-action';\n\tvar CLASS_ACTIVE = 'mui-active';\n\tvar CLASS_BOTTOM = 'mui-bottom';\n\n\n\n\tvar handle = function(event, target) {\n\t\tif (target.tagName === 'A' && target.hash) {\n\t\t\t$.targets._popover = document.getElementById(target.hash.replace('#', ''));\n\t\t\tif ($.targets._popover && $.targets._popover.classList.contains(CLASS_POPOVER)) {\n\t\t\t\treturn target;\n\t\t\t} else {\n\t\t\t\t$.targets._popover = null;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t};\n\n\t$.registerTarget({\n\t\tname: name,\n\t\tindex: 60,\n\t\thandle: handle,\n\t\ttarget: false,\n\t\tisReset: false,\n\t\tisContinue: true\n\t});\n\n\tvar onPopoverShown = function(e) {\n\t\tthis.removeEventListener('webkitTransitionEnd', onPopoverShown);\n\t\tthis.addEventListener($.EVENT_MOVE, $.preventDefault);\n\t\t$.trigger(this, 'shown', this);\n\t}\n\tvar onPopoverHidden = function(e) {\n\t\tsetStyle(this, 'none');\n\t\tthis.removeEventListener('webkitTransitionEnd', onPopoverHidden);\n\t\tthis.removeEventListener($.EVENT_MOVE, $.preventDefault);\n\t\t$.trigger(this, 'hidden', this);\n\t};\n\n\tvar backdrop = (function() {\n\t\tvar element = document.createElement('div');\n\t\telement.classList.add(CLASS_BACKDROP);\n\t\telement.addEventListener($.EVENT_MOVE, $.preventDefault);\n\t\telement.addEventListener('tap', function(e) {\n\t\t\tvar popover = $.targets._popover;\n\t\t\tif (popover) {\n\t\t\t\tpopover.addEventListener('webkitTransitionEnd', onPopoverHidden);\n\t\t\t\tpopover.classList.remove(CLASS_ACTIVE);\n\t\t\t\tremoveBackdrop(popover);\n\t\t\t}\n\t\t});\n\n\t\treturn element;\n\t}());\n\tvar removeBackdropTimer;\n\tvar removeBackdrop = function(popover) {\n\t\tbackdrop.setAttribute('style', 'opacity:0');\n\t\t$.targets.popover = $.targets._popover = null; //reset\n\t\tremoveBackdropTimer = $.later(function() {\n\t\t\tif (!popover.classList.contains(CLASS_ACTIVE) && backdrop.parentNode && backdrop.parentNode === document.body) {\n\t\t\t\tdocument.body.removeChild(backdrop);\n\t\t\t}\n\t\t}, 350);\n\t};\n\twindow.addEventListener('tap', function(e) {\n\t\tif (!$.targets.popover) {\n\t\t\treturn;\n\t\t}\n\t\tvar toggle = false;\n\t\tvar target = e.target;\n\t\tfor (; target && target !== document; target = target.parentNode) {\n\t\t\tif (target === $.targets.popover) {\n\t\t\t\ttoggle = true;\n\t\t\t}\n\t\t}\n\t\tif (toggle) {\n\t\t\te.detail.gesture.preventDefault(); //fixed hashchange\n\t\t\ttogglePopover($.targets._popover, $.targets.popover);\n\t\t}\n\n\t});\n\n\tvar togglePopover = function(popover, anchor, state) {\n\t\tif ((state === 'show' && popover.classList.contains(CLASS_ACTIVE)) || (state === 'hide' && !popover.classList.contains(CLASS_ACTIVE))) {\n\t\t\treturn;\n\t\t}\n\t\tremoveBackdropTimer && removeBackdropTimer.cancel(); //取消remove的timer\n\t\t//remove一遍，以免来回快速切换，导致webkitTransitionEnd不触发，无法remove\n\t\tpopover.removeEventListener('webkitTransitionEnd', onPopoverShown);\n\t\tpopover.removeEventListener('webkitTransitionEnd', onPopoverHidden);\n\t\tbackdrop.classList.remove(CLASS_BAR_BACKDROP);\n\t\tbackdrop.classList.remove(CLASS_ACTION_BACKDROP);\n\t\tvar _popover = document.querySelector('.mui-popover.mui-active');\n\t\tif (_popover) {\n\t\t\t//\t\t\t_popover.setAttribute('style', '');\n\t\t\t_popover.addEventListener('webkitTransitionEnd', onPopoverHidden);\n\t\t\t_popover.classList.remove(CLASS_ACTIVE);\n\t\t\t//\t\t\t_popover.removeEventListener('webkitTransitionEnd', onPopoverHidden);\n\t\t\t//同一个弹出则直接返回，解决同一个popover的toggle\n\t\t\tif (popover === _popover) {\n\t\t\t\tremoveBackdrop(_popover);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tvar isActionSheet = false;\n\t\tif (popover.classList.contains(CLASS_BAR_POPOVER) || popover.classList.contains(CLASS_ACTION_POPOVER)) { //navBar\n\t\t\tif (popover.classList.contains(CLASS_ACTION_POPOVER)) { //action sheet popover\n\t\t\t\tisActionSheet = true;\n\t\t\t\tbackdrop.classList.add(CLASS_ACTION_BACKDROP);\n\t\t\t} else { //bar popover\n\t\t\t\tbackdrop.classList.add(CLASS_BAR_BACKDROP);\n\t\t\t\t//\t\t\t\tif (anchor) {\n\t\t\t\t//\t\t\t\t\tif (anchor.parentNode) {\n\t\t\t\t//\t\t\t\t\t\tvar offsetWidth = anchor.offsetWidth;\n\t\t\t\t//\t\t\t\t\t\tvar offsetLeft = anchor.offsetLeft;\n\t\t\t\t//\t\t\t\t\t\tvar innerWidth = window.innerWidth;\n\t\t\t\t//\t\t\t\t\t\tpopover.style.left = (Math.min(Math.max(offsetLeft, defaultPadding), innerWidth - offsetWidth - defaultPadding)) + \"px\";\n\t\t\t\t//\t\t\t\t\t} else {\n\t\t\t\t//\t\t\t\t\t\t//TODO anchor is position:{left,top,bottom,right}\n\t\t\t\t//\t\t\t\t\t}\n\t\t\t\t//\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsetStyle(popover, 'block'); //actionsheet transform\n\t\tpopover.offsetHeight;\n\t\tpopover.classList.add(CLASS_ACTIVE);\n\t\tbackdrop.setAttribute('style', '');\n\t\tdocument.body.appendChild(backdrop);\n\t\tcalPosition(popover, anchor, isActionSheet); //position\n\t\tbackdrop.classList.add(CLASS_ACTIVE);\n\t\tpopover.addEventListener('webkitTransitionEnd', onPopoverShown);\n\t};\n\tvar setStyle = function(popover, display, top, left) {\n\t\tvar style = popover.style;\n\t\tif (typeof display !== 'undefined')\n\t\t\tstyle.display = display;\n\t\tif (typeof top !== 'undefined')\n\t\t\tstyle.top = top + 'px';\n\t\tif (typeof left !== 'undefined')\n\t\t\tstyle.left = left + 'px';\n\t};\n\tvar calPosition = function(popover, anchor, isActionSheet) {\n\t\tif (!popover || !anchor) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (isActionSheet) { //actionsheet\n\t\t\tsetStyle(popover, 'block')\n\t\t\treturn;\n\t\t}\n\n\t\tvar wWidth = window.innerWidth;\n\t\tvar wHeight = window.innerHeight;\n\n\t\tvar pWidth = popover.offsetWidth;\n\t\tvar pHeight = popover.offsetHeight;\n\n\t\tvar aWidth = anchor.offsetWidth;\n\t\tvar aHeight = anchor.offsetHeight;\n\t\tvar offset = $.offset(anchor);\n\n\t\tvar arrow = popover.querySelector('.' + CLASS_POPOVER_ARROW);\n\t\tif (!arrow) {\n\t\t\tarrow = document.createElement('div');\n\t\t\tarrow.className = CLASS_POPOVER_ARROW;\n\t\t\tpopover.appendChild(arrow);\n\t\t}\n\t\tvar arrowSize = arrow && arrow.offsetWidth / 2 || 0;\n\n\n\n\t\tvar pTop = 0;\n\t\tvar pLeft = 0;\n\t\tvar diff = 0;\n\t\tvar arrowLeft = 0;\n\t\tvar defaultPadding = popover.classList.contains(CLASS_ACTION_POPOVER) ? 0 : 5;\n\n\t\tvar position = 'top';\n\t\tif ((pHeight + arrowSize) < (offset.top - window.pageYOffset)) { //top\n\t\t\tpTop = offset.top - pHeight - arrowSize;\n\t\t} else if ((pHeight + arrowSize) < (wHeight - (offset.top - window.pageYOffset) - aHeight)) { //bottom\n\t\t\tposition = 'bottom';\n\t\t\tpTop = offset.top + aHeight + arrowSize;\n\t\t} else { //middle\n\t\t\tposition = 'middle';\n\t\t\tpTop = Math.max((wHeight - pHeight) / 2 + window.pageYOffset, 0);\n\t\t\tpLeft = Math.max((wWidth - pWidth) / 2 + window.pageXOffset, 0);\n\t\t}\n\t\tif (position === 'top' || position === 'bottom') {\n\t\t\tpLeft = aWidth / 2 + offset.left - pWidth / 2;\n\t\t\tdiff = pLeft;\n\t\t\tif (pLeft < defaultPadding) pLeft = defaultPadding;\n\t\t\tif (pLeft + pWidth > wWidth) pLeft = wWidth - pWidth - defaultPadding;\n\n\t\t\tif (arrow) {\n\t\t\t\tif (position === 'top') {\n\t\t\t\t\tarrow.classList.add(CLASS_BOTTOM);\n\t\t\t\t} else {\n\t\t\t\t\tarrow.classList.remove(CLASS_BOTTOM);\n\t\t\t\t}\n\t\t\t\tdiff = diff - pLeft;\n\t\t\t\tarrowLeft = (pWidth / 2 - arrowSize / 2 + diff);\n\t\t\t\tarrowLeft = Math.max(Math.min(arrowLeft, pWidth - arrowSize * 2 - 6), 6);\n\t\t\t\tarrow.setAttribute('style', 'left:' + arrowLeft + 'px');\n\t\t\t}\n\t\t} else if (position === 'middle') {\n\t\t\tarrow.setAttribute('style', 'display:none');\n\t\t}\n\t\tsetStyle(popover, 'block', pTop, pLeft);\n\t};\n\n\t$.createMask = function(callback) {\n\t\tvar element = document.createElement('div');\n\t\telement.classList.add(CLASS_BACKDROP);\n\t\telement.addEventListener($.EVENT_MOVE, $.preventDefault);\n\t\telement.addEventListener('tap', function() {\n\t\t\tmask.close();\n\t\t});\n\t\tvar mask = [element];\n\t\tmask._show = false;\n\t\tmask.show = function() {\n\t\t\tmask._show = true;\n\t\t\telement.setAttribute('style', 'opacity:1');\n\t\t\tdocument.body.appendChild(element);\n\t\t\treturn mask;\n\t\t};\n\t\tmask._remove = function() {\n\t\t\tif (mask._show) {\n\t\t\t\tmask._show = false;\n\t\t\t\telement.setAttribute('style', 'opacity:0');\n\t\t\t\t$.later(function() {\n\t\t\t\t\tvar body = document.body;\n\t\t\t\t\telement.parentNode === body && body.removeChild(element);\n\t\t\t\t}, 350);\n\t\t\t}\n\t\t\treturn mask;\n\t\t};\n\t\tmask.close = function() {\n\t\t\tif (callback) {\n\t\t\t\tif (callback() !== false) {\n\t\t\t\t\tmask._remove();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tmask._remove();\n\t\t\t}\n\t\t};\n\t\treturn mask;\n\t};\n\t$.fn.popover = function() {\n\t\tvar args = arguments;\n\t\tthis.each(function() {\n\t\t\t$.targets._popover = this;\n\t\t\tif (args[0] === 'show' || args[0] === 'hide' || args[0] === 'toggle') {\n\t\t\t\ttogglePopover(this, args[1], args[0]);\n\t\t\t}\n\t\t});\n\t};\n\n})(mui, window, document, 'popover');\n/**\n * segmented-controllers\n * @param {type} $\n * @param {type} window\n * @param {type} document\n * @param {type} undefined\n * @returns {undefined}\n */\n(function($, window, document, name, undefined) {\n\n    var CLASS_CONTROL_ITEM = 'mui-control-item';\n    var CLASS_SEGMENTED_CONTROL = 'mui-segmented-control';\n    var CLASS_SEGMENTED_CONTROL_VERTICAL = 'mui-segmented-control-vertical';\n    var CLASS_CONTROL_CONTENT = 'mui-control-content';\n    var CLASS_TAB_BAR = 'mui-bar-tab';\n    var CLASS_TAB_ITEM = 'mui-tab-item';\n    var CLASS_SLIDER_ITEM = 'mui-slider-item';\n\n   var handle = function(event, target) {\n        if (target.classList && (target.classList.contains(CLASS_CONTROL_ITEM) || target.classList.contains(CLASS_TAB_ITEM))) {\n            if (target.parentNode && target.parentNode.classList && target.parentNode.classList.contains(CLASS_SEGMENTED_CONTROL_VERTICAL)) {\n                //vertical 如果preventDefault会导致无法滚动\n            } else {\n\n                    event.preventDefault();      \n                    // if(target.tagName == 'A') {\n                    //     // fixed 底部选项卡href 无法跳转 && stop hash change\n                    //     var curr_href = location.hostname + location.pathname,\n                    //         target_href = target.hostname + target.pathname;\n                   \n                    //     if (curr_href == target_href && target.hash !== \"\") {\n                    //         event.preventDefault();\n                    //         return target;\n                    //     }else{\n                    //             return false\n                    //     }\n                    // }\n            }\n            //          if (target.hash) {\n            return target;\n            //          }\n        }\n        return false;\n    };\n\n    $.registerTarget({\n        name: name,\n        index: 80,\n        handle: handle,\n        target: false\n    });\n\n    window.addEventListener('tap', function(e) {\n\n        var targetTab = $.targets.tab;\n        if (!targetTab) {\n            return;\n        }\n        var activeTab;\n        var activeBodies;\n        var targetBody;\n        var className = 'mui-active';\n        var classSelector = '.' + className;\n        var segmentedControl = targetTab.parentNode;\n\n        for (; segmentedControl && segmentedControl !== document; segmentedControl = segmentedControl.parentNode) {\n            if (segmentedControl.classList.contains(CLASS_SEGMENTED_CONTROL)) {\n                activeTab = segmentedControl.querySelector(classSelector + '.' + CLASS_CONTROL_ITEM);\n                break;\n            } else if (segmentedControl.classList.contains(CLASS_TAB_BAR)) {\n                activeTab = segmentedControl.querySelector(classSelector + '.' + CLASS_TAB_ITEM);\n            }\n        }\n\n        if (activeTab) {\n            activeTab.classList.remove(className);\n        }\n\n        var isLastActive = targetTab === activeTab;\n        if (targetTab) {\n            targetTab.classList.add(className);\n        }\n\n        if (!targetTab.hash) {\n            return;\n        }\n        targetBody = document.getElementById(targetTab.hash.replace('#', ''));\n\n        if (!targetBody) {\n            return;\n        }\n        if (!targetBody.classList.contains(CLASS_CONTROL_CONTENT)) { //tab bar popover\n            targetTab.classList[isLastActive ? 'remove' : 'add'](className);\n            return;\n        }\n        if (isLastActive) { //same\n            return;\n        }\n        var parentNode = targetBody.parentNode;\n        activeBodies = parentNode.querySelectorAll('.' + CLASS_CONTROL_CONTENT + classSelector);\n        for (var i = 0; i < activeBodies.length; i++) {\n            var activeBody = activeBodies[i];\n            activeBody.parentNode === parentNode && activeBody.classList.remove(className);\n        }\n\n        targetBody.classList.add(className);\n\n        var contents = [];\n        var _contents = parentNode.querySelectorAll('.' + CLASS_CONTROL_CONTENT);\n        for (var i = 0; i < _contents.length; i++) { //查找直属子节点\n            _contents[i].parentNode === parentNode && (contents.push(_contents[i]));\n        }\n        $.trigger(targetBody, $.eventName('shown', name), {\n            tabNumber: Array.prototype.indexOf.call(contents, targetBody)\n        });\n        e.detail && e.detail.gesture.preventDefault(); //fixed hashchange\n    });\n\n})(mui, window, document, 'tab');\n/**\n * Toggles switch\n * @param {type} $\n * @param {type} window\n * @param {type} name\n * @returns {undefined}\n */\n(function($, window, name) {\n\n\tvar CLASS_SWITCH = 'mui-switch';\n\tvar CLASS_SWITCH_HANDLE = 'mui-switch-handle';\n\tvar CLASS_ACTIVE = 'mui-active';\n\tvar CLASS_DRAGGING = 'mui-dragging';\n\n\tvar CLASS_DISABLED = 'mui-disabled';\n\n\tvar SELECTOR_SWITCH_HANDLE = '.' + CLASS_SWITCH_HANDLE;\n\n\tvar handle = function(event, target) {\n\t\tif (target.classList && target.classList.contains(CLASS_SWITCH)) {\n\t\t\treturn target;\n\t\t}\n\t\treturn false;\n\t};\n\n\t$.registerTarget({\n\t\tname: name,\n\t\tindex: 100,\n\t\thandle: handle,\n\t\ttarget: false\n\t});\n\n\n\tvar Toggle = function(element) {\n\t\tthis.element = element;\n\t\tthis.classList = this.element.classList;\n\t\tthis.handle = this.element.querySelector(SELECTOR_SWITCH_HANDLE);\n\t\tthis.init();\n\t\tthis.initEvent();\n\t};\n\tToggle.prototype.init = function() {\n\t\tthis.toggleWidth = this.element.offsetWidth;\n\t\tthis.handleWidth = this.handle.offsetWidth;\n\t\tthis.handleX = this.toggleWidth - this.handleWidth - 3;\n\t};\n\tToggle.prototype.initEvent = function() {\n\t\tthis.element.addEventListener($.EVENT_START, this);\n\t\tthis.element.addEventListener('drag', this);\n\t\tthis.element.addEventListener('swiperight', this);\n\t\tthis.element.addEventListener($.EVENT_END, this);\n\t\tthis.element.addEventListener($.EVENT_CANCEL, this);\n\n\t};\n\tToggle.prototype.handleEvent = function(e) {\n\t\tif (this.classList.contains(CLASS_DISABLED)) {\n\t\t\treturn;\n\t\t}\n\t\tswitch (e.type) {\n\t\t\tcase $.EVENT_START:\n\t\t\t\tthis.start(e);\n\t\t\t\tbreak;\n\t\t\tcase 'drag':\n\t\t\t\tthis.drag(e);\n\t\t\t\tbreak;\n\t\t\tcase 'swiperight':\n\t\t\t\tthis.swiperight();\n\t\t\t\tbreak;\n\t\t\tcase $.EVENT_END:\n\t\t\tcase $.EVENT_CANCEL:\n\t\t\t\tthis.end(e);\n\t\t\t\tbreak;\n\t\t}\n\t};\n\tToggle.prototype.start = function(e) {\n\t\tthis.handle.style.webkitTransitionDuration = this.element.style.webkitTransitionDuration = '.2s';\n\t\tthis.classList.add(CLASS_DRAGGING);\n\t\tif (this.toggleWidth === 0 || this.handleWidth === 0) { //当switch处于隐藏状态时，width为0，需要重新初始化\n\t\t\tthis.init();\n\t\t}\n\t};\n\tToggle.prototype.drag = function(e) {\n\t\tvar detail = e.detail;\n\t\tif (!this.isDragging) {\n\t\t\tif (detail.direction === 'left' || detail.direction === 'right') {\n\t\t\t\tthis.isDragging = true;\n\t\t\t\tthis.lastChanged = undefined;\n\t\t\t\tthis.initialState = this.classList.contains(CLASS_ACTIVE);\n\t\t\t}\n\t\t}\n\t\tif (this.isDragging) {\n\t\t\tthis.setTranslateX(detail.deltaX);\n\t\t\te.stopPropagation();\n\t\t\tdetail.gesture.preventDefault();\n\t\t}\n\t};\n\tToggle.prototype.swiperight = function(e) {\n\t\tif (this.isDragging) {\n\t\t\te.stopPropagation();\n\t\t}\n\t};\n\tToggle.prototype.end = function(e) {\n\t\tthis.classList.remove(CLASS_DRAGGING);\n\t\tif (this.isDragging) {\n\t\t\tthis.isDragging = false;\n\t\t\te.stopPropagation();\n\t\t\t$.trigger(this.element, 'toggle', {\n\t\t\t\tisActive: this.classList.contains(CLASS_ACTIVE)\n\t\t\t});\n\t\t} else {\n\t\t\tthis.toggle();\n\t\t}\n\t};\n\tToggle.prototype.toggle = function(animate) {\n\t\tvar classList = this.classList;\n\t\tif (animate === false) {\n\t\t\tthis.handle.style.webkitTransitionDuration = this.element.style.webkitTransitionDuration = '0s';\n\t\t} else {\n\t\t\tthis.handle.style.webkitTransitionDuration = this.element.style.webkitTransitionDuration = '.2s';\n\t\t}\n\t\tif (classList.contains(CLASS_ACTIVE)) {\n\t\t\tclassList.remove(CLASS_ACTIVE);\n\t\t\tthis.handle.style.webkitTransform = 'translate(0,0)';\n\t\t} else {\n\t\t\tclassList.add(CLASS_ACTIVE);\n\t\t\tthis.handle.style.webkitTransform = 'translate(' + this.handleX + 'px,0)';\n\t\t}\n\t\t$.trigger(this.element, 'toggle', {\n\t\t\tisActive: this.classList.contains(CLASS_ACTIVE)\n\t\t});\n\t};\n\tToggle.prototype.setTranslateX = $.animationFrame(function(x) {\n\t\tif (!this.isDragging) {\n\t\t\treturn;\n\t\t}\n\t\tvar isChanged = false;\n\t\tif ((this.initialState && -x > (this.handleX / 2)) || (!this.initialState && x > (this.handleX / 2))) {\n\t\t\tisChanged = true;\n\t\t}\n\t\tif (this.lastChanged !== isChanged) {\n\t\t\tif (isChanged) {\n\t\t\t\tthis.handle.style.webkitTransform = 'translate(' + (this.initialState ? 0 : this.handleX) + 'px,0)';\n\t\t\t\tthis.classList[this.initialState ? 'remove' : 'add'](CLASS_ACTIVE);\n\t\t\t} else {\n\t\t\t\tthis.handle.style.webkitTransform = 'translate(' + (this.initialState ? this.handleX : 0) + 'px,0)';\n\t\t\t\tthis.classList[this.initialState ? 'add' : 'remove'](CLASS_ACTIVE);\n\t\t\t}\n\t\t\tthis.lastChanged = isChanged;\n\t\t}\n\n\t});\n\n\t$.fn['switch'] = function(options) {\n\t\tvar switchApis = [];\n\t\tthis.each(function() {\n\t\t\tvar switchApi = null;\n\t\t\tvar id = this.getAttribute('data-switch');\n\t\t\tif (!id) {\n\t\t\t\tid = ++$.uuid;\n\t\t\t\t$.data[id] = new Toggle(this);\n\t\t\t\tthis.setAttribute('data-switch', id);\n\t\t\t} else {\n\t\t\t\tswitchApi = $.data[id];\n\t\t\t}\n\t\t\tswitchApis.push(switchApi);\n\t\t});\n\t\treturn switchApis.length > 1 ? switchApis : switchApis[0];\n\t};\n\t$.ready(function() {\n\t\t$('.' + CLASS_SWITCH)['switch']();\n\t});\n})(mui, window, 'toggle');\n/**\n * Tableviews\n * @param {type} $\n * @param {type} window\n * @param {type} document\n * @returns {undefined}\n */\n(function($, window, document) {\n\n\tvar CLASS_ACTIVE = 'mui-active';\n\tvar CLASS_SELECTED = 'mui-selected';\n\tvar CLASS_GRID_VIEW = 'mui-grid-view';\n\tvar CLASS_RADIO_VIEW = 'mui-table-view-radio';\n\tvar CLASS_TABLE_VIEW_CELL = 'mui-table-view-cell';\n\tvar CLASS_COLLAPSE_CONTENT = 'mui-collapse-content';\n\tvar CLASS_DISABLED = 'mui-disabled';\n\tvar CLASS_TOGGLE = 'mui-switch';\n\tvar CLASS_BTN = 'mui-btn';\n\n\tvar CLASS_SLIDER_HANDLE = 'mui-slider-handle';\n\tvar CLASS_SLIDER_LEFT = 'mui-slider-left';\n\tvar CLASS_SLIDER_RIGHT = 'mui-slider-right';\n\tvar CLASS_TRANSITIONING = 'mui-transitioning';\n\n\n\tvar SELECTOR_SLIDER_HANDLE = '.' + CLASS_SLIDER_HANDLE;\n\tvar SELECTOR_SLIDER_LEFT = '.' + CLASS_SLIDER_LEFT;\n\tvar SELECTOR_SLIDER_RIGHT = '.' + CLASS_SLIDER_RIGHT;\n\tvar SELECTOR_SELECTED = '.' + CLASS_SELECTED;\n\tvar SELECTOR_BUTTON = '.' + CLASS_BTN;\n\tvar overFactor = 0.8;\n\tvar cell, a;\n\n\tvar isMoved = isOpened = openedActions = progress = false;\n\tvar sliderHandle = sliderActionLeft = sliderActionRight = buttonsLeft = buttonsRight = sliderDirection = sliderRequestAnimationFrame = false;\n\tvar timer = translateX = lastTranslateX = sliderActionLeftWidth = sliderActionRightWidth = 0;\n\n\n\n\tvar toggleActive = function(isActive) {\n\t\tif (isActive) {\n\t\t\tif (a) {\n\t\t\t\ta.classList.add(CLASS_ACTIVE);\n\t\t\t} else if (cell) {\n\t\t\t\tcell.classList.add(CLASS_ACTIVE);\n\t\t\t}\n\t\t} else {\n\t\t\ttimer && timer.cancel();\n\t\t\tif (a) {\n\t\t\t\ta.classList.remove(CLASS_ACTIVE);\n\t\t\t} else if (cell) {\n\t\t\t\tcell.classList.remove(CLASS_ACTIVE);\n\t\t\t}\n\t\t}\n\t};\n\n\tvar updateTranslate = function() {\n\t\tif (translateX !== lastTranslateX) {\n\t\t\tif (buttonsRight && buttonsRight.length > 0) {\n\t\t\t\tprogress = translateX / sliderActionRightWidth;\n\t\t\t\tif (translateX < -sliderActionRightWidth) {\n\t\t\t\t\ttranslateX = -sliderActionRightWidth - Math.pow(-translateX - sliderActionRightWidth, overFactor);\n\t\t\t\t}\n\t\t\t\tfor (var i = 0, len = buttonsRight.length; i < len; i++) {\n\t\t\t\t\tvar buttonRight = buttonsRight[i];\n\t\t\t\t\tif (typeof buttonRight._buttonOffset === 'undefined') {\n\t\t\t\t\t\tbuttonRight._buttonOffset = buttonRight.offsetLeft;\n\t\t\t\t\t}\n\t\t\t\t\tbuttonOffset = buttonRight._buttonOffset;\n\t\t\t\t\tsetTranslate(buttonRight, (translateX - buttonOffset * (1 + Math.max(progress, -1))));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (buttonsLeft && buttonsLeft.length > 0) {\n\t\t\t\tprogress = translateX / sliderActionLeftWidth;\n\t\t\t\tif (translateX > sliderActionLeftWidth) {\n\t\t\t\t\ttranslateX = sliderActionLeftWidth + Math.pow(translateX - sliderActionLeftWidth, overFactor);\n\t\t\t\t}\n\t\t\t\tfor (var i = 0, len = buttonsLeft.length; i < len; i++) {\n\t\t\t\t\tvar buttonLeft = buttonsLeft[i];\n\t\t\t\t\tif (typeof buttonLeft._buttonOffset === 'undefined') {\n\t\t\t\t\t\tbuttonLeft._buttonOffset = sliderActionLeftWidth - buttonLeft.offsetLeft - buttonLeft.offsetWidth;\n\t\t\t\t\t}\n\t\t\t\t\tbuttonOffset = buttonLeft._buttonOffset;\n\t\t\t\t\tif (buttonsLeft.length > 1) {\n\t\t\t\t\t\tbuttonLeft.style.zIndex = buttonsLeft.length - i;\n\t\t\t\t\t}\n\t\t\t\t\tsetTranslate(buttonLeft, (translateX + buttonOffset * (1 - Math.min(progress, 1))));\n\t\t\t\t}\n\t\t\t}\n\t\t\tsetTranslate(sliderHandle, translateX);\n\t\t\tlastTranslateX = translateX;\n\t\t}\n\t\tsliderRequestAnimationFrame = requestAnimationFrame(function() {\n\t\t\tupdateTranslate();\n\t\t});\n\t};\n\tvar setTranslate = function(element, x) {\n\t\tif (element) {\n\t\t\telement.style.webkitTransform = 'translate(' + x + 'px,0)';\n\t\t}\n\t};\n\n\twindow.addEventListener($.EVENT_START, function(event) {\n\t\tif (cell) {\n\t\t\ttoggleActive(false);\n\t\t}\n\t\tcell = a = false;\n\t\tisMoved = isOpened = openedActions = false;\n\t\tvar target = event.target;\n\t\tvar isDisabled = false;\n\t\tfor (; target && target !== document; target = target.parentNode) {\n\t\t\tif (target.classList) {\n\t\t\t\tvar classList = target.classList;\n\t\t\t\tif ((target.tagName === 'INPUT' && target.type !== 'radio' && target.type !== 'checkbox') || target.tagName === 'BUTTON' || classList.contains(CLASS_TOGGLE) || classList.contains(CLASS_BTN) || classList.contains(CLASS_DISABLED)) {\n\t\t\t\t\tisDisabled = true;\n\t\t\t\t}\n\t\t\t\tif (classList.contains(CLASS_COLLAPSE_CONTENT)) { //collapse content\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (classList.contains(CLASS_TABLE_VIEW_CELL)) {\n\t\t\t\t\tcell = target;\n\t\t\t\t\t//TODO swipe to delete close\n\t\t\t\t\tvar selected = cell.parentNode.querySelector(SELECTOR_SELECTED);\n\t\t\t\t\tif (!cell.parentNode.classList.contains(CLASS_RADIO_VIEW) && selected && selected !== cell) {\n\t\t\t\t\t\t$.swipeoutClose(selected);\n\t\t\t\t\t\tcell = isDisabled = false;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (!cell.parentNode.classList.contains(CLASS_GRID_VIEW)) {\n\t\t\t\t\t\tvar link = cell.querySelector('a');\n\t\t\t\t\t\tif (link && link.parentNode === cell) { //li>a\n\t\t\t\t\t\t\ta = link;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tvar handle = cell.querySelector(SELECTOR_SLIDER_HANDLE);\n\t\t\t\t\tif (handle) {\n\t\t\t\t\t\ttoggleEvents(cell);\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t}\n\t\t\t\t\tif (!isDisabled) {\n\t\t\t\t\t\tif (handle) {\n\t\t\t\t\t\t\tif (timer) {\n\t\t\t\t\t\t\t\ttimer.cancel();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttimer = $.later(function() {\n\t\t\t\t\t\t\t\ttoggleActive(true);\n\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttoggleActive(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\twindow.addEventListener($.EVENT_MOVE, function(event) {\n\t\ttoggleActive(false);\n\t});\n\n\tvar handleEvent = {\n\t\thandleEvent: function(event) {\n\t\t\tswitch (event.type) {\n\t\t\t\tcase 'drag':\n\t\t\t\t\tthis.drag(event);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'dragend':\n\t\t\t\t\tthis.dragend(event);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'flick':\n\t\t\t\t\tthis.flick(event);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'swiperight':\n\t\t\t\t\tthis.swiperight(event);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'swipeleft':\n\t\t\t\t\tthis.swipeleft(event);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\tdrag: function(event) {\n\t\t\tif (!cell) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!isMoved) { //init\n\t\t\t\tsliderHandle = sliderActionLeft = sliderActionRight = buttonsLeft = buttonsRight = sliderDirection = sliderRequestAnimationFrame = false;\n\t\t\t\tsliderHandle = cell.querySelector(SELECTOR_SLIDER_HANDLE);\n\t\t\t\tif (sliderHandle) {\n\t\t\t\t\tsliderActionLeft = cell.querySelector(SELECTOR_SLIDER_LEFT);\n\t\t\t\t\tsliderActionRight = cell.querySelector(SELECTOR_SLIDER_RIGHT);\n\t\t\t\t\tif (sliderActionLeft) {\n\t\t\t\t\t\tsliderActionLeftWidth = sliderActionLeft.offsetWidth;\n\t\t\t\t\t\tbuttonsLeft = sliderActionLeft.querySelectorAll(SELECTOR_BUTTON);\n\t\t\t\t\t}\n\t\t\t\t\tif (sliderActionRight) {\n\t\t\t\t\t\tsliderActionRightWidth = sliderActionRight.offsetWidth;\n\t\t\t\t\t\tbuttonsRight = sliderActionRight.querySelectorAll(SELECTOR_BUTTON);\n\t\t\t\t\t}\n\t\t\t\t\tcell.classList.remove(CLASS_TRANSITIONING);\n\t\t\t\t\tisOpened = cell.classList.contains(CLASS_SELECTED);\n\t\t\t\t\tif (isOpened) {\n\t\t\t\t\t\topenedActions = cell.querySelector(SELECTOR_SLIDER_LEFT + SELECTOR_SELECTED) ? 'left' : 'right';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar detail = event.detail;\n\t\t\tvar direction = detail.direction;\n\t\t\tvar angle = detail.angle;\n\t\t\tif (direction === 'left' && (angle > 150 || angle < -150)) {\n\t\t\t\tif (buttonsRight || (buttonsLeft && isOpened)) { //存在右侧按钮或存在左侧按钮且是已打开状态\n\t\t\t\t\tisMoved = true;\n\t\t\t\t}\n\t\t\t} else if (direction === 'right' && (angle > -30 && angle < 30)) {\n\t\t\t\tif (buttonsLeft || (buttonsRight && isOpened)) { //存在左侧按钮或存在右侧按钮且是已打开状态\n\t\t\t\t\tisMoved = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (isMoved) {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.detail.gesture.preventDefault();\n\t\t\t\tvar translate = event.detail.deltaX;\n\t\t\t\tif (isOpened) {\n\t\t\t\t\tif (openedActions === 'right') {\n\t\t\t\t\t\ttranslate = translate - sliderActionRightWidth;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttranslate = translate + sliderActionLeftWidth;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ((translate > 0 && !buttonsLeft) || (translate < 0 && !buttonsRight)) {\n\t\t\t\t\tif (!isOpened) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\ttranslate = 0;\n\t\t\t\t}\n\t\t\t\tif (translate < 0) {\n\t\t\t\t\tsliderDirection = 'toLeft';\n\t\t\t\t} else if (translate > 0) {\n\t\t\t\t\tsliderDirection = 'toRight';\n\t\t\t\t} else {\n\t\t\t\t\tif (!sliderDirection) {\n\t\t\t\t\t\tsliderDirection = 'toLeft';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!sliderRequestAnimationFrame) {\n\t\t\t\t\tupdateTranslate();\n\t\t\t\t}\n\t\t\t\ttranslateX = translate;\n\t\t\t}\n\t\t},\n\t\tflick: function(event) {\n\t\t\tif (isMoved) {\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t},\n\t\tswipeleft: function(event) {\n\t\t\tif (isMoved) {\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t},\n\t\tswiperight: function(event) {\n\t\t\tif (isMoved) {\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t},\n\t\tdragend: function(event) {\n\t\t\tif (!isMoved) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tevent.stopPropagation();\n\t\t\tif (sliderRequestAnimationFrame) {\n\t\t\t\tcancelAnimationFrame(sliderRequestAnimationFrame);\n\t\t\t\tsliderRequestAnimationFrame = null;\n\t\t\t}\n\t\t\tvar detail = event.detail;\n\t\t\tisMoved = false;\n\t\t\tvar action = 'close';\n\t\t\tvar actionsWidth = sliderDirection === 'toLeft' ? sliderActionRightWidth : sliderActionLeftWidth;\n\t\t\tvar isToggle = detail.swipe || (Math.abs(translateX) > actionsWidth / 2);\n\t\t\tif (isToggle) {\n\t\t\t\tif (!isOpened) {\n\t\t\t\t\taction = 'open';\n\t\t\t\t} else if (detail.direction === 'left' && openedActions === 'right') {\n\t\t\t\t\taction = 'open';\n\t\t\t\t} else if (detail.direction === 'right' && openedActions === 'left') {\n\t\t\t\t\taction = 'open';\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tcell.classList.add(CLASS_TRANSITIONING);\n\t\t\tvar buttons;\n\t\t\tif (action === 'open') {\n\t\t\t\tvar newTranslate = sliderDirection === 'toLeft' ? -actionsWidth : actionsWidth;\n\t\t\t\tsetTranslate(sliderHandle, newTranslate);\n\t\t\t\tbuttons = sliderDirection === 'toLeft' ? buttonsRight : buttonsLeft;\n\t\t\t\tif (typeof buttons !== 'undefined') {\n\t\t\t\t\tvar button = null;\n\t\t\t\t\tfor (var i = 0; i < buttons.length; i++) {\n\t\t\t\t\t\tbutton = buttons[i];\n\t\t\t\t\t\tsetTranslate(button, newTranslate);\n\t\t\t\t\t}\n\t\t\t\t\tbutton.parentNode.classList.add(CLASS_SELECTED);\n\t\t\t\t\tcell.classList.add(CLASS_SELECTED);\n\t\t\t\t\tif (!isOpened) {\n\t\t\t\t\t\t$.trigger(cell, sliderDirection === 'toLeft' ? 'slideleft' : 'slideright');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsetTranslate(sliderHandle, 0);\n\t\t\t\tsliderActionLeft && sliderActionLeft.classList.remove(CLASS_SELECTED);\n\t\t\t\tsliderActionRight && sliderActionRight.classList.remove(CLASS_SELECTED);\n\t\t\t\tcell.classList.remove(CLASS_SELECTED);\n\t\t\t}\n\t\t\tvar buttonOffset;\n\t\t\tif (buttonsLeft && buttonsLeft.length > 0 && buttonsLeft !== buttons) {\n\t\t\t\tfor (var i = 0, len = buttonsLeft.length; i < len; i++) {\n\t\t\t\t\tvar buttonLeft = buttonsLeft[i];\n\t\t\t\t\tbuttonOffset = buttonLeft._buttonOffset;\n\t\t\t\t\tif (typeof buttonOffset === 'undefined') {\n\t\t\t\t\t\tbuttonLeft._buttonOffset = sliderActionLeftWidth - buttonLeft.offsetLeft - buttonLeft.offsetWidth;\n\t\t\t\t\t}\n\t\t\t\t\tsetTranslate(buttonLeft, buttonOffset);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (buttonsRight && buttonsRight.length > 0 && buttonsRight !== buttons) {\n\t\t\t\tfor (var i = 0, len = buttonsRight.length; i < len; i++) {\n\t\t\t\t\tvar buttonRight = buttonsRight[i];\n\t\t\t\t\tbuttonOffset = buttonRight._buttonOffset;\n\t\t\t\t\tif (typeof buttonOffset === 'undefined') {\n\t\t\t\t\t\tbuttonRight._buttonOffset = buttonRight.offsetLeft;\n\t\t\t\t\t}\n\t\t\t\t\tsetTranslate(buttonRight, -buttonOffset);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction toggleEvents(element, isRemove) {\n\t\tvar method = !!isRemove ? 'removeEventListener' : 'addEventListener';\n\t\telement[method]('drag', handleEvent);\n\t\telement[method]('dragend', handleEvent);\n\t\telement[method]('swiperight', handleEvent);\n\t\telement[method]('swipeleft', handleEvent);\n\t\telement[method]('flick', handleEvent);\n\t};\n\t/**\n\t * 打开滑动菜单\n\t * @param {Object} el\n\t * @param {Object} direction\n\t */\n\t$.swipeoutOpen = function(el, direction) {\n\t\tif (!el) return;\n\t\tvar classList = el.classList;\n\t\tif (classList.contains(CLASS_SELECTED)) return;\n\t\tif (!direction) {\n\t\t\tif (el.querySelector(SELECTOR_SLIDER_RIGHT)) {\n\t\t\t\tdirection = 'right';\n\t\t\t} else {\n\t\t\t\tdirection = 'left';\n\t\t\t}\n\t\t}\n\t\tvar swipeoutAction = el.querySelector($.classSelector(\".slider-\" + direction));\n\t\tif (!swipeoutAction) return;\n\t\tswipeoutAction.classList.add(CLASS_SELECTED);\n\t\tclassList.add(CLASS_SELECTED);\n\t\tclassList.remove(CLASS_TRANSITIONING);\n\t\tvar buttons = swipeoutAction.querySelectorAll(SELECTOR_BUTTON);\n\t\tvar swipeoutWidth = swipeoutAction.offsetWidth;\n\t\tvar translate = (direction === 'right') ? -swipeoutWidth : swipeoutWidth;\n\t\tvar length = buttons.length;\n\t\tvar button;\n\t\tfor (var i = 0; i < length; i++) {\n\t\t\tbutton = buttons[i];\n\t\t\tif (direction === 'right') {\n\t\t\t\tsetTranslate(button, -button.offsetLeft);\n\t\t\t} else {\n\t\t\t\tsetTranslate(button, (swipeoutWidth - button.offsetWidth - button.offsetLeft));\n\t\t\t}\n\t\t}\n\t\tclassList.add(CLASS_TRANSITIONING);\n\t\tfor (var i = 0; i < length; i++) {\n\t\t\tsetTranslate(buttons[i], translate);\n\t\t}\n\t\tsetTranslate(el.querySelector(SELECTOR_SLIDER_HANDLE), translate);\n\t};\n\t/**\n\t * 关闭滑动菜单\n\t * @param {Object} el\n\t */\n\t$.swipeoutClose = function(el) {\n\t\tif (!el) return;\n\t\tvar classList = el.classList;\n\t\tif (!classList.contains(CLASS_SELECTED)) return;\n\t\tvar direction = el.querySelector(SELECTOR_SLIDER_RIGHT + SELECTOR_SELECTED) ? 'right' : 'left';\n\t\tvar swipeoutAction = el.querySelector($.classSelector(\".slider-\" + direction));\n\t\tif (!swipeoutAction) return;\n\t\tswipeoutAction.classList.remove(CLASS_SELECTED);\n\t\tclassList.remove(CLASS_SELECTED);\n\t\tclassList.add(CLASS_TRANSITIONING);\n\t\tvar buttons = swipeoutAction.querySelectorAll(SELECTOR_BUTTON);\n\t\tvar swipeoutWidth = swipeoutAction.offsetWidth;\n\t\tvar length = buttons.length;\n\t\tvar button;\n\t\tsetTranslate(el.querySelector(SELECTOR_SLIDER_HANDLE), 0);\n\t\tfor (var i = 0; i < length; i++) {\n\t\t\tbutton = buttons[i];\n\t\t\tif (direction === 'right') {\n\t\t\t\tsetTranslate(button, (-button.offsetLeft));\n\t\t\t} else {\n\t\t\t\tsetTranslate(button, (swipeoutWidth - button.offsetWidth - button.offsetLeft));\n\t\t\t}\n\t\t}\n\t};\n\n\twindow.addEventListener($.EVENT_END, function(event) { //使用touchend来取消高亮，避免一次点击既不触发tap，doubletap，longtap的事件\n\t\tif (!cell) {\n\t\t\treturn;\n\t\t}\n\t\ttoggleActive(false);\n\t\tsliderHandle && toggleEvents(cell, true);\n\t});\n\twindow.addEventListener($.EVENT_CANCEL, function(event) { //使用touchcancel来取消高亮，避免一次点击既不触发tap，doubletap，longtap的事件\n\t\tif (!cell) {\n\t\t\treturn;\n\t\t}\n\t\ttoggleActive(false);\n\t\tsliderHandle && toggleEvents(cell, true);\n\t});\n\tvar radioOrCheckboxClick = function(event) {\n\t\tvar type = event.target && event.target.type || '';\n\t\tif (type === 'radio' || type === 'checkbox') {\n\t\t\treturn;\n\t\t}\n\t\tvar classList = cell.classList;\n\t\tif (classList.contains('mui-radio')) {\n\t\t\tvar input = cell.querySelector('input[type=radio]');\n\t\t\tif (input) {\n\t\t\t\t//\t\t\t\tinput.click();\n\t\t\t\tif (!input.disabled && !input.readOnly) {\n\t\t\t\t\tinput.checked = !input.checked;\n\t\t\t\t\t$.trigger(input, 'change');\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (classList.contains('mui-checkbox')) {\n\t\t\tvar input = cell.querySelector('input[type=checkbox]');\n\t\t\tif (input) {\n\t\t\t\t//\t\t\t\tinput.click();\n\t\t\t\tif (!input.disabled && !input.readOnly) {\n\t\t\t\t\tinput.checked = !input.checked;\n\t\t\t\t\t$.trigger(input, 'change');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\t//fixed hashchange(android)\n\twindow.addEventListener($.EVENT_CLICK, function(e) {\n\t\tif (cell && cell.classList.contains('mui-collapse')) {\n\t\t\te.preventDefault();\n\t\t}\n\t});\n\twindow.addEventListener('doubletap', function(event) {\n\t\tif (cell) {\n\t\t\tradioOrCheckboxClick(event);\n\t\t}\n\t});\n\tvar preventDefaultException = /^(INPUT|TEXTAREA|BUTTON|SELECT)$/;\n\twindow.addEventListener('tap', function(event) {\n\t\tif (!cell) {\n\t\t\treturn;\n\t\t}\n\t\tvar isExpand = false;\n\t\tvar classList = cell.classList;\n\t\tvar ul = cell.parentNode;\n\t\tif (ul && ul.classList.contains(CLASS_RADIO_VIEW)) {\n\t\t\tif (classList.contains(CLASS_SELECTED)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar selected = ul.querySelector('li' + SELECTOR_SELECTED);\n\t\t\tif (selected) {\n\t\t\t\tselected.classList.remove(CLASS_SELECTED);\n\t\t\t}\n\t\t\tclassList.add(CLASS_SELECTED);\n\t\t\t$.trigger(cell, 'selected', {\n\t\t\t\tel: cell\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tif (classList.contains('mui-collapse') && !cell.parentNode.classList.contains('mui-unfold')) {\n\t\t\tif (!preventDefaultException.test(event.target.tagName)) {\n\t\t\t\tevent.detail.gesture.preventDefault();\n\t\t\t}\n\n\t\t\tif (!classList.contains(CLASS_ACTIVE)) { //展开时,需要收缩其他同类\n\t\t\t\tvar collapse = cell.parentNode.querySelector('.mui-collapse.mui-active');\n\t\t\t\tif (collapse) {\n\t\t\t\t\tcollapse.classList.remove(CLASS_ACTIVE);\n\t\t\t\t}\n\t\t\t\tisExpand = true;\n\t\t\t}\n\t\t\tclassList.toggle(CLASS_ACTIVE);\n\t\t\tif (isExpand) {\n\t\t\t\t//触发展开事件\n\t\t\t\t$.trigger(cell, 'expand');\n\n\t\t\t\t//scroll\n\t\t\t\t//暂不滚动\n\t\t\t\t// var offsetTop = $.offset(cell).top;\n\t\t\t\t// var scrollTop = document.body.scrollTop;\n\t\t\t\t// var height = window.innerHeight;\n\t\t\t\t// var offsetHeight = cell.offsetHeight;\n\t\t\t\t// var cellHeight = (offsetTop - scrollTop + offsetHeight);\n\t\t\t\t// if (offsetHeight > height) {\n\t\t\t\t// \t$.scrollTo(offsetTop, 300);\n\t\t\t\t// } else if (cellHeight > height) {\n\t\t\t\t// \t$.scrollTo(cellHeight - height + scrollTop, 300);\n\t\t\t\t// }\n\t\t\t}\n\t\t} else {\n\t\t\tradioOrCheckboxClick(event);\n\t\t}\n\t});\n})(mui, window, document);\n(function($, window) {\n\t/**\n\t * 警告消息框\n\t */\n\t$.alert = function(message, title, btnValue, callback) {\n\t\tif ($.os.plus) {\n\t\t\tif (typeof message === 'undefined') {\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tif (typeof title === 'function') {\n\t\t\t\t\tcallback = title;\n\t\t\t\t\ttitle = null;\n\t\t\t\t\tbtnValue = '确定';\n\t\t\t\t} else if (typeof btnValue === 'function') {\n\t\t\t\t\tcallback = btnValue;\n\t\t\t\t\tbtnValue = null;\n\t\t\t\t}\n\t\t\t\t$.plusReady(function() {\n\t\t\t\t\tplus.nativeUI.alert(message, callback, title, btnValue);\n\t\t\t\t});\n\t\t\t}\n\n\t\t} else {\n\t\t\t//TODO H5版本\n\t\t\twindow.alert(message);\n\t\t}\n\t};\n\n})(mui, window);\n(function($, window) {\n\t/**\n\t * 确认消息框\n\t */\n\t$.confirm = function(message, title, btnArray, callback) {\n\t\tif ($.os.plus) {\n\t\t\tif (typeof message === 'undefined') {\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tif (typeof title === 'function') {\n\t\t\t\t\tcallback = title;\n\t\t\t\t\ttitle = null;\n\t\t\t\t\tbtnArray = null;\n\t\t\t\t} else if (typeof btnArray === 'function') {\n\t\t\t\t\tcallback = btnArray;\n\t\t\t\t\tbtnArray = null;\n\t\t\t\t}\n\t\t\t\t$.plusReady(function() {\n\t\t\t\t\tplus.nativeUI.confirm(message, callback, title, btnArray);\n\t\t\t\t});\n\t\t\t}\n\n\t\t} else {\n\t\t\t//H5版本，0为确认，1为取消\n\t\t\tif (window.confirm(message)) {\n\t\t\t\tcallback({\n\t\t\t\t\tindex: 0\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tcallback({\n\t\t\t\t\tindex: 1\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n})(mui, window);\n(function($, window) {\n\t/**\n\t * 输入对话框\n\t */\n\t$.prompt = function(text, defaultText, title, btnArray, callback) {\n\t\tif ($.os.plus) {\n\t\t\tif (typeof message === 'undefined') {\n\t\t\t\treturn;\n\t\t\t} else {\n\n\t\t\t\tif (typeof defaultText === 'function') {\n\t\t\t\t\tcallback = defaultText;\n\t\t\t\t\tdefaultText = null;\n\t\t\t\t\ttitle = null;\n\t\t\t\t\tbtnArray = null;\n\t\t\t\t} else if (typeof title === 'function') {\n\t\t\t\t\tcallback = title;\n\t\t\t\t\ttitle = null;\n\t\t\t\t\tbtnArray = null;\n\t\t\t\t} else if (typeof btnArray === 'function') {\n\t\t\t\t\tcallback = btnArray;\n\t\t\t\t\tbtnArray = null;\n\t\t\t\t}\n\t\t\t\t$.plusReady(function() {\n\t\t\t\t\tplus.nativeUI.prompt(text, callback, title, defaultText, btnArray);\n\t\t\t\t});\n\t\t\t}\n\n\t\t} else {\n\t\t\t//H5版本(确认index为0，取消index为1)\n\t\t\tvar result = window.prompt(text);\n\t\t\tif (result) {\n\t\t\t\tcallback({\n\t\t\t\t\tindex: 0,\n\t\t\t\t\tvalue: result\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tcallback({\n\t\t\t\t\tindex: 1,\n\t\t\t\t\tvalue: ''\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n})(mui, window);\n(function($, window) {\n\tvar CLASS_ACTIVE = 'mui-active';\n\t/**\n\t * 自动消失提示框\n\t */\n\t$.toast = function(message,options) {\n\t\tvar durations = {\n\t\t    'long': 3500,\n\t\t    'short': 2000\n\t\t};\n\n\t\t//计算显示时间\n\t\t options = $.extend({\n\t        duration: 'short'\n\t    }, options || {});\n\n\n\t\tif ($.os.plus && options.type !== 'div') {\n\t\t\t//默认显示在底部；\n\t\t\t$.plusReady(function() {\n\t\t\t\tplus.nativeUI.toast(message, {\n\t\t\t\t\tverticalAlign: 'bottom',\n\t\t\t\t\tduration:options.duration\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\tif (typeof options.duration === 'number') {\n\t\t        duration = options.duration>0 ? options.duration:durations['short'];\n\t\t    } else {\n\t\t        duration = durations[options.duration];\n\t\t    }\n\t\t    if (!duration) {\n\t\t        duration = durations['short'];\n\t\t    }\n\t\t\tvar toast = document.createElement('div');\n\t\t\ttoast.classList.add('mui-toast-container');\n\t\t\ttoast.innerHTML = '<div class=\"' + 'mui-toast-message' + '\">' + message + '</div>';\n\t\t\ttoast.addEventListener('webkitTransitionEnd', function() {\n\t\t\t\tif (!toast.classList.contains(CLASS_ACTIVE)) {\n\t\t\t\t\ttoast.parentNode.removeChild(toast);\n\t\t\t\t\ttoast = null;\n\t\t\t\t}\n\t\t\t});\n\t\t\t//点击则自动消失\n\t\t\ttoast.addEventListener('click', function() {\n\t\t        toast.parentNode.removeChild(toast);\n\t\t        toast = null;\n\t\t    });\n\t\t\tdocument.body.appendChild(toast);\n\t\t\ttoast.offsetHeight;\n\t\t\ttoast.classList.add(CLASS_ACTIVE);\n\t\t\tsetTimeout(function() {\n\t\t\t\ttoast && toast.classList.remove(CLASS_ACTIVE);\n\t\t\t}, duration);\n\t\t\t\n\t\t\treturn {\n\t\t        isVisible: function() {return !!toast;}\n\t\t    }\n\t\t}   \n\t};\n\n})(mui, window);\n/**\n * Popup(alert,confirm,prompt)  \n * @param {Object} $\n * @param {Object} window\n * @param {Object} document\n */\n(function($, window, document) {\n    var CLASS_POPUP = 'mui-popup';\n    var CLASS_POPUP_BACKDROP = 'mui-popup-backdrop';\n    var CLASS_POPUP_IN = 'mui-popup-in';\n    var CLASS_POPUP_OUT = 'mui-popup-out';\n    var CLASS_POPUP_INNER = 'mui-popup-inner';\n    var CLASS_POPUP_TITLE = 'mui-popup-title';\n    var CLASS_POPUP_TEXT = 'mui-popup-text';\n    var CLASS_POPUP_INPUT = 'mui-popup-input';\n    var CLASS_POPUP_BUTTONS = 'mui-popup-buttons';\n    var CLASS_POPUP_BUTTON = 'mui-popup-button';\n    var CLASS_POPUP_BUTTON_BOLD = 'mui-popup-button-bold';\n    var CLASS_POPUP_BACKDROP = 'mui-popup-backdrop';\n    var CLASS_ACTIVE = 'mui-active';\n\n    var popupStack = [];\n    var backdrop = (function() {\n        var element = document.createElement('div');\n        element.classList.add(CLASS_POPUP_BACKDROP);\n        element.addEventListener($.EVENT_MOVE, $.preventDefault);\n        element.addEventListener('webkitTransitionEnd', function() {\n            if (!this.classList.contains(CLASS_ACTIVE)) {\n                element.parentNode && element.parentNode.removeChild(element);\n            }\n        });\n        return element;\n    }());\n\n    var createInput = function(placeholder) {\n        return '<div class=\"' + CLASS_POPUP_INPUT + '\"><input type=\"text\" autofocus placeholder=\"' + (placeholder || '') + '\"/></div>';\n    };\n    var createInner = function(message, title, extra) {\n        return '<div class=\"' + CLASS_POPUP_INNER + '\"><div class=\"' + CLASS_POPUP_TITLE + '\">' + title + '</div><div class=\"' + CLASS_POPUP_TEXT + '\">' + message.replace(/\\r\\n/g, \"<br/>\").replace(/\\n/g, \"<br/>\") + '</div>' + (extra || '') + '</div>';\n    };\n    var createButtons = function(btnArray) {\n        var length = btnArray.length;\n        var btns = [];\n        for (var i = 0; i < length; i++) {\n            btns.push('<span class=\"' + CLASS_POPUP_BUTTON + (i === length - 1 ? (' ' + CLASS_POPUP_BUTTON_BOLD) : '') + '\">' + btnArray[i] + '</span>');\n        }\n        return '<div class=\"' + CLASS_POPUP_BUTTONS + '\">' + btns.join('') + '</div>';\n    };\n\n    var createPopup = function(html, callback) {\n        var popupElement = document.createElement('div');\n        popupElement.className = CLASS_POPUP;\n        popupElement.innerHTML = html;\n        var removePopupElement = function() {\n            popupElement.parentNode && popupElement.parentNode.removeChild(popupElement);\n            popupElement = null;\n        };\n        popupElement.addEventListener($.EVENT_MOVE, $.preventDefault);\n        popupElement.addEventListener('webkitTransitionEnd', function(e) {\n            if (popupElement && e.target === popupElement && popupElement.classList.contains(CLASS_POPUP_OUT)) {\n                removePopupElement();\n            }\n        });\n        popupElement.style.display = 'block';\n        document.body.appendChild(popupElement);\n        popupElement.offsetHeight;\n        popupElement.classList.add(CLASS_POPUP_IN);\n\n        if (!backdrop.classList.contains(CLASS_ACTIVE)) {\n            backdrop.style.display = 'block';\n            document.body.appendChild(backdrop);\n            backdrop.offsetHeight;\n            backdrop.classList.add(CLASS_ACTIVE);\n        }\n        var btns = $.qsa('.' + CLASS_POPUP_BUTTON, popupElement);\n        var input = popupElement.querySelector('.' + CLASS_POPUP_INPUT + ' input');\n        var popup = {\n            element: popupElement,\n            close: function(index, animate) {\n                if (popupElement) {\n                    var result = callback && callback({\n                        index: index || 0,\n                        value: input && input.value || ''\n                    });\n                    if (result === false) { //返回false则不关闭当前popup\n                        return;\n                    }\n                    if (animate !== false) {\n                        popupElement.classList.remove(CLASS_POPUP_IN);\n                        popupElement.classList.add(CLASS_POPUP_OUT);\n                    } else {\n                        removePopupElement();\n                    }\n                    popupStack.pop();\n                    //如果还有其他popup，则不remove backdrop\n                    if (popupStack.length) {\n                        popupStack[popupStack.length - 1]['show'](animate);\n                    } else {\n                        backdrop.classList.remove(CLASS_ACTIVE);\n                    }\n                }\n            }\n        };\n        var handleEvent = function(e) {\n            popup.close(btns.indexOf(e.target));\n        };\n        $(popupElement).on('tap', '.' + CLASS_POPUP_BUTTON, handleEvent);\n        if (popupStack.length) {\n            popupStack[popupStack.length - 1]['hide']();\n        }\n        popupStack.push({\n            close: popup.close,\n            show: function(animate) {\n                popupElement.style.display = 'block';\n                popupElement.offsetHeight;\n                popupElement.classList.add(CLASS_POPUP_IN);\n            },\n            hide: function() {\n                popupElement.style.display = 'none';\n                popupElement.classList.remove(CLASS_POPUP_IN);\n            }\n        });\n        return popup;\n    };\n    var createAlert = function(message, title, btnValue, callback, type) {\n        if (typeof message === 'undefined') {\n            return;\n        } else {\n            if (typeof title === 'function') {\n                callback = title;\n                type = btnValue;\n                title = null;\n                btnValue = null;\n            } else if (typeof btnValue === 'function') {\n                type = callback;\n                callback = btnValue;\n                btnValue = null;\n            }\n        }\n        if (!$.os.plus || type === 'div') {\n            return createPopup(createInner(message, title || '提示') + createButtons([btnValue || '确定']), callback);\n        }\n        return plus.nativeUI.alert(message, callback, title || '提示', btnValue || '确定');\n    };\n    var createConfirm = function(message, title, btnArray, callback, type) {\n        if (typeof message === 'undefined') {\n            return;\n        } else {\n            if (typeof title === 'function') {\n                callback = title;\n                type = btnArray;\n                title = null;\n                btnArray = null;\n            } else if (typeof btnArray === 'function') {\n                type = callback;\n                callback = btnArray;\n                btnArray = null;\n            }\n        }\n        if (!$.os.plus || type === 'div') {\n            return createPopup(createInner(message, title || '提示') + createButtons(btnArray || ['取消', '确认']), callback);\n        }\n        return plus.nativeUI.confirm(message, callback, title, btnArray || ['取消', '确认']);\n    };\n    var createPrompt = function(message, placeholder, title, btnArray, callback, type) {\n        if (typeof message === 'undefined') {\n            return;\n        } else {\n            if (typeof placeholder === 'function') {\n                callback = placeholder;\n                type = title;\n                placeholder = null;\n                title = null;\n                btnArray = null;\n            } else if (typeof title === 'function') {\n                callback = title;\n                type = btnArray;\n                title = null;\n                btnArray = null;\n            } else if (typeof btnArray === 'function') {\n                type = callback;\n                callback = btnArray;\n                btnArray = null;\n            }\n        }\n        if (!$.os.plus || type === 'div') {\n            return createPopup(createInner(message, title || '提示', createInput(placeholder)) + createButtons(btnArray || ['取消', '确认']), callback);\n        }\n        return plus.nativeUI.prompt(message, callback, title || '提示', placeholder, btnArray || ['取消', '确认']);\n    };\n    var closePopup = function() {\n        if (popupStack.length) {\n            popupStack[popupStack.length - 1]['close']();\n            return true;\n        } else {\n            return false;\n        }\n    };\n    var closePopups = function() {\n        while (popupStack.length) {\n            popupStack[popupStack.length - 1]['close']();\n        }\n    };\n\n    $.closePopup = closePopup;\n    $.closePopups = closePopups;\n    $.alert = createAlert;\n    $.confirm = createConfirm;\n    $.prompt = createPrompt;\n})(mui, window, document);\n(function($, document) {\n\tvar CLASS_PROGRESSBAR = 'mui-progressbar';\n\tvar CLASS_PROGRESSBAR_IN = 'mui-progressbar-in';\n\tvar CLASS_PROGRESSBAR_OUT = 'mui-progressbar-out';\n\tvar CLASS_PROGRESSBAR_INFINITE = 'mui-progressbar-infinite';\n\n\tvar SELECTOR_PROGRESSBAR = '.mui-progressbar';\n\n\tvar _findProgressbar = function(container) {\n\t\tcontainer = $(container || 'body');\n\t\tif (container.length === 0) return;\n\t\tcontainer = container[0];\n\t\tif (container.classList.contains(CLASS_PROGRESSBAR)) {\n\t\t\treturn container;\n\t\t}\n\t\tvar progressbars = container.querySelectorAll(SELECTOR_PROGRESSBAR);\n\t\tif (progressbars) {\n\t\t\tfor (var i = 0, len = progressbars.length; i < len; i++) {\n\t\t\t\tvar progressbar = progressbars[i];\n\t\t\t\tif (progressbar.parentNode === container) {\n\t\t\t\t\treturn progressbar;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\t/**\n\t * 创建并显示进度条 \n\t * @param {Object} container  可选，默认body，支持selector,DOM Node,mui wrapper\n\t * @param {Object} progress 可选，undefined表示循环，数字表示具体进度\n\t * @param {Object} color 可选，指定颜色样式(目前暂未提供实际样式，可暂时不暴露此参数)\n\t */\n\tvar showProgressbar = function(container, progress, color) {\n\t\tif (typeof container === 'number') {\n\t\t\tcolor = progress;\n\t\t\tprogress = container;\n\t\t\tcontainer = 'body';\n\t\t}\n\t\tcontainer = $(container || 'body');\n\t\tif (container.length === 0) return;\n\t\tcontainer = container[0];\n\t\tvar progressbar;\n\t\tif (container.classList.contains(CLASS_PROGRESSBAR)) {\n\t\t\tprogressbar = container;\n\t\t} else {\n\t\t\tvar progressbars = container.querySelectorAll(SELECTOR_PROGRESSBAR + ':not(.' + CLASS_PROGRESSBAR_OUT + ')');\n\t\t\tif (progressbars) {\n\t\t\t\tfor (var i = 0, len = progressbars.length; i < len; i++) {\n\t\t\t\t\tvar _progressbar = progressbars[i];\n\t\t\t\t\tif (_progressbar.parentNode === container) {\n\t\t\t\t\t\tprogressbar = _progressbar;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!progressbar) {\n\t\t\t\tprogressbar = document.createElement('span');\n\t\t\t\tprogressbar.className = CLASS_PROGRESSBAR + ' ' + CLASS_PROGRESSBAR_IN + (typeof progress !== 'undefined' ? '' : (' ' + CLASS_PROGRESSBAR_INFINITE)) + (color ? (' ' + CLASS_PROGRESSBAR + '-' + color) : '');\n\t\t\t\tif (typeof progress !== 'undefined') {\n\t\t\t\t\tprogressbar.innerHTML = '<span></span>';\n\t\t\t\t}\n\t\t\t\tcontainer.appendChild(progressbar);\n\t\t\t} else {\n\t\t\t\tprogressbar.classList.add(CLASS_PROGRESSBAR_IN);\n\t\t\t}\n\t\t}\n\t\tif (progress) setProgressbar(container, progress);\n\t\treturn progressbar;\n\t};\n\t/**\n\t * 关闭进度条 \n\t * @param {Object} container 可选，默认body，支持selector,DOM Node,mui wrapper\n\t */\n\tvar hideProgressbar = function(container) {\n\t\tvar progressbar = _findProgressbar(container);\n\t\tif (!progressbar) {\n\t\t\treturn;\n\t\t}\n\t\tvar classList = progressbar.classList;\n\t\tif (!classList.contains(CLASS_PROGRESSBAR_IN) || classList.contains(CLASS_PROGRESSBAR_OUT)) {\n\t\t\treturn;\n\t\t}\n\t\tclassList.remove(CLASS_PROGRESSBAR_IN);\n\t\tclassList.add(CLASS_PROGRESSBAR_OUT);\n\t\tprogressbar.addEventListener('webkitAnimationEnd', function() {\n\t\t\tprogressbar.parentNode && progressbar.parentNode.removeChild(progressbar);\n\t\t\tprogressbar = null;\n\t\t});\n\t\treturn;\n\t};\n\t/**\n\t * 设置指定进度条进度 \n\t * @param {Object} container  可选，默认body，支持selector,DOM Node,mui wrapper\n\t * @param {Object} progress 可选，默认0 取值范围[0-100]\n\t * @param {Object} speed 进度条动画时间\n\t */\n\tvar setProgressbar = function(container, progress, speed) {\n\t\tif (typeof container === 'number') {\n\t\t\tspeed = progress;\n\t\t\tprogress = container;\n\t\t\tcontainer = false;\n\t\t}\n\t\tvar progressbar = _findProgressbar(container);\n\t\tif (!progressbar || progressbar.classList.contains(CLASS_PROGRESSBAR_INFINITE)) {\n\t\t\treturn;\n\t\t}\n\t\tif (progress) progress = Math.min(Math.max(progress, 0), 100);\n\t\tprogressbar.offsetHeight;\n\t\tvar span = progressbar.querySelector('span');\n\t\tif (span) {\n\t\t\tvar style = span.style;\n\t\t\tstyle.webkitTransform = 'translate3d(' + (-100 + progress) + '%,0,0)';\n\t\t\tif (typeof speed !== 'undefined') {\n\t\t\t\tstyle.webkitTransitionDuration = speed + 'ms';\n\t\t\t} else {\n\t\t\t\tstyle.webkitTransitionDuration = '';\n\t\t\t}\n\t\t}\n\t\treturn progressbar;\n\t};\n\t$.fn.progressbar = function(options) {\n\t\tvar progressbarApis = [];\n\t\toptions = options || {};\n\t\tthis.each(function() {\n\t\t\tvar self = this;\n\t\t\tvar progressbarApi = self.mui_plugin_progressbar;\n\t\t\tif (!progressbarApi) {\n\t\t\t\tself.mui_plugin_progressbar = progressbarApi = {\n\t\t\t\t\toptions: options,\n\t\t\t\t\tsetOptions: function(options) {\n\t\t\t\t\t\tthis.options = options;\n\t\t\t\t\t},\n\t\t\t\t\tshow: function() {\n\t\t\t\t\t\treturn showProgressbar(self, this.options.progress, this.options.color);\n\t\t\t\t\t},\n\t\t\t\t\tsetProgress: function(progress) {\n\t\t\t\t\t\treturn setProgressbar(self, progress);\n\t\t\t\t\t},\n\t\t\t\t\thide: function() {\n\t\t\t\t\t\treturn hideProgressbar(self);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t} else if (options) {\n\t\t\t\tprogressbarApi.setOptions(options);\n\t\t\t}\n\t\t\tprogressbarApis.push(progressbarApi);\n\t\t});\n\t\treturn progressbarApis.length === 1 ? progressbarApis[0] : progressbarApis;\n\t};\n\t//\t$.setProgressbar = setProgressbar;\n\t//\t$.showProgressbar = showProgressbar;\n\t//\t$.hideProgressbar = hideProgressbar;\n})(mui, document);\n/**\n * Input(TODO resize)\n * @param {type} $\n * @param {type} window\n * @param {type} document\n * @returns {undefined}\n */\n(function($, window, document) {\n\tvar CLASS_ICON = 'mui-icon';\n\tvar CLASS_ICON_CLEAR = 'mui-icon-clear';\n\tvar CLASS_ICON_SPEECH = 'mui-icon-speech';\n\tvar CLASS_ICON_SEARCH = 'mui-icon-search';\n\tvar CLASS_ICON_PASSWORD = 'mui-icon-eye';\n\tvar CLASS_INPUT_ROW = 'mui-input-row';\n\tvar CLASS_PLACEHOLDER = 'mui-placeholder';\n\tvar CLASS_TOOLTIP = 'mui-tooltip';\n\tvar CLASS_HIDDEN = 'mui-hidden';\n\tvar CLASS_FOCUSIN = 'mui-focusin';\n\tvar SELECTOR_ICON_CLOSE = '.' + CLASS_ICON_CLEAR;\n\tvar SELECTOR_ICON_SPEECH = '.' + CLASS_ICON_SPEECH;\n\tvar SELECTOR_ICON_PASSWORD = '.' + CLASS_ICON_PASSWORD;\n\tvar SELECTOR_PLACEHOLDER = '.' + CLASS_PLACEHOLDER;\n\tvar SELECTOR_TOOLTIP = '.' + CLASS_TOOLTIP;\n\n\tvar findRow = function(target) {\n\t\tfor (; target && target !== document; target = target.parentNode) {\n\t\t\tif (target.classList && target.classList.contains(CLASS_INPUT_ROW)) {\n\t\t\t\treturn target;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t};\n\tvar Input = function(element, options) {\n\t\tthis.element = element;\n\t\tthis.options = options || {\n\t\t\tactions: 'clear'\n\t\t};\n\t\tif (~this.options.actions.indexOf('slider')) { //slider\n\t\t\tthis.sliderActionClass = CLASS_TOOLTIP + ' ' + CLASS_HIDDEN;\n\t\t\tthis.sliderActionSelector = SELECTOR_TOOLTIP;\n\t\t} else { //clear,speech,search\n\t\t\tif (~this.options.actions.indexOf('clear')) {\n\t\t\t\tthis.clearActionClass = CLASS_ICON + ' ' + CLASS_ICON_CLEAR + ' ' + CLASS_HIDDEN;\n\t\t\t\tthis.clearActionSelector = SELECTOR_ICON_CLOSE;\n\t\t\t}\n\t\t\tif (~this.options.actions.indexOf('speech')) { //only for 5+\n\t\t\t\tthis.speechActionClass = CLASS_ICON + ' ' + CLASS_ICON_SPEECH;\n\t\t\t\tthis.speechActionSelector = SELECTOR_ICON_SPEECH;\n\t\t\t}\n\t\t\tif (~this.options.actions.indexOf('search')) {\n\t\t\t\tthis.searchActionClass = CLASS_PLACEHOLDER;\n\t\t\t\tthis.searchActionSelector = SELECTOR_PLACEHOLDER;\n\t\t\t}\n\t\t\tif (~this.options.actions.indexOf('password')) {\n\t\t\t\tthis.passwordActionClass = CLASS_ICON + ' ' + CLASS_ICON_PASSWORD;\n\t\t\t\tthis.passwordActionSelector = SELECTOR_ICON_PASSWORD;\n\t\t\t}\n\t\t}\n\t\tthis.init();\n\t};\n\tInput.prototype.init = function() {\n\t\tthis.initAction();\n\t\tthis.initElementEvent();\n\t};\n\tInput.prototype.initAction = function() {\n\t\tvar self = this;\n\n\t\tvar row = self.element.parentNode;\n\t\tif (row) {\n\t\t\tif (self.sliderActionClass) {\n\t\t\t\tself.sliderAction = self.createAction(row, self.sliderActionClass, self.sliderActionSelector);\n\t\t\t} else {\n\t\t\t\tif (self.searchActionClass) {\n\t\t\t\t\tself.searchAction = self.createAction(row, self.searchActionClass, self.searchActionSelector);\n\t\t\t\t\tself.searchAction.addEventListener('tap', function(e) {\n\t\t\t\t\t\t$.focus(self.element);\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (self.speechActionClass) {\n\t\t\t\t\tself.speechAction = self.createAction(row, self.speechActionClass, self.speechActionSelector);\n\t\t\t\t\tself.speechAction.addEventListener('click', $.stopPropagation);\n\t\t\t\t\tself.speechAction.addEventListener('tap', function(event) {\n\t\t\t\t\t\tself.speechActionClick(event);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (self.clearActionClass) {\n\t\t\t\t\tself.clearAction = self.createAction(row, self.clearActionClass, self.clearActionSelector);\n\t\t\t\t\tself.clearAction.addEventListener('tap', function(event) {\n\t\t\t\t\t\tself.clearActionClick(event);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (self.passwordActionClass) {\n\t\t\t\t\tself.passwordAction = self.createAction(row, self.passwordActionClass, self.passwordActionSelector);\n\t\t\t\t\tself.passwordAction.addEventListener('tap', function(event) {\n\t\t\t\t\t\tself.passwordActionClick(event);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\tInput.prototype.createAction = function(row, actionClass, actionSelector) {\n\t\tvar action = row.querySelector(actionSelector);\n\t\tif (!action) {\n\t\t\tvar action = document.createElement('span');\n\t\t\taction.className = actionClass;\n\t\t\tif (actionClass === this.searchActionClass) {\n\t\t\t\taction.innerHTML = '<span class=\"' + CLASS_ICON + ' ' + CLASS_ICON_SEARCH + '\"></span><span>' + this.element.getAttribute('placeholder') + '</span>';\n\t\t\t\tthis.element.setAttribute('placeholder', '');\n\t\t\t\tif (this.element.value.trim()) {\n\t\t\t\t\trow.classList.add('mui-active');\n\t\t\t\t}\n\t\t\t}\n\t\t\trow.insertBefore(action, this.element.nextSibling);\n\t\t}\n\t\treturn action;\n\t};\n\tInput.prototype.initElementEvent = function() {\n\t\tvar element = this.element;\n\n\t\tif (this.sliderActionClass) {\n\t\t\tvar tooltip = this.sliderAction;\n\t\t\tvar timer = null;\n\t\t\tvar showTip = function() { //每次重新计算是因为控件可能被隐藏，初始化时计算是不正确的\n\t\t\t\ttooltip.classList.remove(CLASS_HIDDEN);\n\t\t\t\tvar offsetLeft = element.offsetLeft;\n\t\t\t\tvar width = element.offsetWidth - 28;\n\t\t\t\tvar tooltipWidth = tooltip.offsetWidth;\n\t\t\t\tvar distince = Math.abs(element.max - element.min);\n\t\t\t\tvar scaleWidth = (width / distince) * Math.abs(element.value - element.min);\n\t\t\t\ttooltip.style.left = (14 + offsetLeft + scaleWidth - tooltipWidth / 2) + 'px';\n\t\t\t\ttooltip.innerText = element.value;\n\t\t\t\tif (timer) {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t}\n\t\t\t\ttimer = setTimeout(function() {\n\t\t\t\t\ttooltip.classList.add(CLASS_HIDDEN);\n\t\t\t\t}, 1000);\n\t\t\t};\n\t\t\telement.addEventListener('input', showTip);\n\t\t\telement.addEventListener('tap', showTip);\n\t\t\telement.addEventListener($.EVENT_MOVE, function(e) {\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\t\t} else {\n\t\t\tif (this.clearActionClass) {\n\t\t\t\tvar action = this.clearAction;\n\t\t\t\tif (!action) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$.each(['keyup', 'change', 'input', 'focus', 'cut', 'paste'], function(index, type) {\n\t\t\t\t\t(function(type) {\n\t\t\t\t\t\telement.addEventListener(type, function() {\n\t\t\t\t\t\t\taction.classList[element.value.trim() ? 'remove' : 'add'](CLASS_HIDDEN);\n\t\t\t\t\t\t});\n\t\t\t\t\t})(type);\n\t\t\t\t});\n\t\t\t\telement.addEventListener('blur', function() {\n\t\t\t\t\taction.classList.add(CLASS_HIDDEN);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (this.searchActionClass) {\n\t\t\t\telement.addEventListener('focus', function() {\n\t\t\t\t\telement.parentNode.classList.add('mui-active');\n\t\t\t\t});\n\t\t\t\telement.addEventListener('blur', function() {\n\t\t\t\t\tif (!element.value.trim()) {\n\t\t\t\t\t\telement.parentNode.classList.remove('mui-active');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\tInput.prototype.setPlaceholder = function(text) {\n\t\tif (this.searchActionClass) {\n\t\t\tvar placeholder = this.element.parentNode.querySelector(SELECTOR_PLACEHOLDER);\n\t\t\tplaceholder && (placeholder.getElementsByTagName('span')[1].innerText = text);\n\t\t} else {\n\t\t\tthis.element.setAttribute('placeholder', text);\n\t\t}\n\t};\n\tInput.prototype.passwordActionClick = function(event) {\n\t\tif (this.element.type === 'text') {\n\t\t\tthis.element.type = 'password';\n\t\t} else {\n\t\t\tthis.element.type = 'text';\n\t\t}\n\t\tthis.passwordAction.classList.toggle('mui-active');\n\t\tevent.preventDefault();\n\t};\n\tInput.prototype.clearActionClick = function(event) {\n\t\tvar self = this;\n\t\tself.element.value = '';\n\t\t$.focus(self.element);\n\t\tself.clearAction.classList.add(CLASS_HIDDEN);\n\t\tevent.preventDefault();\n\t};\n\tInput.prototype.speechActionClick = function(event) {\n\t\tif (window.plus) {\n\t\t\tvar self = this;\n\t\t\tvar oldValue = self.element.value;\n\t\t\tself.element.value = '';\n\t\t\tdocument.body.classList.add(CLASS_FOCUSIN);\n\t\t\tplus.speech.startRecognize({\n\t\t\t\tengine: 'iFly'\n\t\t\t}, function(s) {\n\t\t\t\tself.element.value += s;\n\t\t\t\t$.focus(self.element);\n\t\t\t\tplus.speech.stopRecognize();\n\t\t\t\t$.trigger(self.element, 'recognized', {\n\t\t\t\t\tvalue: self.element.value\n\t\t\t\t});\n\t\t\t\tif (oldValue !== self.element.value) {\n\t\t\t\t\t$.trigger(self.element, 'change');\n\t\t\t\t\t$.trigger(self.element, 'input');\n\t\t\t\t}\n\t\t\t\t// document.body.classList.remove(CLASS_FOCUSIN);\n\t\t\t}, function(e) {\n\t\t\t\tdocument.body.classList.remove(CLASS_FOCUSIN);\n\t\t\t});\n\t\t} else {\n\t\t\talert('only for 5+');\n\t\t}\n\t\tevent.preventDefault();\n\t};\n\t$.fn.input = function(options) {\n\t\tvar inputApis = [];\n\t\tthis.each(function() {\n\t\t\tvar inputApi = null;\n\t\t\tvar actions = [];\n\t\t\tvar row = findRow(this.parentNode);\n\t\t\tif (this.type === 'range' && row.classList.contains('mui-input-range')) {\n\t\t\t\tactions.push('slider');\n\t\t\t} else {\n\t\t\t\tvar classList = this.classList;\n\t\t\t\tif (classList.contains('mui-input-clear')) {\n\t\t\t\t\tactions.push('clear');\n\t\t\t\t}\n\t\t\t\tif (!($.os.android && $.os.stream) && classList.contains('mui-input-speech')) {\n\t\t\t\t\tactions.push('speech');\n\t\t\t\t}\n\t\t\t\tif (classList.contains('mui-input-password')) {\n\t\t\t\t\tactions.push('password');\n\t\t\t\t}\n\t\t\t\tif (this.type === 'search' && row.classList.contains('mui-search')) {\n\t\t\t\t\tactions.push('search');\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar id = this.getAttribute('data-input-' + actions[0]);\n\t\t\tif (!id) {\n\t\t\t\tid = ++$.uuid;\n\t\t\t\tinputApi = $.data[id] = new Input(this, {\n\t\t\t\t\tactions: actions.join(',')\n\t\t\t\t});\n\t\t\t\tfor (var i = 0, len = actions.length; i < len; i++) {\n\t\t\t\t\tthis.setAttribute('data-input-' + actions[i], id);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tinputApi = $.data[id];\n\t\t\t}\n\t\t\tinputApis.push(inputApi);\n\t\t});\n\t\treturn inputApis.length === 1 ? inputApis[0] : inputApis;\n\t};\n\t$.ready(function() {\n\t\t$('.mui-input-row input').input();\n\t});\n})(mui, window, document);\n(function($, window) {\n    var CLASS_ACTIVE = 'mui-active';\n    var rgbaRegex = /^rgba\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d*(?:\\.\\d+)?)\\)$/;\n    var getColor = function(colorStr) {\n        var matches = colorStr.match(rgbaRegex);\n        if (matches && matches.length === 5) {\n            return [\n                matches[1],\n                matches[2],\n                matches[3],\n                matches[4]\n            ];\n        }\n        return [];\n    };\n    var Transparent = function(element, options) {\n        this.element = element;\n        this.options = $.extend({\n            top: 0, //距离顶部高度(到达该高度即触发)\n            offset: 150, //滚动透明距离\n            duration: 16, //过渡时间\n            scrollby: window//监听滚动距离容器\n        }, options || {});\n\n        this.scrollByElem = this.options.scrollby || window;\n        if (!this.scrollByElem) {\n            throw new Error(\"监听滚动的元素不存在\");\n        }\n        this.isNativeScroll = false;\n        if (this.scrollByElem === window) {\n            this.isNativeScroll = true;\n        } else if (!~this.scrollByElem.className.indexOf('mui-scroll-wrapper')) {\n            this.isNativeScroll = true;\n        }\n\n        this._style = this.element.style;\n        this._bgColor = this._style.backgroundColor;\n        var color = getColor(mui.getStyles(this.element, 'backgroundColor'));\n        if (color.length) {\n            this._R = color[0];\n            this._G = color[1];\n            this._B = color[2];\n            this._A = parseFloat(color[3]);\n            this.lastOpacity = this._A;\n            this._bufferFn = $.buffer(this.handleScroll, this.options.duration, this);\n            this.initEvent();\n        } else {\n            throw new Error(\"元素背景颜色必须为RGBA\");\n        }\n    };\n\n    Transparent.prototype.initEvent = function() {\n        this.scrollByElem.addEventListener('scroll', this._bufferFn);\n        if (this.isNativeScroll) { //原生scroll\n            this.scrollByElem.addEventListener($.EVENT_MOVE, this._bufferFn);\n        }\n    }\n    Transparent.prototype.handleScroll = function(e) {\n        var y = window.scrollY;\n        if (!this.isNativeScroll && e && e.detail) {\n            y = -e.detail.y;\n        }\n        var opacity = (y - this.options.top) / this.options.offset + this._A;\n        opacity = Math.min(Math.max(this._A, opacity), 1);\n        this._style.backgroundColor = 'rgba(' + this._R + ',' + this._G + ',' + this._B + ',' + opacity + ')';\n        if (opacity > this._A) {\n            this.element.classList.add(CLASS_ACTIVE);\n        } else {\n            this.element.classList.remove(CLASS_ACTIVE);\n        }\n        if (this.lastOpacity !== opacity) {\n            $.trigger(this.element, 'alpha', {\n                alpha: opacity\n            });\n            this.lastOpacity = opacity;\n        }\n    };\n    Transparent.prototype.destory = function() {\n        this.scrollByElem.removeEventListener('scroll', this._bufferFn);\n        this.scrollByElem.removeEventListener($.EVENT_MOVE, this._bufferFn);\n        this.element.style.backgroundColor = this._bgColor;\n        this.element.mui_plugin_transparent = null;\n    };\n    $.fn.transparent = function(options) {\n        options = options || {};\n        var transparentApis = [];\n        this.each(function() {\n            var transparentApi = this.mui_plugin_transparent;\n            if (!transparentApi) {\n                var top = this.getAttribute('data-top');\n                var offset = this.getAttribute('data-offset');\n                var duration = this.getAttribute('data-duration');\n                var scrollby = this.getAttribute('data-scrollby');\n                if (top !== null && typeof options.top === 'undefined') {\n                    options.top = top;\n                }\n                if (offset !== null && typeof options.offset === 'undefined') {\n                    options.offset = offset;\n                }\n                if (duration !== null && typeof options.duration === 'undefined') {\n                    options.duration = duration;\n                }\n                if (scrollby !== null && typeof options.scrollby === 'undefined') {\n                    options.scrollby = document.querySelector(scrollby) || window;\n                }\n                transparentApi = this.mui_plugin_transparent = new Transparent(this, options);\n            }\n            transparentApis.push(transparentApi);\n        });\n        return transparentApis.length === 1 ? transparentApis[0] : transparentApis;\n    };\n    $.ready(function() {\n        $('.mui-bar-transparent').transparent();\n    });\n})(mui, window);\n/**\n * 数字输入框\n * varstion 1.0.1\n * by Houfeng\n * Houfeng@DCloud.io\n */\n\n(function($) {\n\n    var touchSupport = ('ontouchstart' in document);\n    var tapEventName = touchSupport ? 'tap' : 'click';\n    var changeEventName = 'change';\n    var holderClassName = 'mui-numbox';\n    var plusClassSelector = '.mui-btn-numbox-plus,.mui-numbox-btn-plus';\n    var minusClassSelector = '.mui-btn-numbox-minus,.mui-numbox-btn-minus';\n    var inputClassSelector = '.mui-input-numbox,.mui-numbox-input';\n\n    var Numbox = $.Numbox = $.Class.extend({\n        /**\n         * 构造函数\n         **/\n        init: function(holder, options) {\n            var self = this;\n            if (!holder) {\n                throw \"构造 numbox 时缺少容器元素\";\n            }\n            self.holder = holder;\n            options = options || {};\n            options.step = parseInt(options.step || 1);\n            self.options = options;\n            self.input = $.qsa(inputClassSelector, self.holder)[0];\n            self.plus = $.qsa(plusClassSelector, self.holder)[0];\n            self.minus = $.qsa(minusClassSelector, self.holder)[0];\n            self.checkValue();\n            self.initEvent();\n        },\n        /**\n         * 初始化事件绑定\n         **/\n        initEvent: function() {\n            var self = this;\n            self.plus.addEventListener(tapEventName, function(event) {\n                var val = parseInt(self.input.value) + self.options.step;\n                self.input.value = val.toString();\n                $.trigger(self.input, changeEventName, null);\n            });\n            self.minus.addEventListener(tapEventName, function(event) {\n                var val = parseInt(self.input.value) - self.options.step;\n                self.input.value = val.toString();\n                $.trigger(self.input, changeEventName, null);\n            });\n            self.input.addEventListener(changeEventName, function(event) {\n                self.checkValue();\n                var val = parseInt(self.input.value);\n                //触发顶层容器\n                $.trigger(self.holder, changeEventName, {\n                    value: val\n                });\n            });\n        },\n        /**\n         * 获取当前值\n         **/\n        getValue: function() {\n            var self = this;\n            return parseInt(self.input.value);\n        },\n        /**\n         * 验证当前值是法合法\n         **/\n        checkValue: function() {\n            var self = this;\n            var val = self.input.value;\n            if (val == null || val == '' || isNaN(val)) {\n                self.input.value = self.options.min || 0;\n                self.minus.disabled = self.options.min != null;\n            } else {\n                var val = parseInt(val);\n                if (self.options.max != null && !isNaN(self.options.max) && val >= parseInt(self.options.max)) {\n                    val = self.options.max;\n                    self.plus.disabled = true;\n                } else {\n                    self.plus.disabled = false;\n                }\n                if (self.options.min != null && !isNaN(self.options.min) && val <= parseInt(self.options.min)) {\n                    val = self.options.min;\n                    self.minus.disabled = true;\n                } else {\n                    self.minus.disabled = false;\n                }\n                self.input.value = val;\n            }\n        },\n        /**\n         * 更新选项\n         **/\n        setOption: function(name, value) {\n            var self = this;\n            self.options[name] = value;\n        },\n        /**\n         * 动态设置新值\n         **/\n        setValue: function(value) {\n            this.input.value = value;\n            this.checkValue();\n        }\n    });\n\n    $.fn.numbox = function(options) {\n        var instanceArray = [];\n        //遍历选择的元素\n        this.each(function(i, element) {\n            if (element.numbox) {\n                return;\n            }\n            if (options) {\n                element.numbox = new Numbox(element, options);\n            } else {\n                var optionsText = element.getAttribute('data-numbox-options');\n                var options = optionsText ? JSON.parse(optionsText) : {};\n                options.step = element.getAttribute('data-numbox-step') || options.step;\n                options.min = element.getAttribute('data-numbox-min') || options.min;\n                options.max = element.getAttribute('data-numbox-max') || options.max;\n                element.numbox = new Numbox(element, options);\n            }\n        });\n        return this[0] ? this[0].numbox : null;\n    }\n\n    //自动处理 class='mui-locker' 的 dom\n    $.ready(function() {\n        $('.' + holderClassName).numbox();\n    });\n\n}(mui));\n/**\n * Button\n * @param {type} $\n * @param {type} window\n * @param {type} document\n * @returns {undefined}\n */\n(function($, window, document) {\n    var CLASS_ICON = 'mui-icon';\n    var CLASS_DISABLED = 'mui-disabled';\n\n    var STATE_RESET = 'reset';\n    var STATE_LOADING = 'loading';\n\n    var defaultOptions = {\n        loadingText: 'Loading...', //文案\n        loadingIcon: 'mui-spinner' + ' ' + 'mui-spinner-white', //图标，可为空\n        loadingIconPosition: 'left' //图标所处位置，仅支持left|right\n    };\n\n    var Button = function(element, options) {\n        this.element = element;\n        this.options = $.extend({}, defaultOptions, options);\n        if (!this.options.loadingText) {\n            this.options.loadingText = defaultOptions.loadingText;\n        }\n        if (this.options.loadingIcon === null) {\n            this.options.loadingIcon = 'mui-spinner';\n            if ($.getStyles(this.element, 'color') === 'rgb(255, 255, 255)') {\n                this.options.loadingIcon += ' ' + 'mui-spinner-white';\n            }\n        }\n        this.isInput = this.element.tagName === 'INPUT';\n        this.resetHTML = this.isInput ? this.element.value : this.element.innerHTML;\n        this.state = '';\n    };\n    Button.prototype.loading = function() {\n        this.setState(STATE_LOADING);\n    };\n    Button.prototype.reset = function() {\n        this.setState(STATE_RESET);\n    };\n    Button.prototype.setState = function(state) {\n        if (this.state === state) {\n            return false;\n        }\n        this.state = state;\n        if (state === STATE_RESET) {\n            this.element.disabled = false;\n            this.element.classList.remove(CLASS_DISABLED);\n            this.setHtml(this.resetHTML);\n        } else if (state === STATE_LOADING) {\n            this.element.disabled = true;\n            this.element.classList.add(CLASS_DISABLED);\n            var html = this.isInput ? this.options.loadingText : ('<span>' + this.options.loadingText + '</span>');\n            if (this.options.loadingIcon && !this.isInput) {\n                if (this.options.loadingIconPosition === 'right') {\n                    html += '&nbsp;<span class=\"' + this.options.loadingIcon + '\"></span>';\n                } else {\n                    html = '<span class=\"' + this.options.loadingIcon + '\"></span>&nbsp;' + html;\n                }\n            }\n            this.setHtml(html);\n        }\n    };\n    Button.prototype.setHtml = function(html) {\n        if (this.isInput) {\n            this.element.value = html;\n        } else {\n            this.element.innerHTML = html;\n        }\n    }\n    $.fn.button = function(state) {\n        var buttonApis = [];\n        this.each(function() {\n            var buttonApi = this.mui_plugin_button;\n            if (!buttonApi) {\n                var loadingText = this.getAttribute('data-loading-text');\n                var loadingIcon = this.getAttribute('data-loading-icon');\n                var loadingIconPosition = this.getAttribute('data-loading-icon-position');\n                this.mui_plugin_button = buttonApi = new Button(this, {\n                    loadingText: loadingText,\n                    loadingIcon: loadingIcon,\n                    loadingIconPosition: loadingIconPosition\n                });\n            }\n            if (state === STATE_LOADING || state === STATE_RESET) {\n                buttonApi.setState(state);\n            }\n            buttonApis.push(buttonApi);\n        });\n        return buttonApis.length === 1 ? buttonApis[0] : buttonApis;\n    };\n})(mui, window, document);"]}]}